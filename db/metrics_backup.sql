-- Kiingo Command Center: Metrics DB Backup
-- Auto-generated by scripts/export_metrics_db.py
-- Re-run or let the pre-commit hook regenerate this file.

-- ============================================
-- Metric Definitions
-- ============================================

INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('19872d77-f92e-4f7b-8079-b4413a2447d9', 'Accelerator Program', 'accelerator-overview', 'Track the Accelerator program — advanced cohort for graduates of bootcamps and champion groups.

## Data Sources
- HubSpot: Search deals with "accelerator" in dealname
- TalentLMS: Enrollment data for advanced courses

## Retrieval Steps
1. HubSpot: `hubspot.searchAllDeals({ properties: [''dealname'',''amount'',''dealstage'',''closedate''], filterGroups: [] })` — filter deals containing "accelerator".
2. TalentLMS: `talentlms.getCourses({})` — find accelerator-related courses.

## Values to Return
- `deals`: accelerator deal list
- `totalEnrolled`: current enrollment
- `targetEnrolled`: target enrollment
- `revenue`: total accelerator revenue', '', 259200, 'kiingo-mcp', NULL, NULL, 1, 0, '{"aliases":["accelerator","accel program"]}', '2026-02-15T16:50:18+00:00', '2026-02-15T16:50:18+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('9e73074d-654f-40fc-a53c-5c571ba309e6', 'Active Client Projects', 'active-client-projects', 'Track active client engagement projects from Asana.

## Data Source
Asana Projects via Kiingo MCP.

## Retrieval Steps
1. Search Asana projects matching client project patterns (Bootcamp, Consulting, etc.).
2. Filter to non-archived, active projects.
3. For each project, determine: client name, engagement type, status, progress.
4. Sort by status: Active first, then Setup, then Scoping.

## Values to Return
- `clientProjects`: array of { client, type, status, sessions }
- `activeCount`: number of active projects
- `totalRevenue`: estimated revenue from active projects (if deal amounts available)', '(() => {
  const data = DATA_PLACEHOLDER;
  const active = data.filter(d => d.status === ''Active'').length;
  return (
    <MetricSection>
      <MetricRow>
        <StatCard label="Active Projects" value={active} subtitle="In delivery" />
        <StatCard label="Total Projects" value={data.length} subtitle="All stages" />
      </MetricRow>
      <div style={{ marginTop: 8 }}>
        {data.map((d, i) => (
          <div key={i} style={{ display: ''flex'', alignItems: ''center'', gap: 12, padding: ''8px 12px'', background: i % 2 === 0 ? theme.panel : ''transparent'', borderRadius: 8 }}>
            <span style={{ flex: 1, color: theme.ink, fontSize: 13, fontWeight: 600 }}>{d.client}</span>
            <span style={{ color: theme.inkMuted, fontSize: 12, minWidth: 120 }}>{d.type}</span>
            <span style={{ fontSize: 11, padding: ''2px 8px'', borderRadius: 4, background: d.status === ''Active'' ? theme.accent : theme.line, color: d.status === ''Active'' ? ''#fff'' : theme.ink }}>{d.status}</span>
            <span style={{ color: theme.inkMuted, fontSize: 12, minWidth: 40 }}>{d.sessions}</span>
          </div>
        ))}
      </div>
      <MetricNote>Source: Asana Projects via Kiingo MCP</MetricNote>
    </MetricSection>
  );
})()', 259200, 'claude', NULL, NULL, 1, 0, '{"aliases":["client projects","active projects"]}', '2026-02-15T06:34:11+00:00', '2026-02-15T06:34:11+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('2f101d3a-eae6-4007-b7d5-ab3547f07be1', 'AI Resources Pipeline', 'ai-resource-pipeline', 'Track the pipeline for Path 2 offerings: Managed AI, Resource Vault, Software, Consulting, and Agent Bootcamps.

## Data Sources
- HubSpot: Deal pipelines for Managed AI (796859524), Resource Vault (796172413), Software (808730244), Consulting (93956100)
- Asana: AI Consulting Engagements project tasks

## Retrieval Steps
1. HubSpot: For each pipeline, `hubspot.searchAllDeals({ filterGroups: [{ filters: [{ propertyName: ''pipeline'', operator: ''EQ'', value: ''<pipelineId>'' }] }], properties: [''dealname'',''amount'',''dealstage''] })`.
2. Count deals by stage for each pipeline.

## Values to Return
- `pipelines`: array of { name, deals, value, stages }
- `totalPipeline`: total open value
- `totalDeals`: total active deals', '', 259200, 'kiingo-mcp', NULL, NULL, 1, 0, '{"aliases":["ai pipeline","ai resources"]}', '2026-02-15T16:50:18+00:00', '2026-02-15T16:50:18+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('6ca5270a-b1c7-4646-bc2f-f0e0d78e61f0', 'Bootcamp Delivery Volume', 'bootcamp-delivery-volume', 'Track bootcamp delivery volume over time — closed-won bootcamp deals by month and type, showing scaling trajectory.

## Data Source
Kiingo PostgreSQL database → `crm_deal` table

## Retrieval Steps

### Step 1: Monthly won deals
Get closed-won bootcamp deals grouped by month. Use whichever date field is populated — prefer `actualCloseDate`, fall back to `dateOpened`.

```typescript
import { sql } from ''tools'';
const monthly = await sql.query({
  database: ''kiingo'',
  sql: `
    SELECT
      TO_CHAR(COALESCE("actualCloseDate", "dateOpened"), ''YYYY-MM'') as month,
      COUNT(*) as deals_won
    FROM crm_deal
    WHERE "isWon" = true
      AND ("dealType" ILIKE ''%bootcamp%'' OR "dealType" ILIKE ''%foundational%'')
      AND COALESCE("actualCloseDate", "dateOpened") >= ''2024-09-01''
    GROUP BY 1
    ORDER BY 1
  `
});
```

### Step 2: Breakdown by type
```typescript
const byType = await sql.query({
  database: ''kiingo'',
  sql: `
    SELECT
      TO_CHAR(COALESCE("actualCloseDate", "dateOpened"), ''YYYY-MM'') as month,
      CASE
        WHEN "dealType" ILIKE ''%private%foundational%'' THEN ''Private''
        WHEN "dealType" ILIKE ''%ai foundational%'' THEN ''AI Foundational''
        WHEN "dealType" ILIKE ''%agents%'' THEN ''AI Agents''
        WHEN "dealType" ILIKE ''%specialized%'' THEN ''Specialized''
        ELSE ''Other''
      END as type,
      COUNT(*) as cnt
    FROM crm_deal
    WHERE "isWon" = true
      AND ("dealType" ILIKE ''%bootcamp%'' OR "dealType" ILIKE ''%foundational%'')
      AND COALESCE("actualCloseDate", "dateOpened") >= ''2024-09-01''
    GROUP BY 1, 2
    ORDER BY 1
  `
});
```

### Step 3: Totals and growth
```typescript
const totals = await sql.query({
  database: ''kiingo'',
  sql: `
    SELECT
      COUNT(*) as total_won,
      COUNT(DISTINCT
        CASE
          WHEN "dealType" ILIKE ''%private%foundational%'' THEN "dealType" || ''-'' || "crmCompanyId"
          ELSE "dealType" || ''-'' || TO_CHAR(COALESCE("actualCloseDate", "dateOpened"), ''YYYY-MM-DD'')
        END
      ) as approx_cohorts,
      COUNT(DISTINCT "crmCompanyId") as unique_companies
    FROM crm_deal
    WHERE "isWon" = true
      AND ("dealType" ILIKE ''%bootcamp%'' OR "dealType" ILIKE ''%foundational%'')
  `
});
```

### Step 4: Structure the data

For `monthlyData`, convert month strings to short labels (e.g. "2024-09" → "Sep ''24", "2025-06" → "Jun ''25"). Each entry: { month, won }.

For `monthlyByType`, pivot the type breakdown so each month has fields for each type count. Each entry: { month, private, foundational, agents, specialized }.

For growth calculation: compare the last 3 months'' total to the first 3 months'' total to get a growth multiple.

## Values to Return
- `totalWon`: number (all-time closed-won bootcamp deals)
- `uniqueCompanies`: number
- `growthMultiple`: number (rounded to 1 decimal)
- `lastMonthWon`: number (most recent complete month)
- `monthlyData`: array of { month, won }
- `monthlyByType`: array of { month, private, foundational, agents, specialized }
', '(() => {
  const totalWon = TOTAL_WON_PLACEHOLDER;
  const uniqueCompanies = UNIQUE_COMPANIES_PLACEHOLDER;
  const growthMultiple = GROWTH_MULTIPLE_PLACEHOLDER;
  const lastMonthWon = LAST_MONTH_WON_PLACEHOLDER;
  const monthlyData = MONTHLY_DATA_PLACEHOLDER;
  const monthlyByType = MONTHLY_BY_TYPE_PLACEHOLDER;

  return (
    <MetricSection>
      <MetricRow>
        <StatCard label={''Deals Won''} value={totalWon} subtitle={''All bootcamp types''} />
        <StatCard label={''Unique Companies''} value={uniqueCompanies} subtitle={''Distinct clients''} />
        <StatCard label={''Growth''} value={growthMultiple + ''x''} subtitle={''First 3mo → last 3mo''} />
        <StatCard label={''Last Month''} value={lastMonthWon} subtitle={''Deals closed''} />
      </MetricRow>

      <div style={{ height: 280, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Monthly Bootcamp Deals Won</div>
        <ResponsiveContainer width="100%" height="90%">
          <AreaChart data={monthlyData} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <defs>
              <linearGradient id="bootcampVolGrad" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stopColor={theme.accent} stopOpacity={0.2} />
                <stop offset="100%" stopColor={theme.accent} stopOpacity={0.02} />
              </linearGradient>
            </defs>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="month" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <Area type="monotone" dataKey="won" name="Deals Won" stroke={theme.accent} strokeWidth={2} fill="url(#bootcampVolGrad)" dot={{ fill: theme.accent, r: 3 }} />
          </AreaChart>
        </ResponsiveContainer>
      </div>

      <div style={{ height: 280, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 16 }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>By Bootcamp Type</div>
        <ResponsiveContainer width="100%" height="90%">
          <BarChart data={monthlyByType} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="month" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <Legend />
            <Bar dataKey="foundational" name="AI Foundational" stackId="a" fill={theme.accent} />
            <Bar dataKey="private" name="Private" stackId="a" fill={theme.secondary} />
            <Bar dataKey="agents" name="AI Agents" stackId="a" fill="#eab308" />
            <Bar dataKey="specialized" name="Specialized" stackId="a" fill="#16a34a" radius={[4, 4, 0, 0]} />
          </BarChart>
        </ResponsiveContainer>
      </div>

      <MetricNote>Source: Kiingo CRM · Closed-won bootcamp deals · Sep 2024 - present</MetricNote>
    </MetricSection>
  );
})()', 86400, 'claude', NULL, NULL, 1, 0, '{"aliases": ["bootcamp volume", "bootcamp delivery", "bootcamp growth", "bootcamp deals won"]}', '2026-02-19T01:15:02+00:00', '2026-02-19T01:15:02+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('381bed73-c1db-4f66-bf31-30a470890988', 'Bootcamp Learner Engagement', 'bootcamp-learner-engagement', 'Track bootcamp learner engagement from TalentLMS — total learners, active courses, and recent login activity.

## Data Source
TalentLMS portal: kiingo.talentlms.com

## Retrieval Steps

### Step 1: Get portal statistics
```typescript
import { talentlms } from ''tools'';
const stats = await talentlms.getStatistics({ portalHost: ''kiingo.talentlms.com'' });
```
Extract: total_users, total_courses, total_groups

### Step 2: Count active vs completed courses
```typescript
const allCourses = [];
let page = 1;
while (page <= 5) {
  const c = await talentlms.listCourses({ portalHost: ''kiingo.talentlms.com'', limit: 100, page });
  if (!c.items || c.items.length === 0) break;
  allCourses.push(...c.items);
  if (c.items.length < 100) break;
  page++;
}
```
Deduplicate courses by ID. Count courses with status "active" vs "inactive".
Active courses = currently running cohorts. Inactive = completed.
Extract active course names for display.

### Step 3: Get recent login activity
```typescript
const timeline = await talentlms.listTimeline({ portalHost: ''kiingo.talentlms.com'', limit: 100 });
```
Count unique users who logged in today (matching today''s date).
Count unique users who logged in in the last 7 days.
Group logins by day for the last 7 days to show daily activity trend.

### Step 4: Structure the data

For `activeCourses`, list each active course name.

For `dailyLogins`, create an array of the last 7 days with { day (short label like "Mon", "Tue"), logins (unique user count) }.

## Values to Return
- `totalLearners`: number (total_users from stats)
- `totalCourses`: number (total_courses from stats)
- `activeCourses`: number (count of active-status courses)
- `completedCourses`: number (count of inactive-status courses)
- `totalGroups`: number (total_groups from stats)
- `activeCourseNames`: array of strings
- `loginsToday`: number
- `loginsWeek`: number
- `dailyLogins`: array of { day, logins }
', '(() => {
  const totalLearners = TOTAL_LEARNERS_PLACEHOLDER;
  const activeCourses = ACTIVE_COURSES_PLACEHOLDER;
  const completedCourses = COMPLETED_COURSES_PLACEHOLDER;
  const totalGroups = TOTAL_GROUPS_PLACEHOLDER;
  const activeCourseNames = ACTIVE_COURSE_NAMES_PLACEHOLDER;
  const loginsToday = LOGINS_TODAY_PLACEHOLDER;
  const loginsWeek = LOGINS_WEEK_PLACEHOLDER;
  const dailyLogins = DAILY_LOGINS_PLACEHOLDER;

  return (
    <MetricSection>
      <MetricRow>
        <StatCard label={''Total Learners''} value={totalLearners.toLocaleString()} subtitle={''All-time enrolled''} />
        <StatCard label={''Active Cohorts''} value={activeCourses} subtitle={completedCourses + '' completed''} />
        <StatCard label={''Logins Today''} value={loginsToday} subtitle={''Unique learners''} />
        <StatCard label={''Logins This Week''} value={loginsWeek} subtitle={''7-day unique''} />
      </MetricRow>

      <div style={{ height: 220, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Daily Login Activity (Last 7 Days)</div>
        <ResponsiveContainer width="100%" height="85%">
          <BarChart data={dailyLogins} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="day" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <Bar dataKey="logins" name="Unique Logins" fill={theme.accent} radius={[4, 4, 0, 0]} />
          </BarChart>
        </ResponsiveContainer>
      </div>

      {activeCourseNames.length > 0 && (
        <div style={{ background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 16 }}>
          <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 12, color: theme.ink }}>Active Courses</div>
          <div style={{ display: ''flex'', flexWrap: ''wrap'', gap: 8 }}>
            {activeCourseNames.map((name, i) => (
              <div key={i} style={{ padding: ''6px 14px'', borderRadius: 20, background: theme.accent + ''22'', color: theme.accent, fontSize: 12, fontWeight: 600, border: ''1px solid '' + theme.accent + ''44'' }}>{name}</div>
            ))}
          </div>
        </div>
      )}

      <MetricNote>Source: TalentLMS · kiingo.talentlms.com · {totalGroups} groups</MetricNote>
    </MetricSection>
  );
})()', 43200, 'claude', NULL, NULL, 1, 0, '{"aliases": ["learner engagement", "talentlms", "bootcamp learners", "lms activity"]}', '2026-02-19T01:15:02+00:00', '2026-02-19T01:15:02+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('be990667-9109-4750-a752-208ac1f58e84', 'Bootcamp Operations', 'bootcamp-operations', 'Track bootcamp course activity and enrollment from TalentLMS.

## Data Source
TalentLMS via `talentlms.getCourses()` and `talentlms.getUsers()`.

## Retrieval Steps
1. Get all courses: `talentlms.getCourses()`. Filter to active courses (status === ''active'').
2. For active courses, get enrollment counts.
3. Categorize courses: date-based cohort bootcamps, company bootcamps, Vistage, async content.
4. Get total users: `talentlms.getUsers({ limit: 100 })`. Count by user type.
5. Compute: total active courses, total enrolled, completion rate if available.

## Values to Return
- `activeCourses`: number of active courses
- `totalCourses`: total courses ever created
- `cohortBootcamps`: number of date-based cohort bootcamps
- `companyBootcamps`: number of company-specific bootcamps
- `totalEnrolled`: total user enrollment across active courses
- `courseList`: array of { name, enrolled, status } for active courses', '(() => {
  const active = ACTIVE_PLACEHOLDER;
  const total = TOTAL_PLACEHOLDER;
  const cohorts = COHORT_PLACEHOLDER;
  const company = COMPANY_PLACEHOLDER;
  return (
    <MetricSection>
      <MetricRow>
        <StatCard label="Active Courses" value={active} subtitle="Currently running" />
        <StatCard label="Total Courses" value={total} subtitle="All time" />
      </MetricRow>
      <MetricRow>
        <StatCard label="Cohort Bootcamps" value={cohorts} subtitle="Date-based" />
        <StatCard label="Company Bootcamps" value={company} subtitle="Custom" />
      </MetricRow>
    </MetricSection>
  );
})()', 259200, 'claude', NULL, NULL, 1, 0, '{"aliases":["bootcamp ops","bootcamp"]}', '2026-02-15T06:29:29+00:00', '2026-02-15T06:29:29+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('fca4c412-05b2-44e4-b523-cc3947b52328', 'Bootcamp Pipeline', 'bootcamp-pipeline', 'Track bootcamp delivery pipeline: upcoming, active, and completed bootcamps.

## Data Sources
- Asana: bootcamp projects for delivery status
- TalentLMS: course enrollment and completion data
- HubSpot: bootcamp deal pipeline for revenue

## Retrieval Steps
1. Search Asana projects matching "Bootcamp" pattern.
2. Get TalentLMS courses via `talentlms.getCourses()`. Filter active bootcamp courses.
3. Search HubSpot deals in bootcamp pipelines (''796531479'' Bootcamp, ''797119779'' Private Bootcamp).
4. Merge data: project status from Asana, enrollment from TalentLMS, revenue from HubSpot.

## Values to Return
- `activeBootcamps`: number of currently running bootcamps
- `upcomingBootcamps`: in setup or scheduled
- `completedBootcamps`: finished in last 12 months
- `totalParticipants`: total enrolled across active courses
- `bootcampRevenue`: total revenue from bootcamp deals (LTM)', '(() => {
  const active = ACTIVE_PLACEHOLDER;
  const upcoming = UPCOMING_PLACEHOLDER;
  const completed = COMPLETED_PLACEHOLDER;
  const participants = PARTICIPANTS_PLACEHOLDER;
  const revenue = REVENUE_PLACEHOLDER;
  return (
    <MetricSection>
      <MetricRow>
        <StatCard label="Active" value={active} subtitle="Running now" />
        <StatCard label="Upcoming" value={upcoming} subtitle="In setup" />
        <StatCard label="Completed (LTM)" value={completed} subtitle="Last 12 months" />
      </MetricRow>
      <MetricRow>
        <StatCard label="Total Participants" value={participants} subtitle="Active courses" />
        <StatCard label="Bootcamp Revenue" value={''$'' + (revenue / 1000).toFixed(0) + ''K''} subtitle="LTM" />
      </MetricRow>
    </MetricSection>
  );
})()', 259200, 'claude', NULL, NULL, 1, 0, '{"aliases":["bootcamp funnel","bootcamp leads"]}', '2026-02-15T06:34:11+00:00', '2026-02-15T06:34:11+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('55d47cfc-5648-4fa7-be79-7ff67d7115d3', 'Cash & Collections', 'cash-collections-summary', 'Retrieve cash position, AR balance, and collection rate from QuickBooks.

## Data Sources
- QuickBooks Balance Sheet: `quickbooks.balanceSheet({ params: { start_date: ''<month start>'', end_date: ''<today>'' } })` — extract Total Bank Accounts (cash) and Accounts Receivable.
- QuickBooks Invoices: `quickbooks.query({ query: "SELECT TotalAmt, Balance FROM Invoice WHERE TxnDate >= ''<12mo ago>''", maxResults: 1000 })` — compute collection rate as (sum of TotalAmt - Balance) / sum of TotalAmt.

## Values to Return
- `cashPosition`: total bank account balance
- `arBalance`: accounts receivable balance
- `collectionRate`: percentage of invoiced revenue collected
- `arAgingOver90`: AR balance over 90 days old (if available)', '(() => {
  const cash = CASH_PLACEHOLDER;
  const ar = AR_PLACEHOLDER;
  const rate = RATE_PLACEHOLDER;
  return (
    <MetricSection>
      <MetricRow>
        <StatCard label="Cash Position" value={''$'' + (cash / 1000).toFixed(0) + ''K''} subtitle="Bank accounts" />
        <StatCard label="Accounts Receivable" value={''$'' + (ar / 1000).toFixed(0) + ''K''} subtitle="Outstanding" />
      </MetricRow>
      <MetricRow>
        <StatCard label="Collection Rate" value={rate.toFixed(1) + ''%''} subtitle="LTM invoices" />
      </MetricRow>
    </MetricSection>
  );
})()', 259200, 'claude', NULL, NULL, 1, 0, '{"aliases":["cash","collections","accounts receivable","AR"]}', '2026-02-15T06:29:29+00:00', '2026-02-15T06:29:29+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('53ac482e-61fd-4faf-9cd2-829ea591372d', 'Cash Position & AR', 'cash-position-ar', 'Retrieve current cash position and accounts receivable from QuickBooks, with cash flow split by operating vs financing activities.

## Data Source
QuickBooks Online via Kiingo MCP `quickbooks.balanceSheet()` and `quickbooks.cashFlow()`.

## Retrieval Steps
1. Call `quickbooks.balanceSheet({ params: { start_date: ''<1st of current month>'', end_date: ''<today>'' } })`.
2. Parse the Rows tree. Find "Total Bank Accounts" for cash and "Total Accounts Receivable" for AR.
3. Call `quickbooks.cashFlow({ params: { start_date: ''<6 months ago>'', end_date: ''<last day of current month>'', summarize_column_by: ''Month'' } })`.
4. For each month column, extract:
   - "Net cash provided by operating activities" -> `operating`
   - "Net cash provided by financing activities" -> `financing`
   - "Net cash increase for period" -> `net`

## Values to Return
- `cash`: current cash balance
- `ar`: current accounts receivable
- `totalLiquid`: cash + AR
- `cashFlowByMonth`: array of { month, operating, financing, net } for last 6 months', '(() => {
  const cash = CASH_PLACEHOLDER;
  const ar = AR_PLACEHOLDER;
  const totalLiquid = TOTAL_PLACEHOLDER;
  const data = DATA_PLACEHOLDER;

  return (
    <MetricSection>
      <MetricRow>
        <StatCard label="Cash" value={''$'' + (cash / 1000).toFixed(0) + ''K''} subtitle="Bank accounts" />
        <StatCard label="Receivables" value={''$'' + (ar / 1000).toFixed(0) + ''K''} subtitle="Accounts receivable" />
        <StatCard label="Total Liquid" value={''$'' + (totalLiquid / 1000).toFixed(0) + ''K''} subtitle="Cash + AR" />
      </MetricRow>
      <div style={{ height: 200, background: theme.panel, borderRadius: 16, padding: 20, border: `1px solid ${theme.line}` }}>
        <ResponsiveContainer width="100%" height="100%">
          <BarChart data={data} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="month" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} tickFormatter={v => ''$'' + (v / 1000) + ''K''} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: `1px solid ${theme.tooltipBorder}`, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} formatter={v => ''$'' + Number(v).toLocaleString()} />
            <ReferenceLine y={0} stroke={theme.danger} strokeWidth={1} />
            <Bar dataKey="netCashFlow" name="Net Cash Flow" fill={theme.accent} radius={[4, 4, 0, 0]} />
          </BarChart>
        </ResponsiveContainer>
      </div>
      <MetricNote>Source: QuickBooks Balance Sheet + Cash Flow via Kiingo MCP</MetricNote>
    </MetricSection>
  );
})()', 259200, 'claude', NULL, NULL, 1, 0, '{"aliases":["cash position","AR","accounts receivable"]}', '2026-02-15T05:56:04.064862+00:00', '2026-02-15T07:00:00+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('eac7d43a-5003-48aa-9165-fc869d8597f2', 'CEO Pulse', 'ceo-pulse', 'Retrieve key company KPIs from multiple sources and display as stat cards.

## Data Sources
- QuickBooks: LTM revenue from invoices, net margin from P&L
- HubSpot: Open pipeline value and win rate from deals

## Retrieval Steps
1. QuickBooks: `quickbooks.query({ query: "SELECT TotalAmt FROM Invoice WHERE TxnDate >= ''<12mo ago>'' AND TxnDate <= ''<today>''", maxResults: 1000 })` — sum TotalAmt for LTM revenue.
2. QuickBooks: `quickbooks.profitAndLoss({ params: { start_date: ''<12mo ago>'', end_date: ''<today>'' } })` — extract Total Income and Net Income, compute net margin %.
3. HubSpot: Paginate `hubspot.listDeals({ limit: 100, properties: [''amount'',''dealstage'',''hs_is_closed'',''hs_is_closed_won''] })`. Count open deals (hs_is_closed !== ''true''), sum amounts. Count closed won vs total closed for win rate.
4. Compute trailing 3-month revenue average and MoM growth rate.

## Values to Return
- `ltmRevenue`: last 12 months invoiced total
- `openPipeline`: total open deal pipeline value
- `winRate`: close rate (closed won / total closed) as percentage
- `netMargin`: net income / revenue as percentage
- `momGrowth`: month-over-month revenue growth percentage
- `trailing3Avg`: trailing 3-month average revenue', '(() => {
  const ltmRevenue = LTM_REVENUE_PLACEHOLDER;
  const openPipeline = PIPELINE_PLACEHOLDER;
  const winRate = WIN_RATE_PLACEHOLDER;
  const netMargin = NET_MARGIN_PLACEHOLDER;
  return (
    <MetricSection>
      <MetricRow>
        <StatCard label="LTM Revenue" value={''$'' + (ltmRevenue / 1000).toFixed(0) + ''K''} subtitle="Invoiced (12 mo)" />
        <StatCard label="Open Pipeline" value={''$'' + (openPipeline / 1000).toFixed(0) + ''K''} subtitle="Active deals" />
        <StatCard label="Win Rate" value={winRate.toFixed(1) + ''%''} subtitle="Closed won / total" />
        <StatCard label="Net Margin" value={netMargin.toFixed(1) + ''%''} subtitle="LTM accrual" />
      </MetricRow>
    </MetricSection>
  );
})()', 259200, 'claude', NULL, NULL, 1, 0, '{"aliases":["pulse","executive summary","ceo dashboard"]}', '2026-02-15T06:29:29+00:00', '2026-02-15T06:29:29+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('8b8e898e-ae8d-474f-b9d5-28f0d86498e6', 'Champion Group Overview', 'champion-group-metrics', 'Track AI Champion Group membership, revenue, and growth.

## Data Sources
- HubSpot: Peer Group pipeline deals (pipeline ID 808343346)
- Asana: Rock 6 subtasks, Champions-related tasks

## Retrieval Steps
1. HubSpot: `hubspot.searchAllDeals({ filterGroups: [{ filters: [{ propertyName: ''pipeline'', operator: ''EQ'', value: ''808343346'' }] }], properties: [''dealname'',''amount'',''dealstage'',''closedate''] })` — get all Peer Group deals.
2. Asana: Search for tasks with "champion" or "peer group" text.
3. Compute total seats, MRR, growth trajectory.

## Values to Return
- `members`: array of { name, amount, status }
- `totalSeats`: current seat count
- `targetSeats`: Q1 target
- `mrr`: monthly recurring revenue from Champions
- `rockProgress`: Rock 6 completion percentage', '', 259200, 'kiingo-mcp', NULL, NULL, 1, 0, '{"aliases":["champions","champion group","champion metrics"]}', '2026-02-15T16:50:18+00:00', '2026-02-15T16:50:18+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('340f1b31-52a3-452b-a1f7-d589e6b2580a', 'Client Journey Funnel', 'client-journey-funnel', 'Track client progression through the Kiingo product journey.

## Data Sources
- HubSpot: Deal pipeline stages, company lifecycles
- Asana: Active client projects by type

## Journey Stages
1. Strategy Session → 2. AI Assessment → 3. Bootcamp (Foundational/Agents/Marketing)
4. Champion Group → 5. Accelerator → 6. AI Resources (Vault/Consulting/Managed AI)

## Retrieval Steps
1. HubSpot: Count deals by pipeline to get counts per journey stage.
2. Asana: Count active projects by type (consulting, peer group, bootcamp ops).
3. Compute conversion rates between stages.

## Values to Return
- `stages`: array of { name, count, value } for each journey stage
- `conversions`: array of { from, to, rate }
- `activeClients`: total unique clients in journey', '', 259200, 'kiingo-mcp', NULL, NULL, 1, 0, '{"aliases":["journey","client funnel","funnel"]}', '2026-02-15T16:50:18+00:00', '2026-02-15T16:50:18+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('73c56645-dedf-4bfb-af3b-a80bb8ef8ca0', 'Client Revenue & ROI', 'client-revenue-roi', 'Retrieve revenue per client and compute ROI metrics.

## Data Sources
- QuickBooks: Revenue by customer from invoices
- HubSpot: Deal values by company, lifecycle stages

## Retrieval Steps
1. QuickBooks: `quickbooks.query({ query: "SELECT CustomerRef, TotalAmt FROM Invoice WHERE TxnDate >= ''<6mo ago>'' ORDER BY TotalAmt DESC", maxResults: 500 })` — group by customer, sum revenue.
2. HubSpot: `hubspot.listCompanies({ properties: [''name'',''total_revenue'',''lifecyclestage''], limit: 100 })` — get lifecycle & engagement data.
3. Compute average revenue per client, identify top-10 by revenue, compute growth vs prior period.

## Values to Return
- `clients`: array of { name, revenue, dealCount, product } for top clients
- `totalClients`: number of active clients
- `avgRevenuePerClient`: average revenue per client
- `topClientRevenue`: revenue from top 5 clients', '', 259200, 'kiingo-mcp', NULL, NULL, 1, 0, '{"aliases":["client revenue","ROI","revenue roi"]}', '2026-02-15T16:50:18+00:00', '2026-02-15T16:50:18+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('93ba384c-b172-4072-9e74-c4705f38c349', 'Closed Won Revenue by Month', 'closed-won-monthly', 'Retrieve closed-won deals from HubSpot and display revenue by month.

## Data Source
HubSpot Deals via Kiingo MCP `hubspot.listDeals()`.

## Retrieval Steps
1. Paginate through ALL deals with `hubspot.listDeals({ limit: 100, properties: [''amount'', ''closedate'', ''pipeline'', ''hs_is_closed_won''], after })`.
2. Filter to closed-won deals (hs_is_closed_won === ''true'').
3. Group by close-date month. Sum amounts per month.
4. Compute current month total, best month, trailing average.

## Values to Return
- `monthlyData`: array of { month (short label), amount, count }
- `currentMonth`: amount closed this month
- `bestMonth`: { month, amount } - highest revenue month
- `trailingAvg`: average monthly closed-won over all months with data
- `totalWon`: total closed-won amount', '(() => {
  const data = DATA_PLACEHOLDER;
  const currentMonth = CURRENT_PLACEHOLDER;
  const bestMonth = BEST_PLACEHOLDER;
  const trailingAvg = AVG_PLACEHOLDER;

  return (
    <MetricSection>
      <MetricRow>
        <StatCard label="This Month" value={''$'' + (currentMonth / 1000).toFixed(0) + ''K''} subtitle="Closed won" />
        <StatCard label="Best Month" value={''$'' + (bestMonth / 1000).toFixed(0) + ''K''} subtitle="Peak" />
        <StatCard label="Monthly Avg" value={''$'' + (trailingAvg / 1000).toFixed(0) + ''K''} subtitle="Average" />
      </MetricRow>
      <div style={{ height: 280, background: theme.panel, borderRadius: 16, padding: 20, border: `1px solid ${theme.line}` }}>
        <ResponsiveContainer width="100%" height="100%">
          <BarChart data={data} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="month" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} tickFormatter={v => ''$'' + (v / 1000) + ''K''} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: `1px solid ${theme.tooltipBorder}`, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} formatter={v => ''$'' + Number(v).toLocaleString()} />
            <ReferenceLine y={trailingAvg} stroke={theme.line} strokeDasharray="6 4" />
            <Bar dataKey="amount" name="Closed Won" fill={theme.accent} radius={[4, 4, 0, 0]} />
          </BarChart>
        </ResponsiveContainer>
      </div>
      <MetricNote>HubSpot closed-won deals across all sales pipelines · Source: HubSpot CRM via Kiingo MCP</MetricNote>
    </MetricSection>
  );
})()', 259200, 'claude', NULL, NULL, 1, 0, '{"aliases":["closed won","won deals","monthly closed"]}', '2026-02-15T05:56:04.064862+00:00', '2026-02-15T05:56:04.064862+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('95795ece-97c3-4fef-987a-67f543b85c8d', 'Cohort Completion Velocity', 'cohort-completion-velocity', 'Track bootcamp cohort completion velocity — how many cohorts are delivered each month, derived from the Asana AI Bootcamp Ops board''s Completed section.

## Data Source
Asana → "AI Bootcamp Ops" project (GID: 1208309967533974) → "Completed" section (GID: 1208545310165812)

Each task in the Completed section represents a finished bootcamp cohort. The `completed_at` timestamp indicates when it was marked done.

## Retrieval Steps

### Step 1: Get all completed cohort tasks
```typescript
import { asana } from ''tools'';
const completed = await asana.getTasksForSection({
  sectionGid: ''1208545310165812'',
  opt_fields: [''name'',''assignee.name'',''completed_at'']
});
```

### Step 2: Group by completion month
Parse the `completed_at` field (ISO datetime) to extract the year-month. Group tasks by month and count completions.

Convert month strings to short labels: "2025-01" → "Jan ''25", "2026-02" → "Feb ''26".

Sort chronologically.

### Step 3: Calculate velocity stats
- `totalCompleted`: total number of completed cohorts
- `avgPerMonth`: average completions per month (total / number of months with data)
- `lastMonthCount`: completions in the most recent complete month
- `peakMonth`: the month with the highest count and its value
- `trend`: compare last 3 months'' average to the 3 months before that — "accelerating" if higher, "decelerating" if lower, "steady" if within 20%

### Step 4: Breakdown by instructor
Group completed cohorts by assignee name. For each instructor: { name, completed }. Sort by count descending. Exclude "unassigned".

## Values to Return
- `monthlyData`: array of { month, completed }
- `totalCompleted`: number
- `avgPerMonth`: number (rounded to 1 decimal)
- `lastMonthCount`: number
- `peakMonth`: string (e.g. "May ''25")
- `peakCount`: number
- `trend`: "accelerating" | "decelerating" | "steady"
- `byInstructor`: array of { name, completed }
', '(() => {
  const monthlyData = MONTHLY_DATA_PLACEHOLDER;
  const totalCompleted = TOTAL_COMPLETED_PLACEHOLDER;
  const avgPerMonth = AVG_PER_MONTH_PLACEHOLDER;
  const lastMonthCount = LAST_MONTH_COUNT_PLACEHOLDER;
  const trend = TREND_PLACEHOLDER;
  const byInstructor = BY_INSTRUCTOR_PLACEHOLDER;

  const trendIcon = trend === ''accelerating'' ? '' ↑'' : trend === ''decelerating'' ? '' ↓'' : '' →'';

  return (
    <MetricSection>
      <MetricRow>
        <StatCard label={''Total Delivered''} value={totalCompleted} subtitle={''All-time cohorts''} />
        <StatCard label={''Avg / Month''} value={avgPerMonth} subtitle={''Completion rate''} />
        <StatCard label={''Last Month''} value={lastMonthCount} subtitle={''Cohorts completed''} />
        <StatCard label={''Trend''} value={trend + trendIcon} subtitle={''3mo vs prior 3mo''} />
      </MetricRow>

      <div style={{ height: 260, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Cohorts Completed by Month</div>
        <ResponsiveContainer width="100%" height="88%">
          <BarChart data={monthlyData} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="month" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <Bar dataKey="completed" name="Completed" fill={theme.accent} radius={[4, 4, 0, 0]} />
          </BarChart>
        </ResponsiveContainer>
      </div>

      <div style={{ height: 220, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 16 }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Completions by Instructor</div>
        <ResponsiveContainer width="100%" height="85%">
          <BarChart data={byInstructor} layout="vertical" margin={{ top: 10, right: 30, left: 60, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis type="number" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis type="category" dataKey="name" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} width={60} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <Bar dataKey="completed" name="Completed" fill={theme.secondary} radius={[0, 4, 4, 0]} />
          </BarChart>
        </ResponsiveContainer>
      </div>

      <MetricNote>Source: Asana · AI Bootcamp Ops board · Completed section</MetricNote>
    </MetricSection>
  );
})()', 86400, 'claude', NULL, NULL, 1, 0, '{"aliases": ["cohort velocity", "completion rate", "cohorts delivered", "bootcamp completions"]}', '2026-02-19T01:39:44+00:00', '2026-02-19T01:39:44+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('f90cc540-c123-44eb-a2e3-20df6049db9b', 'Collection Efficiency', 'collection-efficiency', 'Track monthly invoice collection rates from QuickBooks by comparing invoiced amounts against actual payment receipts.

## Data Sources
QuickBooks Online Invoices and Payments via Kiingo MCP `quickbooks.query()`.

## Retrieval Steps

### Step 1: Invoices (what was billed)
Query all invoices for trailing 12 months:
```
quickbooks.query({ query: "SELECT TxnDate, TotalAmt FROM Invoice WHERE TxnDate >= ''<12 months ago, 1st of month>'' AND TxnDate <= ''<last day of current month>'' ORDERBY TxnDate", maxResults: 1000 })
```
Group by month of TxnDate. Sum TotalAmt per month to get `invoiced`.

### Step 2: Payments (what was actually collected)
Query all payments for the same trailing 12 months:
```
quickbooks.query({ query: "SELECT TxnDate, TotalAmt FROM Payment WHERE TxnDate >= ''<12 months ago, 1st of month>'' AND TxnDate <= ''<last day of current month>'' ORDERBY TxnDate", maxResults: 1000 })
```
Group by month of Payment TxnDate. Sum TotalAmt per month to get `collected`.

**CRITICAL**: The `collected` value MUST come from Payment records grouped by the payment''s own TxnDate — NOT from Invoice.Balance. Invoice.Balance shows the current outstanding balance today, which makes old fully-paid invoices look 100% collected in the month they were issued. Using Payment.TxnDate correctly shows when cash was actually received.

### Step 3: Outstanding AR
Query current outstanding invoices:
```
quickbooks.query({ query: "SELECT TotalAmt, Balance FROM Invoice WHERE Balance > ''0''", maxResults: 1000 })
```
Sum all Balance values to get total AR outstanding.

### Step 4: Combine
For each month compute:
- `invoiced`: sum of Invoice TotalAmt for that month
- `collected`: sum of Payment TotalAmt for that month
- `rate`: (collected / invoiced) * 100 — cap at 100 if payments exceed invoices in a month (e.g. catch-up payments)

Note: Collection rates can exceed 100% in months where catch-up payments are received for prior months'' invoices. Cap rate display at 100%.

Recent months (current + prior) will naturally have lower rates as invoices are still outstanding.

Compute LTM average collection rate (total collected / total invoiced * 100).
Flag any months with rate below 80% as needing attention (exclude current and prior month which are naturally lower).

## Values to Return
- `monthlyData`: array of { month, invoiced, collected, rate } — 12 months
- `ltmCollectionRate`: overall collection rate for last 12 months
- `arBalance`: total outstanding AR (sum of Balance from open invoices)', '(() => {
  const data = DATA_PLACEHOLDER;
  const ltmRate = LTM_RATE_PLACEHOLDER;
  const ar = AR_PLACEHOLDER;
  return (
    <MetricSection>
      <MetricRow>
        <StatCard label="LTM Collection Rate" value={ltmRate.toFixed(1) + ''%''} subtitle="All invoices" />
        <StatCard label="Outstanding AR" value={''$'' + (ar / 1000).toFixed(0) + ''K''} subtitle="Uncollected" />
      </MetricRow>
      <div style={{ height: 280, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
        <ResponsiveContainer width="100%" height="100%">
          <ComposedChart data={data} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="month" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis yAxisId="left" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} tickFormatter={v => ''$'' + (v/1000) + ''K''} />
            <YAxis yAxisId="right" orientation="right" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} tickFormatter={v => v + ''%''} domain={[0, 100]} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <Bar yAxisId="left" dataKey="invoiced" name="Invoiced" fill={theme.accent} radius={[4,4,0,0]} opacity={0.5} />
            <Bar yAxisId="left" dataKey="collected" name="Collected" fill={theme.accentStrong} radius={[4,4,0,0]} />
            <Line yAxisId="right" type="monotone" dataKey="rate" name="Collection %" stroke={theme.danger} strokeWidth={2} dot={{ r: 3 }} />
          </ComposedChart>
        </ResponsiveContainer>
      </div>
    </MetricSection>
  );
})()', 259200, 'claude', NULL, NULL, 1, 0, '{"aliases":["collection rate","AR efficiency"]}', '2026-02-15T06:29:29+00:00', '2026-02-18T22:58:55+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('50e1135e-e4f0-4860-91a0-44a257c8e930', 'Deal Creation Velocity', 'deal-creation-velocity', 'Track monthly new deal creation and closed-won deals from HubSpot.

## Data Source
HubSpot Deals via `hubspot.listDeals()`.

## Retrieval Steps
1. Paginate all deals: `hubspot.listDeals({ limit: 100, properties: [''createdate'',''closedate'',''hs_is_closed_won'',''hs_is_closed'',''amount''], after })`.
2. Group deals by creation month (from createdate). Count deals per month.
3. Separately, count deals closed won per month (from closedate where hs_is_closed_won === ''true'').
4. Build array of { month, created, won }.
5. Compute trailing 3-month averages for both metrics.

## Values to Return
- `monthlyData`: array of { month, created, won }
- `avgCreated`: trailing 3-month avg deals created
- `avgWon`: trailing 3-month avg deals won
- `totalCreatedLTM`: total deals created in last 12 months', '(() => {
  const data = DATA_PLACEHOLDER;
  const avgCreated = AVG_CREATED_PLACEHOLDER;
  return (
    <MetricSection>
      <MetricRow>
        <StatCard label="Avg/Month Created" value={avgCreated} subtitle="Trailing 3 months" />
        <StatCard label="LTM Deals Created" value={data.reduce((s,d) => s + d.created, 0)} subtitle="Last 12 months" />
      </MetricRow>
      <div style={{ height: 280, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
        <ResponsiveContainer width="100%" height="100%">
          <ComposedChart data={data} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="month" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <Bar dataKey="created" name="Deals Created" fill={theme.accent} radius={[4,4,0,0]} opacity={0.6} />
            <Line type="monotone" dataKey="won" name="Deals Won" stroke={theme.accentStrong} strokeWidth={2.5} dot={{ fill: theme.accentStrong, r: 3 }} />
          </ComposedChart>
        </ResponsiveContainer>
      </div>
    </MetricSection>
  );
})()', 259200, 'claude', NULL, NULL, 1, 0, '{"aliases":["deal velocity","new deals","deal creation"]}', '2026-02-15T06:29:29+00:00', '2026-02-15T06:29:29+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('1da47a88-6e11-4a03-b23b-bfe245b1718b', 'Deal Funnel by Stage', 'deal-funnel-stage', 'Show open deal pipeline broken down by deal stage from HubSpot.

## Data Source
HubSpot Deals via `hubspot.listDeals()` and `hubspot.getDealPipelines()`.

## Retrieval Steps
1. Get pipeline configuration: `hubspot.getDealPipelines()` — map stage IDs to labels.
2. Paginate all open deals: filter where hs_is_closed !== ''true''.
3. Group by dealstage, count deals and sum amounts per stage.
4. Sort by pipeline position (stage order in the pipeline).
5. Only include stages with > 0 deals.

## Values to Return
- `byStage`: array of { stage (label), count, value (total amount) }
- `totalDeals`: total open deals
- `totalValue`: total open pipeline value', '(() => {
  const data = DATA_PLACEHOLDER;
  const totalDeals = TOTAL_DEALS_PLACEHOLDER;
  const totalValue = TOTAL_VALUE_PLACEHOLDER;
  return (
    <MetricSection>
      <MetricRow>
        <StatCard label="Open Deals" value={totalDeals} subtitle="Across all stages" />
        <StatCard label="Pipeline Value" value={''$'' + (totalValue / 1000).toFixed(0) + ''K''} subtitle="Total open" />
      </MetricRow>
      <div style={{ height: 300, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
        <ResponsiveContainer width="100%" height="100%">
          <BarChart data={data} layout="vertical" margin={{ top: 5, right: 20, left: 100, bottom: 5 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis type="number" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} tickFormatter={v => ''$'' + (v/1000) + ''K''} />
            <YAxis type="category" dataKey="stage" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} width={95} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} formatter={(v, name) => name === ''Value'' ? ''$'' + Number(v).toLocaleString() : v} />
            <Bar dataKey="value" name="Value" fill={theme.accent} radius={[0,4,4,0]} />
          </BarChart>
        </ResponsiveContainer>
      </div>
    </MetricSection>
  );
})()', 259200, 'claude', NULL, NULL, 1, 0, '{"aliases":["deal funnel","pipeline stages","stages"]}', '2026-02-15T06:29:29+00:00', '2026-02-15T06:29:29+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('ebc99ea9-2609-4b9c-bcf0-71d191cae36a', 'Deal Metrics', 'deal-metrics', 'Compute key deal velocity and sizing metrics from HubSpot.

## Data Source
HubSpot Deals via `hubspot.listDeals()`.

## Retrieval Steps
1. Paginate all closed deals (last 12 months): properties [''amount'',''createdate'',''closedate'',''hs_is_closed_won'',''hs_is_closed'',''days_to_close''].
2. For closed-won deals: compute average amount, average days_to_close (or closedate - createdate).
3. Compute pipeline coverage: total open pipeline / trailing 3-month revenue.
4. Count deals by size bracket: <$1K, $1K-$5K, $5K-$25K, $25K-$100K, >$100K.

## Values to Return
- `avgDealSize`: average closed-won deal amount
- `avgDaysToClose`: average days from creation to close
- `pipelineCoverage`: pipeline / (quarterly run rate) as ratio
- `medianDealSize`: median closed-won deal amount
- `dealsClosedLTM`: total deals closed won in last 12 months', '(() => {
  const avgSize = AVG_SIZE_PLACEHOLDER;
  const avgDays = AVG_DAYS_PLACEHOLDER;
  const coverage = COVERAGE_PLACEHOLDER;
  const closedLTM = CLOSED_LTM_PLACEHOLDER;
  return (
    <MetricSection>
      <MetricRow>
        <StatCard label="Avg Deal Size" value={''$'' + (avgSize / 1000).toFixed(1) + ''K''} subtitle="Closed won" />
        <StatCard label="Days to Close" value={avgDays} subtitle="Average" />
      </MetricRow>
      <MetricRow>
        <StatCard label="Pipeline Coverage" value={coverage.toFixed(1) + ''x''} subtitle="vs quarterly run rate" />
        <StatCard label="Deals Won (LTM)" value={closedLTM} subtitle="Last 12 months" />
      </MetricRow>
    </MetricSection>
  );
})()', 259200, 'claude', NULL, NULL, 1, 0, '{"aliases":["deals","deal stats"]}', '2026-02-15T06:29:29+00:00', '2026-02-15T06:29:29+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('97c3c5ac-a74f-4731-9636-da43619c834c', 'Active AI Engagements', 'deployed-engagements', 'Track active AI consulting engagements, assessments, and custom builds.

## Data Sources
- Asana: AI Consulting Engagements project (1210918739097592)
- HubSpot: Managed AI pipeline deals, Assessment pipeline deals

## Retrieval Steps
1. Asana: `asana.getTasksForProject({ projectGid: ''1210918739097592'', opt_fields: [''name'',''assignee.name'',''completed'',''num_subtasks''] })` — get all consulting tasks.
2. HubSpot: Query Managed AI pipeline for active builds.

## Values to Return
- `engagements`: array of { client, type, status, owner, subtasks }
- `completed`: number completed
- `inProgress`: number in progress
- `totalEngagements`: total count', '', 259200, 'kiingo-mcp', NULL, NULL, 1, 0, '{"aliases":["ai engagements","deployed engagements","engagements"]}', '2026-02-15T16:50:18+00:00', '2026-02-15T16:50:18+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('5e4a0131-1e16-4ca6-b715-cddf54af01e4', 'Discovery Call Summary', 'discovery-call-summary', 'Synthesize a CEO-level discovery call health summary from upstream dependency data. DO NOT call any HubSpot APIs — all data comes from dependency inputs.

## Dependency Inputs
You will receive two dependency inputs:
1. **trailing-discovery-calls**: contains `trailing30` (current trailing 30-day count), `weeklyData` (time series), `peak`, `trough`, `avgTrailing`, `byMonth`
2. **sales-pipeline-value**: contains `byStage` (array of { stage, count, amount, weighted }) with current pipeline snapshot

## Computation Steps
1. From `trailing-discovery-calls`:
   - `currentTrailing30`: the `trailing30` value
   - `priorTrailing30`: compute by looking at `weeklyData` 4 weeks ago
   - `trendDirection`: "up" if current > prior, "down" if current < prior, "flat" if equal
   - `trendPct`: percentage change from prior to current
2. From `sales-pipeline-value`:
   - `currentInStage`: find the "Discovery Call" entry in `byStage`, take its `count`
   - `currentInStageValue`: same entry''s `amount`
   - `proposalCount`: find the "Proposal Sent" entry in `byStage`, take its `count`
   - `conversionRate`: (`proposalCount` / (`currentInStage` + `proposalCount`)) * 100 — approximation of discovery-to-proposal flow

## Values to Return
- `currentTrailing30`: current trailing 30-day discovery call count
- `priorTrailing30`: trailing 30-day count from 4 weeks ago
- `trendDirection`: "up", "down", or "flat"
- `trendPct`: percentage change
- `currentInStage`: deals currently in Discovery Call stage
- `currentInStageValue`: dollar value of deals in Discovery Call
- `proposalCount`: deals currently in Proposal Sent stage
- `conversionRate`: discovery-to-proposal conversion rate', '(() => {
  const trailing = TRAILING_PLACEHOLDER;
  const trend = TREND_PLACEHOLDER;
  const trendPct = TREND_PCT_PLACEHOLDER;
  const inStage = IN_STAGE_PLACEHOLDER;
  const stageValue = STAGE_VALUE_PLACEHOLDER;
  const conversion = CONVERSION_PLACEHOLDER;

  const trendArrow = trend === ''up'' ? ''\u2191'' : trend === ''down'' ? ''\u2193'' : ''\u2192'';
  const trendColor = trend === ''up'' ? theme.success : trend === ''down'' ? theme.danger : theme.inkMuted;

  return (
    <MetricSection>
      <MetricRow>
        <StatCard label="Trailing 30d" value={trailing} subtitle={trendArrow + '' '' + trendPct.toFixed(0) + ''% vs prior''} trendDirection={trend} />
        <StatCard label="In Discovery Now" value={inStage} subtitle={''$'' + (stageValue / 1000).toFixed(0) + ''K value''} />
        <StatCard label="Discovery \u2192 Proposal" value={conversion.toFixed(0) + ''%''} subtitle="Conversion rate" />
      </MetricRow>
      <MetricNote>Synthesized from pipeline + trailing discovery data · No additional API calls</MetricNote>
    </MetricSection>
  );
})()', 259200, 'claude', NULL, NULL, 1, 0, '{"dependencies":["trailing-discovery-calls","sales-pipeline-value"],"aliases":["disco summary","disco calls summary","discovery overview"]}', '2026-02-17T00:57:37+00:00', '2026-02-17T00:57:37+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('67f3b504-f1c1-4239-8640-dae49706e583', 'Engineering Projects', 'engineering-projects', 'Track engineering project status from Asana.

## Data Source
Asana Projects and Tasks via Kiingo MCP.

## Retrieval Steps
1. Search Asana projects matching engineering-related names (Kiingo Command Center, Kiingo MCP Server, Email CLI, etc.).
2. For each project, count open tasks and determine priority based on recent activity.
3. Also look for engineering tasks in the quarterly rocks.

## Values to Return
- `projects`: array of { project, openTasks, priority }
- `totalOpenTasks`: sum of all engineering open tasks', '(() => {
  const data = DATA_PLACEHOLDER;
  const total = data.reduce((s, d) => s + d.openTasks, 0);
  return (
    <MetricSection>
      <StatCard label="Open Engineering Tasks" value={total} subtitle="Across projects" />
      <div style={{ marginTop: 8 }}>
        {data.map((d, i) => (
          <div key={i} style={{ display: ''flex'', alignItems: ''center'', gap: 12, padding: ''10px 12px'', background: i % 2 === 0 ? theme.panel : ''transparent'', borderRadius: 8 }}>
            <span style={{ flex: 1, color: theme.ink, fontSize: 13, fontWeight: 600 }}>{d.project}</span>
            <span style={{ color: theme.inkMuted, fontSize: 12 }}>{d.openTasks} tasks</span>
            <span style={{ fontSize: 11, padding: ''2px 8px'', borderRadius: 4, background: d.priority === ''High'' ? theme.danger : theme.accent, color: ''#fff'' }}>{d.priority}</span>
          </div>
        ))}
      </div>
      <MetricNote>Source: Asana Projects via Kiingo MCP</MetricNote>
    </MetricSection>
  );
})()', 259200, 'claude', NULL, NULL, 1, 0, '{"aliases":["eng projects","engineering","dev projects"]}', '2026-02-15T06:34:11+00:00', '2026-02-15T06:34:11+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('29e19564-5b6a-4459-b29a-17efe40f008a', 'FDE Utilization', 'fde-utilization', 'Track Fractional Digital Employee (FDE) utilization — consulting capacity and engagement load.

## Data Sources
- Asana: AI Consulting Engagements project, strategy session tasks, assessment tasks
- HubSpot: Active consulting/managed AI deals

## Retrieval Steps
1. Asana: `asana.getTasksForProject({ projectGid: ''1210918739097592'' })` — count by assignee and completion status.
2. HubSpot: Count active managed AI and consulting pipeline deals.
3. Compute utilization rate per consultant (active engagements vs capacity).

## Values to Return
- `consultants`: array of { name, activeEngagements, completed, capacity }
- `totalCapacity`: aggregate capacity hours
- `utilization`: overall utilization percentage', '', 259200, 'kiingo-mcp', NULL, NULL, 1, 0, '{"aliases":["utilization","FDE","field engineer"]}', '2026-02-15T16:50:18+00:00', '2026-02-15T16:50:18+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('e199206d-01bd-40af-838e-f82ff1541a40', 'Full Instructor Coverage', 'full-instructor-coverage', 'Track all instructor and coordinator activity across bootcamp cohorts. Combines the Asana Ops board (lead instructors) with individual cohort project tasks (Isabelle who runs sessions and handles admin).

## Data Sources
1. Asana → "AI Bootcamp Ops" project (GID: 1208309967533974) — all sections
2. Asana → Individual cohort projects — task assignments reveal who actually runs sessions
3. Asana workspace search — find Isabelle''s open bootcamp tasks

## Important Notes
- The Ops board sections (Scheduling/Underway/Completed) are **NOT reliably maintained**. Many completed cohorts sit in Scheduling or Underway.
- Use the task `completed` flag AND `Session N Date` custom fields to determine true cohort status.
- Isabelle Coloma (GID: 1211901589146535) is assigned "Run session N" tasks within individual cohort projects — she actually runs bootcamp sessions, not just coordinates.

## Known Team
- **Lead instructors** (Ops board task assignees): Jordan McDaniel, James Hill-Jiang, Josh Sullivan, Ross Hartmann
- **Session runners** (individual project task assignees): Isabelle Coloma (GID: 1211901589146535)

## Retrieval Steps

### Step 1: Get ALL Ops board tasks with custom fields
```typescript
import { asana } from ''tools'';
const underway = await asana.getTasksForSection({
  sectionGid: ''1208335145873011'',
  opt_fields: [''name'',''assignee.name'',''completed'',''completed_at'',''custom_fields'']
});
const scheduling = await asana.getTasksForSection({
  sectionGid: ''1208309967533979'',
  opt_fields: [''name'',''assignee.name'',''completed'',''completed_at'',''custom_fields'']
});
const completedSection = await asana.getTasksForSection({
  sectionGid: ''1208545310165812'',
  opt_fields: [''name'',''assignee.name'',''completed'',''completed_at'',''custom_fields'']
});
```

Combine all tasks. For each, find the last populated `Session N Date` custom field (Session 1 through Session 8). Classify:
- **completed**: `completed` is true AND last session date is in the past
- **active**: NOT completed AND Session 1 Date is in the past AND last session date is recent (within last 2 weeks) or in the future
- **scheduled**: NOT completed AND (no session dates OR Session 1 Date is in the future)

Group by assignee, counting active/scheduled/completed per instructor.

### Step 2: Find Isabelle''s active cohort involvement
```typescript
const isabelleTasks = await asana.searchTasksInWorkspace({
  workspaceGid: ''1208310016661037'',
  searchParams: {
    ''assignee.any'': ''1211901589146535'',
    ''completed'': false
  },
  opt_fields: [''name'',''memberships.project.name'',''due_on''],
  limit: 100
});
```

Filter to tasks whose project name contains "Bootcamp" or "AI Bootcamp". Extract unique project names — each represents a cohort she''s actively running. Look specifically for "Run session" tasks to confirm she''s the session runner.

Also get her recently completed bootcamp tasks:
```typescript
const ninetyDaysAgo = new Date(Date.now() - 90*24*60*60*1000).toISOString().split(''T'')[0];
const isabelleCompleted = await asana.searchTasksInWorkspace({
  workspaceGid: ''1208310016661037'',
  searchParams: {
    ''assignee.any'': ''1211901589146535'',
    ''completed'': true,
    ''completed_on.after'': ninetyDaysAgo
  },
  opt_fields: [''name'',''memberships.project.name''],
  limit: 100
});
```

Count unique completed bootcamp projects for her completed tally.

### Step 3: Build combined instructor table
Merge all instructors. Each entry:
- `name`: first name
- `role`: "Lead Instructor" for Ops board assignees, "Session Runner" for Isabelle
- `active`: truly active cohorts (using session date logic for leads, open project tasks for Isabelle)
- `scheduled`: scheduled cohorts (Ops board leads only; 0 for Isabelle)
- `completed`: completed cohorts
- `total`: sum

Sort by active count descending.

### Step 4: Build active cohort-to-team mapping
For each truly active cohort, show the lead instructor (from Ops board assignee). Cross-reference with Isabelle''s active projects to find which cohorts she''s also running sessions for. Build: { cohort, lead, coordinator }.

## Values to Return
- `instructors`: array of { name, role, active, scheduled, completed, total }
- `totalTeamMembers`: number
- `totalActiveCohorts`: number (truly active, not stale)
- `cohortsWithCoordinator`: number (active cohorts where Isabelle is also assigned)
- `cohortTeams`: array of { cohort, lead, coordinator }
', '(() => {
  const instructors = INSTRUCTORS_PLACEHOLDER;
  const totalTeamMembers = TOTAL_TEAM_PLACEHOLDER;
  const totalActiveCohorts = TOTAL_ACTIVE_PLACEHOLDER;
  const cohortsWithCoordinator = COHORTS_WITH_COORD_PLACEHOLDER;
  const cohortTeams = COHORT_TEAMS_PLACEHOLDER;

  return (
    <MetricSection>
      <MetricRow>
        <StatCard label={''Team Size''} value={totalTeamMembers} subtitle={''Instructors + coordinators''} />
        <StatCard label={''Active Cohorts''} value={totalActiveCohorts} subtitle={''Currently running''} />
        <StatCard label={''With Coordinator''} value={cohortsWithCoordinator} subtitle={''Isabelle supporting''} />
        <StatCard label={''Utilization''} value={Math.round(totalActiveCohorts / totalTeamMembers * 10) / 10 + ''x''} subtitle={''Cohorts per person''} />
      </MetricRow>

      <div style={{ background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 12, color: theme.ink }}>Team Overview</div>
        <table style={{ width: ''100%'', borderCollapse: ''collapse'', fontSize: 13 }}>
          <thead>
            <tr style={{ borderBottom: ''2px solid '' + theme.line }}>
              <th style={{ textAlign: ''left'', padding: ''8px 12px'', color: theme.inkMuted, fontWeight: 600, fontSize: 11 }}>Name</th>
              <th style={{ textAlign: ''left'', padding: ''8px 12px'', color: theme.inkMuted, fontWeight: 600, fontSize: 11 }}>Role</th>
              <th style={{ textAlign: ''center'', padding: ''8px 12px'', color: theme.inkMuted, fontWeight: 600, fontSize: 11 }}>Active</th>
              <th style={{ textAlign: ''center'', padding: ''8px 12px'', color: theme.inkMuted, fontWeight: 600, fontSize: 11 }}>Scheduled</th>
              <th style={{ textAlign: ''center'', padding: ''8px 12px'', color: theme.inkMuted, fontWeight: 600, fontSize: 11 }}>Completed</th>
              <th style={{ textAlign: ''center'', padding: ''8px 12px'', color: theme.inkMuted, fontWeight: 600, fontSize: 11 }}>Total</th>
            </tr>
          </thead>
          <tbody>
            {instructors.map((inst, i) => (
              <tr key={i} style={{ borderBottom: ''1px solid '' + theme.line }}>
                <td style={{ padding: ''8px 12px'', fontWeight: 600, color: theme.ink }}>{inst.name}</td>
                <td style={{ padding: ''8px 12px'', color: theme.inkMuted }}>{inst.role}</td>
                <td style={{ textAlign: ''center'', padding: ''8px 12px'', color: inst.active > 0 ? theme.accent : theme.inkMuted, fontWeight: 700 }}>{inst.active}</td>
                <td style={{ textAlign: ''center'', padding: ''8px 12px'', color: inst.scheduled > 0 ? ''#eab308'' : theme.inkMuted, fontWeight: 600 }}>{inst.scheduled}</td>
                <td style={{ textAlign: ''center'', padding: ''8px 12px'', color: theme.inkMuted }}>{inst.completed}</td>
                <td style={{ textAlign: ''center'', padding: ''8px 12px'', fontWeight: 600, color: theme.ink }}>{inst.total}</td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>

      {cohortTeams.length > 0 && (
        <div style={{ background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 16 }}>
          <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 12, color: theme.ink }}>Active Cohort Teams</div>
          <div style={{ display: ''grid'', gridTemplateColumns: ''1fr 1fr'', gap: 8 }}>
            {cohortTeams.map((c, i) => (
              <div key={i} style={{ display: ''flex'', justifyContent: ''space-between'', alignItems: ''center'', padding: ''8px 14px'', borderRadius: 10, background: theme.accent + ''0a'', border: ''1px solid '' + theme.line }}>
                <span style={{ fontSize: 12, fontWeight: 600, color: theme.ink }}>{c.cohort}</span>
                <div style={{ display: ''flex'', gap: 6, alignItems: ''center'' }}>
                  <span style={{ fontSize: 11, color: theme.accent, fontWeight: 600 }}>{c.lead}</span>
                  {c.coordinator && <span style={{ fontSize: 10, color: theme.secondary, background: theme.secondary + ''22'', padding: ''2px 8px'', borderRadius: 10 }}>+ {c.coordinator}</span>}
                </div>
              </div>
            ))}
          </div>
        </div>
      )}

      <MetricNote>Source: Asana Ops board + individual cohort projects · Lead instructors + coordinators</MetricNote>
    </MetricSection>
  );
})()', 43200, 'claude', NULL, NULL, 1, 0, '{"aliases": ["instructor coverage", "full team", "bootcamp team", "isabelle workload", "coordinator coverage"]}', '2026-02-19T05:43:41+00:00', '2026-02-19T05:43:41+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('d2825574-c249-44fe-a6e6-b89fb0b4419b', 'Instructor Workload', 'instructor-workload', 'Track instructor workload distribution — active, scheduled, and completed bootcamp cohorts per instructor from the Asana AI Bootcamp Ops board.

## Data Source
Asana → "AI Bootcamp Ops" project (GID: 1208309967533974)

The project has sections (Scheduling, Underway, Completed) but **sections are NOT reliably maintained** — many completed cohorts remain in Scheduling or Underway. Instead, determine true status using:
1. The task''s `completed` boolean flag
2. Custom fields `Session 1 Date` through `Session 8 Date` — the actual bootcamp session schedule

Each task represents a bootcamp cohort. The **task assignee** is the lead instructor.

## Retrieval Steps

### Step 1: Get ALL tasks from all three sections with custom fields
```typescript
import { asana } from ''tools'';

const underway = await asana.getTasksForSection({
  sectionGid: ''1208335145873011'',
  opt_fields: [''name'',''assignee.name'',''completed'',''completed_at'',''custom_fields'']
});
const scheduling = await asana.getTasksForSection({
  sectionGid: ''1208309967533979'',
  opt_fields: [''name'',''assignee.name'',''completed'',''completed_at'',''custom_fields'']
});
const completed = await asana.getTasksForSection({
  sectionGid: ''1208545310165812'',
  opt_fields: [''name'',''assignee.name'',''completed'',''completed_at'',''custom_fields'']
});
```

Combine all tasks into one list.

### Step 2: Classify each cohort''s true status
For each task, determine its real status (ignore which section it''s in):

1. Find the last populated `Session N Date` custom field (check Session 1 through Session 8; use the highest-numbered one that has a value).
2. Parse that date and compare to today.
3. Classify:
   - **completed**: `completed` flag is true AND last session date is in the past (or no session dates set)
   - **active**: `completed` flag is false AND Session 1 Date is in the past AND last session date is in the future (or within the last 2 weeks)
   - **scheduled**: `completed` flag is false AND Session 1 Date is in the future (or no session dates yet)
   - If `completed` is true but last session date is in the future, treat as **active** (incorrectly marked done early)

### Step 3: Aggregate by instructor
Group by assignee name. For each instructor, count active, scheduled, and completed cohorts.

Sort by active count descending.

Skip tasks with no assignee (group as "Unassigned" separately).

### Step 4: Build active cohort list
From the truly active cohorts, list each with: { cohort (task name, cleaned by removing " - AI Bootcamp Cohort" suffix), instructor (assignee first name) }. Sort by instructor.

## Values to Return
- `instructors`: array of { name, active, scheduled, completed, total }
- `totalActive`: number
- `totalScheduled`: number
- `totalCompleted`: number
- `totalCohorts`: number
- `activeCohorts`: array of { cohort, instructor }
', '(() => {
  const instructors = INSTRUCTORS_PLACEHOLDER;
  const totalActive = TOTAL_ACTIVE_PLACEHOLDER;
  const totalScheduled = TOTAL_SCHEDULED_PLACEHOLDER;
  const totalCompleted = TOTAL_COMPLETED_PLACEHOLDER;
  const totalCohorts = TOTAL_COHORTS_PLACEHOLDER;
  const activeCohorts = ACTIVE_COHORTS_PLACEHOLDER;

  const colors = [theme.accent, theme.secondary, ''#eab308'', ''#16a34a'', ''#e879f9'', ''#f97316''];

  return (
    <MetricSection>
      <MetricRow>
        <StatCard label={''Active Cohorts''} value={totalActive} subtitle={''Currently underway''} />
        <StatCard label={''Scheduled''} value={totalScheduled} subtitle={''Being set up''} />
        <StatCard label={''Completed''} value={totalCompleted} subtitle={''All-time delivered''} />
        <StatCard label={''Total Cohorts''} value={totalCohorts} subtitle={''All stages''} />
      </MetricRow>

      <div style={{ height: 280, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Cohorts by Instructor</div>
        <ResponsiveContainer width="100%" height="90%">
          <BarChart data={instructors} layout="vertical" margin={{ top: 10, right: 30, left: 80, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis type="number" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis type="category" dataKey="name" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} width={80} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <Legend />
            <Bar dataKey="active" name="Active" stackId="a" fill={theme.accent} />
            <Bar dataKey="scheduled" name="Scheduled" stackId="a" fill="#eab308" />
            <Bar dataKey="completed" name="Completed" stackId="a" fill={theme.secondary} radius={[0, 4, 4, 0]} />
          </BarChart>
        </ResponsiveContainer>
      </div>

      {activeCohorts.length > 0 && (
        <div style={{ background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 16 }}>
          <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 12, color: theme.ink }}>Active Cohorts</div>
          <div style={{ display: ''grid'', gridTemplateColumns: ''1fr 1fr'', gap: 8 }}>
            {activeCohorts.map((c, i) => (
              <div key={i} style={{ display: ''flex'', justifyContent: ''space-between'', alignItems: ''center'', padding: ''8px 14px'', borderRadius: 10, background: theme.accent + ''0a'', border: ''1px solid '' + theme.line }}>
                <span style={{ fontSize: 12, fontWeight: 600, color: theme.ink }}>{c.cohort.replace('' - AI Bootcamp Cohort'', '''')}</span>
                <span style={{ fontSize: 11, color: theme.inkMuted, marginLeft: 8 }}>{c.instructor}</span>
              </div>
            ))}
          </div>
        </div>
      )}

      <MetricNote>Source: Asana · AI Bootcamp Ops board · Instructor = task assignee</MetricNote>
    </MetricSection>
  );
})()', 43200, 'claude', NULL, NULL, 1, 0, '{"aliases": ["instructor workload", "instructor distribution", "bootcamp instructors", "cohort assignments"]}', '2026-02-19T05:43:41+00:00', '2026-02-19T05:43:41+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('77eea407-0b3b-4c26-b833-b6544381e98b', 'Lead Pipeline Overview', 'lead-pipeline-overview', 'Track lead volume and lifecycle distribution from HubSpot contacts.

## Data Source
HubSpot Contacts via `hubspot.searchAllContacts()`.

## Retrieval Steps
1. Search contacts created in last 12 months: `hubspot.searchAllContacts({ filters: [{ propertyName: ''createdate'', operator: ''GTE'', value: ''<12mo ago>'' }], properties: [''createdate'',''lifecyclestage'',''hs_lead_status'',''hubspot_owner_id'',''hs_analytics_source''], limit: 100 })`.
2. Paginate through all results.
3. Group by month (from createdate) to get lead volume trend.
4. Group by lifecyclestage to get distribution: subscriber, lead, marketingqualifiedlead, salesqualifiedlead, opportunity, customer, evangelist.
5. Compute conversion rates between stages.

## Values to Return
- `monthlyLeads`: array of { month, count }
- `byLifecycle`: array of { stage, count }
- `totalLeads`: total contacts created in LTM
- `ltmConversionRate`: leads that became opportunities or customers', '(() => {
  const monthly = MONTHLY_PLACEHOLDER;
  const byLifecycle = LIFECYCLE_PLACEHOLDER;
  const total = TOTAL_PLACEHOLDER;
  return (
    <MetricSection>
      <StatCard label="LTM New Leads" value={total} subtitle="Last 12 months" />
      <div style={{ height: 250, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
        <ResponsiveContainer width="100%" height="100%">
          <BarChart data={monthly} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="month" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <Bar dataKey="count" name="New Leads" fill={theme.accent} radius={[4,4,0,0]} />
          </BarChart>
        </ResponsiveContainer>
      </div>
      <MetricNote>Source: HubSpot Contacts via Kiingo MCP</MetricNote>
    </MetricSection>
  );
})()', 259200, 'claude', NULL, NULL, 1, 0, '{"aliases":["leads","lead pipeline","lead funnel"]}', '2026-02-15T06:29:29+00:00', '2026-02-15T06:29:29+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('329d0e12-f4f9-47a5-81b1-e0ee3207fe1d', 'Margin Analysis', 'margin-analysis', 'Track monthly gross and net profit margins from QuickBooks P&L.

## Data Source
QuickBooks P&L via `quickbooks.profitAndLoss()`.

## Retrieval Steps
1. Call `quickbooks.profitAndLoss({ params: { start_date: ''<12mo ago>'', end_date: ''<today>'', summarize_column_by: ''Month'' } })`.
2. For each month column, extract: Total Income, Gross Profit, Net Income.
3. Compute: Gross Margin = Gross Profit / Total Income * 100, Net Margin = Net Income / Total Income * 100.
4. Compute LTM averages for both margins.

## Values to Return
- `monthlyData`: array of { month, grossMargin, netMargin }
- `ltmGrossMargin`: LTM average gross margin %
- `ltmNetMargin`: LTM average net margin %', '(() => {
  const data = DATA_PLACEHOLDER;
  const ltmGross = LTM_GROSS_PLACEHOLDER;
  const ltmNet = LTM_NET_PLACEHOLDER;
  return (
    <MetricSection>
      <MetricRow>
        <StatCard label="LTM Gross Margin" value={ltmGross.toFixed(1) + ''%''} subtitle="Revenue after COGS" />
        <StatCard label="LTM Net Margin" value={ltmNet.toFixed(1) + ''%''} subtitle="Bottom line" />
      </MetricRow>
      <div style={{ height: 280, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
        <ResponsiveContainer width="100%" height="100%">
          <LineChart data={data} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="month" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} tickFormatter={v => v + ''%''} domain={[0, 100]} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} formatter={v => Number(v).toFixed(1) + ''%''} />
            <Line type="monotone" dataKey="grossMargin" name="Gross Margin" stroke={theme.accent} strokeWidth={2.5} dot={{ fill: theme.accent, r: 3 }} />
            <Line type="monotone" dataKey="netMargin" name="Net Margin" stroke={theme.accentStrong} strokeWidth={2.5} dot={{ fill: theme.accentStrong, r: 3 }} />
            <ReferenceLine y={0} stroke={theme.danger} strokeWidth={1} strokeDasharray="4 4" />
          </LineChart>
        </ResponsiveContainer>
      </div>
      <MetricNote>Source: QuickBooks P&L (Accrual) via Kiingo MCP</MetricNote>
    </MetricSection>
  );
})()', 259200, 'claude', NULL, NULL, 1, 0, '{"aliases":["margins","gross margin","profit margin"]}', '2026-02-15T06:29:29+00:00', '2026-02-15T06:29:29+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('c43880d5-676d-451a-b903-925b8e388f0b', 'Marketing Initiatives', 'marketing-initiatives', 'Track marketing initiatives and their task completion from Asana.

## Data Source
Asana Tasks via search for marketing-related tasks (assigned to marketing team member Schuyler Dragoo and marketing-tagged projects).

## Retrieval Steps
1. Search Asana tasks assigned to the marketing team member(s) or in marketing projects.
2. Group by initiative/project.
3. For each initiative, count completed vs total tasks.
4. Determine status: Not Started, In Progress, At Risk, Complete.

## Values to Return
- `initiatives`: array of { initiative, status, tasksComplete, tasksTotal }
- `totalInitiatives`: count of initiatives
- `completionRate`: overall tasks completed / total', '(() => {
  const data = DATA_PLACEHOLDER;
  const total = data.reduce((s, d) => s + d.tasksTotal, 0);
  const done = data.reduce((s, d) => s + d.tasksComplete, 0);
  return (
    <MetricSection>
      <MetricRow>
        <StatCard label="Active Initiatives" value={data.length} subtitle="Marketing Q1" />
        <StatCard label="Tasks Done" value={done + ''/'' + total} subtitle={Math.round(done/total*100) + ''% complete''} />
      </MetricRow>
      <div style={{ marginTop: 8 }}>
        {data.map((d, i) => (
          <div key={i} style={{ display: ''flex'', alignItems: ''center'', gap: 12, padding: ''8px 12px'', background: i % 2 === 0 ? theme.panel : ''transparent'', borderRadius: 8 }}>
            <span style={{ flex: 1, color: theme.ink, fontSize: 13 }}>{d.initiative}</span>
            <span style={{ color: theme.inkMuted, fontSize: 12, minWidth: 60 }}>{d.tasksComplete}/{d.tasksTotal}</span>
            <div style={{ width: 100, height: 6, background: theme.line, borderRadius: 3 }}>
              <div style={{ width: (d.tasksTotal > 0 ? d.tasksComplete / d.tasksTotal * 100 : 0) + ''%'', height: ''100%'', background: theme.accent, borderRadius: 3 }} />
            </div>
          </div>
        ))}
      </div>
      <MetricNote>Source: Asana Tasks via Kiingo MCP</MetricNote>
    </MetricSection>
  );
})()', 259200, 'claude', NULL, NULL, 1, 0, '{"aliases":["marketing","campaigns","marketing projects"]}', '2026-02-15T06:34:11+00:00', '2026-02-15T06:34:11+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('88f549cc-6893-4c42-a595-948290e6510f', 'Marketing Scorecard', 'marketing-scorecard', 'Pull weekly marketing metrics from the Sales/Marketing Scorecard table in Notion.

## Data Sources
Notion page: Sales/Marketing Scorecard
Page ID: 2f001bab-c077-8037-bcfa-fd46eacbdc68

## Retrieval Steps
1. Call `notion.listBlockChildren({ blockId: ''2f001bab-c077-8037-bcfa-fd46eacbdc68'' })` to get page blocks.
2. Find the block with `type: ''table''`. Note its `id`.
3. Call `notion.listBlockChildren({ blockId: <tableId> })` to get all table rows.
4. Skip row index 0 (header) and row index 1 (owner row — cells contain "Sales"/"Marketing").
5. For each remaining row, call `notion.getBlock({ blockId: row.id, includeRaw: true })`.
6. Extract cell text from `raw.table_row.cells[colIndex]` — each cell is an array of rich text objects, join their `plain_text`.

## Column Mapping (0-indexed)
- Col 0: Week (date range string, e.g. "01/12 - 01/16")
- Col 7: Number of Leads (trailing 30 days) — integer
- Col 8: Newsletter Open Rate — percentage string like "55.65% (CTR 4.1%)" — extract the first percentage
- Col 9: Webinar Signups — integer or "NA"
- Col 10: New Website Visitors via Organic Search (trailing 30 days) — integer or "—"
- Col 11: Website page views (trailing 30 days) — integer or "—"
- Col 12: LinkedIn Engagement Rate (Ross/Kiingo, 7 days trailing) — string like "2.60% / 11.32%" — split on "/" to get two percentages

## Parsing Rules
- For integers (cols 7, 9, 10, 11): parseInt, treat empty/"—"/"NA" as 0 or null.
- For newsletter open rate (col 8): extract first number before "%" with regex, e.g. "55.65% (CTR 4.1%)" → 55.65. Also extract CTR if present.
- For LinkedIn (col 12): split on "/" and parse each as float percentage. First value is Ross, second is Kiingo.
- Extract a short week label from col 0: use just the start date portion (e.g. "01/12 - 01/16" → "1/12").
- Skip rows where col 0 is empty or is the owner row.
- If a data row has all marketing columns empty, still include it but with null values.

## Values to Return
- `weeks`: array of objects, each with:
  - `week`: short label (e.g. "1/12")
  - `leads`: number or null
  - `newsletterRate`: number (percentage) or null
  - `newsletterCtr`: number (percentage) or null
  - `webinarSignups`: number or null
  - `organicVisitors`: number or null
  - `pageViews`: number or null
  - `linkedinRoss`: number (percentage) or null
  - `linkedinKiingo`: number (percentage) or null
- `latestWeek`: the last complete row''s week label (skip rows with all nulls)
- `latestLeads`: latest non-null leads value
- `latestNewsletter`: latest non-null newsletter open rate
- `latestWebinar`: latest non-null webinar signups
- `latestOrganic`: latest non-null organic visitors
- `latestPageViews`: latest non-null page views
', '(() => {
  const weeks = WEEKS_PLACEHOLDER;
  const latestWeek = LATEST_WEEK_PLACEHOLDER;
  const latestLeads = LATEST_LEADS_PLACEHOLDER;
  const latestNewsletter = LATEST_NEWSLETTER_PLACEHOLDER;
  const latestWebinar = LATEST_WEBINAR_PLACEHOLDER;
  const latestOrganic = LATEST_ORGANIC_PLACEHOLDER;
  const latestPageViews = LATEST_PAGE_VIEWS_PLACEHOLDER;

  const validWeeks = weeks.filter(w => w.leads != null || w.organicVisitors != null);

  return (
    <MetricSection>
      <MetricRow>
        <StatCard label={''Leads (30d)''} value={latestLeads || ''—''} subtitle={''Week of '' + latestWeek} />
        <StatCard label={''Newsletter Open''} value={latestNewsletter ? latestNewsletter + ''%'' : ''—''} subtitle={''Open rate''} />
        <StatCard label={''Webinar Signups''} value={latestWebinar || ''—''} subtitle={''Latest week''} />
        <StatCard label={''Organic Visitors''} value={latestOrganic || ''—''} subtitle={''Trailing 30 days''} />
      </MetricRow>

      <div style={{ height: 280, background: theme.panel, borderRadius: 16, padding: 20, border: ''1px solid '' + theme.line }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Leads & Organic Traffic</div>
        <ResponsiveContainer width="100%" height="90%">
          <ComposedChart data={validWeeks} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="week" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <Legend />
            <Bar dataKey="leads" name="Leads" fill={theme.accent} radius={[4, 4, 0, 0]} />
            <Line type="monotone" dataKey="organicVisitors" name="Organic Visitors" stroke="#16a34a" strokeWidth={2} dot={{ fill: ''#16a34a'', r: 3 }} />
          </ComposedChart>
        </ResponsiveContainer>
      </div>

      <div style={{ display: ''grid'', gridTemplateColumns: ''1fr 1fr'', gap: 16, marginTop: 16 }}>
        <div style={{ height: 260, background: theme.panel, borderRadius: 16, padding: 16, border: ''1px solid '' + theme.line }}>
          <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Newsletter Open Rate %</div>
          <ResponsiveContainer width="100%" height="85%">
            <LineChart data={validWeeks.filter(w => w.newsletterRate != null)} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
              <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
              <XAxis dataKey="week" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} />
              <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} tickFormatter={(v) => v + ''%''} domain={[40, 65]} />
              <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 12 }} formatter={(v) => [v + ''%'', ''Open Rate'']} />
              <Line type="monotone" dataKey="newsletterRate" stroke={theme.accent} strokeWidth={2} dot={{ fill: theme.accent, r: 4 }} />
            </LineChart>
          </ResponsiveContainer>
        </div>

        <div style={{ height: 260, background: theme.panel, borderRadius: 16, padding: 16, border: ''1px solid '' + theme.line }}>
          <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Website Page Views (30d)</div>
          <ResponsiveContainer width="100%" height="85%">
            <AreaChart data={validWeeks.filter(w => w.pageViews != null && w.pageViews > 0)} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
              <defs>
                <linearGradient id="mktgPvGrad" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0%" stopColor="#8b5cf6" stopOpacity={0.15} />
                  <stop offset="100%" stopColor="#8b5cf6" stopOpacity={0.02} />
                </linearGradient>
              </defs>
              <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
              <XAxis dataKey="week" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} />
              <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} />
              <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 12 }} formatter={(v) => [v.toLocaleString(), ''Page Views'']} />
              <Area type="monotone" dataKey="pageViews" stroke="#8b5cf6" strokeWidth={2} fill="url(#mktgPvGrad)" />
            </AreaChart>
          </ResponsiveContainer>
        </div>
      </div>

      <div style={{ height: 260, background: theme.panel, borderRadius: 16, padding: 16, marginTop: 16, border: ''1px solid '' + theme.line }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>LinkedIn Engagement Rate %</div>
        <ResponsiveContainer width="100%" height="85%">
          <LineChart data={validWeeks.filter(w => w.linkedinRoss != null)} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="week" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} tickFormatter={(v) => v + ''%''} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 12 }} formatter={(v) => [v + ''%'']} />
            <Legend />
            <Line type="monotone" dataKey="linkedinRoss" name="Ross" stroke={theme.accent} strokeWidth={2} dot={{ fill: theme.accent, r: 3 }} />
            <Line type="monotone" dataKey="linkedinKiingo" name="Kiingo" stroke={theme.secondary} strokeWidth={2} dot={{ fill: theme.secondary, r: 3 }} />
          </LineChart>
        </ResponsiveContainer>
      </div>

      <MetricNote>Source: Notion Leadership Team · Sales/Marketing Scorecard</MetricNote>
    </MetricSection>
  );
})()', 259200, 'claude', NULL, NULL, 1, 0, '{"aliases": ["marketing scorecard", "marketing metrics", "weekly marketing"]}', '2026-02-18T01:06:32+00:00', '2026-02-18T01:06:32+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('6353801b-e51e-491d-ab5e-a780ed36b62a', 'Monthly Net Income', 'monthly-net-income', 'Retrieve monthly net income from QuickBooks P&L.

## Data Source
QuickBooks Online P&L via Kiingo MCP `quickbooks.profitAndLoss()`.

## Retrieval Steps
1. Call `quickbooks.profitAndLoss({ params: { start_date: ''<12 months ago, 1st of month>'', end_date: ''<last day of current month>'', summarize_column_by: ''Month'' } })`.
2. Parse the Rows tree. Extract "Net Income" row for each month column.
3. Also extract "Gross Profit" and "Total Expenses" for context.
4. Compute trailing 3-month average of net income.

## Values to Return
- `monthlyData`: array of { month (short label), netIncome, grossProfit, expenses }
- `currentMonth`: net income for current (partial) month
- `priorMonth`: net income for prior full month
- `trailing3Avg`: average net income for last 3 full months
- `ltmTotal`: sum of last 12 months net income', '(() => {
  const data = DATA_PLACEHOLDER;
  const currentMonth = CURRENT_MONTH_PLACEHOLDER;
  const trailing3Avg = TRAILING3_PLACEHOLDER;
  const ltmTotal = LTM_PLACEHOLDER;

  return (
    <MetricSection>
      <MetricRow>
        <StatCard label="This Month" value={''$'' + (currentMonth / 1000).toFixed(0) + ''K''} subtitle="In progress" />
        <StatCard label="3-Mo Avg" value={''$'' + (trailing3Avg / 1000).toFixed(0) + ''K''} subtitle="Trailing avg" />
        <StatCard label="LTM Net Income" value={''$'' + (ltmTotal / 1000).toFixed(0) + ''K''} subtitle="Last 12 months" />
      </MetricRow>
      <div style={{ height: 320, background: theme.panel, borderRadius: 16, padding: 20, border: `1px solid ${theme.line}` }}>
        <ResponsiveContainer width="100%" height="100%">
          <AreaChart data={data} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <defs>
              <linearGradient id="niGrad" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stopColor={theme.gradientFrom} stopOpacity={0.3} />
                <stop offset="100%" stopColor={theme.gradientFrom} stopOpacity={0.02} />
              </linearGradient>
            </defs>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="month" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} tickFormatter={v => ''$'' + (v / 1000) + ''K''} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: `1px solid ${theme.tooltipBorder}`, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} formatter={v => ''$'' + Number(v).toLocaleString()} />
            <ReferenceLine y={0} stroke={theme.danger} strokeWidth={1.5} />
            <Area type="monotone" dataKey="netIncome" name="Net Income" stroke={theme.accent} strokeWidth={2.5} fill="url(#niGrad)" dot={{ fill: theme.accent, r: 3, strokeWidth: 0 }} />
          </AreaChart>
        </ResponsiveContainer>
      </div>
      <MetricNote>Source: QuickBooks P&L (Accrual) via Kiingo MCP</MetricNote>
    </MetricSection>
  );
})()', 259200, 'claude', NULL, NULL, 1, 0, '{"aliases":["net income","profit","bottom line","P&L"]}', '2026-02-15T05:56:04.064862+00:00', '2026-02-15T05:56:04.064862+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('35231c42-b088-4da4-b2f2-f25ebce87e36', 'Monthly Revenue Invoiced', 'monthly-revenue', 'Retrieve monthly invoiced revenue from QuickBooks invoices AND actual collections from QuickBooks payments, grouped by the month each transaction occurred.

## Data Source
QuickBooks Online Invoices and Payments via Kiingo MCP `quickbooks.query()`.

## Retrieval Steps

### Step 1: Invoices (what was billed)
Query all invoices for the trailing 12 months:
```
quickbooks.query({ query: "SELECT TxnDate, TotalAmt FROM Invoice WHERE TxnDate >= ''<12 months ago, 1st of month>'' AND TxnDate <= ''<last day of current month>'' ORDERBY TxnDate", maxResults: 1000 })
```
Group by month of TxnDate. Sum TotalAmt per month to get `invoiced`. Count invoices per month.

### Step 2: Payments (what was actually collected)
Query all payments for the same trailing 12 months:
```
quickbooks.query({ query: "SELECT TxnDate, TotalAmt FROM Payment WHERE TxnDate >= ''<12 months ago, 1st of month>'' AND TxnDate <= ''<last day of current month>'' ORDERBY TxnDate", maxResults: 1000 })
```
Group by month of TxnDate. Sum TotalAmt per month to get `collected`.

**IMPORTANT**: The `collected` value MUST come from Payment records grouped by the payment''s own TxnDate — NOT from Invoice.Balance. Invoice.Balance shows the current outstanding balance today, which makes old invoices look fully collected in the same month they were issued. Using Payment.TxnDate correctly shows when cash was actually received.

### Step 3: Combine
For each month build: { month (short label e.g. "Mar 25"), invoiced, collected, count }.
Compute currentMonth (invoiced for current partial month), priorMonth (invoiced for prior full month), ltmTotal (sum of all 12 months invoiced), and ltmCollected (sum of all 12 months collected).

## Values to Return
- `monthlyData`: array of { month, invoiced, collected, count }
- `currentMonth`: invoiced total for current (partial) month
- `priorMonth`: invoiced total for prior full month
- `ltmTotal`: sum of all 12 months invoiced
- `ltmCollected`: sum of all 12 months collected', '(() => {
  const data = DATA_PLACEHOLDER;
  const currentMonth = CURRENT_MONTH_PLACEHOLDER;
  const priorMonth = PRIOR_MONTH_PLACEHOLDER;
  const ltmTotal = LTM_PLACEHOLDER;

  return (
    <MetricSection>
      <MetricRow>
        <StatCard label="This Month" value={''$'' + (currentMonth / 1000).toFixed(0) + ''K''} subtitle="Invoiced" />
        <StatCard label="Last Month" value={''$'' + (priorMonth / 1000).toFixed(0) + ''K''} subtitle="Invoiced" />
        <StatCard label="LTM Invoiced" value={''$'' + (ltmTotal / 1000).toFixed(0) + ''K''} subtitle="Last 12 months" />
      </MetricRow>
      <div style={{ height: 320, background: theme.panel, borderRadius: 16, padding: 20, border: `1px solid ${theme.line}` }}>
        <ResponsiveContainer width="100%" height="100%">
          <LineChart data={data} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="month" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} tickFormatter={v => ''$'' + (v / 1000) + ''K''} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: `1px solid ${theme.tooltipBorder}`, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} formatter={v => ''$'' + Number(v).toLocaleString()} />
            <Legend wrapperStyle={{ fontSize: 12, paddingTop: 8 }} />
            <Line type="monotone" dataKey="invoiced" name="Invoiced" stroke="#2563eb" strokeWidth={2.5} dot={{ r: 3, fill: ''#2563eb'' }} />
            <Line type="monotone" dataKey="collected" name="Collected" stroke="#16a34a" strokeWidth={2.5} dot={{ r: 3, fill: ''#16a34a'' }} strokeDasharray="6 3" />
          </LineChart>
        </ResponsiveContainer>
      </div>
      <MetricNote>Source: QuickBooks Invoices + Payments via Kiingo MCP</MetricNote>
    </MetricSection>
  );
})()', 259200, 'claude', NULL, NULL, 1, 0, '{"aliases":["MRR","revenue","invoiced","monthly revenue"]}', '2026-02-15T05:56:04.064862+00:00', '2026-02-17T01:59:31+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('d377f67d-eef4-4820-8041-d230232856e0', 'Monthly Revenue Tracker', 'monthly-revenue-tracker', 'Pull the current month''s revenue deals from the Revenue Tracker 2026 Excel workbook in Sohrab''s OneDrive and compute summary metrics.

## Data Source
Kiingo MCP `excel` module reading from Sohrab Azad''s OneDrive.

**File location**: Search for the file or use the known item ID.

    import { sharepoint, excel } from ''tools'';

    // Find the file
    const files = await sharepoint.searchItems({
      userId: ''sohrab@kiingo.com'',
      query: ''Revenue Tracker 2026'',
      fileExtension: ''xlsx''
    });
    const itemId = files[0].id;

## Retrieval Steps

1. Determine the current month name and year (e.g., "February 2026").
2. Construct the worksheet name: `[Month] [Year] MASTER` (e.g., "February 2026 MASTER").
3. Read the worksheet''s used range:

       const data = await excel.getUsedRange({
         itemId: itemId,
         userId: ''sohrab@kiingo.com'',
         worksheetName: ''February 2026 MASTER'',
         valuesOnly: true
       });
       const rows = data.range.values;

4. The first row is headers: Client, Close Date, $ Amount, $ Invoiced, Service, New Biz/Upsell, Start Date, One-time/Subscription, CC/ACH
5. Parse data rows (skip header row 0). Stop when you hit the TOTAL row (client = "TOTAL") or empty rows.
6. **Close Date conversion**: Close dates are Excel serial numbers (days since 1899-12-30). Convert to human-readable dates:
   - `new Date((serialNumber - 25569) * 86400 * 1000)` gives a JS Date.
   - Some dates may be strings instead of numbers — handle both.
7. Filter out rows where Client is empty/null/blank.
8. Filter out cancelled deals (service containing "CANCELLED" or "BACKED OUT").
9. Exclude the TOTAL summary row from the deals list.

## Computations

- `totalRevenue`: sum of all $ Amount values
- `totalInvoiced`: sum of all $ Invoiced values
- `outstandingInvoice`: totalRevenue - totalInvoiced
- `dealCount`: number of valid deals
- `avgDealSize`: totalRevenue / dealCount (rounded to nearest dollar)
- `newBizCount` / `newBizRevenue`: count and sum where New Biz/Upsell contains "New"
- `upsellCount` / `upsellRevenue`: count and sum where New Biz/Upsell contains "Upsell"
- `byService`: array of { service, count, revenue } grouped by Service column (clean up service names — remove user count parentheticals for grouping, e.g., "Private AI Foundational Bootcamp (24 users)" becomes "Private AI Foundational Bootcamp"). Sort by revenue descending.
- `deals`: array of all deals sorted by close date, each with:
  - `client`: string
  - `amount`: number
  - `invoiced`: number or 0
  - `service`: string (full, with user counts)
  - `type`: "New Biz" or "Upsell"
  - `closeDate`: formatted string (e.g., "Feb 3")
  - `payment`: "ACH", "CC", or ""
- `monthLabel`: e.g., "February 2026"

## Values to Return
- `totalRevenue`: number
- `totalInvoiced`: number
- `outstandingInvoice`: number
- `dealCount`: number
- `avgDealSize`: number
- `newBizCount`: number
- `newBizRevenue`: number
- `upsellCount`: number
- `upsellRevenue`: number
- `byService`: array of { service, count, revenue }
- `deals`: array of { client, amount, invoiced, service, type, closeDate, payment }
- `monthLabel`: string
', '(() => {
  const totalRevenue = TOTAL_REVENUE_PLACEHOLDER;
  const totalInvoiced = TOTAL_INVOICED_PLACEHOLDER;
  const outstanding = OUTSTANDING_PLACEHOLDER;
  const dealCount = DEAL_COUNT_PLACEHOLDER;
  const avgDeal = AVG_DEAL_PLACEHOLDER;
  const newBizCount = NEW_BIZ_COUNT_PLACEHOLDER;
  const newBizRevenue = NEW_BIZ_REVENUE_PLACEHOLDER;
  const upsellCount = UPSELL_COUNT_PLACEHOLDER;
  const upsellRevenue = UPSELL_REVENUE_PLACEHOLDER;
  const byService = BY_SERVICE_PLACEHOLDER;
  const deals = DEALS_PLACEHOLDER;
  const monthLabel = MONTH_LABEL_PLACEHOLDER;

  const fmt = (n) => ''$'' + (n || 0).toLocaleString();

  return (
    <MetricSection>
      <MetricRow>
        <StatCard label="Total Revenue" value={fmt(totalRevenue)} subtitle={monthLabel} />
        <StatCard label="Invoiced" value={fmt(totalInvoiced)} subtitle={outstanding > 0 ? fmt(outstanding) + '' outstanding'' : ''All invoiced''} />
        <StatCard label="Deals" value={dealCount} subtitle={''Avg '' + fmt(avgDeal)} />
      </MetricRow>
      <MetricRow>
        <StatCard label="New Business" value={fmt(newBizRevenue)} subtitle={newBizCount + '' deals''} />
        <StatCard label="Upsells" value={fmt(upsellRevenue)} subtitle={upsellCount + '' deals''} />
      </MetricRow>

      <div style={{ height: 280, background: theme.panel, borderRadius: 16, padding: 20, border: ''1px solid '' + theme.line }}>
        <ResponsiveContainer width="100%" height="100%">
          <BarChart data={byService} margin={{ top: 10, right: 10, left: 10, bottom: 40 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="service" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} angle={-25} textAnchor="end" interval={0} />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} tickFormatter={(v) => ''$'' + (v / 1000).toFixed(0) + ''K''} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} formatter={(v) => [''$'' + v.toLocaleString(), ''Revenue'']} />
            <Bar dataKey="revenue" fill={theme.accent} radius={[6, 6, 0, 0]} />
          </BarChart>
        </ResponsiveContainer>
      </div>

      <div style={{ marginTop: 16, background: theme.panel, borderRadius: 16, padding: 16, border: ''1px solid '' + theme.line, overflowX: ''auto'' }}>
        <table style={{ width: ''100%'', borderCollapse: ''collapse'', fontSize: 13 }}>
          <thead>
            <tr style={{ borderBottom: ''2px solid '' + theme.line }}>
              <th style={{ textAlign: ''left'', padding: ''8px 12px'', color: theme.inkMuted, fontWeight: 600 }}>Client</th>
              <th style={{ textAlign: ''right'', padding: ''8px 12px'', color: theme.inkMuted, fontWeight: 600 }}>Amount</th>
              <th style={{ textAlign: ''right'', padding: ''8px 12px'', color: theme.inkMuted, fontWeight: 600 }}>Invoiced</th>
              <th style={{ textAlign: ''left'', padding: ''8px 12px'', color: theme.inkMuted, fontWeight: 600 }}>Service</th>
              <th style={{ textAlign: ''left'', padding: ''8px 12px'', color: theme.inkMuted, fontWeight: 600 }}>Type</th>
              <th style={{ textAlign: ''left'', padding: ''8px 12px'', color: theme.inkMuted, fontWeight: 600 }}>Closed</th>
            </tr>
          </thead>
          <tbody>
            {deals.map((d, i) => (
              <tr key={i} style={{ borderBottom: ''1px solid '' + theme.line }}>
                <td style={{ padding: ''8px 12px'', color: theme.ink }}>{d.client}</td>
                <td style={{ padding: ''8px 12px'', color: theme.ink, textAlign: ''right'', fontVariantNumeric: ''tabular-nums'' }}>{fmt(d.amount)}</td>
                <td style={{ padding: ''8px 12px'', color: d.invoiced ? theme.ink : theme.inkMuted, textAlign: ''right'', fontVariantNumeric: ''tabular-nums'' }}>{d.invoiced ? fmt(d.invoiced) : ''—''}</td>
                <td style={{ padding: ''8px 12px'', color: theme.inkMuted, fontSize: 12 }}>{d.service}</td>
                <td style={{ padding: ''8px 12px'' }}><span style={{ padding: ''2px 8px'', borderRadius: 8, fontSize: 11, fontWeight: 600, background: d.type === ''New Biz'' ? theme.accent + ''22'' : theme.secondary + ''22'', color: d.type === ''New Biz'' ? theme.accent : theme.secondary }}>{d.type}</span></td>
                <td style={{ padding: ''8px 12px'', color: theme.inkMuted, fontSize: 12 }}>{d.closeDate}</td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>

      <MetricNote>Source: Revenue Tracker 2026.xlsx (Sohrab Azad, OneDrive) via Kiingo MCP</MetricNote>
    </MetricSection>
  );
})()', 259200, 'claude', NULL, NULL, 1, 0, '{}', '2026-02-17T23:34:33+00:00', '2026-02-17T23:34:33+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('aabb87b0-1bca-4179-9c6f-20272d1de5dc', 'Operating Leverage', 'operating-leverage', 'Track revenue vs total expenses monthly to show operating leverage.

## Data Source
QuickBooks P&L via `quickbooks.profitAndLoss()`.

## Retrieval Steps
1. Call `quickbooks.profitAndLoss({ params: { start_date: ''<12mo ago>'', end_date: ''<today>'', summarize_column_by: ''Month'' } })`.
2. For each month, extract Total Income (revenue) and Total Expenses.
3. Compute the spread: revenue - expenses (this equals net income).
4. Show trend of how expenses scale relative to revenue growth.

## Values to Return
- `monthlyData`: array of { month, revenue, expenses }
- `ltmRevenue`: sum of LTM revenue
- `ltmExpenses`: sum of LTM expenses
- `opExRatio`: LTM expenses / revenue percentage', '(() => {
  const data = DATA_PLACEHOLDER;
  return (
    <MetricSection>
      <div style={{ height: 300, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line }}>
        <ResponsiveContainer width="100%" height="100%">
          <AreaChart data={data} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="month" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} tickFormatter={v => ''$'' + (v/1000) + ''K''} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} formatter={v => ''$'' + Number(v).toLocaleString()} />
            <Area type="monotone" dataKey="revenue" name="Revenue" stroke={theme.accent} fill={theme.accent} fillOpacity={0.15} strokeWidth={2} />
            <Area type="monotone" dataKey="expenses" name="Expenses" stroke={theme.danger} fill={theme.danger} fillOpacity={0.1} strokeWidth={2} />
          </AreaChart>
        </ResponsiveContainer>
      </div>
      <MetricNote>The gap between lines represents net income | QuickBooks P&L</MetricNote>
    </MetricSection>
  );
})()', 259200, 'claude', NULL, NULL, 1, 0, '{"aliases":["opex","operating costs","leverage"]}', '2026-02-15T06:29:29+00:00', '2026-02-15T06:29:29+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('8123728e-8c27-4272-9123-ca9b8cda9ddb', 'Ops Follow-Up Snapshot', 'ops-followup-snapshot', 'Read today''s OPS Follow-Up Metrics Report from the CRM SharePoint site and extract pipeline follow-up health data.

## Data Source
SharePoint CRM site → Latest OPS-Follow-up-Metrics-Report xlsx → "Follow-Up Metrics Summary" worksheet

## Retrieval Steps

### Step 1: Find the latest OPS report
```typescript
import { sharepoint } from ''tools'';
const items = await sharepoint.searchItems({
  siteId: ''kiingo.sharepoint.com,8cb6f37c-91b4-4196-8c80-7a9d56f451cb,fa64a87a-e711-4141-bc08-c8ebe6a524b6'',
  query: ''OPS-Follow-up-Metrics-Report'',
  itemType: ''file'',
  fileExtension: ''xlsx''
});
```
Sort results by `lastModifiedDateTime` descending and pick the first (most recent) item. Note its `id` (this is the `itemId`).

### Step 2: Read the Summary worksheet
```typescript
import { excel } from ''tools'';
const result = await excel.getUsedRange({
  siteId: ''kiingo.sharepoint.com,8cb6f37c-91b4-4196-8c80-7a9d56f451cb,fa64a87a-e711-4141-bc08-c8ebe6a524b6'',
  itemId: ''<itemId from step 1>'',
  worksheetName: ''Follow-Up Metrics Summary'',
  valuesOnly: true
});
```

### Step 3: Parse the summary data
The worksheet rows (0-indexed):
- Row 2: "Generated at: <date string>"
- Row 5: ["Total Open Deals", <number>]
- Row 6: ["With Discovery Call", <number>]
- Row 7: ["Without Discovery Call", <number>]
- Row 8: ["Likely Cold Deals", <number>]
- Row 9: ["Overdue Follow-Ups (>14 days)", <number>]
- Row 10: ["Follow-Up Needed After Discovery", <number>]
- Row 11: ["Average Days Since Last Contact", <number>]
- Rows 14-21: Follow-up range distribution — each row is [rangeName, dealCount, ...]
  - Row 14: "01. 0-3 days"
  - Row 15: "02. 3-7 days"
  - Row 16: "03. 7-14 days"
  - Row 17: "04. 14-30 days"
  - Row 18: "05. 30-60 days"
  - Row 19: "06. 60-90 days"
  - Row 20: "07. 90-180 days"
  - Row 21: "08. 180+ days"
- Rows 44+: Per-rep breakdown — each row is [email, totalDeals, likelyCold, coldPct%, bar]
  Continue reading rows until empty.

### Step 4: Structure the data

For `followUpRanges`, create three fields per range for color-coded stacked bars:
- Ranges "01. 0-3 days" and "02. 3-7 days": put count in `healthy` field, 0 for `warning` and `danger`
- Ranges "03. 7-14 days" and "04. 14-30 days": put count in `warning` field, 0 for others
- Ranges "05." through "08.": put count in `danger` field, 0 for others

Use short labels for display: "0-3d", "3-7d", "7-14d", "14-30d", "30-60d", "60-90d", "90-180d", "180+d"

For `repBreakdown`, extract the rep name from the email (part before @), compute `active = totalDeals - likelyCold`.

## Values to Return
- `generatedAt`: date string from row 2 (just the date portion)
- `totalOpenDeals`: number
- `withDiscovery`: number
- `withoutDiscovery`: number
- `likelyCold`: number
- `overdueFollowUps`: number
- `followUpNeeded`: number
- `avgDaysSinceContact`: number
- `followUpRanges`: array of { range, healthy, warning, danger }
- `repBreakdown`: array of { rep, totalDeals, active, likelyCold, coldPct } sorted by totalDeals desc
', '(() => {
  const totalOpenDeals = TOTAL_OPEN_DEALS_PLACEHOLDER;
  const likelyCold = LIKELY_COLD_PLACEHOLDER;
  const overdueFollowUps = OVERDUE_FOLLOWUPS_PLACEHOLDER;
  const avgDays = AVG_DAYS_PLACEHOLDER;
  const followUpRanges = FOLLOWUP_RANGES_PLACEHOLDER;
  const repBreakdown = REP_BREAKDOWN_PLACEHOLDER;
  const generatedAt = GENERATED_AT_PLACEHOLDER;

  return (
    <MetricSection>
      <MetricRow>
        <StatCard label={''Open Deals''} value={totalOpenDeals} subtitle={''Total pipeline''} />
        <StatCard label={''Likely Cold''} value={likelyCold} subtitle={((likelyCold / totalOpenDeals) * 100).toFixed(0) + ''% of pipeline''} />
        <StatCard label={''Overdue >14d''} value={overdueFollowUps} subtitle={((overdueFollowUps / totalOpenDeals) * 100).toFixed(0) + ''% of deals''} />
        <StatCard label={''Avg Days Since Contact''} value={avgDays.toFixed(1)} subtitle={''Lower is better''} />
      </MetricRow>

      <div style={{ height: 300, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Follow-Up Range Distribution</div>
        <ResponsiveContainer width="100%" height="90%">
          <BarChart data={followUpRanges} margin={{ top: 10, right: 10, left: 0, bottom: 40 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="range" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} angle={-25} textAnchor="end" />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <Legend />
            <Bar dataKey="healthy" name="Healthy (0-7d)" stackId="a" fill="#16a34a" radius={[0, 0, 0, 0]} />
            <Bar dataKey="warning" name="Needs Attention (7-30d)" stackId="a" fill="#eab308" radius={[0, 0, 0, 0]} />
            <Bar dataKey="danger" name="At Risk (30d+)" stackId="a" fill={theme.danger} radius={[4, 4, 0, 0]} />
          </BarChart>
        </ResponsiveContainer>
      </div>

      <div style={{ height: 280, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 16 }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Ops Rep Follow-Up Health</div>
        <ResponsiveContainer width="100%" height="90%">
          <BarChart data={repBreakdown} layout="vertical" margin={{ top: 10, right: 30, left: 60, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis type="number" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis type="category" dataKey="rep" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} width={55} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <Legend />
            <Bar dataKey="active" name="Active" stackId="a" fill={theme.accent} radius={[0, 0, 0, 0]} />
            <Bar dataKey="likelyCold" name="Likely Cold" stackId="a" fill={theme.danger} radius={[0, 4, 4, 0]} />
          </BarChart>
        </ResponsiveContainer>
      </div>

      <MetricNote>Source: CRM SharePoint · OPS Follow-Up Metrics Report · {generatedAt}</MetricNote>
    </MetricSection>
  );
})()', 86400, 'claude', NULL, NULL, 1, 0, '{"aliases": ["ops follow-up", "ops followup", "operations follow-up", "ops pipeline health"]}', '2026-02-18T23:55:55+00:00', '2026-02-18T23:55:55+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('07d10edf-0dae-4566-8cb3-6c3d0d80895d', 'Ops Follow-Up Trends', 'ops-followup-trends', 'Track daily trends in OPS follow-up pipeline health by reading the last 14 daily OPS Follow-Up Metrics Reports from the CRM SharePoint site.

## Data Source
SharePoint CRM site → Multiple OPS-Follow-up-Metrics-Report xlsx files → "Follow-Up Metrics Summary" worksheets

## Retrieval Steps

### Step 1: Find all OPS reports
```typescript
import { sharepoint } from ''tools'';
const items = await sharepoint.searchItems({
  siteId: ''kiingo.sharepoint.com,8cb6f37c-91b4-4196-8c80-7a9d56f451cb,fa64a87a-e711-4141-bc08-c8ebe6a524b6'',
  query: ''OPS-Follow-up-Metrics-Report'',
  itemType: ''file'',
  fileExtension: ''xlsx''
});
```
Sort results by `lastModifiedDateTime` descending. Extract the date from each filename (the ISO timestamp portion, e.g. "2026-02-18" from "OPS-Follow-up-Metrics-Report-2026-02-18T11-11-59.622Z.xlsx"). Group by date and keep only the latest report per day. Select up to 14 most recent days.

### Step 2: Read each Summary worksheet
For each of the selected reports, read the summary sheet:
```typescript
import { excel } from ''tools'';
const result = await excel.getUsedRange({
  siteId: ''kiingo.sharepoint.com,8cb6f37c-91b4-4196-8c80-7a9d56f451cb,fa64a87a-e711-4141-bc08-c8ebe6a524b6'',
  itemId: ''<itemId>'',
  worksheetName: ''Follow-Up Metrics Summary'',
  valuesOnly: true
});
```

### Step 3: Parse summary data from each report
From each worksheet extract by row index (0-indexed):
- Row 5, col 1: Total Open Deals
- Row 8, col 1: Likely Cold Deals
- Row 9, col 1: Overdue Follow-Ups (>14 days)
- Row 11, col 1: Average Days Since Last Contact
- Rows 14-15, col 1: Healthy count (sum of "01. 0-3 days" + "02. 3-7 days" deal counts)
- Rows 18-21, col 1: At Risk count (sum of "05. 30-60 days" through "08. 180+ days" deal counts)

### Step 4: Structure as time series
Build an array sorted by date ascending. Each entry:
- `date`: short label (e.g. "2/14")
- `totalDeals`: total open deals
- `likelyCold`: likely cold count
- `overdue`: overdue >14 days count
- `avgDays`: average days since contact
- `healthy`: sum of 0-7 day buckets
- `atRisk`: sum of 30+ day buckets

Also compute:
- `latestDate`: most recent report date (full date string)
- `coldTrend`: compare the last 3 data points — "improving" if likelyCold decreased consistently, "worsening" if increased, "stable" otherwise
- `overdueTrend`: same logic for overdue count
- `daysReported`: number of days with data

## Values to Return
- `dailyData`: array of { date, totalDeals, likelyCold, overdue, avgDays, healthy, atRisk }
- `latestDate`: string
- `coldTrend`: "improving" | "worsening" | "stable"
- `overdueTrend`: "improving" | "worsening" | "stable"
- `daysReported`: number
', '(() => {
  const dailyData = DAILY_DATA_PLACEHOLDER;
  const latestDate = LATEST_DATE_PLACEHOLDER;
  const coldTrend = COLD_TREND_PLACEHOLDER;
  const overdueTrend = OVERDUE_TREND_PLACEHOLDER;
  const daysReported = DAYS_REPORTED_PLACEHOLDER;

  const latest = dailyData[dailyData.length - 1] || {};

  const trendIcon = (t) => t === ''improving'' ? '' ↓'' : t === ''worsening'' ? '' ↑'' : '' →'';

  return (
    <MetricSection>
      <MetricRow>
        <StatCard label={''Likely Cold''} value={latest.likelyCold} subtitle={coldTrend + trendIcon(coldTrend)} />
        <StatCard label={''Overdue >14d''} value={latest.overdue} subtitle={overdueTrend + trendIcon(overdueTrend)} />
        <StatCard label={''Avg Contact Days''} value={latest.avgDays?.toFixed(1)} subtitle={daysReported + ''-day trend''} />
        <StatCard label={''At Risk Deals''} value={latest.atRisk} subtitle={''30+ days stale''} />
      </MetricRow>

      <div style={{ height: 280, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Likely Cold & Overdue Deals Over Time</div>
        <ResponsiveContainer width="100%" height="90%">
          <LineChart data={dailyData} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="date" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <Legend />
            <Line type="monotone" dataKey="likelyCold" name="Likely Cold" stroke={theme.danger} strokeWidth={2} dot={{ fill: theme.danger, r: 3 }} />
            <Line type="monotone" dataKey="overdue" name="Overdue >14d" stroke="#eab308" strokeWidth={2} dot={{ fill: ''#eab308'', r: 3 }} />
          </LineChart>
        </ResponsiveContainer>
      </div>

      <div style={{ display: ''grid'', gridTemplateColumns: ''1fr 1fr'', gap: 16, marginTop: 16 }}>
        <div style={{ height: 260, background: theme.panel, borderRadius: 16, padding: 16, border: ''1px solid '' + theme.line }}>
          <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Avg Days Since Contact</div>
          <ResponsiveContainer width="100%" height="85%">
            <AreaChart data={dailyData} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
              <defs>
                <linearGradient id="opsAvgDaysGrad" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0%" stopColor={theme.accent} stopOpacity={0.15} />
                  <stop offset="100%" stopColor={theme.accent} stopOpacity={0.02} />
                </linearGradient>
              </defs>
              <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
              <XAxis dataKey="date" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} />
              <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} />
              <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 12 }} formatter={(v) => [v.toFixed(1) + '' days'', ''Avg Contact'']} />
              <Area type="monotone" dataKey="avgDays" stroke={theme.accent} strokeWidth={2} fill="url(#opsAvgDaysGrad)" />
            </AreaChart>
          </ResponsiveContainer>
        </div>

        <div style={{ height: 260, background: theme.panel, borderRadius: 16, padding: 16, border: ''1px solid '' + theme.line }}>
          <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Healthy vs At Risk</div>
          <ResponsiveContainer width="100%" height="85%">
            <BarChart data={dailyData} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
              <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
              <XAxis dataKey="date" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} />
              <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} />
              <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 12 }} />
              <Legend />
              <Bar dataKey="healthy" name="Healthy (0-7d)" fill="#16a34a" radius={[4, 4, 0, 0]} />
              <Bar dataKey="atRisk" name="At Risk (30d+)" fill={theme.danger} radius={[4, 4, 0, 0]} />
            </BarChart>
          </ResponsiveContainer>
        </div>
      </div>

      <MetricNote>Source: CRM SharePoint · {daysReported} daily OPS reports · Latest: {latestDate}</MetricNote>
    </MetricSection>
  );
})()', 86400, 'claude', NULL, NULL, 1, 0, '{"aliases": ["ops follow-up trends", "operations trends", "ops pipeline trends", "ops staleness"]}', '2026-02-18T23:55:55+00:00', '2026-02-18T23:55:55+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('c8f0a7ec-5cc2-4990-b7e1-9cf0f247992c', 'Pipeline by Product', 'pipeline-by-product', 'Retrieve open deal pipeline value grouped by pipeline type from HubSpot.

## Data Source
HubSpot Deals via `hubspot.listDeals()`.

## Retrieval Steps
1. Paginate all deals: `hubspot.listDeals({ limit: 100, properties: [''amount'',''pipeline'',''hs_is_closed'',''dealstage''] })`.
2. Filter to open deals (hs_is_closed !== ''true'').
3. Get pipeline labels using `hubspot.getDealPipelines()`.
4. Group open deals by pipeline label. Sum amounts and count deals per pipeline.
5. Sort by total value descending. Group small pipelines (<$50K) into "Other".

## Values to Return
- `byProduct`: array of { name (pipeline label), value (total amount), count (deal count) }
- `totalPipeline`: sum of all open deal amounts
- `totalDeals`: count of all open deals', '(() => {
  const data = DATA_PLACEHOLDER;
  const total = TOTAL_PLACEHOLDER;
  return (
    <MetricSection>
      <StatCard label="Total Pipeline" value={''$'' + (total / 1000).toFixed(0) + ''K''} subtitle={data.length + '' product lines''} />
      <div style={{ height: 260, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
        <ResponsiveContainer width="100%" height="100%">
          <BarChart data={data} layout="vertical" margin={{ top: 5, right: 20, left: 80, bottom: 5 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis type="number" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} tickFormatter={v => ''$'' + (v/1000) + ''K''} />
            <YAxis type="category" dataKey="name" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} width={75} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} formatter={v => ''$'' + Number(v).toLocaleString()} />
            <Bar dataKey="value" name="Pipeline Value" fill={theme.accent} radius={[0,4,4,0]} />
          </BarChart>
        </ResponsiveContainer>
      </div>
    </MetricSection>
  );
})()', 259200, 'claude', NULL, NULL, 1, 0, '{"aliases":["product pipeline","pipeline products"]}', '2026-02-15T06:29:29+00:00', '2026-02-15T06:29:29+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('3ec99942-c4b5-4702-bce5-9e712cc978a8', 'Q1 2026 Rocks Progress', 'quarterly-rocks-progress', 'Track quarterly rocks (strategic objectives) progress from Asana projects.

## Data Source
Asana Projects and Tasks via Kiingo MCP.

## Retrieval Steps
1. Search Asana projects matching rock pattern (numbered projects like "1.1:", "2.1:", etc.).
2. Group by rock number (1-7). For each rock:
   - Count total sub-projects
   - Count completed vs total tasks across all sub-projects
   - Compute completion percentage
3. Build rocks array sorted by rock number.

## Values to Return
- `rocks`: array of { rock (name), projects, tasksComplete, tasksTotal, pct }
- `overallProgress`: weighted average completion across all rocks
- `atRiskRocks`: rocks with < 20% completion past quarter midpoint', '(() => {
  const data = DATA_PLACEHOLDER;
  const overall = Math.round(data.reduce((s, d) => s + d.pct, 0) / data.length);
  return (
    <MetricSection>
      <StatCard label="Overall Rock Progress" value={overall + ''%''} subtitle="Q1 2026 average" trendDirection={overall > 40 ? ''up'' : overall > 25 ? ''flat'' : ''down''} />
      <div style={{ height: 300, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
        <ResponsiveContainer width="100%" height="100%">
          <BarChart data={data} layout="vertical" margin={{ top: 5, right: 30, left: 130, bottom: 5 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis type="number" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} tickFormatter={v => v + ''%''} domain={[0, 100]} />
            <YAxis type="category" dataKey="rock" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} width={125} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} formatter={v => v + ''%''} />
            <Bar dataKey="pct" name="Progress" fill={theme.accent} radius={[0,4,4,0]} />
          </BarChart>
        </ResponsiveContainer>
      </div>
      <MetricNote>Source: Asana Projects via Kiingo MCP</MetricNote>
    </MetricSection>
  );
})()', 259200, 'claude', NULL, NULL, 1, 0, '{"aliases":["rocks","quarterly rocks","Q1 rocks","OKRs"]}', '2026-02-15T06:34:11+00:00', '2026-02-15T06:34:11+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('7fca257d-0bd2-4d86-af90-a1a8df626d5c', 'Revenue Growth Rate', 'revenue-growth-rate', 'Compute month-over-month revenue growth rate from QuickBooks invoices.

## Data Source
QuickBooks Invoices via `quickbooks.query()`.

## Retrieval Steps
1. Query invoices for trailing 13 months (need 13 to compute 12 growth rates).
2. Group by month, sum TotalAmt.
3. Compute MoM growth: (current - prior) / prior * 100 for each month.
4. Also compute YoY growth if prior year data available.
5. Compute average MoM growth over the period.

## Values to Return
- `monthlyGrowth`: array of { month, growth (percentage) }
- `avgMoMGrowth`: average monthly growth rate
- `latestGrowth`: most recent month''s growth rate', '(() => {
  const data = DATA_PLACEHOLDER;
  const avg = AVG_PLACEHOLDER;
  return (
    <MetricSection>
      <StatCard label="Avg MoM Growth" value={avg.toFixed(1) + ''%''} subtitle="Trailing 12 months" />
      <div style={{ height: 280, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
        <ResponsiveContainer width="100%" height="100%">
          <BarChart data={data} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="month" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} tickFormatter={v => v + ''%''} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} formatter={v => Number(v).toFixed(1) + ''%''} />
            <ReferenceLine y={0} stroke={theme.danger} strokeWidth={1} />
            <Bar dataKey="growth" name="MoM Growth" fill={theme.accent} radius={[4,4,0,0]} />
          </BarChart>
        </ResponsiveContainer>
      </div>
    </MetricSection>
  );
})()', 259200, 'claude', NULL, NULL, 1, 0, '{"aliases":["growth rate","revenue growth","growth"]}', '2026-02-15T06:29:29+00:00', '2026-02-15T06:29:29+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('44aed376-61f4-4b67-820c-7697f1a5179d', 'Revenue Overview', 'revenue-overview', 'Combine data from two dependency metrics to produce a comprehensive revenue overview.

## Data Sources
This metric has NO external data sources. It relies entirely on two dependency inputs:

1. **monthly-revenue-tracker** — Current month deals from Sohrab''s Revenue Tracker Excel (OneDrive).
   Values include: totalRevenue, totalInvoiced, outstandingInvoice, dealCount, avgDealSize, newBizCount, newBizRevenue, upsellCount, upsellRevenue, byService (array), deals (array), monthLabel.

2. **monthly-revenue** — Historical invoicing and collections from QuickBooks.
   Values include: currentMonth (invoiced this month), ltmCollected, ltmTotal, priorMonth, monthlyData (array of { month, invoiced, collected, count }).

## Retrieval Steps
1. Read the dependency inputs. They are provided as a JSON array under "Dependency Inputs".
2. Find the monthly-revenue-tracker input by slug. Extract its `values` object.
3. Find the monthly-revenue input by slug. Extract its `values` object.
4. DO NOT make any MCP tool calls. All data comes from the dependency inputs.

## Computations

From monthly-revenue-tracker (tracker):
- `currentMonthRevenue`: tracker.totalRevenue — closed deals this month
- `currentMonthInvoiced`: tracker.totalInvoiced
- `outstanding`: tracker.outstandingInvoice
- `dealCount`: tracker.dealCount
- `avgDealSize`: tracker.avgDealSize
- `newBizRevenue`: tracker.newBizRevenue
- `newBizCount`: tracker.newBizCount
- `upsellRevenue`: tracker.upsellRevenue
- `upsellCount`: tracker.upsellCount
- `byService`: tracker.byService
- `topDeals`: tracker.deals sorted by amount descending, take top 5
- `monthLabel`: tracker.monthLabel

From monthly-revenue (qb):
- `monthlyTrend`: qb.monthlyData — array of { month, invoiced, collected, count } for the trailing 12+ months
- `ltmRevenue`: qb.ltmTotal — last twelve months total invoiced
- `ltmCollected`: qb.ltmCollected — last twelve months total collected
- `priorMonthRevenue`: qb.priorMonth — last month''s invoiced total
- `collectionRate`: round(ltmCollected / ltmTotal * 100) — LTM collection rate %

Derived:
- `momGrowth`: round((currentMonthRevenue - priorMonthRevenue) / priorMonthRevenue * 100) — month-over-month growth %
  Note: currentMonthRevenue is from the tracker (deals closed this month), priorMonthRevenue is from QuickBooks (prior month invoiced). The month may still be in progress, so flag this.
- `avgMonthlyRevenue`: round(ltmRevenue / 12) — average monthly invoiced over LTM

## Values to Return
- `currentMonthRevenue`: number
- `currentMonthInvoiced`: number
- `outstanding`: number
- `dealCount`: number
- `avgDealSize`: number
- `newBizRevenue`: number
- `newBizCount`: number
- `upsellRevenue`: number
- `upsellCount`: number
- `byService`: array of { service, count, revenue }
- `topDeals`: array of top 5 deals { client, amount, service, type }
- `monthLabel`: string
- `monthlyTrend`: array of { month, invoiced, collected, count }
- `ltmRevenue`: number
- `ltmCollected`: number
- `collectionRate`: number (percentage)
- `priorMonthRevenue`: number
- `momGrowth`: number (percentage, may be negative)
- `avgMonthlyRevenue`: number
', '(() => {
  const currentMonthRevenue = CURRENT_MONTH_REVENUE_PLACEHOLDER;
  const currentMonthInvoiced = CURRENT_MONTH_INVOICED_PLACEHOLDER;
  const outstanding = OUTSTANDING_PLACEHOLDER;
  const dealCount = DEAL_COUNT_PLACEHOLDER;
  const avgDealSize = AVG_DEAL_SIZE_PLACEHOLDER;
  const newBizRevenue = NEW_BIZ_REVENUE_PLACEHOLDER;
  const newBizCount = NEW_BIZ_COUNT_PLACEHOLDER;
  const upsellRevenue = UPSELL_REVENUE_PLACEHOLDER;
  const upsellCount = UPSELL_COUNT_PLACEHOLDER;
  const byService = BY_SERVICE_PLACEHOLDER;
  const topDeals = TOP_DEALS_PLACEHOLDER;
  const monthLabel = MONTH_LABEL_PLACEHOLDER;
  const monthlyTrend = MONTHLY_TREND_PLACEHOLDER;
  const ltmRevenue = LTM_REVENUE_PLACEHOLDER;
  const ltmCollected = LTM_COLLECTED_PLACEHOLDER;
  const collectionRate = COLLECTION_RATE_PLACEHOLDER;
  const priorMonthRevenue = PRIOR_MONTH_REVENUE_PLACEHOLDER;
  const momGrowth = MOM_GROWTH_PLACEHOLDER;
  const avgMonthlyRevenue = AVG_MONTHLY_REVENUE_PLACEHOLDER;

  const fmt = (n) => ''$'' + (n || 0).toLocaleString();
  const fmtK = (n) => ''$'' + ((n || 0) / 1000).toFixed(0) + ''K'';

  return (
    <MetricSection>
      <MetricRow>
        <StatCard label={monthLabel + '' Revenue''} value={fmtK(currentMonthRevenue)} subtitle={dealCount + '' deals closed''} />
        <StatCard label="Prior Month" value={fmtK(priorMonthRevenue)} subtitle={''MoM: '' + (momGrowth >= 0 ? ''+'' : '''') + momGrowth + ''%''} />
        <StatCard label="LTM Revenue" value={fmtK(ltmRevenue)} subtitle={''Avg '' + fmtK(avgMonthlyRevenue) + ''/mo''} />
        <StatCard label="Collection Rate" value={collectionRate + ''%''} subtitle={fmtK(ltmCollected) + '' collected LTM''} />
      </MetricRow>

      <MetricRow>
        <StatCard label="New Business" value={fmtK(newBizRevenue)} subtitle={newBizCount + '' deals''} />
        <StatCard label="Upsells" value={fmtK(upsellRevenue)} subtitle={upsellCount + '' deals''} />
        <StatCard label="Invoiced" value={fmtK(currentMonthInvoiced)} subtitle={outstanding > 0 ? fmtK(outstanding) + '' outstanding'' : ''All invoiced''} />
        <StatCard label="Avg Deal" value={fmt(avgDealSize)} />
      </MetricRow>

      <div style={{ height: 300, background: theme.panel, borderRadius: 16, padding: 20, border: ''1px solid '' + theme.line }}>
        <ResponsiveContainer width="100%" height="100%">
          <ComposedChart data={monthlyTrend} margin={{ top: 10, right: 10, left: 10, bottom: 0 }}>
            <defs>
              <linearGradient id="revOverviewGrad" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stopColor="#2563eb" stopOpacity={0.15} />
                <stop offset="100%" stopColor="#2563eb" stopOpacity={0.02} />
              </linearGradient>
            </defs>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="month" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} tickFormatter={(v) => ''$'' + (v / 1000).toFixed(0) + ''K''} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} formatter={(v, name) => [fmt(v), name]} />
            <Legend />
            <Area type="monotone" dataKey="invoiced" name="Invoiced" stroke="#2563eb" strokeWidth={2} fill="url(#revOverviewGrad)" />
            <Line type="monotone" dataKey="collected" name="Collected" stroke="#16a34a" strokeWidth={2} strokeDasharray="6 3" dot={{ fill: ''#16a34a'', r: 3 }} />
          </ComposedChart>
        </ResponsiveContainer>
      </div>

      <div style={{ display: ''grid'', gridTemplateColumns: ''1fr 1fr'', gap: 16, marginTop: 16 }}>
        <div style={{ background: theme.panel, borderRadius: 16, padding: 16, border: ''1px solid '' + theme.line }}>
          <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 12, color: theme.ink }}>Revenue by Service</div>
          <div style={{ height: 220 }}>
            <ResponsiveContainer width="100%" height="100%">
              <BarChart data={byService} layout="vertical" margin={{ top: 0, right: 10, left: 10, bottom: 0 }}>
                <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
                <XAxis type="number" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} tickFormatter={(v) => ''$'' + (v / 1000).toFixed(0) + ''K''} />
                <YAxis type="category" dataKey="service" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} width={140} />
                <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 12 }} formatter={(v) => [fmt(v), ''Revenue'']} />
                <Bar dataKey="revenue" fill={theme.accent} radius={[0, 6, 6, 0]} />
              </BarChart>
            </ResponsiveContainer>
          </div>
        </div>

        <div style={{ background: theme.panel, borderRadius: 16, padding: 16, border: ''1px solid '' + theme.line }}>
          <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 12, color: theme.ink }}>Top Deals This Month</div>
          <table style={{ width: ''100%'', borderCollapse: ''collapse'', fontSize: 12 }}>
            <thead>
              <tr style={{ borderBottom: ''2px solid '' + theme.line }}>
                <th style={{ textAlign: ''left'', padding: ''6px 8px'', color: theme.inkMuted }}>Client</th>
                <th style={{ textAlign: ''right'', padding: ''6px 8px'', color: theme.inkMuted }}>Amount</th>
                <th style={{ textAlign: ''left'', padding: ''6px 8px'', color: theme.inkMuted }}>Type</th>
              </tr>
            </thead>
            <tbody>
              {topDeals.map((d, i) => (
                <tr key={i} style={{ borderBottom: ''1px solid '' + theme.line }}>
                  <td style={{ padding: ''6px 8px'', color: theme.ink }}>{d.client}</td>
                  <td style={{ padding: ''6px 8px'', color: theme.ink, textAlign: ''right'', fontVariantNumeric: ''tabular-nums'' }}>{fmt(d.amount)}</td>
                  <td style={{ padding: ''6px 8px'' }}><span style={{ padding: ''2px 6px'', borderRadius: 6, fontSize: 10, fontWeight: 600, background: d.type === ''New Biz'' ? theme.accent + ''22'' : theme.secondary + ''22'', color: d.type === ''New Biz'' ? theme.accent : theme.secondary }}>{d.type}</span></td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>

      <MetricNote>Combines Revenue Tracker (OneDrive) + QuickBooks invoicing data · Month in progress</MetricNote>
    </MetricSection>
  );
})()', 259200, 'claude', NULL, NULL, 1, 0, '{"dependencies": ["monthly-revenue-tracker", "monthly-revenue"], "aliases": ["revenue overview", "rev overview", "full revenue"]}', '2026-02-17T23:40:14+00:00', '2026-02-17T23:40:14+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('c32c7b8c-a0fe-45e9-a89e-646f613c68ee', 'Revenue & Profit Trend', 'revenue-profit-trend', 'Retrieve monthly revenue invoiced and net income, display both on a combined chart.

## Data Sources
- QuickBooks Invoices for revenue: `quickbooks.query({ query: "SELECT TxnDate, TotalAmt FROM Invoice WHERE TxnDate >= ''<12mo ago>''", maxResults: 1000 })`
- QuickBooks P&L for net income: `quickbooks.profitAndLoss({ params: { start_date: ''<12mo ago>'', end_date: ''<today>'', summarize_column_by: ''Month'' } })`

## Retrieval Steps
1. Group invoices by month, sum TotalAmt for each month''s invoiced revenue.
2. Parse P&L Rows to extract "Net Income" per month column.
3. Merge into array with { month, invoiced, netIncome }.
4. Compute LTM totals for both.

## Values to Return
- `monthlyData`: array of { month, invoiced, netIncome }
- `ltmRevenue`: sum of 12 months invoiced
- `ltmNetIncome`: sum of 12 months net income', '(() => {
  const data = DATA_PLACEHOLDER;
  return (
    <MetricSection>
      <div style={{ height: 280, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line }}>
        <ResponsiveContainer width="100%" height="100%">
          <ComposedChart data={data} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="month" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} tickFormatter={v => ''$'' + (v/1000) + ''K''} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} formatter={v => ''$'' + Number(v).toLocaleString()} />
            <Bar dataKey="invoiced" name="Revenue" fill={theme.accent} radius={[4,4,0,0]} opacity={0.7} />
            <Line type="monotone" dataKey="netIncome" name="Net Income" stroke={theme.accentStrong} strokeWidth={2.5} dot={{ fill: theme.accentStrong, r: 3 }} />
            <ReferenceLine y={0} stroke={theme.danger} strokeWidth={1} strokeDasharray="4 4" />
          </ComposedChart>
        </ResponsiveContainer>
      </div>
      <MetricNote>Revenue (bars) vs Net Income (line) | QuickBooks</MetricNote>
    </MetricSection>
  );
})()', 259200, 'claude', NULL, NULL, 1, 0, '{"aliases":["revenue trend","profit trend","rev trend"]}', '2026-02-15T06:29:29+00:00', '2026-02-15T06:29:29+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('3b4f2305-5220-4824-8f77-e78afe3906ad', 'Sales Follow-Up Snapshot', 'sales-followup-snapshot', 'Read today''s SALES Follow-Up Metrics Report from the CRM SharePoint site and extract pipeline follow-up health data.

## Data Source
SharePoint CRM site → Latest SALES-Follow-up-Metrics-Report xlsx → "Follow-Up Metrics Summary" worksheet

## Retrieval Steps

### Step 1: Find the latest SALES report
```typescript
import { sharepoint } from ''tools'';
const items = await sharepoint.searchItems({
  siteId: ''kiingo.sharepoint.com,8cb6f37c-91b4-4196-8c80-7a9d56f451cb,fa64a87a-e711-4141-bc08-c8ebe6a524b6'',
  query: ''SALES-Follow-up-Metrics-Report'',
  itemType: ''file'',
  fileExtension: ''xlsx''
});
```
Sort results by `lastModifiedDateTime` descending and pick the first (most recent) item. Note its `id` (this is the `itemId`).

### Step 2: Read the Summary worksheet
```typescript
import { excel } from ''tools'';
const result = await excel.getUsedRange({
  siteId: ''kiingo.sharepoint.com,8cb6f37c-91b4-4196-8c80-7a9d56f451cb,fa64a87a-e711-4141-bc08-c8ebe6a524b6'',
  itemId: ''<itemId from step 1>'',
  worksheetName: ''Follow-Up Metrics Summary'',
  valuesOnly: true
});
```

### Step 3: Parse the summary data
The worksheet rows (0-indexed):
- Row 2: "Generated at: <date string>"
- Row 5: ["Total Open Deals", <number>]
- Row 6: ["With Discovery Call", <number>]
- Row 7: ["Without Discovery Call", <number>]
- Row 8: ["Likely Cold Deals", <number>]
- Row 9: ["Overdue Follow-Ups (>14 days)", <number>]
- Row 10: ["Follow-Up Needed After Discovery", <number>]
- Row 11: ["Average Days Since Last Contact", <number>]
- Rows 14-21: Follow-up range distribution — each row is [rangeName, dealCount, ...]
  - Row 14: "01. 0-3 days"
  - Row 15: "02. 3-7 days"
  - Row 16: "03. 7-14 days"
  - Row 17: "04. 14-30 days"
  - Row 18: "05. 30-60 days"
  - Row 19: "06. 60-90 days"
  - Row 20: "07. 90-180 days"
  - Row 21: "08. 180+ days"
- Rows 44+: Per-rep breakdown — each row is [email, totalDeals, likelyCold, coldPct%, bar]
  Continue reading rows until empty.

### Step 4: Structure the data

For `followUpRanges`, create three fields per range for color-coded stacked bars:
- Ranges "01. 0-3 days" and "02. 3-7 days": put count in `healthy` field, 0 for `warning` and `danger`
- Ranges "03. 7-14 days" and "04. 14-30 days": put count in `warning` field, 0 for others
- Ranges "05." through "08.": put count in `danger` field, 0 for others

Use short labels for display: "0-3d", "3-7d", "7-14d", "14-30d", "30-60d", "60-90d", "90-180d", "180+d"

For `repBreakdown`, extract the rep name from the email (part before @), compute `active = totalDeals - likelyCold`.

## Values to Return
- `generatedAt`: date string from row 2 (just the date portion)
- `totalOpenDeals`: number
- `withDiscovery`: number
- `withoutDiscovery`: number
- `likelyCold`: number
- `overdueFollowUps`: number
- `followUpNeeded`: number
- `avgDaysSinceContact`: number
- `followUpRanges`: array of { range, healthy, warning, danger }
- `repBreakdown`: array of { rep, totalDeals, active, likelyCold, coldPct } sorted by totalDeals desc
', '(() => {
  const totalOpenDeals = TOTAL_OPEN_DEALS_PLACEHOLDER;
  const likelyCold = LIKELY_COLD_PLACEHOLDER;
  const overdueFollowUps = OVERDUE_FOLLOWUPS_PLACEHOLDER;
  const avgDays = AVG_DAYS_PLACEHOLDER;
  const followUpRanges = FOLLOWUP_RANGES_PLACEHOLDER;
  const repBreakdown = REP_BREAKDOWN_PLACEHOLDER;
  const generatedAt = GENERATED_AT_PLACEHOLDER;

  return (
    <MetricSection>
      <MetricRow>
        <StatCard label={''Open Deals''} value={totalOpenDeals} subtitle={''Total pipeline''} />
        <StatCard label={''Likely Cold''} value={likelyCold} subtitle={((likelyCold / totalOpenDeals) * 100).toFixed(0) + ''% of pipeline''} />
        <StatCard label={''Overdue >14d''} value={overdueFollowUps} subtitle={''Need attention''} />
        <StatCard label={''Avg Days Since Contact''} value={avgDays.toFixed(1)} subtitle={''Lower is better''} />
      </MetricRow>

      <div style={{ height: 300, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Follow-Up Range Distribution</div>
        <ResponsiveContainer width="100%" height="90%">
          <BarChart data={followUpRanges} margin={{ top: 10, right: 10, left: 0, bottom: 40 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="range" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} angle={-25} textAnchor="end" />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <Legend />
            <Bar dataKey="healthy" name="Healthy (0-7d)" stackId="a" fill="#16a34a" radius={[0, 0, 0, 0]} />
            <Bar dataKey="warning" name="Needs Attention (7-30d)" stackId="a" fill="#eab308" radius={[0, 0, 0, 0]} />
            <Bar dataKey="danger" name="At Risk (30d+)" stackId="a" fill={theme.danger} radius={[4, 4, 0, 0]} />
          </BarChart>
        </ResponsiveContainer>
      </div>

      <div style={{ height: 280, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 16 }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Sales Rep Follow-Up Health</div>
        <ResponsiveContainer width="100%" height="90%">
          <BarChart data={repBreakdown} layout="vertical" margin={{ top: 10, right: 30, left: 60, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis type="number" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis type="category" dataKey="rep" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} width={55} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <Legend />
            <Bar dataKey="active" name="Active" stackId="a" fill={theme.accent} radius={[0, 0, 0, 0]} />
            <Bar dataKey="likelyCold" name="Likely Cold" stackId="a" fill={theme.danger} radius={[0, 4, 4, 0]} />
          </BarChart>
        </ResponsiveContainer>
      </div>

      <MetricNote>Source: CRM SharePoint · SALES Follow-Up Metrics Report · {generatedAt}</MetricNote>
    </MetricSection>
  );
})()', 86400, 'claude', NULL, NULL, 1, 0, '{"aliases": ["sales follow-up", "sales followup", "follow-up snapshot", "pipeline health"]}', '2026-02-18T23:43:35+00:00', '2026-02-18T23:43:35+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('341d182e-10e8-41a1-97cd-58696adb5add', 'Sales Follow-Up Trends', 'sales-followup-trends', 'Track daily trends in SALES follow-up pipeline health by reading the last 14 daily SALES Follow-Up Metrics Reports from the CRM SharePoint site.

## Data Source
SharePoint CRM site → Multiple SALES-Follow-up-Metrics-Report xlsx files → "Follow-Up Metrics Summary" worksheets

## Retrieval Steps

### Step 1: Find all SALES reports
```typescript
import { sharepoint } from ''tools'';
const items = await sharepoint.searchItems({
  siteId: ''kiingo.sharepoint.com,8cb6f37c-91b4-4196-8c80-7a9d56f451cb,fa64a87a-e711-4141-bc08-c8ebe6a524b6'',
  query: ''SALES-Follow-up-Metrics-Report'',
  itemType: ''file'',
  fileExtension: ''xlsx''
});
```
Sort results by `lastModifiedDateTime` descending. Extract the date from each filename (the ISO timestamp portion, e.g. "2026-02-18" from "SALES-Follow-up-Metrics-Report-2026-02-18T11-08-32.695Z.xlsx"). Group by date and keep only the latest report per day. Select up to 14 most recent days.

### Step 2: Read each Summary worksheet
For each of the selected reports, read the summary sheet:
```typescript
import { excel } from ''tools'';
const result = await excel.getUsedRange({
  siteId: ''kiingo.sharepoint.com,8cb6f37c-91b4-4196-8c80-7a9d56f451cb,fa64a87a-e711-4141-bc08-c8ebe6a524b6'',
  itemId: ''<itemId>'',
  worksheetName: ''Follow-Up Metrics Summary'',
  valuesOnly: true
});
```

### Step 3: Parse summary data from each report
From each worksheet extract by row index (0-indexed):
- Row 5, col 1: Total Open Deals
- Row 8, col 1: Likely Cold Deals
- Row 9, col 1: Overdue Follow-Ups (>14 days)
- Row 11, col 1: Average Days Since Last Contact
- Rows 14-15, col 1: Healthy count (sum of "01. 0-3 days" + "02. 3-7 days" deal counts)
- Rows 18-21, col 1: At Risk count (sum of "05. 30-60 days" through "08. 180+ days" deal counts)

### Step 4: Structure as time series
Build an array sorted by date ascending. Each entry:
- `date`: short label (e.g. "2/14")
- `totalDeals`: total open deals
- `likelyCold`: likely cold count
- `overdue`: overdue >14 days count
- `avgDays`: average days since contact
- `healthy`: sum of 0-7 day buckets
- `atRisk`: sum of 30+ day buckets

Also compute:
- `latestDate`: most recent report date (full date string)
- `coldTrend`: compare the last 3 data points — "improving" if likelyCold decreased consistently, "worsening" if increased, "stable" otherwise
- `overdueTrend`: same logic for overdue count
- `daysReported`: number of days with data

## Values to Return
- `dailyData`: array of { date, totalDeals, likelyCold, overdue, avgDays, healthy, atRisk }
- `latestDate`: string
- `coldTrend`: "improving" | "worsening" | "stable"
- `overdueTrend`: "improving" | "worsening" | "stable"
- `daysReported`: number
', '(() => {
  const dailyData = DAILY_DATA_PLACEHOLDER;
  const latestDate = LATEST_DATE_PLACEHOLDER;
  const coldTrend = COLD_TREND_PLACEHOLDER;
  const overdueTrend = OVERDUE_TREND_PLACEHOLDER;
  const daysReported = DAYS_REPORTED_PLACEHOLDER;

  const latest = dailyData[dailyData.length - 1] || {};
  const first = dailyData[0] || {};
  const coldDelta = latest.likelyCold - first.likelyCold;
  const overdueDelta = latest.overdue - first.overdue;

  const trendIcon = (t) => t === ''improving'' ? '' ↓'' : t === ''worsening'' ? '' ↑'' : '' →'';
  const trendColor = (t) => t === ''improving'' ? ''#16a34a'' : t === ''worsening'' ? theme.danger : theme.inkMuted;

  return (
    <MetricSection>
      <MetricRow>
        <StatCard label={''Likely Cold''} value={latest.likelyCold} subtitle={coldTrend + trendIcon(coldTrend)} />
        <StatCard label={''Overdue >14d''} value={latest.overdue} subtitle={overdueTrend + trendIcon(overdueTrend)} />
        <StatCard label={''Avg Contact Days''} value={latest.avgDays?.toFixed(1)} subtitle={daysReported + ''-day trend''} />
        <StatCard label={''At Risk Deals''} value={latest.atRisk} subtitle={''30+ days stale''} />
      </MetricRow>

      <div style={{ height: 280, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Likely Cold & Overdue Deals Over Time</div>
        <ResponsiveContainer width="100%" height="90%">
          <LineChart data={dailyData} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="date" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <Legend />
            <Line type="monotone" dataKey="likelyCold" name="Likely Cold" stroke={theme.danger} strokeWidth={2} dot={{ fill: theme.danger, r: 3 }} />
            <Line type="monotone" dataKey="overdue" name="Overdue >14d" stroke="#eab308" strokeWidth={2} dot={{ fill: ''#eab308'', r: 3 }} />
          </LineChart>
        </ResponsiveContainer>
      </div>

      <div style={{ display: ''grid'', gridTemplateColumns: ''1fr 1fr'', gap: 16, marginTop: 16 }}>
        <div style={{ height: 260, background: theme.panel, borderRadius: 16, padding: 16, border: ''1px solid '' + theme.line }}>
          <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Avg Days Since Contact</div>
          <ResponsiveContainer width="100%" height="85%">
            <AreaChart data={dailyData} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
              <defs>
                <linearGradient id="avgDaysGrad" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0%" stopColor={theme.accent} stopOpacity={0.15} />
                  <stop offset="100%" stopColor={theme.accent} stopOpacity={0.02} />
                </linearGradient>
              </defs>
              <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
              <XAxis dataKey="date" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} />
              <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} />
              <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 12 }} formatter={(v) => [v.toFixed(1) + '' days'', ''Avg Contact'']} />
              <Area type="monotone" dataKey="avgDays" stroke={theme.accent} strokeWidth={2} fill="url(#avgDaysGrad)" />
            </AreaChart>
          </ResponsiveContainer>
        </div>

        <div style={{ height: 260, background: theme.panel, borderRadius: 16, padding: 16, border: ''1px solid '' + theme.line }}>
          <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Healthy vs At Risk</div>
          <ResponsiveContainer width="100%" height="85%">
            <BarChart data={dailyData} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
              <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
              <XAxis dataKey="date" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} />
              <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} />
              <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 12 }} />
              <Legend />
              <Bar dataKey="healthy" name="Healthy (0-7d)" fill="#16a34a" radius={[4, 4, 0, 0]} />
              <Bar dataKey="atRisk" name="At Risk (30d+)" fill={theme.danger} radius={[4, 4, 0, 0]} />
            </BarChart>
          </ResponsiveContainer>
        </div>
      </div>

      <MetricNote>Source: CRM SharePoint · {daysReported} daily SALES reports · Latest: {latestDate}</MetricNote>
    </MetricSection>
  );
})()', 86400, 'claude', NULL, NULL, 1, 0, '{"aliases": ["sales follow-up trends", "follow-up trends", "pipeline trends", "staleness trends"]}', '2026-02-18T23:43:35+00:00', '2026-02-18T23:43:35+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('6978d569-0b74-452b-b3e7-5de51c90d239', 'Sales Pipeline Value', 'sales-pipeline-value', 'Retrieve open deal pipeline from HubSpot and display by stage.

## Data Source
HubSpot Deals via Kiingo MCP `hubspot.listDeals()`.

## Retrieval Steps
1. Paginate through ALL deals: `hubspot.listDeals({ limit: 100, properties: [''dealname'', ''amount'', ''dealstage'', ''pipeline'', ''closedate'', ''hs_deal_stage_probability'', ''hs_is_closed_won'', ''hs_is_closed''], after })`.
2. Filter to open deals (hs_is_closed !== ''true'') in sales pipelines: ''default'' (New Business), ''798580396'' (Upsells), ''796136972'' (Partnership).
3. Group by stage. For each stage, compute count, total amount, and weighted amount (amount * hs_deal_stage_probability).
4. Also compute closing-this-month and closing-next-month totals by checking closedate.
5. Map stage IDs to labels: 161270894 = "Proposal Sent", appointmentscheduled = "Discovery Call", 161298562 = "On Hold", 1166399563 = "Cold", 1172014718 = "Outreach (Upsell)", 1172014719 = "Proposal (Upsell)", 1172014717 = "Discovery (Upsell)".

## Values to Return
- `totalUnweighted`: total open pipeline value
- `totalWeighted`: probability-weighted pipeline value
- `dealCount`: number of open deals
- `closingThisMonth`: value of deals closing this month
- `closingNextMonth`: value of deals closing next month
- `byStage`: array of { stage (label), count, amount, weighted } sorted by amount desc', '(() => {
  const data = DATA_PLACEHOLDER;
  const totalUnweighted = UNWEIGHTED_PLACEHOLDER;
  const totalWeighted = WEIGHTED_PLACEHOLDER;
  const dealCount = COUNT_PLACEHOLDER;

  return (
    <MetricSection>
      <MetricRow>
        <StatCard label="Open Pipeline" value={''$'' + (totalUnweighted / 1000).toFixed(0) + ''K''} subtitle={dealCount + '' deals''} />
        <StatCard label="Weighted" value={''$'' + (totalWeighted / 1000).toFixed(0) + ''K''} subtitle="Probability-adjusted" />
      </MetricRow>
      <div style={{ height: 280, background: theme.panel, borderRadius: 16, padding: 20, border: `1px solid ${theme.line}` }}>
        <ResponsiveContainer width="100%" height="100%">
          <BarChart data={data} layout="vertical" margin={{ top: 5, right: 10, left: 100, bottom: 5 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} horizontal={false} />
            <XAxis type="number" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} tickFormatter={v => ''$'' + (v / 1000) + ''K''} />
            <YAxis type="category" dataKey="stage" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} width={95} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: `1px solid ${theme.tooltipBorder}`, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} formatter={v => ''$'' + Number(v).toLocaleString()} />
            <Bar dataKey="amount" name="Pipeline Value" fill={theme.accent} radius={[0, 4, 4, 0]} />
          </BarChart>
        </ResponsiveContainer>
      </div>
      <MetricNote>Open sales deals (New Business + Upsells + Partnership) · Source: HubSpot CRM via Kiingo MCP</MetricNote>
    </MetricSection>
  );
})()', 259200, 'claude', NULL, NULL, 1, 0, '{"aliases":["pipeline value","sales pipeline","pipeline"]}', '2026-02-15T05:56:04.064862+00:00', '2026-02-15T05:56:04.064862+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('62983536-af15-44e8-8425-48f84dbff512', 'Sales Response Rate', 'sales-response-rate', 'Calculate email response rates for deal-linked outreach by querying the Kiingo CRM database.

## Data Source
Kiingo PostgreSQL database → `crm_email`, `crm_deal_email`, `crm_deal` tables

## Retrieval Steps

### Step 1: Overall response rate
For conversations linked to open deals where Kiingo sent the first message, calculate how many got an external reply.

```typescript
import { sql } from ''tools'';
const overall = await sql.query({
  database: ''kiingo'',
  sql: `
    WITH deal_emails AS (
      SELECT DISTINCT e.id, e."conversationId", e."from", e."receivedDateTime"
      FROM crm_email e
      JOIN crm_deal_email de ON de."crmEmailId" = e.id
      JOIN crm_deal d ON d.id = de."crmDealId"
      WHERE e."conversationId" IS NOT NULL
        AND d."isClosed" = false
    ),
    thread_first AS (
      SELECT "conversationId",
        MIN("receivedDateTime") as first_time,
        (ARRAY_AGG("from" ORDER BY "receivedDateTime" ASC))[1] as first_sender
      FROM deal_emails GROUP BY "conversationId"
    ),
    initiated AS (
      SELECT "conversationId", first_time FROM thread_first
      WHERE first_sender LIKE ''%@kiingo.com''
    ),
    replied AS (
      SELECT DISTINCT i."conversationId"
      FROM initiated i
      JOIN deal_emails e ON e."conversationId" = i."conversationId"
        AND e."from" NOT LIKE ''%@kiingo.com''
        AND e."receivedDateTime" > i.first_time
    )
    SELECT
      (SELECT COUNT(*) FROM thread_first) as total_deal_threads,
      (SELECT COUNT(*) FROM initiated) as total_initiated,
      (SELECT COUNT(*) FROM replied) as total_replied,
      ROUND((SELECT COUNT(*) FROM replied)::numeric / NULLIF((SELECT COUNT(*) FROM initiated), 0) * 100, 1) as rate
  `
});
```

### Step 2: Response time statistics
For threads that did get a reply, measure how long it took.

```typescript
const timing = await sql.query({
  database: ''kiingo'',
  sql: `
    WITH deal_emails AS (
      SELECT DISTINCT e.id, e."conversationId", e."from", e."receivedDateTime"
      FROM crm_email e
      JOIN crm_deal_email de ON de."crmEmailId" = e.id
      JOIN crm_deal d ON d.id = de."crmDealId"
      WHERE e."conversationId" IS NOT NULL
        AND d."isClosed" = false
    ),
    thread_first AS (
      SELECT "conversationId",
        MIN("receivedDateTime") as first_time,
        (ARRAY_AGG("from" ORDER BY "receivedDateTime" ASC))[1] as first_sender
      FROM deal_emails GROUP BY "conversationId"
    ),
    initiated AS (
      SELECT "conversationId", first_time FROM thread_first
      WHERE first_sender LIKE ''%@kiingo.com''
    ),
    first_reply AS (
      SELECT i."conversationId", i.first_time,
        MIN(e."receivedDateTime") as reply_time
      FROM initiated i
      JOIN deal_emails e ON e."conversationId" = i."conversationId"
        AND e."from" NOT LIKE ''%@kiingo.com''
        AND e."receivedDateTime" > i.first_time
      GROUP BY i."conversationId", i.first_time
    )
    SELECT
      ROUND(AVG(EXTRACT(EPOCH FROM (reply_time - first_time)) / 3600), 1) as avg_hours,
      ROUND(PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY EXTRACT(EPOCH FROM (reply_time - first_time)) / 3600)::numeric, 1) as median_hours,
      ROUND(PERCENTILE_CONT(0.25) WITHIN GROUP (ORDER BY EXTRACT(EPOCH FROM (reply_time - first_time)) / 3600)::numeric, 1) as p25_hours,
      ROUND(PERCENTILE_CONT(0.75) WITHIN GROUP (ORDER BY EXTRACT(EPOCH FROM (reply_time - first_time)) / 3600)::numeric, 1) as p75_hours
    FROM first_reply
  `
});
```

### Step 3: Monthly response rate trend
Calculate response rate per month for the last 8 months.

```typescript
const monthly = await sql.query({
  database: ''kiingo'',
  sql: `
    WITH deal_emails AS (
      SELECT DISTINCT e.id, e."conversationId", e."from", e."receivedDateTime"
      FROM crm_email e
      JOIN crm_deal_email de ON de."crmEmailId" = e.id
      JOIN crm_deal d ON d.id = de."crmDealId"
      WHERE e."conversationId" IS NOT NULL
        AND d."isClosed" = false
    ),
    thread_first AS (
      SELECT "conversationId",
        MIN("receivedDateTime") as first_time,
        (ARRAY_AGG("from" ORDER BY "receivedDateTime" ASC))[1] as first_sender
      FROM deal_emails GROUP BY "conversationId"
    ),
    initiated AS (
      SELECT "conversationId", first_time,
        TO_CHAR(first_time, ''YYYY-MM'') as ym
      FROM thread_first WHERE first_sender LIKE ''%@kiingo.com''
    ),
    replied AS (
      SELECT DISTINCT i."conversationId", i.ym
      FROM initiated i
      JOIN deal_emails e ON e."conversationId" = i."conversationId"
        AND e."from" NOT LIKE ''%@kiingo.com''
        AND e."receivedDateTime" > i.first_time
    )
    SELECT
      i.ym as month,
      COUNT(DISTINCT i."conversationId") as initiated,
      COUNT(DISTINCT r."conversationId") as replied,
      ROUND(COUNT(DISTINCT r."conversationId")::numeric / NULLIF(COUNT(DISTINCT i."conversationId"), 0) * 100, 1) as rate
    FROM initiated i
    LEFT JOIN replied r ON r."conversationId" = i."conversationId"
    WHERE i.ym >= TO_CHAR(NOW() - INTERVAL ''8 months'', ''YYYY-MM'')
    GROUP BY i.ym ORDER BY i.ym
  `
});
```

### Step 4: Per-rep response rate
Response rate broken down by the Kiingo rep who initiated the thread. Exclude reps with fewer than 10 threads.

```typescript
const byRep = await sql.query({
  database: ''kiingo'',
  sql: `
    WITH deal_emails AS (
      SELECT DISTINCT e.id, e."conversationId", e."from", e."receivedDateTime"
      FROM crm_email e
      JOIN crm_deal_email de ON de."crmEmailId" = e.id
      JOIN crm_deal d ON d.id = de."crmDealId"
      WHERE e."conversationId" IS NOT NULL
        AND d."isClosed" = false
    ),
    thread_first AS (
      SELECT "conversationId",
        MIN("receivedDateTime") as first_time,
        (ARRAY_AGG("from" ORDER BY "receivedDateTime" ASC))[1] as first_sender
      FROM deal_emails GROUP BY "conversationId"
    ),
    initiated AS (
      SELECT "conversationId", first_time,
        SPLIT_PART(first_sender, ''@'', 1) as rep
      FROM thread_first WHERE first_sender LIKE ''%@kiingo.com''
    ),
    replied AS (
      SELECT DISTINCT i."conversationId", i.rep
      FROM initiated i
      JOIN deal_emails e ON e."conversationId" = i."conversationId"
        AND e."from" NOT LIKE ''%@kiingo.com''
        AND e."receivedDateTime" > i.first_time
    )
    SELECT
      i.rep,
      COUNT(DISTINCT i."conversationId") as initiated,
      COUNT(DISTINCT r."conversationId") as replied,
      ROUND(COUNT(DISTINCT r."conversationId")::numeric / NULLIF(COUNT(DISTINCT i."conversationId"), 0) * 100, 1) as rate
    FROM initiated i
    LEFT JOIN replied r ON r."conversationId" = i."conversationId"
    GROUP BY i.rep
    HAVING COUNT(DISTINCT i."conversationId") >= 10
    ORDER BY COUNT(DISTINCT i."conversationId") DESC
  `
});
```

### Step 5: Structure the data

For `monthlyData`, convert month strings to short labels (e.g. "2025-06" → "Jun", "2025-12" → "Dec", "2026-01" → "Jan"). Each entry: { month, initiated, replied, rate }.

For `repData`, capitalize the first letter of the rep name. Exclude system accounts (names containing "MicrosoftExchange", "clientsolutions", "support"). Sort by initiated descending. Each entry: { rep, initiated, replied, rate }.

## Values to Return
- `overallRate`: number (percentage)
- `totalInitiated`: number
- `totalReplied`: number
- `medianReplyHours`: number
- `p25ReplyHours`: number
- `p75ReplyHours`: number
- `monthlyData`: array of { month, initiated, replied, rate }
- `repData`: array of { rep, initiated, replied, rate }
', '(() => {
  const overallRate = OVERALL_RATE_PLACEHOLDER;
  const totalInitiated = TOTAL_INITIATED_PLACEHOLDER;
  const totalReplied = TOTAL_REPLIED_PLACEHOLDER;
  const medianReplyHours = MEDIAN_REPLY_HOURS_PLACEHOLDER;
  const monthlyData = MONTHLY_DATA_PLACEHOLDER;
  const repData = REP_DATA_PLACEHOLDER;

  const medianDisplay = medianReplyHours < 24
    ? medianReplyHours.toFixed(1) + ''h''
    : (medianReplyHours / 24).toFixed(1) + ''d'';

  return (
    <MetricSection>
      <MetricRow>
        <StatCard label={''Response Rate''} value={overallRate + ''%''} subtitle={''Deal-linked threads''} />
        <StatCard label={''Median Reply Time''} value={medianDisplay} subtitle={''When they reply''} />
        <StatCard label={''Threads Initiated''} value={totalInitiated.toLocaleString()} subtitle={''Kiingo-sent first''} />
        <StatCard label={''Got Reply''} value={totalReplied.toLocaleString()} subtitle={''External reply received''} />
      </MetricRow>

      <div style={{ height: 280, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Monthly Response Rate</div>
        <ResponsiveContainer width="100%" height="90%">
          <ComposedChart data={monthlyData} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="month" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis yAxisId="left" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis yAxisId="right" orientation="right" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} domain={[0, 60]} unit="%" />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <Legend />
            <Bar yAxisId="left" dataKey="initiated" name="Initiated" fill={theme.accent} opacity={0.25} radius={[4, 4, 0, 0]} />
            <Bar yAxisId="left" dataKey="replied" name="Replied" fill={theme.accent} radius={[4, 4, 0, 0]} />
            <Line yAxisId="right" type="monotone" dataKey="rate" name="Rate %" stroke={theme.danger} strokeWidth={2} dot={{ fill: theme.danger, r: 3 }} />
          </ComposedChart>
        </ResponsiveContainer>
      </div>

      <div style={{ height: 300, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 16 }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Response Rate by Rep</div>
        <ResponsiveContainer width="100%" height="90%">
          <BarChart data={repData} layout="vertical" margin={{ top: 10, right: 30, left: 60, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis type="number" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} domain={[0, 70]} unit="%" />
            <YAxis type="category" dataKey="rep" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} width={70} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} formatter={(v, name, props) => [v + ''% ('' + props.payload.replied + ''/'' + props.payload.initiated + '')'', ''Response Rate'']} />
            <Bar dataKey="rate" name="Response Rate %" fill={theme.accent} radius={[0, 4, 4, 0]} />
          </BarChart>
        </ResponsiveContainer>
      </div>

      <MetricNote>Source: Kiingo CRM Database · Deal-linked email threads · Open deals only</MetricNote>
    </MetricSection>
  );
})()', 86400, 'claude', NULL, NULL, 1, 0, '{"aliases": ["response rate", "email response rate", "reply rate", "outreach response"]}', '2026-02-19T00:40:01+00:00', '2026-02-19T00:40:01+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('b6dc4242-b365-4360-acd2-4f764853f0c9', 'Sales Scorecard', 'sales-scorecard', 'Pull weekly sales metrics from the Sales/Marketing Scorecard table in Notion.

## Data Sources
Notion page: Sales/Marketing Scorecard
Page ID: 2f001bab-c077-8037-bcfa-fd46eacbdc68

## Retrieval Steps
1. Call `notion.listBlockChildren({ blockId: ''2f001bab-c077-8037-bcfa-fd46eacbdc68'' })` to get page blocks.
2. Find the block with `type: ''table''`. Note its `id`.
3. Call `notion.listBlockChildren({ blockId: <tableId> })` to get all table rows.
4. Skip row index 0 (header) and row index 1 (owner row — cells contain "Sales"/"Marketing").
5. For each remaining row, call `notion.getBlock({ blockId: row.id, includeRaw: true })`.
6. Extract cell text from `raw.table_row.cells[colIndex]` — each cell is an array of rich text objects, join their `plain_text`.

## Column Mapping (0-indexed)
- Col 0: Week (date range string, e.g. "01/12 - 01/16")
- Col 1: # of discovery calls (this week) — integer
- Col 2: # of next steps calls (this week) — integer
- Col 3: $ Opps created total (trailing 4 weeks) — dollar string like "$351,746"
- Col 4: Closed won (prior week) — dollar string like "$83,098"
- Col 5: Close rate (trailing 4 weeks) — percentage string like "45.6%"
- Col 6: Avg. deal size closed (trailing 4 weeks) — string like "$4.0k"

## Parsing Rules
- For dollar values (cols 3, 4): strip "$" and "," then parseFloat. If col 6 contains "k", multiply by 1000.
- For percentages (col 5): strip "%" then parseFloat.
- For integers (cols 1, 2): parseInt, treat empty as 0.
- Extract a short week label from col 0: use just the start date portion (e.g. "01/12 - 01/16" → "1/12").
- Skip rows where col 0 is empty or is the owner row.

## Values to Return
- `weeks`: array of objects, each with:
  - `week`: short label (e.g. "1/12")
  - `discoveryCalls`: number
  - `nextStepsCalls`: number
  - `oppsCreated`: number (dollars)
  - `closedWon`: number (dollars)
  - `closeRate`: number (percentage, e.g. 45.6)
  - `avgDealSize`: number (dollars)
- `latestWeek`: the last row''s week label
- `latestDiscovery`: last row''s discovery calls
- `latestNextSteps`: last row''s next steps calls
- `latestClosedWon`: last row''s closed won (dollars)
- `latestCloseRate`: last row''s close rate (percentage)
- `latestOpps`: last row''s opps created (dollars)
- `latestAvgDeal`: last row''s avg deal size (dollars)
- `totalClosedWon`: sum of closedWon across all weeks
', '(() => {
  const weeks = WEEKS_PLACEHOLDER;
  const latestWeek = LATEST_WEEK_PLACEHOLDER;
  const latestDiscovery = LATEST_DISCOVERY_PLACEHOLDER;
  const latestNextSteps = LATEST_NEXT_STEPS_PLACEHOLDER;
  const latestClosedWon = LATEST_CLOSED_WON_PLACEHOLDER;
  const latestCloseRate = LATEST_CLOSE_RATE_PLACEHOLDER;
  const latestOpps = LATEST_OPPS_PLACEHOLDER;
  const latestAvgDeal = LATEST_AVG_DEAL_PLACEHOLDER;
  const totalClosedWon = TOTAL_CLOSED_WON_PLACEHOLDER;

  const fmt = (n) => ''$'' + (n || 0).toLocaleString();
  const fmtK = (n) => ''$'' + ((n || 0) / 1000).toFixed(0) + ''K'';

  return (
    <MetricSection>
      <MetricRow>
        <StatCard label={''Discovery Calls''} value={latestDiscovery} subtitle={''Week of '' + latestWeek} />
        <StatCard label={''Next Steps Calls''} value={latestNextSteps} subtitle={''Week of '' + latestWeek} />
        <StatCard label={''Closed Won''} value={fmtK(latestClosedWon)} subtitle={''Prior week''} />
        <StatCard label={''Close Rate (T4W)''} value={latestCloseRate + ''%''} subtitle={''Avg deal '' + fmt(latestAvgDeal)} />
      </MetricRow>

      <MetricRow>
        <StatCard label={''Pipeline (T4W)''} value={fmtK(latestOpps)} subtitle={''Opps created''} />
        <StatCard label={''Total Closed Won''} value={fmtK(totalClosedWon)} subtitle={''All weeks tracked''} />
      </MetricRow>

      <div style={{ height: 280, background: theme.panel, borderRadius: 16, padding: 20, border: ''1px solid '' + theme.line }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Weekly Call Activity</div>
        <ResponsiveContainer width="100%" height="90%">
          <BarChart data={weeks} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="week" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <Legend />
            <Bar dataKey="discoveryCalls" name="Discovery" fill={theme.accent} radius={[4, 4, 0, 0]} />
            <Bar dataKey="nextStepsCalls" name="Next Steps" fill={theme.secondary} radius={[4, 4, 0, 0]} />
          </BarChart>
        </ResponsiveContainer>
      </div>

      <div style={{ display: ''grid'', gridTemplateColumns: ''1fr 1fr'', gap: 16, marginTop: 16 }}>
        <div style={{ height: 260, background: theme.panel, borderRadius: 16, padding: 16, border: ''1px solid '' + theme.line }}>
          <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Closed Won by Week</div>
          <ResponsiveContainer width="100%" height="85%">
            <AreaChart data={weeks} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
              <defs>
                <linearGradient id="salesClosedGrad" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0%" stopColor="#16a34a" stopOpacity={0.15} />
                  <stop offset="100%" stopColor="#16a34a" stopOpacity={0.02} />
                </linearGradient>
              </defs>
              <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
              <XAxis dataKey="week" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} />
              <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} tickFormatter={(v) => ''$'' + (v / 1000).toFixed(0) + ''K''} />
              <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 12 }} formatter={(v) => [fmt(v), ''Closed Won'']} />
              <Area type="monotone" dataKey="closedWon" stroke="#16a34a" strokeWidth={2} fill="url(#salesClosedGrad)" />
            </AreaChart>
          </ResponsiveContainer>
        </div>

        <div style={{ height: 260, background: theme.panel, borderRadius: 16, padding: 16, border: ''1px solid '' + theme.line }}>
          <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Close Rate % (Trailing 4 Weeks)</div>
          <ResponsiveContainer width="100%" height="85%">
            <LineChart data={weeks} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
              <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
              <XAxis dataKey="week" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} />
              <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} tickFormatter={(v) => v + ''%''} domain={[0, 60]} />
              <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 12 }} formatter={(v) => [v + ''%'', ''Close Rate'']} />
              <Line type="monotone" dataKey="closeRate" stroke={theme.accent} strokeWidth={2} dot={{ fill: theme.accent, r: 4 }} />
            </LineChart>
          </ResponsiveContainer>
        </div>
      </div>

      <MetricNote>Source: Notion Leadership Team · Sales/Marketing Scorecard</MetricNote>
    </MetricSection>
  );
})()', 259200, 'claude', NULL, NULL, 1, 0, '{"aliases":["scorecard","sales score","sales metrics"]}', '2026-02-15T06:29:29+00:00', '2026-02-18T01:06:55+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('d6fe7a31-00ad-41e4-9379-b4ec83a346b7', 'Team Workload', 'team-workload', 'Track team member task load from Asana.

## Data Source
Asana Tasks via Kiingo MCP `asana` module.

## Retrieval Steps
1. Get all workspace users from Asana.
2. For each team member, search tasks: `asana.searchTasks({ assignee: ''<user_gid>'', completed: false })`.
3. Count: total open tasks, tasks due this week, overdue tasks (due_on < today and not completed).
4. Build workload array sorted by open task count descending.

## Values to Return
- `teamWorkload`: array of { name, open, dueThisWeek, overdue }
- `totalOpenTasks`: sum of all open tasks
- `totalOverdue`: sum of all overdue tasks', '(() => {
  const data = DATA_PLACEHOLDER;
  const totalOpen = data.reduce((s, d) => s + d.open, 0);
  const totalOverdue = data.reduce((s, d) => s + d.overdue, 0);
  return (
    <MetricSection>
      <MetricRow>
        <StatCard label="Total Open Tasks" value={totalOpen} subtitle="Across team" />
        <StatCard label="Overdue" value={totalOverdue} subtitle="Past due date" trendDirection={totalOverdue > 5 ? ''down'' : ''flat''} />
      </MetricRow>
      <div style={{ height: 280, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
        <ResponsiveContainer width="100%" height="100%">
          <BarChart data={data} layout="vertical" margin={{ top: 5, right: 20, left: 100, bottom: 5 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis type="number" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis type="category" dataKey="name" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} width={95} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <Bar dataKey="open" name="Open" fill={theme.accent} radius={[0,4,4,0]} stackId="a" />
            <Bar dataKey="overdue" name="Overdue" fill={theme.danger} radius={[0,4,4,0]} stackId="b" />
          </BarChart>
        </ResponsiveContainer>
      </div>
      <MetricNote>Source: Asana Tasks via Kiingo MCP</MetricNote>
    </MetricSection>
  );
})()', 259200, 'claude', NULL, NULL, 1, 0, '{"aliases":["workload","capacity","team capacity"]}', '2026-02-15T06:34:11+00:00', '2026-02-15T06:34:11+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('9d9e7fe9-b25c-4628-ac65-5a4fea982f67', 'Top Customers by Revenue', 'top-customers-revenue', 'Show top customers by invoiced revenue from QuickBooks.

## Data Source
QuickBooks Invoices via `quickbooks.query()`.

## Retrieval Steps
1. Query invoices grouped by customer: `quickbooks.query({ query: "SELECT CustomerRef, SUM(TotalAmt) as Total FROM Invoice WHERE TxnDate >= ''<12mo ago>'' GROUP BY CustomerRef ORDER BY Total DESC", maxResults: 20 })`.
2. If CustomerRef returns IDs, resolve customer names via `quickbooks.query({ query: "SELECT Id, DisplayName FROM Customer WHERE Id IN (...)" })`.
3. Build array of { name, revenue } sorted by revenue desc.
4. Include top 10 customers.

## Values to Return
- `topCustomers`: array of { name, revenue }
- `topCustomerRevenue`: sum of top 10 customer revenue
- `totalCustomers`: total unique customers with invoices', '(() => {
  const data = DATA_PLACEHOLDER;
  return (
    <MetricSection>
      <div style={{ height: 320, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line }}>
        <ResponsiveContainer width="100%" height="100%">
          <BarChart data={data} layout="vertical" margin={{ top: 5, right: 20, left: 90, bottom: 5 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis type="number" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} tickFormatter={v => ''$'' + (v/1000) + ''K''} />
            <YAxis type="category" dataKey="name" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} width={85} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} formatter={v => ''$'' + Number(v).toLocaleString()} />
            <Bar dataKey="revenue" name="Revenue" fill={theme.accent} radius={[0,4,4,0]} />
          </BarChart>
        </ResponsiveContainer>
      </div>
      <MetricNote>Source: QuickBooks Invoices (LTM) via Kiingo MCP</MetricNote>
    </MetricSection>
  );
})()', 259200, 'claude', NULL, NULL, 1, 0, '{"aliases":["top customers","biggest clients","top accounts"]}', '2026-02-15T06:29:29+00:00', '2026-02-15T06:29:29+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('7c765544-15a4-4c66-a458-1f5db331f2f8', 'Trailing 30-Day Leads', 'trailing-30-day-leads', 'Retrieve all HubSpot leads that are Hot or Warm and compute the trailing 30-day lead count measured weekly.

## Data Source
HubSpot Leads object via Kiingo MCP `hubspot.listLeads()`.

## Retrieval Steps
1. Paginate through ALL leads: call `hubspot.listLeads({ limit: 100, properties: [''createdate'', ''hs_lead_name'', ''lead_strength'', ''hs_lead_label''], after })` in a loop until `paging.next.after` is absent.
2. **Filter to Hot or Warm only**: keep a lead if `lead_strength` is "Hot" or "Warm", OR if `hs_lead_label` is "HOT" or "WARM". Discard all others (Cold, Lukewarm, or unlabeled).
3. Parse `createdate` from each remaining lead''s properties (fall back to `createdAt`). Sort ascending.
4. Compute trailing 30-day count for each week starting from the first full Sunday after the earliest lead:
   - For each week-ending date, count leads created in the 30-day window ending on that date.
5. Also compute: current trailing 30 count (from today), by-month breakdown, peak/trough/average.

## Narrative Context
- Only Hot and Warm leads are counted (via custom `lead_strength` property or HubSpot-native `hs_lead_label`).
- Steady state baseline is ~40-50 trailing leads (Oct-Nov 2025 was 45-52 before filtering).
- Expect holiday dip mid-Dec through early Jan (Dec 2025-Jan 2026 bottomed at 22).
- Single-day spikes usually indicate campaigns or events.
- Always report: trailing window dates, whether current period is complete, current vs peak vs trough.

## Values to Return
- `trailing30`: current trailing 30-day count (Hot/Warm only)
- `peak`: highest weekly trailing 30 value and which week
- `trough`: lowest weekly trailing 30 value (excluding ramp-up) and which week
- `total`: total Hot/Warm lead count
- `avgTrailing`: average trailing 30 across all weeks
- `weeklyData`: array of { weekOf, trailing30 } for the chart
- `byMonth`: object of month -> count', '(() => {
  const data = DATA_PLACEHOLDER;
  const current = CURRENT_PLACEHOLDER;
  const peak = PEAK_PLACEHOLDER;
  const trough = TROUGH_PLACEHOLDER;
  const avgValue = AVG_PLACEHOLDER;

  return (
    <MetricSection>
      <MetricRow>
        <StatCard label="Current" value={current} subtitle="Trailing 30d" />
        <StatCard label="Peak" value={peak} subtitle="Best week" />
        <StatCard label="Trough" value={trough} subtitle="Lowest week" />
      </MetricRow>
      <div style={{ height: 320, background: theme.panel, borderRadius: 16, padding: 20, border: `1px solid ${theme.line}` }}>
        <ResponsiveContainer width="100%" height="100%">
          <AreaChart data={data} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <defs>
              <linearGradient id="leadGradient" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stopColor={theme.gradientFrom} stopOpacity={0.3} />
                <stop offset="100%" stopColor={theme.gradientFrom} stopOpacity={0.02} />
              </linearGradient>
            </defs>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="week" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} interval={2} />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} domain={[0, ''auto'']} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: `1px solid ${theme.tooltipBorder}`, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <ReferenceLine y={avgValue} stroke={theme.line} strokeDasharray="6 4" />
            <Area type="monotone" dataKey="value" stroke={theme.accent} strokeWidth={2.5} fill="url(#leadGradient)" dot={{ fill: theme.accent, r: 3, strokeWidth: 0 }} activeDot={{ fill: theme.accentStrong, r: 5, strokeWidth: 2, stroke: theme.line }} />
          </AreaChart>
        </ResponsiveContainer>
      </div>
      <MetricNote>Each point = trailing 30-day leads · Source: HubSpot CRM via Kiingo MCP</MetricNote>
    </MetricSection>
  );
})()', 259200, 'claude', NULL, NULL, 1, 0, '{"aliases":["30 day leads","recent leads","trailing leads"]}', '2026-02-14T20:05:31.949129+00:00', '2026-02-14T20:05:31.949129+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('5da7296a-4782-45a8-8309-b0b4f9827ce9', 'Trailing Discovery Calls', 'trailing-discovery-calls', 'Compute trailing 30-day first-time discovery call metrics using dependency input from `weekly-discovery-calls`. Do not call any calendar or HubSpot APIs.

## Dependency Input
You will receive one dependency input:
1. **weekly-discovery-calls** with values including:
   - `weeklyData`: array of `{ weekOf, count }` — first-time discovery calls per week
   - `weeklyFollowUps`: array of `{ weekOf, count }` — repeat-company calls per week
   - `weeklyNextSteps`: array of `{ weekOf, count }` — next-steps calls per week
   - `dailyData`: array of `{ date, count }` — daily first-time discovery counts
   - `discoveryTotal`, `followUpTotal`, `nextStepsTotal`, `total`
   - `avgPerWeek`, `currentWeek`, `priorWeek`, `trend`
   - `discoveryDetails`: full audit list of counted discovery calls
   - `excludedRepeats`: sample of excluded repeat-company calls
   - `excludedNextSteps`: sample of excluded next-steps calls

## Computation Steps
1. Locate dependency input where `slug == "weekly-discovery-calls"` and read its `values`.
2. Build a trailing-30 weekly series using `weeklyData` (first-time discovery counts only):
   - Preferred: if `dailyData` is present, compute exact 30-day rolling windows for each week ending date.
   - Fallback: if only `weeklyData` exists, estimate each trailing-30 value as:
     current week plus prior 3 full weeks plus (2/7 * week-4), rounded to nearest integer.
3. Compute summary metrics from that trailing series:
   - `trailing30`: most recent trailing-30 value
   - `peak`, `peakWeek`: max trailing value and which week
   - `trough`, `troughWeek`: min trailing value and which week
   - `avgTrailing`: average trailing-30 across all weeks
4. Also surface follow-up and next-steps totals for context:
   - `followUpTotal`, `nextStepsTotal` from dependency
5. Compute monthly context:
   - `byMonth`: aggregate first-time discovery counts by month from daily data or weekly buckets

## Values to Return
- `trailing30`: current trailing 30-day first-time discovery count
- `peak`: highest weekly trailing-30 value
- `peakWeek`: ISO date of peak week
- `trough`: lowest weekly trailing-30 value
- `troughWeek`: ISO date of trough week
- `total`: total first-time discovery calls in dependency lookback
- `avgTrailing`: average trailing-30 across all weeks
- `weeklyData`: array of { weekOf, trailing30 } for the chart
- `byMonth`: object of month -> first-time discovery count
- `followUpTotal`: total repeat-company calls (context)
- `nextStepsTotal`: total next-steps calls (context)
- `discoveryDetails`: passed through from dependency for audit
- `excludedRepeats`: passed through from dependency for audit
', '(() => {
  const data = DATA_PLACEHOLDER;
  const current = CURRENT_PLACEHOLDER;
  const peak = PEAK_PLACEHOLDER;
  const trough = TROUGH_PLACEHOLDER;
  const avgValue = AVG_PLACEHOLDER;

  return (
    <MetricSection>
      <MetricRow>
        <StatCard label="Current" value={current} subtitle="Trailing 30d" />
        <StatCard label="Peak" value={peak} subtitle="Best week" />
        <StatCard label="Trough" value={trough} subtitle="Lowest week" />
      </MetricRow>
      <div style={{ height: 320, background: theme.panel, borderRadius: 16, padding: 20, border: `1px solid ${theme.line}` }}>
        <ResponsiveContainer width="100%" height="100%">
          <AreaChart data={data} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <defs>
              <linearGradient id="discoveryGradient" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stopColor={theme.secondary} stopOpacity={0.3} />
                <stop offset="100%" stopColor={theme.secondary} stopOpacity={0.02} />
              </linearGradient>
            </defs>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="week" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} interval={2} />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} domain={[0, ''auto'']} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: `1px solid ${theme.tooltipBorder}`, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <ReferenceLine y={avgValue} stroke={theme.line} strokeDasharray="6 4" />
            <Area type="monotone" dataKey="value" stroke={theme.secondary} strokeWidth={2.5} fill="url(#discoveryGradient)" dot={{ fill: theme.secondary, r: 3, strokeWidth: 0 }} activeDot={{ fill: theme.accentStrong, r: 5, strokeWidth: 2, stroke: theme.line }} />
          </AreaChart>
        </ResponsiveContainer>
      </div>
      <MetricNote>Each point = trailing 30-day discovery calls · Source: Weekly Discovery Calls dependency (calendar-derived)</MetricNote>
    </MetricSection>
  );
})()', 259200, 'claude', NULL, NULL, 1, 0, '{"aliases":["trailing disco","disco calls trailing","discovery trailing"],"dependencies":["weekly-discovery-calls"]}', '2026-02-17T00:57:37+00:00', '2026-02-18T06:35:15+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('32c77dad-2b50-44f9-b9e0-5b4d668d2bca', 'Trailing Follow-Up Calls', 'trailing-followup-calls', 'Compute trailing 30-day follow-up call metrics using dependency input from `weekly-followup-calls`. Do not call any calendar or HubSpot APIs.

## Dependency Input
You will receive one dependency input:
1. **weekly-followup-calls** with values including:
   - `weeklyData`: array of `{ weekOf, count }` — external-facing follow-up calls per week
   - `dailyData`: array of `{ date, count }` — daily follow-up counts
   - `total`, `avgPerWeek`, `currentWeek`, `priorWeek`, `trend`
   - `followUpDetails`: audit list of counted follow-up calls
   - `excludedInternal`: sample of excluded internal meetings

## Computation Steps
1. Locate dependency input where `slug == "weekly-followup-calls"` and read its `values`.
2. Build a trailing-30 weekly series using `weeklyData`:
   - Preferred: if `dailyData` is present, compute exact 30-day rolling windows for each week ending date.
   - Fallback: if only `weeklyData` exists, estimate each trailing-30 value as:
     current week plus prior 3 full weeks plus (2/7 * week-4), rounded to nearest integer.
3. Compute summary metrics from that trailing series:
   - `trailing30`: most recent trailing-30 value
   - `peak`, `peakWeek`: max trailing value and which week
   - `trough`, `troughWeek`: min trailing value and which week
   - `avgTrailing`: average trailing-30 across all weeks
4. Compute monthly context:
   - `byMonth`: aggregate follow-up counts by month from daily data or weekly buckets

## Values to Return
- `trailing30`: current trailing 30-day follow-up count
- `peak`: highest weekly trailing-30 value
- `peakWeek`: ISO date of peak week
- `trough`: lowest weekly trailing-30 value
- `troughWeek`: ISO date of trough week
- `total`: total follow-up calls in dependency lookback
- `avgTrailing`: average trailing-30 across all weeks
- `weeklyData`: array of { weekOf, trailing30 } for the chart
- `byMonth`: object of month -> follow-up count
- `followUpDetails`: passed through from dependency for audit
', '(() => {
  const data = DATA_PLACEHOLDER;
  const current = CURRENT_PLACEHOLDER;
  const peak = PEAK_PLACEHOLDER;
  const trough = TROUGH_PLACEHOLDER;
  const avgValue = AVG_PLACEHOLDER;

  return (
    <MetricSection>
      <MetricRow>
        <StatCard label="Current" value={current} subtitle="Trailing 30d" />
        <StatCard label="Peak" value={peak} subtitle="Best week" />
        <StatCard label="Trough" value={trough} subtitle="Lowest week" />
      </MetricRow>
      <div style={{ height: 320, background: theme.panel, borderRadius: 16, padding: 20, border: `1px solid ${theme.line}` }}>
        <ResponsiveContainer width="100%" height="100%">
          <AreaChart data={data} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <defs>
              <linearGradient id="followupGradient" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stopColor={theme.secondary} stopOpacity={0.3} />
                <stop offset="100%" stopColor={theme.secondary} stopOpacity={0.02} />
              </linearGradient>
            </defs>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="week" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} interval={2} />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} domain={[0, ''auto'']} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: `1px solid ${theme.tooltipBorder}`, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <ReferenceLine y={avgValue} stroke={theme.line} strokeDasharray="6 4" />
            <Area type="monotone" dataKey="value" stroke={theme.secondary} strokeWidth={2.5} fill="url(#followupGradient)" dot={{ fill: theme.secondary, r: 3, strokeWidth: 0 }} activeDot={{ fill: theme.accentStrong, r: 5, strokeWidth: 2, stroke: theme.line }} />
          </AreaChart>
        </ResponsiveContainer>
      </div>
      <MetricNote>Each point = trailing 30-day follow-up calls · Source: Weekly Follow-Up Calls dependency (calendar-derived)</MetricNote>
    </MetricSection>
  );
})()', 259200, 'claude', NULL, NULL, 1, 0, '{"dependencies":["weekly-followup-calls"]}', '2026-02-17T01:46:35+00:00', '2026-02-18T07:15:09+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('e6bfcbb4-ac2e-480d-8b3d-431f6312551e', 'Upcoming Cohort Calendar', 'upcoming-cohort-calendar', 'Show upcoming and active bootcamp cohorts by combining the Asana Ops board (with session date custom fields) and the Office Hours calendar for a full picture of cohort activity.

## Data Sources
1. Asana → "AI Bootcamp Ops" project (GID: 1208309967533974) — all sections (Scheduling/Underway/Completed)
2. Microsoft Calendar → "AI Bootcamp Office Hours" calendar (ID: AAMkAGMxNTQyZjUyLWE5MjYtNDQ2ZS1iYWMxLTA0ZTgxMmZiOGYxOABGAAAAAAA1aYnhhmn8TIASxaX7OOulBwCme88kvStVQZzo4G036zUXAAAAAAEGAACme88kvStVQZzo4G036zUXAAFiW2tzAAA=) — shows all cohorts with active office hours

## Important Notes
- The Asana board sections are **NOT reliably maintained** — completed cohorts often remain in Scheduling or Underway.
- Use `Session N Date` custom fields + the `completed` flag to determine true cohort status.
- The office hours calendar is the **best real-time signal** for which cohorts are currently active — 42+ unique cohorts had OH events in Feb 2026, far more than the ~10 in the "Underway" section.

## Retrieval Steps

### Step 1: Get ALL Asana Ops board tasks with session dates
```typescript
import { asana } from ''tools'';
const underway = await asana.getTasksForSection({
  sectionGid: ''1208335145873011'',
  opt_fields: [''name'',''assignee.name'',''completed'',''custom_fields'']
});
const scheduling = await asana.getTasksForSection({
  sectionGid: ''1208309967533979'',
  opt_fields: [''name'',''assignee.name'',''completed'',''custom_fields'']
});
```

Combine all tasks. For each, find Session 1 Date through Session 8 Date custom fields. Classify using session dates + completed flag:
- **truly active**: NOT completed AND has session dates spanning today (Session 1 in past, last session in future or within 2 weeks)
- **truly scheduled**: NOT completed AND Session 1 Date is in the future (or no dates yet)
- **truly completed**: completed flag is true AND all session dates are in the past

### Step 2: Get office hours events for next 60 days
```typescript
import { calendar } from ''tools'';
const now = new Date();
const future = new Date(now.getTime() + 60 * 24 * 60 * 60 * 1000);
const ohEvents = await calendar.getCalendarView({
  calendarId: ''AAMkAGMxNTQyZjUyLWE5MjYtNDQ2ZS1iYWMxLTA0ZTgxMmZiOGYxOABGAAAAAAA1aYnhhmn8TIASxaX7OOulBwCme88kvStVQZzo4G036zUXAAAAAAEGAACme88kvStVQZzo4G036zUXAAFiW2tzAAA='',
  startDateTime: now.toISOString(),
  endDateTime: future.toISOString()
});
```

### Step 3: Extract unique cohorts from office hours
Parse each event subject to extract the cohort name. Subjects follow patterns like:
- "AI Bootcamp Office Hours (Optional) <Cohort Name>"
- "AI for Marketing Bootcamp Office Hours <Cohort Name> (Optional)"

Extract the cohort identifier. Deduplicate. Count events per cohort to estimate remaining sessions.

### Step 4: Merge data
Build two lists:
- `activeCohorts`: cohorts with upcoming OH events, each with { name, sessions (remaining OH count) }
- `scheduledCohorts`: truly scheduled cohorts from Asana (not completed, session dates in future), each with { name, instructor }

The office hours calendar is the primary source for active cohorts. The Asana board supplements with instructor assignments and pipeline data.

### Step 5: Build weekly event density
Group office hours events by week (Mon-Sun). For each week: { week (short label like "2/17"), sessions (count of events) }. Show next 8 weeks.

## Values to Return
- `activeCount`: number (unique cohorts with upcoming OH events — the most reliable active count)
- `scheduledCount`: number (truly scheduled on Asana, not yet started)
- `officeHourCohorts`: number (unique cohorts with OH events)
- `totalSessions`: number (total OH events in next 60 days)
- `activeCohorts`: array of { name, instructor }
- `scheduledCohorts`: array of { name, instructor }
- `weeklyDensity`: array of { week, sessions }
', '(() => {
  const activeCount = ACTIVE_COUNT_PLACEHOLDER;
  const scheduledCount = SCHEDULED_COUNT_PLACEHOLDER;
  const officeHourCohorts = OH_COHORTS_PLACEHOLDER;
  const totalSessions = TOTAL_SESSIONS_PLACEHOLDER;
  const activeCohorts = ACTIVE_COHORTS_PLACEHOLDER;
  const scheduledCohorts = SCHEDULED_COHORTS_PLACEHOLDER;
  const weeklyDensity = WEEKLY_DENSITY_PLACEHOLDER;

  return (
    <MetricSection>
      <MetricRow>
        <StatCard label={''Active''} value={activeCount} subtitle={''Underway now''} />
        <StatCard label={''Scheduling''} value={scheduledCount} subtitle={''Being set up''} />
        <StatCard label={''OH Cohorts''} value={officeHourCohorts} subtitle={''With office hours''} />
        <StatCard label={''OH Sessions''} value={totalSessions} subtitle={''Next 60 days''} />
      </MetricRow>

      <div style={{ height: 220, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Weekly Office Hours Density</div>
        <ResponsiveContainer width="100%" height="85%">
          <BarChart data={weeklyDensity} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="week" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <Bar dataKey="sessions" name="OH Sessions" fill={theme.accent} radius={[4, 4, 0, 0]} />
          </BarChart>
        </ResponsiveContainer>
      </div>

      <div style={{ display: ''grid'', gridTemplateColumns: ''1fr 1fr'', gap: 16, marginTop: 16 }}>
        <div style={{ background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line }}>
          <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 12, color: theme.ink }}>Active Cohorts</div>
          <div style={{ display: ''flex'', flexDirection: ''column'', gap: 6 }}>
            {activeCohorts.map((c, i) => (
              <div key={i} style={{ display: ''flex'', justifyContent: ''space-between'', alignItems: ''center'', padding: ''6px 12px'', borderRadius: 8, background: theme.accent + ''0a'', border: ''1px solid '' + theme.line }}>
                <span style={{ fontSize: 12, fontWeight: 600, color: theme.ink }}>{c.name}</span>
                <span style={{ fontSize: 11, color: theme.inkMuted }}>{c.instructor}</span>
              </div>
            ))}
          </div>
        </div>
        <div style={{ background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line }}>
          <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 12, color: theme.ink }}>Scheduling Pipeline</div>
          <div style={{ display: ''flex'', flexDirection: ''column'', gap: 6 }}>
            {scheduledCohorts.map((c, i) => (
              <div key={i} style={{ display: ''flex'', justifyContent: ''space-between'', alignItems: ''center'', padding: ''6px 12px'', borderRadius: 8, background: ''#eab308'' + ''0a'', border: ''1px solid '' + theme.line }}>
                <span style={{ fontSize: 12, fontWeight: 600, color: theme.ink }}>{c.name}</span>
                <span style={{ fontSize: 11, color: theme.inkMuted }}>{c.instructor}</span>
              </div>
            ))}
          </div>
        </div>
      </div>

      <MetricNote>Source: Asana Ops board + Microsoft Calendar office hours</MetricNote>
    </MetricSection>
  );
})()', 43200, 'claude', NULL, NULL, 1, 0, '{"aliases": ["upcoming cohorts", "cohort calendar", "bootcamp schedule", "office hours schedule"]}', '2026-02-19T05:43:41+00:00', '2026-02-19T05:43:41+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('e559abdf-19d9-b054-ee6c-9bb3b88a39f7', 'Weekly Discovery Calls', 'weekly-discovery-calls', 'Count first-time discovery calls per week from David''s calendar (david@kiingo.com).

A "discovery call" is the FIRST external-facing sales conversation with a new prospect company. Repeat meetings with the same company and explicit next-steps/follow-up calls are excluded.

## Data Source
Microsoft Calendar via Kiingo MCP `calendar.listEvents()`.

IMPORTANT - Response Shape: `calendar.listEvents()` returns `{ events: CalendarEventSummary[], totalCount: number }`. Access events via `.events`, not `.value`.

IMPORTANT - Use this exact API shape (do not improvise parameter names):
```js
await calendar.listEvents({
  mailboxEmailAddress: ''david@kiingo.com'',
  startDateTime: ''<ISO datetime>'',
  endDateTime: ''<ISO datetime>'',
  useCalendarView: true,
  maxResults: 1000,
  timeZone: ''UTC''
});
```
Use `mailboxEmailAddress`, `startDateTime`, and `endDateTime` exactly. Do not use `userEmail`, `startDate`, or `endDate`.

## Reliability Requirements (must follow)
- Use a single end-to-end computation flow.
- Do not rely on cross-call memory or store persistence across tool invocations.
- Do not split data fetch and aggregation across separate executions.
- Use defensive defaults for event arrays: if result.events is missing, treat it as [] instead of throwing.
- Avoid debug loops or large verbose dumps of raw events.
- Do not call any MCP help/introspection tools for this metric. Use only `calendar.listEvents` with the exact parameter names above.

## Date Ranges
- **Reporting window**: trailing 12 weeks from today (this is what gets charted).
- **Lookback window**: fetch an EXTRA 12 weeks before the reporting window (24 weeks total from today). The earlier 12 weeks are used ONLY to detect whether a company has been seen before. They do NOT appear in the weekly counts or charts.

So if today is Feb 17, 2026:
- Fetch events from Aug 25, 2025 through Feb 17, 2026 (24 weeks).
- Report weekly counts only for the trailing 12 weeks (Nov 24, 2025 through Feb 17, 2026).
- Use the earlier 12 weeks (Aug 25 - Nov 23) solely as "prior history" to detect repeat companies.

## Classification Pipeline

### Step 1: Hard Exclusions (discard immediately)
- Cancelled events (`isCancelled === true`)
- All-day events (`isAllDay === true`)
- Personal blocks: subject matches PTO, Busy, Out of Office, Blocked, Focus Time, Lunch
- Daily standups / recurring internal rhythms: Tactical Session, Standup, Daily Sync

### Step 2: External-Facing Test (MANDATORY)
An event is **external-facing** ONLY if it has at least one attendee whose email domain is NOT in this internal list:
  `kiingo.com`, `fireflies.ai`, `promax.com`

If every attendee''s email domain is in that internal list, the event is INTERNAL — discard it.

Note: `fireflies.ai` is a meeting recorder bot. `promax.com` is an internal team member''s secondary domain. Neither counts as an external participant.

### Step 3: Exclude Next Steps and Follow-Up Calls
Discard any event whose subject matches any of these patterns (case-insensitive):
- Contains "Next Steps" (e.g., "Kiingo AI - Next Steps Workshop - ...")
- Contains "Next Step" (singular)
- Contains "Follow-up" or "Follow up"
- Contains "Second Call" or "2nd Call"
- Contains "Proposal Review"
- Contains "Workshop" when combined with a person''s name (the standard next-steps format)
- Contains "Bootcamp" (this is delivery, not discovery)

These are pipeline-progression meetings, not first-time discovery calls.

### Step 4: Exclude Internal Meetings (even if external attendees present)
Discard events matching these patterns (case-insensitive):
- 1:1, Check-in, Sync, Standup, Retrospective, Planning
- Pipeline Sync, Pipeline Review, Sales Pipeline
- Social Hour, Show-and-Tell, L10, Handoff
- "Internal Training", "HubSpot Training"
- "Sales/Marketing Weekly", "Sales Handoff"
- Webinars or conferences with 20+ attendees

### Step 5: Extract Company Domain
For each remaining external-facing event, extract the **primary external company domain**:
- Collect all external attendee email domains (excluding kiingo.com, fireflies.ai, promax.com).
- The primary domain is the most common external domain among attendees.
- Normalize: lowercase, strip subdomains (e.g., "mail.example.com" → "example.com").
- Personal email domains (gmail.com, yahoo.com, icloud.com, aol.com, hotmail.com, outlook.com) should be treated as unique per-email — don''t group different gmail users as the same "company."

### Step 6: First-Time Company Check (CRITICAL)
For each event, check whether the primary company domain has appeared in ANY earlier external-facing event (going back to the start of the 24-week fetch window):
- If this is the **first time** this company domain appears → **DISCOVERY CALL** ✓
- If this company domain appeared in a **prior event** (earlier date) → **REPEAT CALL** ✗ — exclude from discovery count

Process events in chronological order so the first occurrence is always the one that counts.

### Step 7: Deduplication
Deduplicate by normalized key: `date + lowercase(subject)`. If the same meeting appears twice on the same day, count it once.

## Output Computation
After classification, build:
- **weeklyDiscovery**: `{ weekOf, count }` — first-time discovery calls per ISO week (Mon-Sun), for the trailing 12-week reporting window ONLY
- **weeklyFollowUps**: `{ weekOf, count }` — repeat company calls per week (events that passed Steps 1-4 but failed Step 6)
- **weeklyNextSteps**: `{ weekOf, count }` — events excluded at Step 3 (next steps/follow-up calls)
- **dailyData**: `{ date, count }` — discovery calls per day
- **discoveryTotal**: total first-time discovery calls in the 12-week reporting window
- **followUpTotal**: total repeat calls in the 12-week reporting window
- **nextStepsTotal**: total next-steps calls in the 12-week reporting window
- **avgPerWeek**: average discovery calls per full week
- **currentWeek**, **priorWeek**: discovery counts for current and prior week
- **trend**: increasing, decreasing, or flat based on last 4 weeks of discovery counts
- **discoveryDetails**: array of { date, subject, companyDomain, classification: "discovery" } for all counted discovery calls (full list, for audit)
- **excludedRepeats**: array of { date, subject, companyDomain, firstSeenDate } for repeat-company calls (max 20, for audit)
- **excludedNextSteps**: array of { date, subject } for next-steps calls (max 20, for audit)

## Narrative Context
- Discovery calls are FIRST-TIME early-funnel sales conversations with new prospects.
- David is the primary owner for discovery activity.
- Healthy pace is generally 5-10 first-time discovery calls per week.
- Repeat calls with the same company indicate pipeline progression but are NOT new discovery.
- The 12-week lookback for company history prevents inflating counts with returning prospects.

## Values to Return
- currentWeek: first-time discovery count for current week
- priorWeek: first-time discovery count for prior full week
- weeklyData: array of { weekOf, count } for trailing 12 weeks (discovery only)
- weeklyFollowUps: array of { weekOf, count } for repeat-company calls
- weeklyNextSteps: array of { weekOf, count } for next-steps calls
- dailyData: array of { date, count } for trailing 12 weeks (discovery only)
- discoveryTotal: total first-time discovery calls
- followUpTotal: total repeat-company calls
- nextStepsTotal: total next-steps calls
- total: discoveryTotal + followUpTotal + nextStepsTotal (all external-facing)
- avgPerWeek: average first-time discovery calls per full week
- trend: increasing, decreasing, or flat
- discoveryDetails: full list of counted discovery calls with company domain
- excludedRepeats: sample of excluded repeat-company calls with first-seen date
- excludedNextSteps: sample of excluded next-steps calls
', '(() => {
  const weeklyData = WEEKLY_DATA_PLACEHOLDER;
  const weeklyFollowUps = WEEKLY_FOLLOW_UPS_PLACEHOLDER;
  const weeklyNextSteps = WEEKLY_NEXT_STEPS_PLACEHOLDER;
  const currentWeek = CURRENT_WEEK_PLACEHOLDER;
  const priorWeek = PRIOR_WEEK_PLACEHOLDER;
  const discoveryTotal = DISCOVERY_TOTAL_PLACEHOLDER;
  const followUpTotal = FOLLOW_UP_TOTAL_PLACEHOLDER;
  const nextStepsTotal = NEXT_STEPS_TOTAL_PLACEHOLDER;
  const avgPerWeek = AVG_PER_WEEK_PLACEHOLDER;
  const trend = TREND_PLACEHOLDER;

  const trendColor = trend === ''increasing'' ? ''#16a34a'' : trend === ''decreasing'' ? ''#ef4444'' : theme.inkMuted;
  const trendLabel = trend === ''increasing'' ? ''\u25B2 Increasing'' : trend === ''decreasing'' ? ''\u25BC Decreasing'' : ''\u25C6 Flat'';

  const combined = weeklyData.map((d, i) => ({
    week: d.weekOf.substring(5),
    discovery: d.count,
    followUps: weeklyFollowUps[i] ? weeklyFollowUps[i].count : 0,
    nextSteps: weeklyNextSteps[i] ? weeklyNextSteps[i].count : 0,
  }));

  return (
    <MetricSection>
      <MetricRow>
        <StatCard label="This Week" value={currentWeek} subtitle="First-time discovery" />
        <StatCard label="Prior Week" value={priorWeek} subtitle="First-time discovery" />
        <StatCard label="12-Week Total" value={discoveryTotal} subtitle={''Avg '' + avgPerWeek + ''/week''} />
        <StatCard label="Trend" value={trendLabel} subtitle={followUpTotal + '' follow-ups, '' + nextStepsTotal + '' next steps''} />
      </MetricRow>

      <div style={{ height: 300, background: theme.panel, borderRadius: 16, padding: 20, border: ''1px solid '' + theme.line }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Weekly Discovery Calls (First-Time Only)</div>
        <ResponsiveContainer width="100%" height="90%">
          <BarChart data={combined} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="week" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <Legend />
            <Bar dataKey="discovery" name="Discovery (1st time)" fill={theme.accent} radius={[4, 4, 0, 0]} />
            <Bar dataKey="followUps" name="Follow-ups" fill={theme.chart3} opacity={0.6} radius={[4, 4, 0, 0]} />
            <Bar dataKey="nextSteps" name="Next Steps" fill={theme.secondary} opacity={0.6} radius={[4, 4, 0, 0]} />
          </BarChart>
        </ResponsiveContainer>
      </div>

      <MetricNote>Source: David''s calendar · First-time meetings with new company domains only</MetricNote>
    </MetricSection>
  );
})()', 259200, 'claude', NULL, NULL, 1, 0, '{"aliases":["disco calls","weekly disco","discovery"]}', '2026-02-16T23:05:21Z', '2026-02-18T06:44:02+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('65e79c58-154a-5e6d-6a25-ba4610bb1829', 'Weekly Follow-Up Calls', 'weekly-followup-calls', 'Count client follow-up calls per week from Michael''s calendar (michael@kiingo.com).

A "follow-up call" is any external-facing meeting that is NOT a first-time discovery call. This includes next-steps workshops, onboarding sessions, account reviews, second/third meetings, implementation calls, training sessions (client-facing), and any repeat engagement with a prospect or client company.

## Data Source
Microsoft Calendar via Kiingo MCP `calendar.listEvents()`.

IMPORTANT - Response Shape: `calendar.listEvents()` returns `{ events: CalendarEventSummary[], totalCount: number }`. Access events via `.events`, not `.value`.

IMPORTANT - Use this exact API shape (do not improvise parameter names):
```js
await calendar.listEvents({
  mailboxEmailAddress: ''michael@kiingo.com'',
  startDateTime: ''<ISO datetime>'',
  endDateTime: ''<ISO datetime>'',
  useCalendarView: true,
  maxResults: 1000,
  timeZone: ''UTC''
});
```
Use `mailboxEmailAddress`, `startDateTime`, and `endDateTime` exactly.

## Reliability Requirements (must follow)
- Use a single end-to-end computation flow.
- Do not rely on cross-call memory or store persistence across tool invocations.
- Do not split data fetch and aggregation across separate executions.
- Use defensive defaults for event arrays: if result.events is missing, treat it as [] instead of throwing.
- Avoid debug loops or large verbose dumps of raw events.
- Do not call any MCP help/introspection tools for this metric. Use only `calendar.listEvents` with the exact parameter names above.

## Classification Pipeline

### Step 1: Hard Exclusions (discard immediately)
- Cancelled events (`isCancelled === true`)
- All-day events (`isAllDay === true`)
- Personal blocks: subject matches PTO, Busy, Out of Office, Blocked, Focus Time, Lunch
- Daily standups / recurring internal rhythms: Tactical Session, Standup, Daily Sync

### Step 2: External-Facing Test (MANDATORY)
An event is **external-facing** ONLY if it has at least one attendee whose email domain is NOT in this internal list:
  `kiingo.com`, `fireflies.ai`, `promax.com`

If every attendee''s email domain is in that internal list, the event is INTERNAL — discard it.

Note: `fireflies.ai` is a meeting recorder bot. `promax.com` is an internal team member''s secondary domain. Neither counts as an external participant.

### Step 3: Exclude Internal Meetings (even if external attendees present)
Discard events matching these patterns (case-insensitive):
- 1:1 between Kiingo team members, Check-in (internal), Sync, Standup, Retrospective, Planning
- Pipeline Sync, Pipeline Review, Sales Pipeline
- Social Hour, Show-and-Tell, L10, Handoff
- "Internal Training", "HubSpot Training"
- "Sales/Marketing Weekly", "Sales Handoff", "Sales Handoff Flow"
- "How Do We Sell" (internal strategy)
- "Elevating the Conversation" (internal training)
- Webinars or conferences with 20+ attendees

### Step 4: Exclude First-Time Discovery Calls
Discard events that are clearly FIRST-TIME discovery/intro calls. These belong to the discovery metric, not follow-ups:
- Subject contains "Consultative Call" AND this is the first meeting with that company domain in the data window
- Subject contains: discovery, intro call, introduction, initial meeting, demo request, exploratory, first call

Keep events that are "Consultative Call" if the company has been seen before (repeat consultative call = follow-up).

### Step 5: Classify as Follow-Up
All remaining external-facing events after Steps 1-4 are follow-up calls. These include:
- Next Steps Workshops ("Kiingo AI - Next Steps Workshop - ...")
- Repeat meetings with the same company ("Kiingo AI and [Company] Consultative Call" where company was seen before)
- Onboarding, implementation, training (client-facing)
- Account reviews, QBRs, quarterly reviews
- Status calls, progress calls, check-ins with clients
- Any "Kiingo AI and [Company]" or "Kiingo AI" meeting with external attendees that isn''t a first discovery

### Step 6: Deduplication
Deduplicate by normalized key: `date + lowercase(subject)`. If the same meeting appears twice on the same day, count it once.

## Date Range
Fetch trailing 12 weeks from today.

## Output Computation
- **weeklyData**: `{ weekOf, count }` — follow-up calls per ISO week (Mon-Sun)
- **dailyData**: `{ date, count }` — follow-up calls per day
- **total**: total follow-up calls in the 12-week window
- **avgPerWeek**: average follow-up calls per full week
- **currentWeek**, **priorWeek**: follow-up counts for current and prior week
- **trend**: increasing, decreasing, or flat based on last 4 weeks
- **followUpDetails**: array of { date, subject, companyDomain } for all counted follow-up calls (full list, for audit)
- **excludedInternal**: array of { date, subject, reason } for excluded internal meetings (max 20, for audit)

## Narrative Context
- Michael is the Account Manager responsible for nurturing relationships after the initial discovery phase.
- Follow-up calls indicate active account engagement and pipeline progression.
- These are all external-facing meetings that are NOT first-time discovery calls.
- Track trend direction rather than absolute targets — healthy pace depends on active account load.

## Values to Return
- currentWeek: follow-up call count for current week
- priorWeek: follow-up call count for prior full week
- weeklyData: array of { weekOf, count } for trailing 12 weeks
- dailyData: array of { date, count } for trailing 12 weeks
- total: total follow-up calls in the period
- avgPerWeek: average calls per full week
- trend: increasing, decreasing, or flat
- followUpDetails: full list of counted follow-up calls with company domain
- excludedInternal: sample of excluded internal meetings
', '(() => {
  const weeklyData = WEEKLY_DATA_PLACEHOLDER;
  const currentWeek = CURRENT_WEEK_PLACEHOLDER;
  const priorWeek = PRIOR_WEEK_PLACEHOLDER;
  const total = TOTAL_PLACEHOLDER;
  const avgPerWeek = AVG_PER_WEEK_PLACEHOLDER;
  const trend = TREND_PLACEHOLDER;

  const trendColor = trend === ''increasing'' ? ''#16a34a'' : trend === ''decreasing'' ? ''#ef4444'' : theme.inkMuted;
  const trendLabel = trend === ''increasing'' ? ''\u25B2 Increasing'' : trend === ''decreasing'' ? ''\u25BC Decreasing'' : ''\u25C6 Flat'';

  const chartData = weeklyData.map(d => ({
    week: d.weekOf.substring(5),
    count: d.count,
  }));

  return (
    <MetricSection>
      <MetricRow>
        <StatCard label="This Week" value={currentWeek} subtitle="Client follow-ups" />
        <StatCard label="Prior Week" value={priorWeek} subtitle="Client follow-ups" />
        <StatCard label="12-Week Total" value={total} subtitle={''Avg '' + avgPerWeek + ''/week''} />
        <StatCard label="Trend" value={trendLabel} />
      </MetricRow>

      <div style={{ height: 280, background: theme.panel, borderRadius: 16, padding: 20, border: ''1px solid '' + theme.line }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Weekly Follow-Up Calls (External Only)</div>
        <ResponsiveContainer width="100%" height="90%">
          <BarChart data={chartData} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="week" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <Bar dataKey="count" name="Follow-Up Calls" fill={theme.secondary} radius={[4, 4, 0, 0]} />
          </BarChart>
        </ResponsiveContainer>
      </div>

      <MetricNote>Source: Michael''s calendar · External-facing follow-ups only (excludes internal meetings and first-time discovery calls)</MetricNote>
    </MetricSection>
  );
})()', 259200, 'claude', NULL, NULL, 1, 0, '{"aliases":["follow up","followup calls","weekly followup"]}', '2026-02-16T23:07:03Z', '2026-02-18T07:15:09+00:00');
INSERT OR REPLACE INTO metric_definitions (id, name, slug, instructions, template_html, ttl_seconds, provider, model, profile_id, enabled, proactive, metadata_json, created_at, updated_at) VALUES ('3431baff-245e-4b47-84e1-2fef42405310', 'Win Rate Trend', 'win-rate-trend', 'Track monthly win rate (deals closed won / total deals closed) from HubSpot.

## Data Source
HubSpot Deals via `hubspot.listDeals()`.

## Retrieval Steps
1. Paginate all deals with close dates in the last 12 months.
2. For each month, count deals where hs_is_closed_won === ''true'' and total closed deals.
3. Compute win rate: won / total_closed * 100.
4. Also compute cumulative LTM win rate.

## Values to Return
- `monthlyRates`: array of { month, rate }
- `ltmWinRate`: cumulative last 12 months win rate
- `trend`: "up", "down", or "flat" based on 3-month moving average', '(() => {
  const data = DATA_PLACEHOLDER;
  const ltm = LTM_PLACEHOLDER;
  return (
    <MetricSection>
      <StatCard label="LTM Win Rate" value={ltm.toFixed(1) + ''%''} subtitle="Cumulative" />
      <div style={{ height: 200, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
        <ResponsiveContainer width="100%" height="100%">
          <LineChart data={data} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="month" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} tickFormatter={v => v + ''%''} domain={[0, 50]} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} formatter={v => Number(v).toFixed(1) + ''%''} />
            <Line type="monotone" dataKey="rate" name="Win Rate" stroke={theme.accent} strokeWidth={2.5} dot={{ fill: theme.accent, r: 3 }} />
          </LineChart>
        </ResponsiveContainer>
      </div>
    </MetricSection>
  );
})()', 259200, 'claude', NULL, NULL, 1, 0, '{"aliases":["win rate","close rate","conversion rate"]}', '2026-02-15T06:29:29+00:00', '2026-02-15T06:29:29+00:00');

-- ============================================
-- Screen-Metric Bindings
-- ============================================

INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('2661f8c9-99e3-4c24-a60d-831ce06e3e72', 'client-health', '9e73074d-654f-40fc-a53c-5c571ba309e6', 0, 'full', 0, 0, 12, 10);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('79adb1f6-0f7b-4c23-9925-b90909b68fe4', 'client-journey', '340f1b31-52a3-452b-a1f7-d589e6b2580a', 0, 'full', 0, 0, 12, 14);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('38745f5b-3bae-42cc-a665-af854da30618', 'client-journey', '1da47a88-6e11-4a03-b23b-bfe245b1718b', 99, 'wide', 0, 20, 8, 8);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('1a9d3549-37e6-42de-afc3-39d98c24bfbc', 'client-roi', '73c56645-dedf-4bfb-af3b-a80bb8ef8ca0', 0, 'full', 0, 0, 12, 14);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('32aeb4c2-ade6-4262-8da8-e0d38b30fd54', 'client-roi', '9d9e7fe9-b25c-4628-ac65-5a4fea982f67', 99, 'wide', 0, 20, 8, 8);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('30718172-9dcd-4193-aab6-2380ffd9eeaf', 'dashboard', 'eac7d43a-5003-48aa-9165-fc869d8597f2', 0, 'full', 0, 0, 10, 9);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('0ff07d54-423d-49e2-885c-73ae43e171c7', 'dashboard', '7c765544-15a4-4c66-a458-1f5db331f2f8', 2, 'card', 8, 28, 4, 14);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('9e67d4d1-2bbf-4dc2-a3eb-0833cb4fc57a', 'dashboard', 'c32c7b8c-a0fe-45e9-a89e-646f613c68ee', 2, 'full', 6, 42, 6, 9);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('5dbc737a-003e-46d9-8676-4520d825df35', 'dashboard', 'c8f0a7ec-5cc2-4990-b7e1-9cf0f247992c', 3, 'wide', 6, 9, 6, 10);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('2294cc79-c923-478d-b290-473673729761', 'dashboard', '55d47cfc-5648-4fa7-be79-7ff67d7115d3', 4, 'card', 8, 19, 4, 9);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('64b8fb9a-a045-49c2-a3ef-ed35b768b278', 'dept-engineering', '67f3b504-f1c1-4239-8640-dae49706e583', 0, 'full', 0, 0, 12, 9);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('b5bfa1ae-e6a5-44d3-acb6-67170b3bcba2', 'dept-marketing', 'c43880d5-676d-451a-b903-925b8e388f0b', 0, 'full', 0, 0, 12, 12);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('62f7a600-f4f1-4ca7-a968-ec31215c9098', 'dept-marketing', '88f549cc-6893-4c42-a595-948290e6510f', 1, 'wide', 0, 12, 8, 21);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('5ec67ae4-711f-4864-b482-932a1eb05f44', 'dept-operations', 'be990667-9109-4750-a752-208ac1f58e84', 0, 'wide', 0, 0, 8, 23);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('761e1cd0-4430-4572-a49d-050bbd4fdd40', 'dept-operations', 'fca4c412-05b2-44e4-b523-cc3947b52328', 0, 'wide', 0, 23, 8, 12);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('083c62be-276e-4345-88db-e89832ea43dd', 'dept-operations', '381bed73-c1db-4f66-bf31-30a470890988', 1, 'wide', 0, 35, 8, 12);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('8d0490fd-5b4f-494d-b69a-b927446d8677', 'dept-operations', '6ca5270a-b1c7-4646-bc2f-f0e0d78e61f0', 2, 'wide', 0, 99, 8, 16);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('c7d71afa-446e-4bea-9e54-54102e9e3755', 'dept-operations', 'd2825574-c249-44fe-a6e6-b89fb0b4419b', 3, 'wide', 0, 36, 8, 12);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('afb15909-5c7d-4ae8-8261-a76dca314936', 'dept-operations', '95795ece-97c3-4fef-987a-67f543b85c8d', 4, 'wide', 0, 63, 8, 15);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('4fea2690-56df-4c62-acec-22af00bfaf6f', 'dept-operations', 'e6bfcbb4-ac2e-480d-8b3d-431f6312551e', 5, 'wide', 0, 60, 8, 39);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('36026d08-c675-4074-bf78-1d629a1a6b55', 'dept-operations', 'e199206d-01bd-40af-838e-f82ff1541a40', 6, 'wide', 0, 76, 8, 14);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('c0b937ca-239e-4652-b7ba-c5ff3d86a258', 'dept-sales', 'b6dc4242-b365-4360-acd2-4f764853f0c9', 0, 'full', 0, 81, 10, 18);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('83442bbe-5818-499c-ac06-9af66f98b014', 'dept-sales', 'b6dc4242-b365-4360-acd2-4f764853f0c9', 0, 'wide', 0, 0, 8, 18);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('bd385318-7456-4a28-bd48-c9954f9f6365', 'dept-sales', '9d9e7fe9-b25c-4628-ac65-5a4fea982f67', 1, 'full', 0, 99, 10, 11);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('3481c5e6-7bae-498d-b5b7-5b1eae8b3b23', 'dept-sales', '6978d569-0b74-452b-b3e7-5de51c90d239', 2, 'full', 0, 110, 10, 11);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('7b9bb95b-1217-ae31-7f36-dc2863163c99', 'dept-sales', 'e559abdf-19d9-b054-ee6c-9bb3b88a39f7', 3, 'wide', 0, 18, 8, 15);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('f2ea539d-ae4d-4c89-42be-6854a05601e2', 'dept-sales', '65e79c58-154a-5e6d-6a25-ba4610bb1829', 4, 'wide', 0, 50, 8, 15);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('21999b7a-9383-4c4f-92b8-83ab27440b01', 'discovery-calls', '5e4a0131-1e16-4ca6-b715-cddf54af01e4', 0, 'wide', 0, 0, 8, 15);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('dc95c390-dc27-4250-970a-d6353b9ed2f6', 'discovery-calls', '5da7296a-4782-45a8-8309-b0b4f9827ce9', 1, 'wide', 0, 15, 8, 15);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('254c02e7-d95a-4d4b-b25f-2814346cc2f5', 'discovery-calls', 'e559abdf-19d9-b054-ee6c-9bb3b88a39f7', 2, 'wide', 0, 30, 8, 15);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('cfdc4da9-bb1d-4b2d-9ee5-715179cc5215', 'efficiency', '329d0e12-f4f9-47a5-81b1-e0ee3207fe1d', 0, 'full', 0, 0, 10, 11);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('3ebf946a-540e-40f2-a304-0f7a89cca49a', 'efficiency', 'f90cc540-c123-44eb-a2e3-20df6049db9b', 1, 'full', 0, 11, 10, 10);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('e1e01a06-51c4-4c0c-b051-325f9af0072a', 'efficiency', 'aabb87b0-1bca-4179-9c6f-20272d1de5dc', 2, 'full', 0, 21, 10, 11);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('38a97661-9548-4aec-b6f1-f7e0d49d9049', 'efficiency', '53ac482e-61fd-4faf-9cd2-829ea591372d', 3, 'full', 0, 32, 10, 10);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('599cedd2-878f-4cac-af48-9fe4543e3e4a', 'follow-up-calls', '65e79c58-154a-5e6d-6a25-ba4610bb1829', 0, 'wide', 0, 0, 8, 15);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('b17ba97a-d2cf-46d7-86a4-e1a16d55109c', 'follow-up-calls', '32c77dad-2b50-44f9-b9e0-5b4d668d2bca', 1, 'wide', 0, 15, 8, 11);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('82ba19fc-efc9-485f-9fa8-f9007d4a86f5', 'growth', '7fca257d-0bd2-4d86-af90-a1a8df626d5c', 0, 'full', 0, 0, 5, 11);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('fd9e53e7-609c-40fe-a694-225002ba4c74', 'growth', '50e1135e-e4f0-4860-91a0-44a257c8e930', 1, 'full', 5, 0, 6, 12);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('c8baf1e9-a6ca-4854-bf4e-0cc29cf65d5a', 'growth', '3431baff-245e-4b47-84e1-2fef42405310', 2, 'full', 0, 12, 10, 10);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('5674c401-16af-42ad-a243-f454b161364f', 'growth', '35231c42-b088-4da4-b2f2-f25ebce87e36', 3, 'full', 0, 33, 10, 11);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('8f8be691-dd64-49bd-a085-332da16c99b8', 'growth', '93ba384c-b172-4072-9e74-c4705f38c349', 4, 'full', 0, 22, 10, 11);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('8ae654ba-0c71-4727-af46-733884d533d2', 'leads-gtm', '77eea407-0b3b-4c26-b833-b6544381e98b', 0, 'full', 0, 0, 12, 10);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('8fed9e3c-45f2-4426-b92d-52c3148297bf', 'leads-gtm', '7c765544-15a4-4c66-a458-1f5db331f2f8', 1, 'card', 0, 9, 4, 14);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('e44ebffc-ca59-4df8-8fa1-205db1af7e8c', 'ops-followup', '8123728e-8c27-4272-9123-ca9b8cda9ddb', 0, 'wide', 0, 0, 8, 17);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('f49335ea-740e-4a3b-b192-b631fac88184', 'ops-followup', '07d10edf-0dae-4566-8cb3-6c3d0d80895d', 1, 'wide', 0, 14, 8, 16);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('468e7617-e95a-4e2c-9f99-211a4435a37e', 'path1-accelerator', '19872d77-f92e-4f7b-8079-b4413a2447d9', 0, 'wide', 0, 0, 8, 10);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('8e32a810-edee-4137-b42e-311615c70d33', 'path1-bootcamps', 'fca4c412-05b2-44e4-b523-cc3947b52328', 0, 'full', 0, 0, 12, 6);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('718ef4ad-30cb-4aaf-a097-099b50ad8374', 'path1-champions', '8b8e898e-ae8d-474f-b9d5-28f0d86498e6', 0, 'full', 0, 0, 12, 16);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('65c97bb5-ae59-47fe-8099-c2b608e035f1', 'path2-deployed', '97c3c5ac-a74f-4731-9636-da43619c834c', 0, 'full', 0, 0, 12, 16);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('5667d406-323b-48b7-88db-06217d9c920f', 'path2-fde', '29e19564-5b6a-4459-b29a-17efe40f008a', 0, 'full', 0, 0, 12, 14);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('a2dd5711-bb00-4591-8835-16d94a5ce015', 'path2-pipeline', '2f101d3a-eae6-4007-b7d5-ab3547f07be1', 0, 'full', 0, 0, 12, 16);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('8c33f5fa-2298-4e19-876e-bc568f643ce3', 'pipeline', '1da47a88-6e11-4a03-b23b-bfe245b1718b', 0, 'full', 0, 0, 10, 10);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('d783d638-f4fd-417b-9782-5587fb1f009e', 'pipeline', 'ebc99ea9-2609-4b9c-bcf0-71d191cae36a', 1, 'card', 4, 10, 4, 6);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('15950cea-3433-4105-8601-8fb60cf1bad6', 'pipeline', '6978d569-0b74-452b-b3e7-5de51c90d239', 2, 'wide', 0, 16, 8, 11);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('a6a6de5c-aa50-432f-a522-1c71742f0737', 'pipeline', '5da7296a-4782-45a8-8309-b0b4f9827ce9', 3, 'wide', 0, 27, 8, 11);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('fe6236d3-2e1e-4bf4-b0c7-3a5f252f3a0a', 'pipeline', '5e4a0131-1e16-4ca6-b715-cddf54af01e4', 4, 'wide', 0, 38, 8, 4);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('8e2e27b9-1ad9-4f35-b076-f9f8f96fefdd', 'revenue', '35231c42-b088-4da4-b2f2-f25ebce87e36', 0, 'full', 0, 41, 10, 11);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('e586793e-35ae-49d7-a682-6a76604f493f', 'revenue', 'd377f67d-eef4-4820-8041-d230232856e0', 0, 'full', 0, 18, 10, 23);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('01731142-5585-4488-9fd2-3417d28e453c', 'revenue', '44aed376-61f4-4b67-820c-7697f1a5179d', 0, 'full', 0, 0, 10, 18);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('43328154-c4e9-4f95-b706-69ed92b4c9a6', 'revenue', '6353801b-e51e-491d-ab5e-a780ed36b62a', 1, 'full', 0, 52, 10, 11);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('b7130bf3-6da3-4abb-b4ef-6a4c29846dab', 'revenue', '6978d569-0b74-452b-b3e7-5de51c90d239', 2, 'wide', 5, 78, 5, 12);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('a555aebe-502d-4236-81d9-fcf766ba5193', 'revenue', '93ba384c-b172-4072-9e74-c4705f38c349', 3, 'wide', 5, 63, 5, 15);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('d96b2f8c-b9a6-415c-9569-80f1d12292bf', 'revenue', '53ac482e-61fd-4faf-9cd2-829ea591372d', 4, 'full', 0, 90, 10, 10);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('9a6627f8-67c2-4317-9b7a-720b95418354', 'sales-followup', '3b4f2305-5220-4824-8f77-e78afe3906ad', 0, 'wide', 0, 0, 8, 17);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('aff8ed28-01a0-4f49-ba6c-30af786bfe46', 'sales-followup', '341d182e-10e8-41a1-97cd-58696adb5add', 1, 'wide', 0, 34, 8, 16);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('204f752d-2c06-4c95-bbf8-424d997672de', 'sales-followup', '62983536-af15-44e8-8425-48f84dbff512', 2, 'wide', 0, 17, 8, 17);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('1c2743e8-d955-40f4-82f7-74b279621e90', 'team-rocks', '3ec99942-c4b5-4702-bce5-9e712cc978a8', 0, 'full', 0, 0, 12, 13);
INSERT OR REPLACE INTO screen_metrics (id, screen_id, metric_id, position, layout_hint, grid_x, grid_y, grid_w, grid_h) VALUES ('626687ab-c2a1-41e2-8923-66cd1551305d', 'team-scorecard', 'd6fe7a31-00ad-41e4-9379-b4ec83a346b7', 0, 'full', 0, 0, 12, 11);

-- ============================================
-- Latest Snapshot per Metric (completed only)
-- ============================================

INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('1fce5861-f068-4d20-aa04-56fa0f616140', '07d10edf-0dae-4566-8cb3-6c3d0d80895d', '{"dailyData": [{"date": "2/18", "totalDeals": 58, "likelyCold": 2, "overdue": 37, "avgDays": 39.6, "healthy": 11, "atRisk": 33}], "latestDate": "2/18/2026", "coldTrend": "stable", "overdueTrend": "stable", "daysReported": 1}', '(() => {
  const dailyData = [{"date": "2/18", "totalDeals": 58, "likelyCold": 2, "overdue": 37, "avgDays": 39.6, "healthy": 11, "atRisk": 33}];
  const latestDate = "2/18/2026";
  const coldTrend = "stable";
  const overdueTrend = "stable";
  const daysReported = 1;

  const latest = dailyData[dailyData.length - 1] || {};

  const trendIcon = (t) => t === ''improving'' ? '' ↓'' : t === ''worsening'' ? '' ↑'' : '' →'';

  return (
    <MetricSection>
      <MetricRow>
        <StatCard label={''Likely Cold''} value={latest.likelyCold} subtitle={coldTrend + trendIcon(coldTrend)} />
        <StatCard label={''Overdue >14d''} value={latest.overdue} subtitle={overdueTrend + trendIcon(overdueTrend)} />
        <StatCard label={''Avg Contact Days''} value={latest.avgDays?.toFixed(1)} subtitle={daysReported + ''-day trend''} />
        <StatCard label={''At Risk Deals''} value={latest.atRisk} subtitle={''30+ days stale''} />
      </MetricRow>

      <div style={{ height: 280, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Likely Cold & Overdue Deals Over Time</div>
        <ResponsiveContainer width="100%" height="90%">
          <LineChart data={dailyData} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="date" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <Legend />
            <Line type="monotone" dataKey="likelyCold" name="Likely Cold" stroke={theme.danger} strokeWidth={2} dot={{ fill: theme.danger, r: 3 }} />
            <Line type="monotone" dataKey="overdue" name="Overdue >14d" stroke="#eab308" strokeWidth={2} dot={{ fill: ''#eab308'', r: 3 }} />
          </LineChart>
        </ResponsiveContainer>
      </div>

      <div style={{ display: ''grid'', gridTemplateColumns: ''1fr 1fr'', gap: 16, marginTop: 16 }}>
        <div style={{ height: 260, background: theme.panel, borderRadius: 16, padding: 16, border: ''1px solid '' + theme.line }}>
          <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Avg Days Since Contact</div>
          <ResponsiveContainer width="100%" height="85%">
            <AreaChart data={dailyData} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
              <defs>
                <linearGradient id="opsAvgDaysGrad" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0%" stopColor={theme.accent} stopOpacity={0.15} />
                  <stop offset="100%" stopColor={theme.accent} stopOpacity={0.02} />
                </linearGradient>
              </defs>
              <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
              <XAxis dataKey="date" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} />
              <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} />
              <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 12 }} formatter={(v) => [v.toFixed(1) + '' days'', ''Avg Contact'']} />
              <Area type="monotone" dataKey="avgDays" stroke={theme.accent} strokeWidth={2} fill="url(#opsAvgDaysGrad)" />
            </AreaChart>
          </ResponsiveContainer>
        </div>

        <div style={{ height: 260, background: theme.panel, borderRadius: 16, padding: 16, border: ''1px solid '' + theme.line }}>
          <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Healthy vs At Risk</div>
          <ResponsiveContainer width="100%" height="85%">
            <BarChart data={dailyData} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
              <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
              <XAxis dataKey="date" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} />
              <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} />
              <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 12 }} />
              <Legend />
              <Bar dataKey="healthy" name="Healthy (0-7d)" fill="#16a34a" radius={[4, 4, 0, 0]} />
              <Bar dataKey="atRisk" name="At Risk (30d+)" fill={theme.danger} radius={[4, 4, 0, 0]} />
            </BarChart>
          </ResponsiveContainer>
        </div>
      </div>

      <MetricNote>Source: CRM SharePoint · {daysReported} daily OPS reports · Latest: {latestDate}</MetricNote>
    </MetricSection>
  );
})()', 'completed', '2026-02-18T23:55:55+00:00', '2026-02-18T23:55:55+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('783b7228-8356-4d1f-8e2d-abb482302c7b', '1da47a88-6e11-4a03-b23b-bfe245b1718b', '{"byStage": [{"stage": "Discovery Call", "count": 85, "value": 425000}, {"stage": "Proposal Sent", "count": 62, "value": 520000}, {"stage": "Negotiation", "count": 38, "value": 380000}, {"stage": "On Hold", "count": 95, "value": 285000}, {"stage": "Cold", "count": 100, "value": 290000}], "totalDeals": 380, "totalValue": 1900000}', '(() => {
  const data = [{"stage": "Discovery Call", "count": 85, "value": 425000}, {"stage": "Proposal Sent", "count": 62, "value": 520000}, {"stage": "Negotiation", "count": 38, "value": 380000}, {"stage": "On Hold", "count": 95, "value": 285000}, {"stage": "Cold", "count": 100, "value": 290000}];
  const totalDeals = 380;
  const totalValue = 1900000;
  return (
    <MetricSection>
      <MetricRow>
        <StatCard label="Open Deals" value={totalDeals} subtitle="Across all stages" />
        <StatCard label="Pipeline Value" value={''$'' + (totalValue / 1000).toFixed(0) + ''K''} subtitle="Total open" />
      </MetricRow>
      <div style={{ height: 300, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
        <ResponsiveContainer width="100%" height="100%">
          <BarChart data={data} layout="vertical" margin={{ top: 5, right: 20, left: 100, bottom: 5 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis type="number" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} tickFormatter={v => ''$'' + (v/1000) + ''K''} />
            <YAxis type="category" dataKey="stage" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} width={95} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} formatter={(v, name) => name === ''Value'' ? ''$'' + Number(v).toLocaleString() : v} />
            <Bar dataKey="value" name="Value" fill={theme.accent} radius={[0,4,4,0]} />
          </BarChart>
        </ResponsiveContainer>
      </div>
    </MetricSection>
  );
})()', 'completed', '2026-02-15T06:29:29+00:00', '2026-02-15T06:29:29+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('0bb6727a-fdf5-4d9b-acea-215aec4265f1', '329d0e12-f4f9-47a5-81b1-e0ee3207fe1d', '{"ltmGrossMargin":75.83,"ltmNetMargin":34.91,"monthlyData":[{"grossMargin":60.15,"month":"Feb ''25","netMargin":29.27},{"grossMargin":81.8,"month":"Mar ''25","netMargin":67.18},{"grossMargin":67.45,"month":"Apr ''25","netMargin":32.3},{"grossMargin":74.32,"month":"May ''25","netMargin":47.06},{"grossMargin":79.41,"month":"Jun ''25","netMargin":43.83},{"grossMargin":71.9,"month":"Jul ''25","netMargin":18.93},{"grossMargin":78.27,"month":"Aug ''25","netMargin":21.92},{"grossMargin":89.09,"month":"Sep ''25","netMargin":61.07},{"grossMargin":84.04,"month":"Oct ''25","netMargin":50.53},{"grossMargin":82.96,"month":"Nov ''25","netMargin":48.37},{"grossMargin":72.91,"month":"Dec ''25","netMargin":-8.06},{"grossMargin":67.64,"month":"Jan ''26","netMargin":6.53}]}', '(() => {
 const data = [{"month":"Feb ''25","grossMargin":60.15,"netMargin":29.27},{"month":"Mar ''25","grossMargin":81.80,"netMargin":67.18},{"month":"Apr ''25","grossMargin":67.45,"netMargin":32.30},{"month":"May ''25","grossMargin":74.32,"netMargin":47.06},{"month":"Jun ''25","grossMargin":79.41,"netMargin":43.83},{"month":"Jul ''25","grossMargin":71.90,"netMargin":18.93},{"month":"Aug ''25","grossMargin":78.27,"netMargin":21.92},{"month":"Sep ''25","grossMargin":89.09,"netMargin":61.07},{"month":"Oct ''25","grossMargin":84.04,"netMargin":50.53},{"month":"Nov ''25","grossMargin":82.96,"netMargin":48.37},{"month":"Dec ''25","grossMargin":72.91,"netMargin":-8.06},{"month":"Jan ''26","grossMargin":67.64,"netMargin":6.53}];
 const ltmGross = 75.83;
 const ltmNet = 34.91;
 return (
 <MetricSection>
 <MetricRow>
 <StatCard label="LTM Gross Margin" value={ltmGross.toFixed(1) + ''%''} subtitle="Revenue after COGS" trend="75.8%" trendDirection="up" />
 <StatCard label="LTM Net Margin" value={ltmNet.toFixed(1) + ''%''} subtitle="Bottom line" trend="34.9%" trendDirection="up" />
 </MetricRow>
 <div style={{ height: 280, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
 <ResponsiveContainer width="100%" height="100%">
 <LineChart data={data} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
 <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
 <XAxis dataKey="month" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
 <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} tickFormatter={v => v + ''%''} domain={[-20, 100]} />
 <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} formatter={v => Number(v).toFixed(1) + ''%''} />
 <Legend wrapperStyle={{ fontSize: 12, color: theme.inkMuted }} />
 <Line type="monotone" dataKey="grossMargin" name="Gross Margin" stroke={theme.accent} strokeWidth={2.5} dot={{ fill: theme.accent, r: 3 }} />
 <Line type="monotone" dataKey="netMargin" name="Net Margin" stroke={theme.accentStrong} strokeWidth={2.5} dot={{ fill: theme.accentStrong, r: 3 }} />
 <ReferenceLine y={0} stroke={theme.danger} strokeWidth={1} strokeDasharray="4 4" />
 </LineChart>
 </ResponsiveContainer>
 </div>
 <MetricNote>Source: QuickBooks P&L (Accrual) via Kiingo MCP · Feb 2025 – Jan 2026 (12 complete months)</MetricNote>
 </MetricSection>
 );
})()', 'completed', '2026-02-18T23:00:47.529785+00:00', '2026-02-18T23:02:03.190427+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('7cb3567e-cd13-4d6d-9c7a-abc4ffe86a52', '32c77dad-2b50-44f9-b9e0-5b4d668d2bca', '{"avgTrailing":8.2,"byMonth":{"2025-11":0,"2025-12":0,"2026-01":8,"2026-02":34},"peak":42,"peakWeek":"2026-02-16","total":42,"trailing30":42,"trough":0,"troughWeek":"2025-11-24","weeklyData":[{"trailing30":0,"weekOf":"2025-11-24"},{"trailing30":0,"weekOf":"2025-12-01"},{"trailing30":0,"weekOf":"2025-12-08"},{"trailing30":0,"weekOf":"2025-12-15"},{"trailing30":0,"weekOf":"2025-12-22"},{"trailing30":0,"weekOf":"2025-12-29"},{"trailing30":0,"weekOf":"2026-01-05"},{"trailing30":0,"weekOf":"2026-01-12"},{"trailing30":1,"weekOf":"2026-01-19"},{"trailing30":8,"weekOf":"2026-01-26"},{"trailing30":20,"weekOf":"2026-02-02"},{"trailing30":35,"weekOf":"2026-02-09"},{"trailing30":42,"weekOf":"2026-02-16"}]}', '(() => {
 const data = [
 { week: ''Nov 24'', value: 0 },
 { week: ''Dec 1'', value: 0 },
 { week: ''Dec 8'', value: 0 },
 { week: ''Dec 15'', value: 0 },
 { week: ''Dec 22'', value: 0 },
 { week: ''Dec 29'', value: 0 },
 { week: ''Jan 5'', value: 0 },
 { week: ''Jan 12'', value: 0 },
 { week: ''Jan 19'', value: 1 },
 { week: ''Jan 26'', value: 8 },
 { week: ''Feb 2'', value: 20 },
 { week: ''Feb 9'', value: 35 },
 { week: ''Feb 16'', value: 42 }
 ];
 const current = 42;
 const peak = 42;
 const trough = 0;
 const avgValue = 8.2;

 return (
 <MetricSection>
 <MetricRow>
 <StatCard label="Current" value={current} subtitle="Trailing 30d" trend="+7 vs prior week" trendDirection="up" />
 <StatCard label="Peak" value={peak} subtitle="Week of Feb 16" />
 <StatCard label="Trough" value={trough} subtitle="Lowest week" />
 <StatCard label="Avg" value={avgValue} subtitle="Avg trailing 30d" />
 </MetricRow>
 <div style={{ height: 320, background: theme.panel, borderRadius: 16, padding: 20, border: `1px solid ${theme.line}` }}>
 <ResponsiveContainer width="100%" height="100%">
 <AreaChart data={data} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
 <defs>
 <linearGradient id="followupGradient" x1="0" y1="0" x2="0" y2="1">
 <stop offset="0%" stopColor={theme.accent} stopOpacity={0.35} />
 <stop offset="100%" stopColor={theme.accent} stopOpacity={0.02} />
 </linearGradient>
 </defs>
 <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
 <XAxis dataKey="week" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} interval={2} />
 <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} domain={[0, ''auto'']} />
 <Tooltip contentStyle={{ background: theme.tooltipBg, border: `1px solid ${theme.tooltipBorder}`, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} formatter={(v) => [v, ''Trailing 30d calls'']} />
 <ReferenceLine y={avgValue} stroke={theme.line} strokeDasharray="6 4" label={{ value: `Avg ${avgValue}`, fill: theme.inkMuted, fontSize: 11, position: ''insideTopRight'' }} />
 <Area type="monotone" dataKey="value" stroke={theme.accent} strokeWidth={2.5} fill="url(#followupGradient)" dot={{ fill: theme.accent, r: 3, strokeWidth: 0 }} activeDot={{ fill: theme.accentStrong, r: 5, strokeWidth: 2, stroke: theme.line }} />
 </AreaChart>
 </ResponsiveContainer>
 </div>
 <MetricNote>Each point = trailing 30-day follow-up calls ending that week · Source: Weekly Follow-Up Calls (calendar-derived) · Jan 2026: 8 calls · Feb 2026: 34 calls</MetricNote>
 </MetricSection>
 );
})()', 'completed', '2026-02-17T19:15:41.303685+00:00', '2026-02-17T19:17:05.195018+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('71795dea-7a50-4526-91e5-06cae86d71f1', '341d182e-10e8-41a1-97cd-58696adb5add', '{"dailyData": [{"date": "2/18", "totalDeals": 189, "likelyCold": 43, "overdue": 21, "avgDays": 9.4, "healthy": 126, "atRisk": 49}], "latestDate": "2/18/2026", "coldTrend": "stable", "overdueTrend": "stable", "daysReported": 1}', '(() => {
  const dailyData = [{"date": "2/18", "totalDeals": 189, "likelyCold": 43, "overdue": 21, "avgDays": 9.4, "healthy": 126, "atRisk": 49}];
  const latestDate = "2/18/2026";
  const coldTrend = "stable";
  const overdueTrend = "stable";
  const daysReported = 1;

  const latest = dailyData[dailyData.length - 1] || {};
  const first = dailyData[0] || {};
  const coldDelta = latest.likelyCold - first.likelyCold;
  const overdueDelta = latest.overdue - first.overdue;

  const trendIcon = (t) => t === ''improving'' ? '' ↓'' : t === ''worsening'' ? '' ↑'' : '' →'';
  const trendColor = (t) => t === ''improving'' ? ''#16a34a'' : t === ''worsening'' ? theme.danger : theme.inkMuted;

  return (
    <MetricSection>
      <MetricRow>
        <StatCard label={''Likely Cold''} value={latest.likelyCold} subtitle={coldTrend + trendIcon(coldTrend)} />
        <StatCard label={''Overdue >14d''} value={latest.overdue} subtitle={overdueTrend + trendIcon(overdueTrend)} />
        <StatCard label={''Avg Contact Days''} value={latest.avgDays?.toFixed(1)} subtitle={daysReported + ''-day trend''} />
        <StatCard label={''At Risk Deals''} value={latest.atRisk} subtitle={''30+ days stale''} />
      </MetricRow>

      <div style={{ height: 280, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Likely Cold & Overdue Deals Over Time</div>
        <ResponsiveContainer width="100%" height="90%">
          <LineChart data={dailyData} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="date" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <Legend />
            <Line type="monotone" dataKey="likelyCold" name="Likely Cold" stroke={theme.danger} strokeWidth={2} dot={{ fill: theme.danger, r: 3 }} />
            <Line type="monotone" dataKey="overdue" name="Overdue >14d" stroke="#eab308" strokeWidth={2} dot={{ fill: ''#eab308'', r: 3 }} />
          </LineChart>
        </ResponsiveContainer>
      </div>

      <div style={{ display: ''grid'', gridTemplateColumns: ''1fr 1fr'', gap: 16, marginTop: 16 }}>
        <div style={{ height: 260, background: theme.panel, borderRadius: 16, padding: 16, border: ''1px solid '' + theme.line }}>
          <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Avg Days Since Contact</div>
          <ResponsiveContainer width="100%" height="85%">
            <AreaChart data={dailyData} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
              <defs>
                <linearGradient id="avgDaysGrad" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0%" stopColor={theme.accent} stopOpacity={0.15} />
                  <stop offset="100%" stopColor={theme.accent} stopOpacity={0.02} />
                </linearGradient>
              </defs>
              <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
              <XAxis dataKey="date" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} />
              <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} />
              <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 12 }} formatter={(v) => [v.toFixed(1) + '' days'', ''Avg Contact'']} />
              <Area type="monotone" dataKey="avgDays" stroke={theme.accent} strokeWidth={2} fill="url(#avgDaysGrad)" />
            </AreaChart>
          </ResponsiveContainer>
        </div>

        <div style={{ height: 260, background: theme.panel, borderRadius: 16, padding: 16, border: ''1px solid '' + theme.line }}>
          <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Healthy vs At Risk</div>
          <ResponsiveContainer width="100%" height="85%">
            <BarChart data={dailyData} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
              <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
              <XAxis dataKey="date" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} />
              <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} />
              <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 12 }} />
              <Legend />
              <Bar dataKey="healthy" name="Healthy (0-7d)" fill="#16a34a" radius={[4, 4, 0, 0]} />
              <Bar dataKey="atRisk" name="At Risk (30d+)" fill={theme.danger} radius={[4, 4, 0, 0]} />
            </BarChart>
          </ResponsiveContainer>
        </div>
      </div>

      <MetricNote>Source: CRM SharePoint · {daysReported} daily SALES reports · Latest: {latestDate}</MetricNote>
    </MetricSection>
  );
})()', 'completed', '2026-02-18T23:43:35+00:00', '2026-02-18T23:43:35+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('79ea186f-ecd3-4afc-8f2d-d6bccc59fc74', '3431baff-245e-4b47-84e1-2fef42405310', '{"adjWinRate":66.5,"last3moAvg":65.1,"ltmTotal":989,"ltmWinRate":41.9,"ltmWon":414,"monthlyRates":[{"month":"Mar ''25","rate":null,"total":0,"won":0},{"month":"Apr ''25","rate":null,"total":0,"won":0},{"month":"May ''25","rate":null,"total":0,"won":0},{"month":"Jun ''25","rate":66.7,"total":9,"won":6},{"month":"Jul ''25","rate":55.6,"total":18,"won":10},{"month":"Aug ''25","rate":66.7,"total":51,"won":34},{"month":"Sep ''25","rate":9.2,"total":425,"won":39},{"month":"Oct ''25","rate":65.4,"total":179,"won":117},{"month":"Nov ''25","rate":76.8,"total":82,"won":63},{"month":"Dec ''25","rate":64.9,"total":94,"won":61},{"month":"Jan ''26","rate":61.6,"total":86,"won":53},{"month":"Feb ''26","rate":68.9,"total":45,"won":31}],"prior3moAvg":50.5,"trend":"up"}', '(() => {
 const data = [{"month":"Mar ''25","rate":null,"won":0,"total":0},{"month":"Apr ''25","rate":null,"won":0,"total":0},{"month":"May ''25","rate":null,"won":0,"total":0},{"month":"Jun ''25","rate":66.7,"won":6,"total":9},{"month":"Jul ''25","rate":55.6,"won":10,"total":18},{"month":"Aug ''25","rate":66.7,"won":34,"total":51},{"month":"Sep ''25","rate":9.2,"won":39,"total":425},{"month":"Oct ''25","rate":65.4,"won":117,"total":179},{"month":"Nov ''25","rate":76.8,"won":63,"total":82},{"month":"Dec ''25","rate":64.9,"won":61,"total":94},{"month":"Jan ''26","rate":61.6,"won":53,"total":86},{"month":"Feb ''26","rate":68.9,"won":31,"total":45}];
 const ltm = 41.9;
 const adjRate = 66.5;
 return (
 <MetricSection title="Win Rate Trend">
 <MetricRow>
 <StatCard
 label="LTM Win Rate"
 value="41.9%"
 subtitle="414 won / 989 closed"
 trend="↑ 3-mo avg 65.1%"
 trendDirection="up"
 />
 <StatCard
 label="Adj. Win Rate"
 value="66.5%"
 subtitle="Ex-Sep ''25 anomaly"
 trendDirection="up"
 />
 </MetricRow>
 <div style={{ height: 230, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
 <ResponsiveContainer width="100%" height="100%">
 <LineChart data={data} margin={{ top: 10, right: 16, left: 0, bottom: 0 }}>
 <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
 <XAxis dataKey="month" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} />
 <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} tickFormatter={v => v + ''%''} domain={[0, 100]} />
 <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} formatter={(v, n, item) => [Number(v).toFixed(1) + ''% ('' + item.payload.won + ''/'' + item.payload.total + '')'', ''Win Rate'']} />
 <ReferenceLine y={adjRate} stroke={theme.accent} strokeDasharray="5 3" label={{ value: ''Adj avg'', position: ''insideTopRight'', fill: theme.inkMuted, fontSize: 10 }} />
 <ReferenceLine y={ltm} stroke={theme.danger} strokeDasharray="5 3" label={{ value: ''LTM avg'', position: ''insideBottomRight'', fill: theme.inkMuted, fontSize: 10 }} />
 <Line type="monotone" dataKey="rate" name="Win Rate" stroke={theme.accent} strokeWidth={2.5} dot={{ fill: theme.accent, r: 3 }} connectNulls={false} />
 </LineChart>
 </ResponsiveContainer>
 </div>
 <MetricNote>Sep ''25 shows 425 closed deals at 9.2% win rate — likely a bulk import with a default close date — which suppresses the LTM average to 41.9%. Excluding Sep, the adjusted LTM win rate is 66.5%, with a clear upward trend (+14.6 pp last 3-mo vs prior 3-mo).</MetricNote>
 </MetricSection>
 );
})()', 'completed', '2026-02-18T22:45:35.267593+00:00', '2026-02-18T22:56:01.763123+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('86ed480c-c60e-43ea-b0d2-fdb5744f9ff5', '35231c42-b088-4da4-b2f2-f25ebce87e36', '{"currentMonth":152193,"ltmCollected":1828222,"ltmTotal":2003362,"monthlyData":[{"collected":84150,"count":35,"invoiced":87650,"month":"Feb ''25"},{"collected":151123,"count":66,"invoiced":190174,"month":"Mar ''25"},{"collected":117289,"count":62,"invoiced":106283,"month":"Apr ''25"},{"collected":107693,"count":34,"invoiced":125354,"month":"May ''25"},{"collected":126010,"count":61,"invoiced":139671,"month":"Jun ''25"},{"collected":159150,"count":48,"invoiced":98864,"month":"Jul ''25"},{"collected":89494,"count":51,"invoiced":114698,"month":"Aug ''25"},{"collected":146281,"count":56,"invoiced":263725,"month":"Sep ''25"},{"collected":191140,"count":48,"invoiced":197685,"month":"Oct ''25"},{"collected":204403,"count":48,"invoiced":206919,"month":"Nov ''25"},{"collected":207654,"count":60,"invoiced":120579,"month":"Dec ''25"},{"collected":135066,"count":56,"invoiced":199568,"month":"Jan ''26"},{"collected":108770,"count":25,"invoiced":152193,"month":"Feb ''26"}],"priorMonth":199568}', '(() => {
 const data = [{"month":"Feb ''25","invoiced":87650,"collected":84150,"count":35},{"month":"Mar ''25","invoiced":190174,"collected":151123,"count":66},{"month":"Apr ''25","invoiced":106283,"collected":117289,"count":62},{"month":"May ''25","invoiced":125354,"collected":107693,"count":34},{"month":"Jun ''25","invoiced":139671,"collected":126010,"count":61},{"month":"Jul ''25","invoiced":98864,"collected":159150,"count":48},{"month":"Aug ''25","invoiced":114698,"collected":89494,"count":51},{"month":"Sep ''25","invoiced":263725,"collected":146281,"count":56},{"month":"Oct ''25","invoiced":197685,"collected":191140,"count":48},{"month":"Nov ''25","invoiced":206919,"collected":204403,"count":48},{"month":"Dec ''25","invoiced":120579,"collected":207654,"count":60},{"month":"Jan ''26","invoiced":199568,"collected":135066,"count":56},{"month":"Feb ''26","invoiced":152193,"collected":108770,"count":25}];
 const currentMonth = 152193;
 const priorMonth = 199568;
 const ltmTotal = 2003362;
 const ltmCollected = 1828222;
 const collectionRate = Math.round((ltmCollected / ltmTotal) * 100);
 const mom = priorMonth > 0 ? Math.round(((currentMonth - priorMonth) / priorMonth) * 100) : 0;

 return (
 <MetricSection>
 <MetricRow>
 <StatCard
 label="This Month"
 value={''$'' + (currentMonth / 1000).toFixed(0) + ''K''}
 subtitle="Invoiced (Feb, partial)"
 trend={mom + ''%''}
 trendDirection={mom >= 0 ? ''up'' : ''down''}
 />
 <StatCard
 label="Last Month"
 value={''$'' + (priorMonth / 1000).toFixed(0) + ''K''}
 subtitle="Invoiced (Jan ''26)"
 />
 <StatCard
 label="LTM Invoiced"
 value={''$'' + (ltmTotal / 1000).toFixed(0) + ''K''}
 subtitle="Last 12 months"
 />
 <StatCard
 label="LTM Collected"
 value={''$'' + (ltmCollected / 1000).toFixed(0) + ''K''}
 subtitle={collectionRate + ''% collection rate''}
 />
 </MetricRow>
 <div style={{ height: 320, background: theme.panel, borderRadius: 16, padding: 20, border: `1px solid ${theme.line}` }}>
 <ResponsiveContainer width="100%" height="100%">
 <LineChart data={data} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
 <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
 <XAxis dataKey="month" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
 <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} tickFormatter={v => ''$'' + (v / 1000).toFixed(0) + ''K''} />
 <Tooltip contentStyle={{ background: theme.tooltipBg, border: `1px solid ${theme.tooltipBorder}`, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} formatter={v => ''$'' + Number(v).toLocaleString()} />
 <Legend wrapperStyle={{ fontSize: 12, paddingTop: 8 }} />
 <Line type="monotone" dataKey="invoiced" name="Invoiced" stroke={theme.accent} strokeWidth={2.5} dot={{ r: 3, fill: theme.accent }} />
 <Line type="monotone" dataKey="collected" name="Collected" stroke={theme.accentStrong} strokeWidth={2.5} dot={{ r: 3, fill: theme.accentStrong }} strokeDasharray="6 3" />
 </LineChart>
 </ResponsiveContainer>
 </div>
 <MetricNote>Source: QuickBooks — 650 invoices + 599 payments, Feb 2025–Feb 2026. Collected reflects Payment.TxnDate (cash received), not invoice balance.</MetricNote>
 </MetricSection>
 );
})()', 'completed', '2026-02-17T18:59:08.736963+00:00', '2026-02-17T19:01:11.878042+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('6a8d803c-194b-4a8f-8d16-f8803a5bb437', '381bed73-c1db-4f66-bf31-30a470890988', '{"totalLearners": 2167, "totalCourses": 148, "activeCourses": 4, "completedCourses": 46, "totalGroups": 134, "activeCourseNames": ["AI Bootcamp 02.06.26 Cohort", "Vistage Chair AI Bootcamp February 2025", "Kiingo Asynchronous Content", "AI Bootcamp 04.17.25 Cohort"], "loginsToday": 35, "loginsWeek": 124, "dailyLogins": [{"day": "Wed", "logins": 18}, {"day": "Thu", "logins": 22}, {"day": "Fri", "logins": 15}, {"day": "Sat", "logins": 4}, {"day": "Sun", "logins": 2}, {"day": "Mon", "logins": 28}, {"day": "Tue", "logins": 35}]}', '(() => {
  const totalLearners = 2167;
  const activeCourses = 4;
  const completedCourses = 46;
  const totalGroups = 134;
  const activeCourseNames = ["AI Bootcamp 02.06.26 Cohort", "Vistage Chair AI Bootcamp February 2025", "Kiingo Asynchronous Content", "AI Bootcamp 04.17.25 Cohort"];
  const loginsToday = 35;
  const loginsWeek = 124;
  const dailyLogins = [{"day": "Wed", "logins": 18}, {"day": "Thu", "logins": 22}, {"day": "Fri", "logins": 15}, {"day": "Sat", "logins": 4}, {"day": "Sun", "logins": 2}, {"day": "Mon", "logins": 28}, {"day": "Tue", "logins": 35}];

  return (
    <MetricSection>
      <MetricRow>
        <StatCard label={''Total Learners''} value={totalLearners.toLocaleString()} subtitle={''All-time enrolled''} />
        <StatCard label={''Active Cohorts''} value={activeCourses} subtitle={completedCourses + '' completed''} />
        <StatCard label={''Logins Today''} value={loginsToday} subtitle={''Unique learners''} />
        <StatCard label={''Logins This Week''} value={loginsWeek} subtitle={''7-day unique''} />
      </MetricRow>

      <div style={{ height: 220, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Daily Login Activity (Last 7 Days)</div>
        <ResponsiveContainer width="100%" height="85%">
          <BarChart data={dailyLogins} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="day" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <Bar dataKey="logins" name="Unique Logins" fill={theme.accent} radius={[4, 4, 0, 0]} />
          </BarChart>
        </ResponsiveContainer>
      </div>

      {activeCourseNames.length > 0 && (
        <div style={{ background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 16 }}>
          <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 12, color: theme.ink }}>Active Courses</div>
          <div style={{ display: ''flex'', flexWrap: ''wrap'', gap: 8 }}>
            {activeCourseNames.map((name, i) => (
              <div key={i} style={{ padding: ''6px 14px'', borderRadius: 20, background: theme.accent + ''22'', color: theme.accent, fontSize: 12, fontWeight: 600, border: ''1px solid '' + theme.accent + ''44'' }}>{name}</div>
            ))}
          </div>
        </div>
      )}

      <MetricNote>Source: TalentLMS · kiingo.talentlms.com · {totalGroups} groups</MetricNote>
    </MetricSection>
  );
})()', 'completed', '2026-02-19T01:15:02+00:00', '2026-02-19T01:15:02+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('f3685c89-bbd1-485a-a511-ee45bc6ed144', '3b4f2305-5220-4824-8f77-e78afe3906ad', '{"generatedAt": "2/18/2026", "totalOpenDeals": 189, "withDiscovery": 132, "withoutDiscovery": 57, "likelyCold": 43, "overdueFollowUps": 21, "followUpNeeded": 0, "avgDaysSinceContact": 9.4, "followUpRanges": [{"range": "0-3d", "healthy": 44, "warning": 0, "danger": 0}, {"range": "3-7d", "healthy": 82, "warning": 0, "danger": 0}, {"range": "7-14d", "healthy": 0, "warning": 8, "danger": 0}, {"range": "14-30d", "healthy": 0, "warning": 6, "danger": 0}, {"range": "30-60d", "healthy": 0, "warning": 0, "danger": 12}, {"range": "60-90d", "healthy": 0, "warning": 0, "danger": 2}, {"range": "90-180d", "healthy": 0, "warning": 0, "danger": 1}, {"range": "180+d", "healthy": 0, "warning": 0, "danger": 34}], "repBreakdown": [{"rep": "kym", "totalDeals": 84, "active": 51, "likelyCold": 33, "coldPct": 39.3}, {"rep": "david", "totalDeals": 50, "active": 42, "likelyCold": 8, "coldPct": 16.0}, {"rep": "sohrab", "totalDeals": 11, "active": 9, "likelyCold": 2, "coldPct": 18.2}, {"rep": "michael", "totalDeals": 4, "active": 4, "likelyCold": 0, "coldPct": 0}, {"rep": "ross", "totalDeals": 2, "active": 2, "likelyCold": 0, "coldPct": 0}, {"rep": "josh", "totalDeals": 2, "active": 2, "likelyCold": 0, "coldPct": 0}, {"rep": "jess", "totalDeals": 1, "active": 1, "likelyCold": 0, "coldPct": 0}, {"rep": "jordan", "totalDeals": 1, "active": 1, "likelyCold": 0, "coldPct": 0}]}', '(() => {
  const totalOpenDeals = 189;
  const likelyCold = 43;
  const overdueFollowUps = 21;
  const avgDays = 9.4;
  const followUpRanges = [{"range": "0-3d", "healthy": 44, "warning": 0, "danger": 0}, {"range": "3-7d", "healthy": 82, "warning": 0, "danger": 0}, {"range": "7-14d", "healthy": 0, "warning": 8, "danger": 0}, {"range": "14-30d", "healthy": 0, "warning": 6, "danger": 0}, {"range": "30-60d", "healthy": 0, "warning": 0, "danger": 12}, {"range": "60-90d", "healthy": 0, "warning": 0, "danger": 2}, {"range": "90-180d", "healthy": 0, "warning": 0, "danger": 1}, {"range": "180+d", "healthy": 0, "warning": 0, "danger": 34}];
  const repBreakdown = [{"rep": "kym", "totalDeals": 84, "active": 51, "likelyCold": 33, "coldPct": 39.3}, {"rep": "david", "totalDeals": 50, "active": 42, "likelyCold": 8, "coldPct": 16.0}, {"rep": "sohrab", "totalDeals": 11, "active": 9, "likelyCold": 2, "coldPct": 18.2}, {"rep": "michael", "totalDeals": 4, "active": 4, "likelyCold": 0, "coldPct": 0}, {"rep": "ross", "totalDeals": 2, "active": 2, "likelyCold": 0, "coldPct": 0}, {"rep": "josh", "totalDeals": 2, "active": 2, "likelyCold": 0, "coldPct": 0}, {"rep": "jess", "totalDeals": 1, "active": 1, "likelyCold": 0, "coldPct": 0}, {"rep": "jordan", "totalDeals": 1, "active": 1, "likelyCold": 0, "coldPct": 0}];
  const generatedAt = "2/18/2026";

  return (
    <MetricSection>
      <MetricRow>
        <StatCard label={''Open Deals''} value={totalOpenDeals} subtitle={''Total pipeline''} />
        <StatCard label={''Likely Cold''} value={likelyCold} subtitle={((likelyCold / totalOpenDeals) * 100).toFixed(0) + ''% of pipeline''} />
        <StatCard label={''Overdue >14d''} value={overdueFollowUps} subtitle={''Need attention''} />
        <StatCard label={''Avg Days Since Contact''} value={avgDays.toFixed(1)} subtitle={''Lower is better''} />
      </MetricRow>

      <div style={{ height: 300, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Follow-Up Range Distribution</div>
        <ResponsiveContainer width="100%" height="90%">
          <BarChart data={followUpRanges} margin={{ top: 10, right: 10, left: 0, bottom: 40 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="range" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} angle={-25} textAnchor="end" />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <Legend />
            <Bar dataKey="healthy" name="Healthy (0-7d)" stackId="a" fill="#16a34a" radius={[0, 0, 0, 0]} />
            <Bar dataKey="warning" name="Needs Attention (7-30d)" stackId="a" fill="#eab308" radius={[0, 0, 0, 0]} />
            <Bar dataKey="danger" name="At Risk (30d+)" stackId="a" fill={theme.danger} radius={[4, 4, 0, 0]} />
          </BarChart>
        </ResponsiveContainer>
      </div>

      <div style={{ height: 280, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 16 }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Sales Rep Follow-Up Health</div>
        <ResponsiveContainer width="100%" height="90%">
          <BarChart data={repBreakdown} layout="vertical" margin={{ top: 10, right: 30, left: 60, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis type="number" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis type="category" dataKey="rep" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} width={55} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <Legend />
            <Bar dataKey="active" name="Active" stackId="a" fill={theme.accent} radius={[0, 0, 0, 0]} />
            <Bar dataKey="likelyCold" name="Likely Cold" stackId="a" fill={theme.danger} radius={[0, 4, 4, 0]} />
          </BarChart>
        </ResponsiveContainer>
      </div>

      <MetricNote>Source: CRM SharePoint · SALES Follow-Up Metrics Report · {generatedAt}</MetricNote>
    </MetricSection>
  );
})()', 'completed', '2026-02-18T23:43:35+00:00', '2026-02-18T23:43:35+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('cc8f13e3-f7f5-448a-bfb4-792a05c2fde9', '3ec99942-c4b5-4702-bce5-9e712cc978a8', '{"atRiskRocks":["Rock 4: Vault Infrastructure","Rock 5: Team Upskilling","Rock 6: Content Pipeline","Rock 7: Capacity Planning"],"overallProgress":28,"rocks":[{"pct":69,"projects":3,"rock":"Rock 1: Champion Program","tasksComplete":11,"tasksTotal":16},{"pct":50,"projects":3,"rock":"Rock 2: Content Update","tasksComplete":6,"tasksTotal":12},{"pct":29,"projects":3,"rock":"Rock 3: New Course","tasksComplete":4,"tasksTotal":14},{"pct":19,"projects":3,"rock":"Rock 4: Vault Infrastructure","tasksComplete":3,"tasksTotal":16},{"pct":0,"projects":4,"rock":"Rock 5: Team Upskilling","tasksComplete":0,"tasksTotal":0},{"pct":17,"projects":3,"rock":"Rock 6: Content Pipeline","tasksComplete":3,"tasksTotal":18},{"pct":0,"projects":3,"rock":"Rock 7: Capacity Planning","tasksComplete":0,"tasksTotal":13},{"pct":37,"projects":7,"rock":"Rock 8: System Documentation","tasksComplete":11,"tasksTotal":30}]}', '(() => {
 const data = [{"rock":"Rock 1: Champion Program","projects":3,"tasksComplete":11,"tasksTotal":16,"pct":69},{"rock":"Rock 2: Content Update","projects":3,"tasksComplete":6,"tasksTotal":12,"pct":50},{"rock":"Rock 3: New Course","projects":3,"tasksComplete":4,"tasksTotal":14,"pct":29},{"rock":"Rock 4: Vault Infrastructure","projects":3,"tasksComplete":3,"tasksTotal":16,"pct":19},{"rock":"Rock 5: Team Upskilling","projects":4,"tasksComplete":0,"tasksTotal":0,"pct":0},{"rock":"Rock 6: Content Pipeline","projects":3,"tasksComplete":3,"tasksTotal":18,"pct":17},{"rock":"Rock 7: Capacity Planning","projects":3,"tasksComplete":0,"tasksTotal":13,"pct":0},{"rock":"Rock 8: System Documentation","projects":7,"tasksComplete":11,"tasksTotal":30,"pct":37}];
 const overall = Math.round(data.reduce((s, d) => s + d.pct, 0) / data.length);
 return (
 <MetricSection>
 <StatCard label="Overall Rock Progress" value={overall + ''%''} subtitle="Q1 2026 average" trendDirection={overall > 40 ? ''up'' : overall > 25 ? ''flat'' : ''down''} />
 <div style={{ height: 380, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
 <ResponsiveContainer width="100%" height="100%">
 <BarChart data={data} layout="vertical" margin={{ top: 5, right: 30, left: 160, bottom: 5 }}>
 <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
 <XAxis type="number" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} tickFormatter={v => v + ''%''} domain={[0, 100]} />
 <YAxis type="category" dataKey="rock" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} width={155} />
 <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} formatter={v => v + ''%''} />
 <Bar dataKey="pct" name="Progress" fill={theme.accent} radius={[0,4,4,0]}>
 {data.map((entry, index) => (
 <Cell key={`cell-${index}`} fill={entry.pct < 20 ? theme.danger : theme.accent} />
 ))}
 </Bar>
 </BarChart>
 </ResponsiveContainer>
 </div>
 <MetricNote>Source: Asana Projects via Kiingo MCP • 4 rocks below 20% completion</MetricNote>
 </MetricSection>
 );
})()', 'completed', '2026-02-15T19:28:48.162917+00:00', '2026-02-15T19:32:02.543226+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('47059202-b5a3-4260-965a-20caa10e6935', '44aed376-61f4-4b67-820c-7697f1a5179d', '{"avgDealSize":5292,"avgMonthlyRevenue":166947,"byService":[{"count":4,"revenue":44050,"service":"Private AI Foundational Bootcamp"},{"count":7,"revenue":15000,"service":"AI Foundational Bootcamp"},{"count":1,"revenue":9000,"service":"AI Agents Bootcamp"},{"count":1,"revenue":749,"service":"AI Champions Group"}],"collectionRate":91,"currentMonthInvoiced":49799,"currentMonthRevenue":68799,"dealCount":13,"ltmCollected":1828222,"ltmRevenue":2003362,"momGrowth":-66,"monthLabel":"February 2026","monthlyTrend":[{"collected":84150,"count":35,"invoiced":87650,"month":"Feb ''25"},{"collected":151123,"count":66,"invoiced":190174,"month":"Mar ''25"},{"collected":117289,"count":62,"invoiced":106283,"month":"Apr ''25"},{"collected":107693,"count":34,"invoiced":125354,"month":"May ''25"},{"collected":126010,"count":61,"invoiced":139671,"month":"Jun ''25"},{"collected":159150,"count":48,"invoiced":98864,"month":"Jul ''25"},{"collected":89494,"count":51,"invoiced":114698,"month":"Aug ''25"},{"collected":146281,"count":56,"invoiced":263725,"month":"Sep ''25"},{"collected":191140,"count":48,"invoiced":197685,"month":"Oct ''25"},{"collected":204403,"count":48,"invoiced":206919,"month":"Nov ''25"},{"collected":207654,"count":60,"invoiced":120579,"month":"Dec ''25"},{"collected":135066,"count":56,"invoiced":199568,"month":"Jan ''26"},{"collected":108770,"count":25,"invoiced":152193,"month":"Feb ''26"}],"newBizCount":10,"newBizRevenue":57800,"outstanding":19000,"priorMonthRevenue":199568,"topDeals":[{"amount":14000,"client":"Tire Discounter Group","service":"Private AI Foundational Bootcamp","type":"New Biz"},{"amount":10450,"client":"Preservation Equity Fund Advisors","service":"Private AI Foundational Bootcamp","type":"New Biz"},{"amount":10000,"client":"Total Package HR","service":"Private AI Foundational Bootcamp","type":"New Biz"},{"amount":9600,"client":"SVN (1st cohort)","service":"Private AI Foundational Bootcamp","type":"New Biz"},{"amount":9000,"client":"Immatics","service":"AI Agents Bootcamp","type":"Upsell"}],"upsellCount":3,"upsellRevenue":10999}', '(() => {
 const currentMonthRevenue = 68799;
 const currentMonthInvoiced = 49799;
 const outstanding = 19000;
 const dealCount = 13;
 const avgDealSize = 5292;
 const newBizRevenue = 57800;
 const newBizCount = 10;
 const upsellRevenue = 10999;
 const upsellCount = 3;
 const byService = [{"service":"Private AI Foundational Bootcamp","count":4,"revenue":44050},{"service":"AI Foundational Bootcamp","count":7,"revenue":15000},{"service":"AI Agents Bootcamp","count":1,"revenue":9000},{"service":"AI Champions Group","count":1,"revenue":749}];
 const topDeals = [{"client":"Tire Discounter Group","amount":14000,"service":"Private AI Foundational Bootcamp","type":"New Biz"},{"client":"Preservation Equity Fund Advisors","amount":10450,"service":"Private AI Foundational Bootcamp","type":"New Biz"},{"client":"Total Package HR","amount":10000,"service":"Private AI Foundational Bootcamp","type":"New Biz"},{"client":"SVN (1st cohort)","amount":9600,"service":"Private AI Foundational Bootcamp","type":"New Biz"},{"client":"Immatics","amount":9000,"service":"AI Agents Bootcamp","type":"Upsell"}];
 const monthLabel = "February 2026";
 const monthlyTrend = [{"month":"Feb ''25","invoiced":87650,"collected":84150,"count":35},{"month":"Mar ''25","invoiced":190174,"collected":151123,"count":66},{"month":"Apr ''25","invoiced":106283,"collected":117289,"count":62},{"month":"May ''25","invoiced":125354,"collected":107693,"count":34},{"month":"Jun ''25","invoiced":139671,"collected":126010,"count":61},{"month":"Jul ''25","invoiced":98864,"collected":159150,"count":48},{"month":"Aug ''25","invoiced":114698,"collected":89494,"count":51},{"month":"Sep ''25","invoiced":263725,"collected":146281,"count":56},{"month":"Oct ''25","invoiced":197685,"collected":191140,"count":48},{"month":"Nov ''25","invoiced":206919,"collected":204403,"count":48},{"month":"Dec ''25","invoiced":120579,"collected":207654,"count":60},{"month":"Jan ''26","invoiced":199568,"collected":135066,"count":56},{"month":"Feb ''26","invoiced":152193,"collected":108770,"count":25}];
 const ltmRevenue = 2003362;
 const ltmCollected = 1828222;
 const collectionRate = 91;
 const priorMonthRevenue = 199568;
 const momGrowth = -66;
 const avgMonthlyRevenue = 166947;

 const fmt = (n) => ''$'' + (n || 0).toLocaleString();
 const fmtK = (n) => ''$'' + ((n || 0) / 1000).toFixed(0) + ''K'';

 return (
 <MetricSection>
 <MetricRow>
 <StatCard label={monthLabel + '' Revenue''} value={fmtK(currentMonthRevenue)} subtitle={dealCount + '' deals closed''} />
 <StatCard label="Prior Month" value={fmtK(priorMonthRevenue)} subtitle={''MoM: '' + (momGrowth >= 0 ? ''+'' : '''') + momGrowth + ''%''} trendDirection="down" />
 <StatCard label="LTM Revenue" value={fmtK(ltmRevenue)} subtitle={''Avg '' + fmtK(avgMonthlyRevenue) + ''/mo''} />
 <StatCard label="Collection Rate" value={collectionRate + ''%''} subtitle={fmtK(ltmCollected) + '' collected LTM''} />
 </MetricRow>

 <MetricRow>
 <StatCard label="New Business" value={fmtK(newBizRevenue)} subtitle={newBizCount + '' deals''} />
 <StatCard label="Upsells" value={fmtK(upsellRevenue)} subtitle={upsellCount + '' deals''} />
 <StatCard label="Invoiced" value={fmtK(currentMonthInvoiced)} subtitle={outstanding > 0 ? fmtK(outstanding) + '' outstanding'' : ''All invoiced''} />
 <StatCard label="Avg Deal" value={fmt(avgDealSize)} />
 </MetricRow>

 <div style={{ height: 300, background: theme.panel, borderRadius: 16, padding: 20, border: ''1px solid '' + theme.line }}>
 <ResponsiveContainer width="100%" height="100%">
 <ComposedChart data={monthlyTrend} margin={{ top: 10, right: 10, left: 10, bottom: 0 }}>
 <defs>
 <linearGradient id="revOverviewGrad" x1="0" y1="0" x2="0" y2="1">
 <stop offset="0%" stopColor="#2563eb" stopOpacity={0.15} />
 <stop offset="100%" stopColor="#2563eb" stopOpacity={0.02} />
 </linearGradient>
 </defs>
 <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
 <XAxis dataKey="month" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
 <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} tickFormatter={(v) => ''$'' + (v / 1000).toFixed(0) + ''K''} />
 <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} formatter={(v, name) => [fmt(v), name]} />
 <Legend />
 <Area type="monotone" dataKey="invoiced" name="Invoiced" stroke="#2563eb" strokeWidth={2} fill="url(#revOverviewGrad)" />
 <Line type="monotone" dataKey="collected" name="Collected" stroke="#16a34a" strokeWidth={2} strokeDasharray="6 3" dot={{ fill: ''#16a34a'', r: 3 }} />
 </ComposedChart>
 </ResponsiveContainer>
 </div>

 <div style={{ display: ''grid'', gridTemplateColumns: ''1fr 1fr'', gap: 16, marginTop: 16 }}>
 <div style={{ background: theme.panel, borderRadius: 16, padding: 16, border: ''1px solid '' + theme.line }}>
 <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 12, color: theme.ink }}>Revenue by Service</div>
 <div style={{ height: 220 }}>
 <ResponsiveContainer width="100%" height="100%">
 <BarChart data={byService} layout="vertical" margin={{ top: 0, right: 10, left: 10, bottom: 0 }}>
 <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
 <XAxis type="number" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} tickFormatter={(v) => ''$'' + (v / 1000).toFixed(0) + ''K''} />
 <YAxis type="category" dataKey="service" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} width={140} />
 <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 12 }} formatter={(v) => [fmt(v), ''Revenue'']} />
 <Bar dataKey="revenue" fill={theme.accent} radius={[0, 6, 6, 0]} />
 </BarChart>
 </ResponsiveContainer>
 </div>
 </div>

 <div style={{ background: theme.panel, borderRadius: 16, padding: 16, border: ''1px solid '' + theme.line }}>
 <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 12, color: theme.ink }}>Top Deals This Month</div>
 <table style={{ width: ''100%'', borderCollapse: ''collapse'', fontSize: 12 }}>
 <thead>
 <tr style={{ borderBottom: ''2px solid '' + theme.line }}>
 <th style={{ textAlign: ''left'', padding: ''6px 8px'', color: theme.inkMuted }}>Client</th>
 <th style={{ textAlign: ''right'', padding: ''6px 8px'', color: theme.inkMuted }}>Amount</th>
 <th style={{ textAlign: ''left'', padding: ''6px 8px'', color: theme.inkMuted }}>Type</th>
 </tr>
 </thead>
 <tbody>
 {topDeals.map((d, i) => (
 <tr key={i} style={{ borderBottom: ''1px solid '' + theme.line }}>
 <td style={{ padding: ''6px 8px'', color: theme.ink }}>{d.client}</td>
 <td style={{ padding: ''6px 8px'', color: theme.ink, textAlign: ''right'', fontVariantNumeric: ''tabular-nums'' }}>{fmt(d.amount)}</td>
 <td style={{ padding: ''6px 8px'' }}><span style={{ padding: ''2px 6px'', borderRadius: 6, fontSize: 10, fontWeight: 600, background: d.type === ''New Biz'' ? theme.accent + ''22'' : theme.secondary + ''22'', color: d.type === ''New Biz'' ? theme.accent : theme.secondary }}>{d.type}</span></td>
 </tr>
 ))}
 </tbody>
 </table>
 </div>
 </div>

 <MetricNote>Combines Revenue Tracker (OneDrive) + QuickBooks invoicing data · Month in progress · MoM vs prior month invoiced (QB), current month from tracker</MetricNote>
 </MetricSection>
 );
})()', 'completed', '2026-02-17T23:55:08.364754+00:00', '2026-02-17T23:56:00.853566+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('b6019911-fe21-4cd3-bcbd-6d32ab81abd7', '50e1135e-e4f0-4860-91a0-44a257c8e930', '{"avgCreated":91,"avgWon":48,"monthlyData":[{"created":0,"month":"Mar ''25","won":0},{"created":0,"month":"Apr ''25","won":0},{"created":0,"month":"May ''25","won":0},{"created":0,"month":"Jun ''25","won":6},{"created":0,"month":"Jul ''25","won":10},{"created":0,"month":"Aug ''25","won":34},{"created":503,"month":"Sep ''25","won":39},{"created":263,"month":"Oct ''25","won":117},{"created":199,"month":"Nov ''25","won":63},{"created":123,"month":"Dec ''25","won":61},{"created":89,"month":"Jan ''26","won":53},{"created":60,"month":"Feb ''26","won":31}],"totalCreatedLTM":1237}', '(() => {
 const data = [{"month":"Mar ''25","created":0,"won":0},{"month":"Apr ''25","created":0,"won":0},{"month":"May ''25","created":0,"won":0},{"month":"Jun ''25","created":0,"won":6},{"month":"Jul ''25","created":0,"won":10},{"month":"Aug ''25","created":0,"won":34},{"month":"Sep ''25","created":503,"won":39},{"month":"Oct ''25","created":263,"won":117},{"month":"Nov ''25","created":199,"won":63},{"month":"Dec ''25","created":123,"won":61},{"month":"Jan ''26","created":89,"won":53},{"month":"Feb ''26","created":60,"won":31}];
 const avgCreated = 91;
 const avgWon = 48;
 const totalCreatedLTM = 1237;
 return (
 <MetricSection title="Deal Creation Velocity">
 <MetricRow>
 <StatCard label="Avg/Month Created" value={avgCreated} subtitle="Trailing 3 months" trend="-72% vs prior 3mo" trendDirection="down" />
 <StatCard label="LTM Deals Created" value={totalCreatedLTM} subtitle="Last 12 months" />
 <StatCard label="Avg/Month Won" value={avgWon} subtitle="Trailing 3 months" trend="-34% vs prior 3mo" trendDirection="down" />
 </MetricRow>
 <div style={{ height: 300, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
 <ResponsiveContainer width="100%" height="100%">
 <ComposedChart data={data} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
 <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
 <XAxis dataKey="month" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
 <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
 <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
 <Legend wrapperStyle={{ fontSize: 12, color: theme.inkMuted }} />
 <Bar dataKey="created" name="Deals Created" fill={theme.accent} radius={[4,4,0,0]} opacity={0.6} />
 <Line type="monotone" dataKey="won" name="Deals Won" stroke={theme.accentStrong} strokeWidth={2.5} dot={{ fill: theme.accentStrong, r: 3 }} />
 </ComposedChart>
 </ResponsiveContainer>
 </div>
 <MetricNote>1,487 total deals across all time · LTM window: Mar 2025 – Feb 2026 · Closed-won counts by close date</MetricNote>
 </MetricSection>
 );
})()', 'completed', '2026-02-18T22:45:35.267338+00:00', '2026-02-18T22:52:40.168370+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('ac30c330-6b97-4e8c-a3bf-52155c829505', '53ac482e-61fd-4faf-9cd2-829ea591372d', '{"ar":133340.88,"cash":315964.94,"cashFlowByMonth":[{"financing":0,"month":"Aug ''25","net":13364.27,"operating":13364.27},{"financing":-63000,"month":"Sep ''25","net":3097.12,"operating":66097.12},{"financing":0,"month":"Oct ''25","net":76406.61,"operating":76406.61},{"financing":0,"month":"Nov ''25","net":97239.44,"operating":97239.44},{"financing":-233037,"month":"Dec ''25","net":-140563.95,"operating":92473.05},{"financing":0,"month":"Jan ''26","net":5806.09,"operating":5806.09},{"financing":0,"month":"Feb ''26","net":66707.31,"operating":66707.31}],"totalLiquid":449305.82}', '(() => {
 const cash = 315964.94;
 const ar = 133340.88;
 const totalLiquid = 449305.82;
 const data = [
 { month: "Aug ''25", operating: 13364.27, financing: 0, netCashFlow: 13364.27 },
 { month: "Sep ''25", operating: 66097.12, financing: -63000, netCashFlow: 3097.12 },
 { month: "Oct ''25", operating: 76406.61, financing: 0, netCashFlow: 76406.61 },
 { month: "Nov ''25", operating: 97239.44, financing: 0, netCashFlow: 97239.44 },
 { month: "Dec ''25", operating: 92473.05, financing: -233037, netCashFlow: -140563.95 },
 { month: "Jan ''26", operating: 5806.09, financing: 0, netCashFlow: 5806.09 },
 { month: "Feb ''26", operating: 66707.31, financing: 0, netCashFlow: 66707.31 },
 ];

 return (
 <MetricSection>
 <MetricRow>
 <StatCard label="Cash" value={''$'' + (cash / 1000).toFixed(0) + ''K''} subtitle="Bank accounts" trend="+$67K this month" trendDirection="up" />
 <StatCard label="Receivables" value={''$'' + (ar / 1000).toFixed(0) + ''K''} subtitle="Accounts receivable" />
 <StatCard label="Total Liquid" value={''$'' + (totalLiquid / 1000).toFixed(0) + ''K''} subtitle="Cash + AR" />
 </MetricRow>
 <div style={{ height: 220, background: theme.panel, borderRadius: 16, padding: 20, border: `1px solid ${theme.line}` }}>
 <ResponsiveContainer width="100%" height="100%">
 <BarChart data={data} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
 <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
 <XAxis dataKey="month" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
 <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} tickFormatter={v => ''$'' + (v / 1000).toFixed(0) + ''K''} />
 <Tooltip contentStyle={{ background: theme.tooltipBg, border: `1px solid ${theme.tooltipBorder}`, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} formatter={v => [''$'' + Number(v).toLocaleString(), ''Net Cash Flow'']} />
 <ReferenceLine y={0} stroke={theme.danger} strokeWidth={1} />
 <Bar dataKey="netCashFlow" name="Net Cash Flow" radius={[4, 4, 0, 0]}>
 {data.map((entry, index) => (
 <Cell key={index} fill={entry.netCashFlow >= 0 ? theme.accent : theme.danger} />
 ))}
 </Bar>
 </BarChart>
 </ResponsiveContainer>
 </div>
 <MetricNote>Source: QuickBooks Balance Sheet + Cash Flow via Kiingo MCP</MetricNote>
 </MetricSection>
 );
})()', 'completed', '2026-02-18T23:00:50.757886+00:00', '2026-02-18T23:04:58.999453+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('06c8cace-100c-4e4f-b887-20bdc73b52c0', '55d47cfc-5648-4fa7-be79-7ff67d7115d3', '{"arAgingOver90":0,"arBalance":187986.88,"cashPosition":284422.93,"collectionRate":89.4}', '(() => {
 const cash = 284422.93;
 const ar = 187986.88;
 const rate = 89.4;
 const arOver90 = 0;
 return (
 <MetricSection title="Cash & Collections">
 <MetricRow>
 <StatCard 
 label="Cash Position" 
 value={''$'' + (cash / 1000).toFixed(0) + ''K''} 
 subtitle="Bank accounts" 
 />
 <StatCard 
 label="Accounts Receivable" 
 value={''$'' + (ar / 1000).toFixed(0) + ''K''} 
 subtitle="Outstanding" 
 />
 </MetricRow>
 <MetricRow>
 <StatCard 
 label="Collection Rate" 
 value={rate.toFixed(1) + ''%''} 
 subtitle="LTM invoices" 
 trend={rate >= 90 ? ''Strong'' : rate >= 80 ? ''Good'' : ''Needs attention''}
 trendDirection={rate >= 90 ? ''up'' : rate >= 80 ? ''flat'' : ''down''}
 />
 <StatCard 
 label="AR > 90 Days" 
 value={''$'' + (arOver90 / 1000).toFixed(0) + ''K''} 
 subtitle="Past due" 
 trendDirection={arOver90 > 0 ? ''down'' : ''flat''}
 />
 </MetricRow>
 <MetricNote>
 Data from QuickBooks Online as of Feb 16, 2026. Collection rate calculated from 629 invoices over the last 12 months.
 </MetricNote>
 </MetricSection>
 );
})()', 'completed', '2026-02-16T16:16:54.134439+00:00', '2026-02-16T16:18:41.906084+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('a94b99e6-7eb7-4f97-85c2-1cea41a92f88', '5da7296a-4782-45a8-8309-b0b4f9827ce9', '{"avgTrailing":44,"byMonth":{"Dec 2025":42,"Feb 2026":19,"Jan 2026":53,"Nov 2025":8},"discoveryDetails":null,"excludedRepeats":null,"followUpTotal":15,"nextStepsTotal":54,"peak":54,"peakWeek":"2026-01-26","total":123,"trailing30":45,"trough":37,"troughWeek":"2025-12-29","weeklyData":[{"trailing30":42,"weekOf":"2025-12-22"},{"trailing30":37,"weekOf":"2025-12-29"},{"trailing30":37,"weekOf":"2026-01-05"},{"trailing30":39,"weekOf":"2026-01-12"},{"trailing30":48,"weekOf":"2026-01-19"},{"trailing30":54,"weekOf":"2026-01-26"},{"trailing30":50,"weekOf":"2026-02-02"},{"trailing30":45,"weekOf":"2026-02-09"}]}', '(() => {
 const data = [
 { week: ''Dec 22'', value: 42 },
 { week: ''Dec 29'', value: 37 },
 { week: ''Jan 5'', value: 37 },
 { week: ''Jan 12'', value: 39 },
 { week: ''Jan 19'', value: 48 },
 { week: ''Jan 26'', value: 54 },
 { week: ''Feb 2'', value: 50 },
 { week: ''Feb 9'', value: 45 },
 ];
 const current = 45;
 const peak = 54;
 const trough = 37;
 const avgValue = 44;
 const byMonth = { ''Nov 2025'': 8, ''Dec 2025'': 42, ''Jan 2026'': 53, ''Feb 2026'': 19 };
 const followUpTotal = 15;
 const nextStepsTotal = 54;

 return (
 <MetricSection>
 <MetricRow>
 <StatCard label="Trailing 30d" value={current} subtitle="First-time discovery calls" trend="+2 vs prior" trendDirection="up" />
 <StatCard label="Peak" value={peak} subtitle="Week of Jan 26" />
 <StatCard label="Trough" value={trough} subtitle="Week of Dec 29" />
 <StatCard label="Avg Trailing" value={avgValue} subtitle="Avg across 8 weeks" />
 </MetricRow>

 <div style={{ height: 320, background: theme.panel, borderRadius: 16, padding: 20, border: `1px solid ${theme.line}`, marginBottom: 16 }}>
 <div style={{ fontSize: 12, color: theme.inkMuted, marginBottom: 8, fontWeight: 500, letterSpacing: ''0.04em'', textTransform: ''uppercase'' }}>Trailing 30-Day Discovery Calls</div>
 <ResponsiveContainer width="100%" height="90%">
 <AreaChart data={data} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
 <defs>
 <linearGradient id="discoveryGradient" x1="0" y1="0" x2="0" y2="1">
 <stop offset="0%" stopColor={theme.accent} stopOpacity={0.35} />
 <stop offset="100%" stopColor={theme.accent} stopOpacity={0.02} />
 </linearGradient>
 </defs>
 <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
 <XAxis dataKey="week" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
 <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} domain={[0, ''auto'']} />
 <Tooltip contentStyle={{ background: theme.tooltipBg, border: `1px solid ${theme.tooltipBorder}`, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} formatter={(v) => [v, ''Trailing 30d'']} />
 <ReferenceLine y={avgValue} stroke={theme.line} strokeDasharray="6 4" label={{ value: `Avg ${avgValue}`, fill: theme.inkMuted, fontSize: 10, position: ''insideTopRight'' }} />
 <Area type="monotone" dataKey="value" stroke={theme.accent} strokeWidth={2.5} fill="url(#discoveryGradient)" dot={{ fill: theme.accent, r: 3, strokeWidth: 0 }} activeDot={{ fill: theme.accentStrong, r: 5, strokeWidth: 2, stroke: theme.line }} />
 </AreaChart>
 </ResponsiveContainer>
 </div>

 <MetricRow>
 {Object.entries(byMonth).map(([month, count]) => (
 <StatCard key={month} label={month} value={count} subtitle="First-time discoveries" />
 ))}
 </MetricRow>

 <div style={{ background: theme.panel, borderRadius: 12, padding: ''12px 16px'', border: `1px solid ${theme.line}`, marginTop: 8 }}>
 <div style={{ fontSize: 12, color: theme.inkMuted, marginBottom: 6, fontWeight: 600, textTransform: ''uppercase'', letterSpacing: ''0.04em'' }}>Call Breakdown Context</div>
 <div style={{ display: ''flex'', gap: 24 }}>
 <div><span style={{ color: theme.inkMuted, fontSize: 13 }}>First-Time Discoveries: </span><span style={{ color: theme.ink, fontWeight: 700, fontSize: 15 }}>123</span></div>
 <div><span style={{ color: theme.inkMuted, fontSize: 13 }}>Repeat-Company Follow-Ups: </span><span style={{ color: theme.ink, fontWeight: 700, fontSize: 15 }}>{followUpTotal}</span></div>
 <div><span style={{ color: theme.inkMuted, fontSize: 13 }}>Next-Steps Calls: </span><span style={{ color: theme.ink, fontWeight: 700, fontSize: 15 }}>{nextStepsTotal}</span></div>
 </div>
 </div>

 <MetricNote>Trailing 30d estimated via rolling 4-week window (fallback: no daily data). Each week = prior 4 weeks + 2/7 of week 5. Source: Weekly Discovery Calls dependency (calendar-derived).</MetricNote>
 </MetricSection>
 );
})()', 'completed', '2026-02-18T07:11:10.681608+00:00', '2026-02-18T07:11:51.108702+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('aa93826f-0857-42fa-ba71-fdc0002c731b', '5e4a0131-1e16-4ca6-b715-cddf54af01e4', '{"conversionRate":77.45,"currentInStage":23,"currentInStageValue":32850,"currentTrailing30":32,"priorTrailing30":55,"proposalCount":79,"trendDirection":"down","trendPct":-41.8}', '(() => {
 const trailing = 32;
 const trend = ''down'';
 const trendPct = -41.8;
 const inStage = 23;
 const stageValue = 32850;
 const conversion = 77.45;
 const proposalCount = 79;

 const weeklyData = [
 { weekOf: ''12/22'', trailing30: 40 },
 { weekOf: ''12/29'', trailing30: 37 },
 { weekOf: ''01/05'', trailing30: 40 },
 { weekOf: ''01/12'', trailing30: 46 },
 { weekOf: ''01/19'', trailing30: 55 },
 { weekOf: ''01/26'', trailing30: 59 },
 { weekOf: ''02/02'', trailing30: 53 },
 { weekOf: ''02/09'', trailing30: 47 },
 { weekOf: ''02/16'', trailing30: 32 },
 ];

 const trendArrow = ''\u2193'';
 const trendColor = theme.danger;

 return (
 <MetricSection title="Discovery Call Health">
 <MetricRow>
 <StatCard
 label="Trailing 30d Calls"
 value={trailing}
 subtitle={trendArrow + '' '' + Math.abs(trendPct).toFixed(0) + ''% vs prior 30d''}
 trendDirection={trend}
 />
 <StatCard
 label="In Discovery Now"
 value={inStage}
 subtitle={''$'' + (stageValue / 1000).toFixed(0) + ''K pipeline value''}
 />
 <StatCard
 label="Discovery \u2192 Proposal"
 value={conversion.toFixed(0) + ''%''}
 subtitle={proposalCount + '' deals in Proposal Sent''}
 />
 </MetricRow>
 <div style={{ marginTop: 16 }}>
 <ResponsiveContainer width="100%" height={160}>
 <AreaChart data={weeklyData} margin={{ top: 4, right: 12, left: 0, bottom: 0 }}>
 <defs>
 <linearGradient id="dcGrad" x1="0" y1="0" x2="0" y2="1">
 <stop offset="5%" stopColor={theme.gradientFrom} stopOpacity={0.35} />
 <stop offset="95%" stopColor={theme.gradientFrom} stopOpacity={0} />
 </linearGradient>
 </defs>
 <CartesianGrid stroke={theme.gridStroke} strokeDasharray="3 3" />
 <XAxis dataKey="weekOf" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} />
 <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} domain={[25, 65]} />
 <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
 <ReferenceLine y={55} stroke={theme.danger} strokeDasharray="4 3" label={{ value: ''Prior 30d: 55'', fill: theme.danger, fontSize: 10, position: ''insideTopRight'' }} />
 <Area type="monotone" dataKey="trailing30" stroke={theme.accent} fill="url(#dcGrad)" strokeWidth={2} dot={{ r: 3, fill: theme.accent }} name="Trailing 30d" />
 </AreaChart>
 </ResponsiveContainer>
 </div>
 <MetricNote>Synthesized from pipeline + trailing discovery data · No additional API calls · Prior 30d baseline: week of 2026-01-19</MetricNote>
 </MetricSection>
 );
})()', 'completed', '2026-02-18T07:11:12.185199+00:00', '2026-02-18T07:12:09.967352+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('8785f14f-ccfb-43aa-a739-c785d34a4923', '62983536-af15-44e8-8425-48f84dbff512', '{"overallRate": 41.2, "totalInitiated": 11952, "totalReplied": 4929, "medianReplyHours": 14.7, "p25ReplyHours": 0.8, "p75ReplyHours": 131.8, "monthlyData": [{"month": "Jul", "initiated": 753, "replied": 312, "rate": 41.4}, {"month": "Aug", "initiated": 891, "replied": 345, "rate": 38.7}, {"month": "Sep", "initiated": 824, "replied": 349, "rate": 42.4}, {"month": "Oct", "initiated": 876, "replied": 371, "rate": 42.4}, {"month": "Nov", "initiated": 1042, "replied": 389, "rate": 37.3}, {"month": "Dec", "initiated": 1285, "replied": 498, "rate": 38.8}, {"month": "Jan", "initiated": 943, "replied": 401, "rate": 42.5}, {"month": "Feb", "initiated": 512, "replied": 164, "rate": 32.0}], "repData": [{"rep": "Ross", "initiated": 3185, "replied": 1254, "rate": 39.4}, {"rep": "Kym", "initiated": 2623, "replied": 1131, "rate": 43.1}, {"rep": "Sohrab", "initiated": 1807, "replied": 1012, "rate": 56.0}, {"rep": "David", "initiated": 1602, "replied": 597, "rate": 37.3}, {"rep": "Josh", "initiated": 607, "replied": 370, "rate": 61.0}, {"rep": "James", "initiated": 541, "replied": 186, "rate": 34.4}, {"rep": "Jordan", "initiated": 339, "replied": 133, "rate": 39.2}, {"rep": "Isabelle", "initiated": 122, "replied": 38, "rate": 31.1}, {"rep": "Logan", "initiated": 100, "replied": 44, "rate": 44.0}]}', '(() => {
  const overallRate = 41.2;
  const totalInitiated = 11952;
  const totalReplied = 4929;
  const medianReplyHours = 14.7;
  const monthlyData = [{"month": "Jul", "initiated": 753, "replied": 312, "rate": 41.4}, {"month": "Aug", "initiated": 891, "replied": 345, "rate": 38.7}, {"month": "Sep", "initiated": 824, "replied": 349, "rate": 42.4}, {"month": "Oct", "initiated": 876, "replied": 371, "rate": 42.4}, {"month": "Nov", "initiated": 1042, "replied": 389, "rate": 37.3}, {"month": "Dec", "initiated": 1285, "replied": 498, "rate": 38.8}, {"month": "Jan", "initiated": 943, "replied": 401, "rate": 42.5}, {"month": "Feb", "initiated": 512, "replied": 164, "rate": 32.0}];
  const repData = [{"rep": "Ross", "initiated": 3185, "replied": 1254, "rate": 39.4}, {"rep": "Kym", "initiated": 2623, "replied": 1131, "rate": 43.1}, {"rep": "Sohrab", "initiated": 1807, "replied": 1012, "rate": 56.0}, {"rep": "David", "initiated": 1602, "replied": 597, "rate": 37.3}, {"rep": "Josh", "initiated": 607, "replied": 370, "rate": 61.0}, {"rep": "James", "initiated": 541, "replied": 186, "rate": 34.4}, {"rep": "Jordan", "initiated": 339, "replied": 133, "rate": 39.2}, {"rep": "Isabelle", "initiated": 122, "replied": 38, "rate": 31.1}, {"rep": "Logan", "initiated": 100, "replied": 44, "rate": 44.0}];

  const medianDisplay = medianReplyHours < 24
    ? medianReplyHours.toFixed(1) + ''h''
    : (medianReplyHours / 24).toFixed(1) + ''d'';

  return (
    <MetricSection>
      <MetricRow>
        <StatCard label={''Response Rate''} value={overallRate + ''%''} subtitle={''Deal-linked threads''} />
        <StatCard label={''Median Reply Time''} value={medianDisplay} subtitle={''When they reply''} />
        <StatCard label={''Threads Initiated''} value={totalInitiated.toLocaleString()} subtitle={''Kiingo-sent first''} />
        <StatCard label={''Got Reply''} value={totalReplied.toLocaleString()} subtitle={''External reply received''} />
      </MetricRow>

      <div style={{ height: 280, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Monthly Response Rate</div>
        <ResponsiveContainer width="100%" height="90%">
          <ComposedChart data={monthlyData} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="month" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis yAxisId="left" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis yAxisId="right" orientation="right" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} domain={[0, 60]} unit="%" />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <Legend />
            <Bar yAxisId="left" dataKey="initiated" name="Initiated" fill={theme.accent} opacity={0.25} radius={[4, 4, 0, 0]} />
            <Bar yAxisId="left" dataKey="replied" name="Replied" fill={theme.accent} radius={[4, 4, 0, 0]} />
            <Line yAxisId="right" type="monotone" dataKey="rate" name="Rate %" stroke={theme.danger} strokeWidth={2} dot={{ fill: theme.danger, r: 3 }} />
          </ComposedChart>
        </ResponsiveContainer>
      </div>

      <div style={{ height: 300, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 16 }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Response Rate by Rep</div>
        <ResponsiveContainer width="100%" height="90%">
          <BarChart data={repData} layout="vertical" margin={{ top: 10, right: 30, left: 60, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis type="number" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} domain={[0, 70]} unit="%" />
            <YAxis type="category" dataKey="rep" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} width={70} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} formatter={(v, name, props) => [v + ''% ('' + props.payload.replied + ''/'' + props.payload.initiated + '')'', ''Response Rate'']} />
            <Bar dataKey="rate" name="Response Rate %" fill={theme.accent} radius={[0, 4, 4, 0]} />
          </BarChart>
        </ResponsiveContainer>
      </div>

      <MetricNote>Source: Kiingo CRM Database · Deal-linked email threads · Open deals only</MetricNote>
    </MetricSection>
  );
})()', 'completed', '2026-02-19T00:40:01+00:00', '2026-02-19T00:40:01+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('a966ee86-df22-44c2-9758-c6a93fd3e8aa', '6353801b-e51e-491d-ab5e-a780ed36b62a', '{"currentMonth":-57718.51,"ltmTotal":720695.84,"monthlyData":[{"expenses":28149.03,"grossProfit":54828.75,"month":"Feb ''25","netIncome":26679.72},{"expenses":29008.37,"grossProfit":162336.98,"month":"Mar ''25","netIncome":133328.61},{"expenses":37359.8,"grossProfit":71685.75,"month":"Apr ''25","netIncome":34325.95},{"expenses":34172.47,"grossProfit":93168.75,"month":"May ''25","netIncome":58996.28},{"expenses":51073.14,"grossProfit":113997.91,"month":"Jun ''25","netIncome":62924.77},{"expenses":52371.15,"grossProfit":71083.51,"month":"Jul ''25","netIncome":18712.36},{"expenses":64774.7,"grossProfit":89772.92,"month":"Aug ''25","netIncome":25139.33},{"expenses":74215.28,"grossProfit":234948.41,"month":"Sep ''25","netIncome":161054.1},{"expenses":66572.18,"grossProfit":166139.59,"month":"Oct ''25","netIncome":99889.98},{"expenses":71879.07,"grossProfit":171661.82,"month":"Nov ''25","netIncome":100082.03},{"expenses":97923.15,"grossProfit":87912.2,"month":"Dec ''25","netIncome":-9713.46},{"expenses":87120.32,"grossProfit":96107.81,"month":"Jan ''26","netIncome":9276.17},{"expenses":73871.12,"grossProfit":16143.47,"month":"Feb ''26","netIncome":-57718.51}],"priorMonth":9276.17,"trailing3Avg":33214.91}', '(() => {
 const data = [{"month":"Feb ''25","netIncome":26679.72,"grossProfit":54828.75,"expenses":28149.03},{"month":"Mar ''25","netIncome":133328.61,"grossProfit":162336.98,"expenses":29008.37},{"month":"Apr ''25","netIncome":34325.95,"grossProfit":71685.75,"expenses":37359.8},{"month":"May ''25","netIncome":58996.28,"grossProfit":93168.75,"expenses":34172.47},{"month":"Jun ''25","netIncome":62924.77,"grossProfit":113997.91,"expenses":51073.14},{"month":"Jul ''25","netIncome":18712.36,"grossProfit":71083.51,"expenses":52371.15},{"month":"Aug ''25","netIncome":25139.33,"grossProfit":89772.92,"expenses":64774.7},{"month":"Sep ''25","netIncome":161054.1,"grossProfit":234948.41,"expenses":74215.28},{"month":"Oct ''25","netIncome":99889.98,"grossProfit":166139.59,"expenses":66572.18},{"month":"Nov ''25","netIncome":100082.03,"grossProfit":171661.82,"expenses":71879.07},{"month":"Dec ''25","netIncome":-9713.46,"grossProfit":87912.2,"expenses":97923.15},{"month":"Jan ''26","netIncome":9276.17,"grossProfit":96107.81,"expenses":87120.32},{"month":"Feb ''26","netIncome":-57718.51,"grossProfit":16143.47,"expenses":73871.12}];
 const currentMonth = -57718.51;
 const trailing3Avg = 33214.91;
 const ltmTotal = 720695.84;
 const fmt = (v) => (v < 0 ? ''-$'' : ''$'') + Math.abs(v / 1000).toFixed(0) + ''K'';

 return (
 <MetricSection>
 <MetricRow>
 <StatCard label="This Month" value={fmt(currentMonth)} subtitle="Feb ''26 · In progress" trendDirection="down" />
 <StatCard label="3-Mo Avg" value={fmt(trailing3Avg)} subtitle="Nov ''25 – Jan ''26" />
 <StatCard label="LTM Net Income" value={fmt(ltmTotal)} subtitle="Feb ''25 – Jan ''26" />
 </MetricRow>
 <div style={{ height: 320, background: theme.panel, borderRadius: 16, padding: 20, border: `1px solid ${theme.line}` }}>
 <ResponsiveContainer width="100%" height="100%">
 <AreaChart data={data} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
 <defs>
 <linearGradient id="niGrad" x1="0" y1="0" x2="0" y2="1">
 <stop offset="0%" stopColor={theme.gradientFrom} stopOpacity={0.3} />
 <stop offset="100%" stopColor={theme.gradientFrom} stopOpacity={0.02} />
 </linearGradient>
 </defs>
 <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
 <XAxis dataKey="month" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
 <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} tickFormatter={v => (v < 0 ? ''-$'' : ''$'') + Math.abs(v / 1000).toFixed(0) + ''K''} />
 <Tooltip contentStyle={{ background: theme.tooltipBg, border: `1px solid ${theme.tooltipBorder}`, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} formatter={v => (v < 0 ? ''-$'' : ''$'') + Math.abs(Number(v)).toLocaleString(undefined, { maximumFractionDigits: 0 })} />
 <ReferenceLine y={0} stroke={theme.danger} strokeWidth={1.5} />
 <Area type="monotone" dataKey="netIncome" name="Net Income" stroke={theme.accent} strokeWidth={2.5} fill="url(#niGrad)" dot={{ fill: theme.accent, r: 3, strokeWidth: 0 }} />
 </AreaChart>
 </ResponsiveContainer>
 </div>
 <MetricNote>Source: QuickBooks P&L (Accrual) via Kiingo MCP</MetricNote>
 </MetricSection>
 );
})()', 'completed', '2026-02-18T22:45:33.872469+00:00', '2026-02-18T23:00:21.006825+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('41716d37-cd55-409f-80db-db1f9bc5013a', '65e79c58-154a-5e6d-6a25-ba4610bb1829', '{"avgPerWeek":2.9,"currentWeek":7,"dailyData":[{"count":0,"date":"2025-11-25"},{"count":0,"date":"2025-11-26"},{"count":0,"date":"2025-11-27"},{"count":0,"date":"2025-11-28"},{"count":0,"date":"2025-11-29"},{"count":0,"date":"2025-11-30"},{"count":0,"date":"2025-12-01"},{"count":0,"date":"2025-12-02"},{"count":0,"date":"2025-12-03"},{"count":0,"date":"2025-12-04"},{"count":0,"date":"2025-12-05"},{"count":0,"date":"2025-12-06"},{"count":0,"date":"2025-12-07"},{"count":0,"date":"2025-12-08"},{"count":0,"date":"2025-12-09"},{"count":0,"date":"2025-12-10"},{"count":0,"date":"2025-12-11"},{"count":0,"date":"2025-12-12"},{"count":0,"date":"2025-12-13"},{"count":0,"date":"2025-12-14"},{"count":0,"date":"2025-12-15"},{"count":0,"date":"2025-12-16"},{"count":0,"date":"2025-12-17"},{"count":0,"date":"2025-12-18"},{"count":0,"date":"2025-12-19"},{"count":0,"date":"2025-12-20"},{"count":0,"date":"2025-12-21"},{"count":0,"date":"2025-12-22"},{"count":0,"date":"2025-12-23"},{"count":0,"date":"2025-12-24"},{"count":0,"date":"2025-12-25"},{"count":0,"date":"2025-12-26"},{"count":0,"date":"2025-12-27"},{"count":0,"date":"2025-12-28"},{"count":0,"date":"2025-12-29"},{"count":0,"date":"2025-12-30"},{"count":0,"date":"2025-12-31"},{"count":0,"date":"2026-01-01"},{"count":0,"date":"2026-01-02"},{"count":0,"date":"2026-01-03"},{"count":0,"date":"2026-01-04"},{"count":0,"date":"2026-01-05"},{"count":0,"date":"2026-01-06"},{"count":0,"date":"2026-01-07"},{"count":0,"date":"2026-01-08"},{"count":0,"date":"2026-01-09"},{"count":0,"date":"2026-01-10"},{"count":0,"date":"2026-01-11"},{"count":0,"date":"2026-01-12"},{"count":0,"date":"2026-01-13"},{"count":0,"date":"2026-01-14"},{"count":0,"date":"2026-01-15"},{"count":0,"date":"2026-01-16"},{"count":0,"date":"2026-01-17"},{"count":0,"date":"2026-01-18"},{"count":0,"date":"2026-01-19"},{"count":0,"date":"2026-01-20"},{"count":1,"date":"2026-01-21"},{"count":0,"date":"2026-01-22"},{"count":0,"date":"2026-01-23"},{"count":0,"date":"2026-01-24"},{"count":0,"date":"2026-01-25"},{"count":0,"date":"2026-01-26"},{"count":1,"date":"2026-01-27"},{"count":4,"date":"2026-01-28"},{"count":0,"date":"2026-01-29"},{"count":2,"date":"2026-01-30"},{"count":0,"date":"2026-01-31"},{"count":0,"date":"2026-02-01"},{"count":1,"date":"2026-02-02"},{"count":0,"date":"2026-02-03"},{"count":2,"date":"2026-02-04"},{"count":3,"date":"2026-02-05"},{"count":6,"date":"2026-02-06"},{"count":0,"date":"2026-02-07"},{"count":0,"date":"2026-02-08"},{"count":1,"date":"2026-02-09"},{"count":1,"date":"2026-02-10"},{"count":0,"date":"2026-02-11"},{"count":6,"date":"2026-02-12"},{"count":7,"date":"2026-02-13"},{"count":0,"date":"2026-02-14"},{"count":0,"date":"2026-02-15"},{"count":5,"date":"2026-02-16"},{"count":2,"date":"2026-02-17"}],"priorWeek":15,"total":42,"trend":"increasing","weeklyData":[{"count":0,"weekOf":"2025-11-24"},{"count":0,"weekOf":"2025-12-01"},{"count":0,"weekOf":"2025-12-08"},{"count":0,"weekOf":"2025-12-15"},{"count":0,"weekOf":"2025-12-22"},{"count":0,"weekOf":"2025-12-29"},{"count":0,"weekOf":"2026-01-05"},{"count":0,"weekOf":"2026-01-12"},{"count":1,"weekOf":"2026-01-19"},{"count":7,"weekOf":"2026-01-26"},{"count":12,"weekOf":"2026-02-02"},{"count":15,"weekOf":"2026-02-09"},{"count":7,"weekOf":"2026-02-16"}]}', '<MetricSection title="Weekly Follow-Up Calls">
 {(() => {
 const weeklyData = [{weekOf:''2025-11-24'',count:0,label:''Nov 24''},{weekOf:''2025-12-01'',count:0,label:''Dec 1''},{weekOf:''2025-12-08'',count:0,label:''Dec 8''},{weekOf:''2025-12-15'',count:0,label:''Dec 15''},{weekOf:''2025-12-22'',count:0,label:''Dec 22''},{weekOf:''2025-12-29'',count:0,label:''Dec 29''},{weekOf:''2026-01-05'',count:0,label:''Jan 5''},{weekOf:''2026-01-12'',count:0,label:''Jan 12''},{weekOf:''2026-01-19'',count:1,label:''Jan 19''},{weekOf:''2026-01-26'',count:7,label:''Jan 26''},{weekOf:''2026-02-02'',count:12,label:''Feb 2''},{weekOf:''2026-02-09'',count:15,label:''Feb 9''},{weekOf:''2026-02-16'',count:7,label:''Feb 16*''}];
 return (
 <div>
 <MetricRow>
 <StatCard label="This Week" value={7} subtitle="Mon–Tue (partial)" trend="+7 vs prior" trendDirection="up" />
 <StatCard label="Prior Week" value={15} subtitle="Feb 9–15" />
 <StatCard label="12-Week Total" value={42} subtitle="Since Nov 25" />
 <StatCard label="Avg / Full Week" value="2.9" subtitle="Trailing 12 weeks" trend="Increasing" trendDirection="up" />
 </MetricRow>
 <div style={{ marginTop: 24 }}>
 <div style={{ fontSize: 13, color: theme.inkMuted, marginBottom: 8, fontWeight: 500 }}>Follow-Up Calls by Week (Trailing 12 Weeks)</div>
 <ResponsiveContainer width="100%" height={220}>
 <BarChart data={weeklyData} margin={{ top: 4, right: 16, left: -8, bottom: 0 }}>
 <CartesianGrid stroke={theme.gridStroke} vertical={false} />
 <XAxis dataKey="label" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
 <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} allowDecimals={false} />
 <Tooltip contentStyle={{ background: theme.tooltipBg, border: `1px solid ${theme.tooltipBorder}`, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} formatter={(v, n, p) => [v, p.payload.weekOf === ''2026-02-16'' ? ''Calls (partial week)'' : ''Calls'']} />
 <Bar dataKey="count" radius={[4,4,0,0]}>
 {weeklyData.map((entry, i) => (
 <Cell key={i} fill={entry.weekOf === ''2026-02-16'' ? theme.accentStrong : theme.accent} opacity={entry.weekOf === ''2026-02-16'' ? 0.7 : 1} />
 ))}
 <LabelList dataKey="count" position="top" style={{ fill: theme.inkMuted, fontSize: 11 }} formatter={(v) => v > 0 ? v : ''''} />
 </Bar>
 </BarChart>
 </ResponsiveContainer>
 </div>
 <MetricNote>* Feb 16 week is partial (Mon–Tue only). Trend is strongly increasing — activity ramped from 0 in late Nov/Dec to 15 calls in the Feb 9 week. Consultative calls, Next Steps Workshops, and follow-up engagements with named client accounts are included.</MetricNote>
 </div>
 );
 })()}
</MetricSection>', 'completed', '2026-02-17T18:07:04.301738+00:00', '2026-02-17T18:09:48.273504+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('9f67ead7-48af-4c1f-9c47-12dcdde32dd9', '67f3b504-f1c1-4239-8640-dae49706e583', '{"projects":[{"lastModified":"2026-02-16T14:10:48.127Z","openTasks":16,"priority":"High","project":"Kiingo Command Center"},{"lastModified":"2026-02-12T18:09:12.858Z","openTasks":15,"priority":"High","project":"Kiingo MCP Server"},{"lastModified":"2025-12-15T03:24:12.573Z","openTasks":21,"priority":"Medium","project":"Kiingo Chat"},{"lastModified":"2026-01-11T08:06:03.624Z","openTasks":14,"priority":"Medium","project":"Kiingo Cloud"},{"lastModified":"2026-02-09T17:01:09.108Z","openTasks":6,"priority":"Low","project":"Kiingo Website"},{"lastModified":"2026-02-08T05:46:21.110Z","openTasks":3,"priority":"Low","project":"Engineering - Kiingo Cloud Actions"}],"totalOpenTasks":75}', '(() => { const data = [{project:''Kiingo Command Center'',openTasks:16,priority:''High''},{project:''Kiingo MCP Server'',openTasks:15,priority:''High''},{project:''Kiingo Chat'',openTasks:21,priority:''Medium''},{project:''Kiingo Cloud'',openTasks:14,priority:''Medium''},{project:''Kiingo Website'',openTasks:6,priority:''Low''},{project:''Engineering - Kiingo Cloud Actions'',openTasks:3,priority:''Low''}]; const total = data.reduce((s, d) => s + d.openTasks, 0); return (<MetricSection><StatCard label="Open Engineering Tasks" value={total} subtitle="Across 6 projects" /><div style={{ marginTop: 16 }}>{data.map((d, i) => (<div key={i} style={{ display: ''flex'', alignItems: ''center'', gap: 12, padding: ''10px 12px'', background: i % 2 === 0 ? theme.panel : ''transparent'', borderRadius: 8 }}><span style={{ flex: 1, color: theme.ink, fontSize: 13, fontWeight: 600 }}>{d.project}</span><span style={{ color: theme.inkMuted, fontSize: 12 }}>{d.openTasks} tasks</span><span style={{ fontSize: 11, padding: ''2px 8px'', borderRadius: 4, background: d.priority === ''High'' ? theme.danger : d.priority === ''Medium'' ? theme.accent : theme.inkMuted, color: ''#fff'' }}>{d.priority}</span></div>))}</div><MetricNote>Source: Asana Projects via Kiingo MCP • Last updated {new Date().toLocaleDateString()}</MetricNote></MetricSection>); })()', 'completed', '2026-02-16T23:38:31.381782+00:00', '2026-02-16T23:39:27.819694+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('9f7528fd-b3c8-4f8d-bac9-16dad5ee920f', '6978d569-0b74-452b-b3e7-5de51c90d239', '{"byStage":[{"amount":531190,"count":79,"stage":"Proposal Sent","weighted":265595},{"amount":370747,"count":71,"stage":"On Hold","weighted":37075},{"amount":130747,"count":21,"stage":"Proposal (Upsell)","weighted":65374},{"amount":32850,"count":23,"stage":"Discovery Call","weighted":9855},{"amount":11498,"count":9,"stage":"Cold (Upsell)","weighted":1150},{"amount":7298,"count":27,"stage":"Outreach (Upsell)","weighted":730},{"amount":6698,"count":13,"stage":"On Hold (Upsell)","weighted":670},{"amount":850,"count":3,"stage":"Discovery (Upsell)","weighted":255},{"amount":0,"count":1,"stage":"Lead In (Partner)","weighted":0},{"amount":0,"count":2,"stage":"Discovery (Partner)","weighted":0},{"amount":0,"count":11,"stage":"Requirements (Partner)","weighted":0},{"amount":0,"count":1,"stage":"Proposal (Partner)","weighted":0},{"amount":0,"count":4,"stage":"On Hold (Partner)","weighted":0},{"amount":0,"count":3,"stage":"Free Trial (Partner)","weighted":0}],"closingNextMonth":228249,"closingThisMonth":71294,"dealCount":268,"totalUnweighted":1091878,"totalWeighted":380703}', '(() => {
 const data = [
 { stage: ''Proposal Sent'', count: 79, amount: 531190, weighted: 265595 },
 { stage: ''On Hold'', count: 71, amount: 370747, weighted: 37075 },
 { stage: ''Proposal (Upsell)'', count: 21, amount: 130747, weighted: 65374 },
 { stage: ''Discovery Call'', count: 23, amount: 32850, weighted: 9855 },
 { stage: ''Cold (Upsell)'', count: 9, amount: 11498, weighted: 1150 },
 { stage: ''Outreach (Upsell)'', count: 27, amount: 7298, weighted: 730 },
 { stage: ''On Hold (Upsell)'', count: 13, amount: 6698, weighted: 670 },
 { stage: ''Discovery (Upsell)'', count: 3, amount: 850, weighted: 255 },
 { stage: ''Requirements (Partner)'', count: 11, amount: 0, weighted: 0 },
 { stage: ''Free Trial (Partner)'', count: 3, amount: 0, weighted: 0 },
 { stage: ''On Hold (Partner)'', count: 4, amount: 0, weighted: 0 },
 { stage: ''Discovery (Partner)'', count: 2, amount: 0, weighted: 0 },
 { stage: ''Proposal (Partner)'', count: 1, amount: 0, weighted: 0 },
 { stage: ''Lead In (Partner)'', count: 1, amount: 0, weighted: 0 },
 ];
 const totalUnweighted = 1091878;
 const totalWeighted = 380703;
 const dealCount = 268;
 const closingThisMonth = 71294;
 const closingNextMonth = 228249;
 const chartData = data.filter(d => d.amount > 0);

 return (
 <MetricSection>
 <MetricRow>
 <StatCard label="Open Pipeline" value={''$'' + (totalUnweighted / 1000).toFixed(0) + ''K''} subtitle={dealCount + '' deals''} />
 <StatCard label="Weighted Pipeline" value={''$'' + (totalWeighted / 1000).toFixed(0) + ''K''} subtitle="Probability-adjusted" />
 <StatCard label="Closing This Month" value={''$'' + (closingThisMonth / 1000).toFixed(0) + ''K''} subtitle="Feb 2026" />
 <StatCard label="Closing Next Month" value={''$'' + (closingNextMonth / 1000).toFixed(0) + ''K''} subtitle="Mar 2026" />
 </MetricRow>
 <div style={{ height: 320, background: theme.panel, borderRadius: 16, padding: ''20px 20px 20px 20px'', border: `1px solid ${theme.line}` }}>
 <ResponsiveContainer width="100%" height="100%">
 <BarChart data={chartData} layout="vertical" margin={{ top: 5, right: 60, left: 130, bottom: 5 }}>
 <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} horizontal={false} />
 <XAxis type="number" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} tickFormatter={v => ''$'' + (v / 1000).toFixed(0) + ''K''} />
 <YAxis type="category" dataKey="stage" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} width={125} />
 <Tooltip
 contentStyle={{ background: theme.tooltipBg, border: `1px solid ${theme.tooltipBorder}`, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }}
 formatter={(v, name) => [''$'' + Number(v).toLocaleString(), name]}
 />
 <Legend wrapperStyle={{ fontSize: 12, color: theme.inkMuted }} />
 <Bar dataKey="amount" name="Pipeline Value" fill={theme.accent} radius={[0, 4, 4, 0]}>
 <LabelList dataKey="count" position="right" style={{ fill: theme.inkMuted, fontSize: 11 }} formatter={v => v + '' deals''} />
 </Bar>
 <Bar dataKey="weighted" name="Weighted Value" fill={theme.accentStrong} radius={[0, 4, 4, 0]} opacity={0.7} />
 </BarChart>
 </ResponsiveContainer>
 </div>
 <MetricNote>Open sales deals across New Business, Upsells &amp; Partnership pipelines · Source: HubSpot CRM via Kiingo MCP · As of Feb 17, 2026</MetricNote>
 </MetricSection>
 );
})()', 'completed', '2026-02-17T18:22:46.041617+00:00', '2026-02-17T18:24:44.948310+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('eb1ec21e-536a-4372-8735-0785171334c8', '6ca5270a-b1c7-4646-bc2f-f0e0d78e61f0', '{"totalWon": 349, "uniqueCompanies": 142, "growthMultiple": 5.2, "lastMonthWon": 30, "monthlyData": [{"month": "Sep ''24", "won": 2}, {"month": "Oct ''24", "won": 5}, {"month": "Nov ''24", "won": 8}, {"month": "Dec ''24", "won": 10}, {"month": "Jan ''25", "won": 14}, {"month": "Feb ''25", "won": 22}, {"month": "Mar ''25", "won": 18}, {"month": "Apr ''25", "won": 20}, {"month": "May ''25", "won": 24}, {"month": "Jun ''25", "won": 22}, {"month": "Jul ''25", "won": 18}, {"month": "Aug ''25", "won": 20}, {"month": "Sep ''25", "won": 26}, {"month": "Oct ''25", "won": 32}, {"month": "Nov ''25", "won": 28}, {"month": "Dec ''25", "won": 24}, {"month": "Jan ''26", "won": 30}, {"month": "Feb ''26", "won": 18}], "monthlyByType": [{"month": "Sep ''24", "foundational": 2, "private": 0, "agents": 0, "specialized": 0}, {"month": "Oct ''24", "foundational": 4, "private": 1, "agents": 0, "specialized": 0}, {"month": "Nov ''24", "foundational": 6, "private": 2, "agents": 0, "specialized": 0}, {"month": "Dec ''24", "foundational": 7, "private": 3, "agents": 0, "specialized": 0}, {"month": "Jan ''25", "foundational": 10, "private": 3, "agents": 1, "specialized": 0}, {"month": "Feb ''25", "foundational": 14, "private": 5, "agents": 2, "specialized": 1}, {"month": "Mar ''25", "foundational": 12, "private": 4, "agents": 1, "specialized": 1}, {"month": "Apr ''25", "foundational": 12, "private": 4, "agents": 2, "specialized": 2}, {"month": "May ''25", "foundational": 14, "private": 5, "agents": 3, "specialized": 2}, {"month": "Jun ''25", "foundational": 12, "private": 5, "agents": 3, "specialized": 2}, {"month": "Jul ''25", "foundational": 10, "private": 4, "agents": 2, "specialized": 2}, {"month": "Aug ''25", "foundational": 12, "private": 4, "agents": 2, "specialized": 2}, {"month": "Sep ''25", "foundational": 16, "private": 5, "agents": 3, "specialized": 2}, {"month": "Oct ''25", "foundational": 18, "private": 6, "agents": 4, "specialized": 4}, {"month": "Nov ''25", "foundational": 16, "private": 5, "agents": 4, "specialized": 3}, {"month": "Dec ''25", "foundational": 14, "private": 4, "agents": 3, "specialized": 3}, {"month": "Jan ''26", "foundational": 18, "private": 5, "agents": 4, "specialized": 3}, {"month": "Feb ''26", "foundational": 10, "private": 4, "agents": 2, "specialized": 2}]}', '(() => {
  const totalWon = 349;
  const uniqueCompanies = 142;
  const growthMultiple = 5.2;
  const lastMonthWon = 30;
  const monthlyData = [{"month": "Sep ''24", "won": 2}, {"month": "Oct ''24", "won": 5}, {"month": "Nov ''24", "won": 8}, {"month": "Dec ''24", "won": 10}, {"month": "Jan ''25", "won": 14}, {"month": "Feb ''25", "won": 22}, {"month": "Mar ''25", "won": 18}, {"month": "Apr ''25", "won": 20}, {"month": "May ''25", "won": 24}, {"month": "Jun ''25", "won": 22}, {"month": "Jul ''25", "won": 18}, {"month": "Aug ''25", "won": 20}, {"month": "Sep ''25", "won": 26}, {"month": "Oct ''25", "won": 32}, {"month": "Nov ''25", "won": 28}, {"month": "Dec ''25", "won": 24}, {"month": "Jan ''26", "won": 30}, {"month": "Feb ''26", "won": 18}];
  const monthlyByType = [{"month": "Sep ''24", "foundational": 2, "private": 0, "agents": 0, "specialized": 0}, {"month": "Oct ''24", "foundational": 4, "private": 1, "agents": 0, "specialized": 0}, {"month": "Nov ''24", "foundational": 6, "private": 2, "agents": 0, "specialized": 0}, {"month": "Dec ''24", "foundational": 7, "private": 3, "agents": 0, "specialized": 0}, {"month": "Jan ''25", "foundational": 10, "private": 3, "agents": 1, "specialized": 0}, {"month": "Feb ''25", "foundational": 14, "private": 5, "agents": 2, "specialized": 1}, {"month": "Mar ''25", "foundational": 12, "private": 4, "agents": 1, "specialized": 1}, {"month": "Apr ''25", "foundational": 12, "private": 4, "agents": 2, "specialized": 2}, {"month": "May ''25", "foundational": 14, "private": 5, "agents": 3, "specialized": 2}, {"month": "Jun ''25", "foundational": 12, "private": 5, "agents": 3, "specialized": 2}, {"month": "Jul ''25", "foundational": 10, "private": 4, "agents": 2, "specialized": 2}, {"month": "Aug ''25", "foundational": 12, "private": 4, "agents": 2, "specialized": 2}, {"month": "Sep ''25", "foundational": 16, "private": 5, "agents": 3, "specialized": 2}, {"month": "Oct ''25", "foundational": 18, "private": 6, "agents": 4, "specialized": 4}, {"month": "Nov ''25", "foundational": 16, "private": 5, "agents": 4, "specialized": 3}, {"month": "Dec ''25", "foundational": 14, "private": 4, "agents": 3, "specialized": 3}, {"month": "Jan ''26", "foundational": 18, "private": 5, "agents": 4, "specialized": 3}, {"month": "Feb ''26", "foundational": 10, "private": 4, "agents": 2, "specialized": 2}];

  return (
    <MetricSection>
      <MetricRow>
        <StatCard label={''Deals Won''} value={totalWon} subtitle={''All bootcamp types''} />
        <StatCard label={''Unique Companies''} value={uniqueCompanies} subtitle={''Distinct clients''} />
        <StatCard label={''Growth''} value={growthMultiple + ''x''} subtitle={''First 3mo → last 3mo''} />
        <StatCard label={''Last Month''} value={lastMonthWon} subtitle={''Deals closed''} />
      </MetricRow>

      <div style={{ height: 280, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Monthly Bootcamp Deals Won</div>
        <ResponsiveContainer width="100%" height="90%">
          <AreaChart data={monthlyData} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <defs>
              <linearGradient id="bootcampVolGrad" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stopColor={theme.accent} stopOpacity={0.2} />
                <stop offset="100%" stopColor={theme.accent} stopOpacity={0.02} />
              </linearGradient>
            </defs>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="month" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <Area type="monotone" dataKey="won" name="Deals Won" stroke={theme.accent} strokeWidth={2} fill="url(#bootcampVolGrad)" dot={{ fill: theme.accent, r: 3 }} />
          </AreaChart>
        </ResponsiveContainer>
      </div>

      <div style={{ height: 280, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 16 }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>By Bootcamp Type</div>
        <ResponsiveContainer width="100%" height="90%">
          <BarChart data={monthlyByType} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="month" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <Legend />
            <Bar dataKey="foundational" name="AI Foundational" stackId="a" fill={theme.accent} />
            <Bar dataKey="private" name="Private" stackId="a" fill={theme.secondary} />
            <Bar dataKey="agents" name="AI Agents" stackId="a" fill="#eab308" />
            <Bar dataKey="specialized" name="Specialized" stackId="a" fill="#16a34a" radius={[4, 4, 0, 0]} />
          </BarChart>
        </ResponsiveContainer>
      </div>

      <MetricNote>Source: Kiingo CRM · Closed-won bootcamp deals · Sep 2024 - present</MetricNote>
    </MetricSection>
  );
})()', 'completed', '2026-02-19T01:15:02+00:00', '2026-02-19T01:15:02+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('07f743c8-bdb5-4037-9396-0ae8f1206d5f', '77eea407-0b3b-4c26-b833-b6544381e98b', '{"monthlyLeads": [{"month": "Mar 25", "count": 45}, {"month": "Apr 25", "count": 52}, {"month": "May 25", "count": 38}, {"month": "Jun 25", "count": 61}, {"month": "Jul 25", "count": 42}, {"month": "Aug 25", "count": 55}, {"month": "Sep 25", "count": 78}, {"month": "Oct 25", "count": 65}, {"month": "Nov 25", "count": 58}, {"month": "Dec 25", "count": 35}, {"month": "Jan 26", "count": 72}, {"month": "Feb 26", "count": 48}], "totalLeads": 649}', '(() => {
  const monthly = [{"month":"Mar 25","count":45},{"month":"Apr 25","count":52},{"month":"May 25","count":38},{"month":"Jun 25","count":61},{"month":"Jul 25","count":42},{"month":"Aug 25","count":55},{"month":"Sep 25","count":78},{"month":"Oct 25","count":65},{"month":"Nov 25","count":58},{"month":"Dec 25","count":35},{"month":"Jan 26","count":72},{"month":"Feb 26","count":48}];
  const total = 649;
  return (
    <MetricSection>
      <StatCard label="LTM New Leads" value={total} subtitle="Last 12 months" />
      <div style={{ height: 250, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
        <ResponsiveContainer width="100%" height="100%">
          <BarChart data={monthly} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="month" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <Bar dataKey="count" name="New Leads" fill={theme.accent} radius={[4,4,0,0]} />
          </BarChart>
        </ResponsiveContainer>
      </div>
      <MetricNote>Source: HubSpot Contacts via Kiingo MCP</MetricNote>
    </MetricSection>
  );
})()', 'completed', '2026-02-15T06:29:29+00:00', '2026-02-15T06:29:29+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('eb6f72af-4132-4ca3-be14-5bfce4f80774', '7c765544-15a4-4c66-a458-1f5db331f2f8', '{"avgTrailing":43,"byMonth":{"2025-09":13,"2025-10":47,"2025-11":42,"2025-12":33,"2026-01":63,"2026-02":32},"peak":{"value":68,"week":"2026-02-08"},"total":230,"trailing30":64,"trough":{"value":22,"week":"2026-01-11"},"weeklyData":[{"trailing30":5,"weekOf":"2025-09-22"},{"trailing30":11,"weekOf":"2025-09-29"},{"trailing30":18,"weekOf":"2025-10-06"},{"trailing30":26,"weekOf":"2025-10-13"},{"trailing30":37,"weekOf":"2025-10-20"},{"trailing30":44,"weekOf":"2025-10-27"},{"trailing30":50,"weekOf":"2025-11-03"},{"trailing30":52,"weekOf":"2025-11-10"},{"trailing30":51,"weekOf":"2025-11-17"},{"trailing30":48,"weekOf":"2025-11-24"},{"trailing30":46,"weekOf":"2025-12-01"},{"trailing30":43,"weekOf":"2025-12-08"},{"trailing30":39,"weekOf":"2025-12-15"},{"trailing30":35,"weekOf":"2025-12-22"},{"trailing30":30,"weekOf":"2025-12-29"},{"trailing30":26,"weekOf":"2026-01-05"},{"trailing30":22,"weekOf":"2026-01-11"},{"trailing30":32,"weekOf":"2026-01-18"},{"trailing30":47,"weekOf":"2026-01-25"},{"trailing30":57,"weekOf":"2026-02-01"},{"trailing30":68,"weekOf":"2026-02-08"},{"trailing30":64,"weekOf":"2026-02-15"}]}', '(() => {
 const data = [{"week":"Sep 22","value":5},{"week":"Sep 29","value":11},{"week":"Oct 6","value":18},{"week":"Oct 13","value":26},{"week":"Oct 20","value":37},{"week":"Oct 27","value":44},{"week":"Nov 3","value":50},{"week":"Nov 10","value":52},{"week":"Nov 17","value":51},{"week":"Nov 24","value":48},{"week":"Dec 1","value":46},{"week":"Dec 8","value":43},{"week":"Dec 15","value":39},{"week":"Dec 22","value":35},{"week":"Dec 29","value":30},{"week":"Jan 5","value":26},{"week":"Jan 11","value":22},{"week":"Jan 18","value":32},{"week":"Jan 25","value":47},{"week":"Feb 1","value":57},{"week":"Feb 8","value":68},{"week":"Feb 15","value":64}];
 const current = 64;
 const peak = 68;
 const trough = 22;
 const avgValue = 43;

 return (
 <MetricSection>
 <MetricRow>
 <StatCard label="Current" value={current} subtitle="Trailing 30d" />
 <StatCard label="Peak" value={peak} subtitle="Best week" />
 <StatCard label="Trough" value={trough} subtitle="Lowest week" />
 </MetricRow>
 <div style={{ height: 320, background: theme.panel, borderRadius: 16, padding: 20, border: `1px solid ${theme.line}` }}>
 <ResponsiveContainer width="100%" height="100%">
 <AreaChart data={data} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
 <defs>
 <linearGradient id="leadGradient" x1="0" y1="0" x2="0" y2="1">
 <stop offset="0%" stopColor={theme.gradientFrom} stopOpacity={0.3} />
 <stop offset="100%" stopColor={theme.gradientFrom} stopOpacity={0.02} />
 </linearGradient>
 </defs>
 <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
 <XAxis dataKey="week" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} interval={2} />
 <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} domain={[0, ''auto'']} />
 <Tooltip contentStyle={{ background: theme.tooltipBg, border: `1px solid ${theme.tooltipBorder}`, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
 <ReferenceLine y={avgValue} stroke={theme.line} strokeDasharray="6 4" />
 <Area type="monotone" dataKey="value" stroke={theme.accent} strokeWidth={2.5} fill="url(#leadGradient)" dot={{ fill: theme.accent, r: 3, strokeWidth: 0 }} activeDot={{ fill: theme.accentStrong, r: 5, strokeWidth: 2, stroke: theme.line }} />
 </AreaChart>
 </ResponsiveContainer>
 </div>
 <MetricNote>Each point = trailing 30-day leads · Source: HubSpot CRM via Kiingo MCP</MetricNote>
 </MetricSection>
 );
})()', 'completed', '2026-02-16T22:43:36.929875+00:00', '2026-02-16T22:44:28.407545+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('6c4b1746-7895-448e-8d57-6ef64dea2441', '7fca257d-0bd2-4d86-af90-a1a8df626d5c', '{"avgMoMGrowth":15.01,"latestGrowth":65.51,"monthlyGrowth":[{"growth":-42.28,"month":"2025-02"},{"growth":116.97,"month":"2025-03"},{"growth":-44.11,"month":"2025-04"},{"growth":17.94,"month":"2025-05"},{"growth":11.42,"month":"2025-06"},{"growth":-29.22,"month":"2025-07"},{"growth":16.02,"month":"2025-08"},{"growth":129.93,"month":"2025-09"},{"growth":-25.04,"month":"2025-10"},{"growth":4.67,"month":"2025-11"},{"growth":-41.73,"month":"2025-12"},{"growth":65.51,"month":"2026-01"}]}', '(() => {
 const data = [{"month":"Feb ''25","growth":-42.28},{"month":"Mar ''25","growth":116.97},{"month":"Apr ''25","growth":-44.11},{"month":"May ''25","growth":17.94},{"month":"Jun ''25","growth":11.42},{"month":"Jul ''25","growth":-29.22},{"month":"Aug ''25","growth":16.02},{"month":"Sep ''25","growth":129.93},{"month":"Oct ''25","growth":-25.04},{"month":"Nov ''25","growth":4.67},{"month":"Dec ''25","growth":-41.73},{"month":"Jan ''26","growth":65.51}];
 const avg = 15.01;
 const latest = 65.51;
 return (
 <MetricSection title="Revenue Growth Rate">
 <MetricRow>
 <StatCard label="Avg MoM Growth" value={avg.toFixed(1) + ''%''} subtitle="Trailing 12 months" trend="+15.0%" trendDirection="up" />
 <StatCard label="Latest MoM Growth" value={latest.toFixed(1) + ''%''} subtitle="Jan ''26 vs Dec ''25" trend="+65.5%" trendDirection="up" />
 </MetricRow>
 <div style={{ height: 280, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
 <ResponsiveContainer width="100%" height="100%">
 <BarChart data={data} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
 <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
 <XAxis dataKey="month" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
 <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} tickFormatter={v => v + ''%''} />
 <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} formatter={v => Number(v).toFixed(1) + ''%''} />
 <ReferenceLine y={0} stroke={theme.danger} strokeWidth={1} strokeDasharray="4 2" />
 <Bar dataKey="growth" name="MoM Growth" radius={[4,4,0,0]}>
 {data.map((entry, index) => (
 <Cell key={index} fill={entry.growth >= 0 ? theme.accent : theme.danger} />
 ))}
 </Bar>
 </BarChart>
 </ResponsiveContainer>
 </div>
 <MetricNote>Source: QuickBooks invoices · 668 invoices · Jan 2025 – Jan 2026</MetricNote>
 </MetricSection>
 );
})()', 'completed', '2026-02-18T22:45:35.264423+00:00', '2026-02-18T22:57:39.732772+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('5df46984-0a5d-41b5-8be6-ea79517bb731', '8123728e-8c27-4272-9123-ca9b8cda9ddb', '{"generatedAt": "2/18/2026", "totalOpenDeals": 58, "withDiscovery": 51, "withoutDiscovery": 7, "likelyCold": 2, "overdueFollowUps": 37, "followUpNeeded": 0, "avgDaysSinceContact": 39.6, "followUpRanges": [{"range": "0-3d", "healthy": 3, "warning": 0, "danger": 0}, {"range": "3-7d", "healthy": 8, "warning": 0, "danger": 0}, {"range": "7-14d", "healthy": 0, "warning": 5, "danger": 0}, {"range": "14-30d", "healthy": 0, "warning": 9, "danger": 0}, {"range": "30-60d", "healthy": 0, "warning": 0, "danger": 10}, {"range": "60-90d", "healthy": 0, "warning": 0, "danger": 16}, {"range": "90-180d", "healthy": 0, "warning": 0, "danger": 1}, {"range": "180+d", "healthy": 0, "warning": 0, "danger": 6}], "repBreakdown": [{"rep": "kym", "totalDeals": 23, "active": 22, "likelyCold": 1, "coldPct": 4.3}, {"rep": "ross", "totalDeals": 10, "active": 10, "likelyCold": 0, "coldPct": 0}, {"rep": "josh", "totalDeals": 6, "active": 6, "likelyCold": 0, "coldPct": 0}, {"rep": "david", "totalDeals": 4, "active": 3, "likelyCold": 1, "coldPct": 25.0}, {"rep": "michael", "totalDeals": 4, "active": 4, "likelyCold": 0, "coldPct": 0}, {"rep": "james", "totalDeals": 3, "active": 3, "likelyCold": 0, "coldPct": 0}, {"rep": "jordan", "totalDeals": 2, "active": 2, "likelyCold": 0, "coldPct": 0}, {"rep": "jess", "totalDeals": 1, "active": 1, "likelyCold": 0, "coldPct": 0}]}', '(() => {
  const totalOpenDeals = 58;
  const likelyCold = 2;
  const overdueFollowUps = 37;
  const avgDays = 39.6;
  const followUpRanges = [{"range": "0-3d", "healthy": 3, "warning": 0, "danger": 0}, {"range": "3-7d", "healthy": 8, "warning": 0, "danger": 0}, {"range": "7-14d", "healthy": 0, "warning": 5, "danger": 0}, {"range": "14-30d", "healthy": 0, "warning": 9, "danger": 0}, {"range": "30-60d", "healthy": 0, "warning": 0, "danger": 10}, {"range": "60-90d", "healthy": 0, "warning": 0, "danger": 16}, {"range": "90-180d", "healthy": 0, "warning": 0, "danger": 1}, {"range": "180+d", "healthy": 0, "warning": 0, "danger": 6}];
  const repBreakdown = [{"rep": "kym", "totalDeals": 23, "active": 22, "likelyCold": 1, "coldPct": 4.3}, {"rep": "ross", "totalDeals": 10, "active": 10, "likelyCold": 0, "coldPct": 0}, {"rep": "josh", "totalDeals": 6, "active": 6, "likelyCold": 0, "coldPct": 0}, {"rep": "david", "totalDeals": 4, "active": 3, "likelyCold": 1, "coldPct": 25.0}, {"rep": "michael", "totalDeals": 4, "active": 4, "likelyCold": 0, "coldPct": 0}, {"rep": "james", "totalDeals": 3, "active": 3, "likelyCold": 0, "coldPct": 0}, {"rep": "jordan", "totalDeals": 2, "active": 2, "likelyCold": 0, "coldPct": 0}, {"rep": "jess", "totalDeals": 1, "active": 1, "likelyCold": 0, "coldPct": 0}];
  const generatedAt = "2/18/2026";

  return (
    <MetricSection>
      <MetricRow>
        <StatCard label={''Open Deals''} value={totalOpenDeals} subtitle={''Total pipeline''} />
        <StatCard label={''Likely Cold''} value={likelyCold} subtitle={((likelyCold / totalOpenDeals) * 100).toFixed(0) + ''% of pipeline''} />
        <StatCard label={''Overdue >14d''} value={overdueFollowUps} subtitle={((overdueFollowUps / totalOpenDeals) * 100).toFixed(0) + ''% of deals''} />
        <StatCard label={''Avg Days Since Contact''} value={avgDays.toFixed(1)} subtitle={''Lower is better''} />
      </MetricRow>

      <div style={{ height: 300, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Follow-Up Range Distribution</div>
        <ResponsiveContainer width="100%" height="90%">
          <BarChart data={followUpRanges} margin={{ top: 10, right: 10, left: 0, bottom: 40 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="range" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} angle={-25} textAnchor="end" />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <Legend />
            <Bar dataKey="healthy" name="Healthy (0-7d)" stackId="a" fill="#16a34a" radius={[0, 0, 0, 0]} />
            <Bar dataKey="warning" name="Needs Attention (7-30d)" stackId="a" fill="#eab308" radius={[0, 0, 0, 0]} />
            <Bar dataKey="danger" name="At Risk (30d+)" stackId="a" fill={theme.danger} radius={[4, 4, 0, 0]} />
          </BarChart>
        </ResponsiveContainer>
      </div>

      <div style={{ height: 280, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 16 }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Ops Rep Follow-Up Health</div>
        <ResponsiveContainer width="100%" height="90%">
          <BarChart data={repBreakdown} layout="vertical" margin={{ top: 10, right: 30, left: 60, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis type="number" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis type="category" dataKey="rep" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} width={55} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <Legend />
            <Bar dataKey="active" name="Active" stackId="a" fill={theme.accent} radius={[0, 0, 0, 0]} />
            <Bar dataKey="likelyCold" name="Likely Cold" stackId="a" fill={theme.danger} radius={[0, 4, 4, 0]} />
          </BarChart>
        </ResponsiveContainer>
      </div>

      <MetricNote>Source: CRM SharePoint · OPS Follow-Up Metrics Report · {generatedAt}</MetricNote>
    </MetricSection>
  );
})()', 'completed', '2026-02-18T23:55:55+00:00', '2026-02-18T23:55:55+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('2c10d8a2-1fd1-4e96-abcd-6db82f7f4212', '88f549cc-6893-4c42-a595-948290e6510f', '{"weeks": [{"week": "1/1", "leads": 25, "newsletterRate": 52.95, "newsletterCtr": null, "webinarSignups": 42, "organicVisitors": null, "pageViews": null, "linkedinRoss": 2.6, "linkedinKiingo": 11.32}, {"week": "1/12", "leads": null, "newsletterRate": 55.65, "newsletterCtr": 4.1, "webinarSignups": 80, "organicVisitors": 73, "pageViews": 530, "linkedinRoss": 2.17, "linkedinKiingo": 2.39}, {"week": "1/19", "leads": 38, "newsletterRate": 57.36, "newsletterCtr": 3.99, "webinarSignups": null, "organicVisitors": 172, "pageViews": 813, "linkedinRoss": 0.0, "linkedinKiingo": 5.67}, {"week": "1/26", "leads": 54, "newsletterRate": 57.38, "newsletterCtr": 0.9, "webinarSignups": null, "organicVisitors": 181, "pageViews": 946, "linkedinRoss": 1.61, "linkedinKiingo": 7.78}, {"week": "2/2", "leads": 66, "newsletterRate": 58.28, "newsletterCtr": 2.9, "webinarSignups": 29, "organicVisitors": 172, "pageViews": 890, "linkedinRoss": 4.6, "linkedinKiingo": 6.67}, {"week": "2/9", "leads": 77, "newsletterRate": 54.03, "newsletterCtr": 4.0, "webinarSignups": 73, "organicVisitors": 175, "pageViews": 907, "linkedinRoss": 3.89, "linkedinKiingo": 9.35}, {"week": "2/16", "leads": null, "newsletterRate": null, "newsletterCtr": null, "webinarSignups": null, "organicVisitors": null, "pageViews": null, "linkedinRoss": null, "linkedinKiingo": null}], "latestWeek": "2/9", "latestLeads": 77, "latestNewsletter": 54.03, "latestWebinar": 73, "latestOrganic": 175, "latestPageViews": 907}', '(() => {
  const weeks = [{"week": "1/1", "leads": 25, "newsletterRate": 52.95, "newsletterCtr": null, "webinarSignups": 42, "organicVisitors": null, "pageViews": null, "linkedinRoss": 2.6, "linkedinKiingo": 11.32}, {"week": "1/12", "leads": null, "newsletterRate": 55.65, "newsletterCtr": 4.1, "webinarSignups": 80, "organicVisitors": 73, "pageViews": 530, "linkedinRoss": 2.17, "linkedinKiingo": 2.39}, {"week": "1/19", "leads": 38, "newsletterRate": 57.36, "newsletterCtr": 3.99, "webinarSignups": null, "organicVisitors": 172, "pageViews": 813, "linkedinRoss": 0.0, "linkedinKiingo": 5.67}, {"week": "1/26", "leads": 54, "newsletterRate": 57.38, "newsletterCtr": 0.9, "webinarSignups": null, "organicVisitors": 181, "pageViews": 946, "linkedinRoss": 1.61, "linkedinKiingo": 7.78}, {"week": "2/2", "leads": 66, "newsletterRate": 58.28, "newsletterCtr": 2.9, "webinarSignups": 29, "organicVisitors": 172, "pageViews": 890, "linkedinRoss": 4.6, "linkedinKiingo": 6.67}, {"week": "2/9", "leads": 77, "newsletterRate": 54.03, "newsletterCtr": 4.0, "webinarSignups": 73, "organicVisitors": 175, "pageViews": 907, "linkedinRoss": 3.89, "linkedinKiingo": 9.35}, {"week": "2/16", "leads": null, "newsletterRate": null, "newsletterCtr": null, "webinarSignups": null, "organicVisitors": null, "pageViews": null, "linkedinRoss": null, "linkedinKiingo": null}];
  const latestWeek = "2/9";
  const latestLeads = 77;
  const latestNewsletter = 54.03;
  const latestWebinar = 73;
  const latestOrganic = 175;
  const latestPageViews = 907;

  const validWeeks = weeks.filter(w => w.leads != null || w.organicVisitors != null);

  return (
    <MetricSection>
      <MetricRow>
        <StatCard label={''Leads (30d)''} value={latestLeads || ''—''} subtitle={''Week of '' + latestWeek} />
        <StatCard label={''Newsletter Open''} value={latestNewsletter ? latestNewsletter + ''%'' : ''—''} subtitle={''Open rate''} />
        <StatCard label={''Webinar Signups''} value={latestWebinar || ''—''} subtitle={''Latest week''} />
        <StatCard label={''Organic Visitors''} value={latestOrganic || ''—''} subtitle={''Trailing 30 days''} />
      </MetricRow>

      <div style={{ height: 280, background: theme.panel, borderRadius: 16, padding: 20, border: ''1px solid '' + theme.line }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Leads & Organic Traffic</div>
        <ResponsiveContainer width="100%" height="90%">
          <ComposedChart data={validWeeks} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="week" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <Legend />
            <Bar dataKey="leads" name="Leads" fill={theme.accent} radius={[4, 4, 0, 0]} />
            <Line type="monotone" dataKey="organicVisitors" name="Organic Visitors" stroke="#16a34a" strokeWidth={2} dot={{ fill: ''#16a34a'', r: 3 }} />
          </ComposedChart>
        </ResponsiveContainer>
      </div>

      <div style={{ display: ''grid'', gridTemplateColumns: ''1fr 1fr'', gap: 16, marginTop: 16 }}>
        <div style={{ height: 260, background: theme.panel, borderRadius: 16, padding: 16, border: ''1px solid '' + theme.line }}>
          <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Newsletter Open Rate %</div>
          <ResponsiveContainer width="100%" height="85%">
            <LineChart data={validWeeks.filter(w => w.newsletterRate != null)} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
              <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
              <XAxis dataKey="week" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} />
              <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} tickFormatter={(v) => v + ''%''} domain={[40, 65]} />
              <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 12 }} formatter={(v) => [v + ''%'', ''Open Rate'']} />
              <Line type="monotone" dataKey="newsletterRate" stroke={theme.accent} strokeWidth={2} dot={{ fill: theme.accent, r: 4 }} />
            </LineChart>
          </ResponsiveContainer>
        </div>

        <div style={{ height: 260, background: theme.panel, borderRadius: 16, padding: 16, border: ''1px solid '' + theme.line }}>
          <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Website Page Views (30d)</div>
          <ResponsiveContainer width="100%" height="85%">
            <AreaChart data={validWeeks.filter(w => w.pageViews != null && w.pageViews > 0)} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
              <defs>
                <linearGradient id="mktgPvGrad" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0%" stopColor="#8b5cf6" stopOpacity={0.15} />
                  <stop offset="100%" stopColor="#8b5cf6" stopOpacity={0.02} />
                </linearGradient>
              </defs>
              <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
              <XAxis dataKey="week" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} />
              <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} />
              <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 12 }} formatter={(v) => [v.toLocaleString(), ''Page Views'']} />
              <Area type="monotone" dataKey="pageViews" stroke="#8b5cf6" strokeWidth={2} fill="url(#mktgPvGrad)" />
            </AreaChart>
          </ResponsiveContainer>
        </div>
      </div>

      <div style={{ height: 260, background: theme.panel, borderRadius: 16, padding: 16, marginTop: 16, border: ''1px solid '' + theme.line }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>LinkedIn Engagement Rate %</div>
        <ResponsiveContainer width="100%" height="85%">
          <LineChart data={validWeeks.filter(w => w.linkedinRoss != null)} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="week" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} tickFormatter={(v) => v + ''%''} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 12 }} formatter={(v) => [v + ''%'']} />
            <Legend />
            <Line type="monotone" dataKey="linkedinRoss" name="Ross" stroke={theme.accent} strokeWidth={2} dot={{ fill: theme.accent, r: 3 }} />
            <Line type="monotone" dataKey="linkedinKiingo" name="Kiingo" stroke={theme.secondary} strokeWidth={2} dot={{ fill: theme.secondary, r: 3 }} />
          </LineChart>
        </ResponsiveContainer>
      </div>

      <MetricNote>Source: Notion Leadership Team · Sales/Marketing Scorecard</MetricNote>
    </MetricSection>
  );
})()', 'completed', '2026-02-18T01:06:32+00:00', '2026-02-18T01:06:32+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('67cf5a31-e264-427e-afa8-50ac86edb4ec', '93ba384c-b172-4072-9e74-c4705f38c349', '{"bestMonth":{"amount":369676,"month":"Oct ''25"},"currentMonth":144899,"monthlyData":[{"amount":19420,"count":5,"month":"Jun ''25"},{"amount":25387,"count":10,"month":"Jul ''25"},{"amount":106600,"count":33,"month":"Aug ''25"},{"amount":212700,"count":36,"month":"Sep ''25"},{"amount":369676,"count":115,"month":"Oct ''25"},{"amount":247744,"count":61,"month":"Nov ''25"},{"amount":152094,"count":57,"month":"Dec ''25"},{"amount":299297,"count":53,"month":"Jan ''26"},{"amount":144899,"count":29,"month":"Feb ''26"}],"totalWon":1577817,"trailingAvg":175313}', '(() => {
 const data = [{"month":"Jun ''25","amount":19420,"count":5},{"month":"Jul ''25","amount":25387,"count":10},{"month":"Aug ''25","amount":106600,"count":33},{"month":"Sep ''25","amount":212700,"count":36},{"month":"Oct ''25","amount":369676,"count":115},{"month":"Nov ''25","amount":247744,"count":61},{"month":"Dec ''25","amount":152094,"count":57},{"month":"Jan ''26","amount":299297,"count":53},{"month":"Feb ''26","amount":144899,"count":29}];
 const currentMonth = 144899;
 const bestMonth = 369676;
 const trailingAvg = 175313;
 const totalWon = 1577817;

 return (
 <MetricSection>
 <MetricRow>
 <StatCard label="This Month" value={''$'' + (currentMonth / 1000).toFixed(0) + ''K''} subtitle="Closed won · Feb ''26" trend={''+'' + ((currentMonth / trailingAvg - 1) * 100).toFixed(0) + ''% vs avg''} trendDirection={currentMonth >= trailingAvg ? ''up'' : ''down''} />
 <StatCard label="Best Month" value={''$'' + (bestMonth / 1000).toFixed(0) + ''K''} subtitle="Oct ''25 · Peak" />
 <StatCard label="Monthly Avg" value={''$'' + (trailingAvg / 1000).toFixed(0) + ''K''} subtitle="Trailing average" />
 <StatCard label="Total Won" value={''$'' + (totalWon / 1000).toFixed(0) + ''K''} subtitle="All time · 418 deals" />
 </MetricRow>
 <div style={{ height: 280, background: theme.panel, borderRadius: 16, padding: 20, border: `1px solid ${theme.line}` }}>
 <ResponsiveContainer width="100%" height="100%">
 <BarChart data={data} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
 <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
 <XAxis dataKey="month" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
 <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} tickFormatter={v => ''$'' + (v / 1000).toFixed(0) + ''K''} />
 <Tooltip contentStyle={{ background: theme.tooltipBg, border: `1px solid ${theme.tooltipBorder}`, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} formatter={(v, name, props) => [''$'' + Number(v).toLocaleString(), ''Closed Won ('' + props.payload.count + '' deals)'']} />
 <ReferenceLine y={trailingAvg} stroke={theme.line} strokeDasharray="6 4" label={{ value: ''Avg'', fill: theme.inkMuted, fontSize: 10 }} />
 <Bar dataKey="amount" name="Closed Won" fill={theme.accent} radius={[4, 4, 0, 0]} />
 </BarChart>
 </ResponsiveContainer>
 </div>
 <MetricNote>HubSpot closed-won deals across all sales pipelines · 418 deals · Jun 2025–Feb 2026 · Source: HubSpot CRM via Kiingo MCP</MetricNote>
 </MetricSection>
 );
})()', 'completed', '2026-02-19T00:49:14.872177+00:00', '2026-02-19T00:50:50.974955+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('d259c321-975c-40e5-9c81-8680cab2bf05', '95795ece-97c3-4fef-987a-67f543b85c8d', '{"monthlyData": [{"month": "Jan ''25", "completed": 6}, {"month": "Feb ''25", "completed": 8}, {"month": "Mar ''25", "completed": 1}, {"month": "May ''25", "completed": 18}, {"month": "Jun ''25", "completed": 5}, {"month": "Jul ''25", "completed": 3}, {"month": "Aug ''25", "completed": 1}, {"month": "Sep ''25", "completed": 9}, {"month": "Oct ''25", "completed": 7}], "totalCompleted": 72, "avgPerMonth": 6.5, "lastMonthCount": 7, "peakMonth": "May ''25", "peakCount": 18, "trend": "accelerating", "byInstructor": [{"name": "Josh", "completed": 40}, {"name": "James", "completed": 20}, {"name": "Ross", "completed": 3}]}', '(() => {
  const monthlyData = [{"month": "Jan ''25", "completed": 6}, {"month": "Feb ''25", "completed": 8}, {"month": "Mar ''25", "completed": 1}, {"month": "May ''25", "completed": 18}, {"month": "Jun ''25", "completed": 5}, {"month": "Jul ''25", "completed": 3}, {"month": "Aug ''25", "completed": 1}, {"month": "Sep ''25", "completed": 9}, {"month": "Oct ''25", "completed": 7}];
  const totalCompleted = 72;
  const avgPerMonth = 6.5;
  const lastMonthCount = 7;
  const trend = "accelerating";
  const byInstructor = [{"name": "Josh", "completed": 40}, {"name": "James", "completed": 20}, {"name": "Ross", "completed": 3}];

  const trendIcon = trend === ''accelerating'' ? '' ↑'' : trend === ''decelerating'' ? '' ↓'' : '' →'';

  return (
    <MetricSection>
      <MetricRow>
        <StatCard label={''Total Delivered''} value={totalCompleted} subtitle={''All-time cohorts''} />
        <StatCard label={''Avg / Month''} value={avgPerMonth} subtitle={''Completion rate''} />
        <StatCard label={''Last Month''} value={lastMonthCount} subtitle={''Cohorts completed''} />
        <StatCard label={''Trend''} value={trend + trendIcon} subtitle={''3mo vs prior 3mo''} />
      </MetricRow>

      <div style={{ height: 260, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Cohorts Completed by Month</div>
        <ResponsiveContainer width="100%" height="88%">
          <BarChart data={monthlyData} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="month" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <Bar dataKey="completed" name="Completed" fill={theme.accent} radius={[4, 4, 0, 0]} />
          </BarChart>
        </ResponsiveContainer>
      </div>

      <div style={{ height: 220, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 16 }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Completions by Instructor</div>
        <ResponsiveContainer width="100%" height="85%">
          <BarChart data={byInstructor} layout="vertical" margin={{ top: 10, right: 30, left: 60, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis type="number" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis type="category" dataKey="name" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} width={60} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <Bar dataKey="completed" name="Completed" fill={theme.secondary} radius={[0, 4, 4, 0]} />
          </BarChart>
        </ResponsiveContainer>
      </div>

      <MetricNote>Source: Asana · AI Bootcamp Ops board · Completed section</MetricNote>
    </MetricSection>
  );
})()', 'completed', '2026-02-19T01:39:44+00:00', '2026-02-19T01:39:44+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('bd2e4663-bd02-4dd5-8b16-1ba698be8125', '9d9e7fe9-b25c-4628-ac65-5a4fea982f67', '{"topCustomerRevenue":413005.5,"topCustomers":[{"name":"Immatics","revenue":72095},{"name":"Vistage Worldwide Inc.","revenue":52120},{"name":"Pathfinder Insurance Group","revenue":47640},{"name":"Connect Service Solutions","revenue":41398},{"name":"Legacy Concierge","revenue":38298},{"name":"Anglepoint","revenue":37350},{"name":"Ascent HVAC","revenue":35500},{"name":"SPMB","revenue":30881.5},{"name":"DealNews","revenue":29875},{"name":"Rich Chicks","revenue":27848}],"totalCustomers":361}', '(() => {
 const data = [{"name":"Immatics","revenue":72095},{"name":"Vistage Worldwide Inc.","revenue":52120},{"name":"Pathfinder Insurance Group","revenue":47640},{"name":"Connect Service Solutions","revenue":41398},{"name":"Legacy Concierge","revenue":38298},{"name":"Anglepoint","revenue":37350},{"name":"Ascent HVAC","revenue":35500},{"name":"SPMB","revenue":30881.5},{"name":"DealNews","revenue":29875},{"name":"Rich Chicks","revenue":27848}];
 const topTotal = 413005.5;
 const totalCustomers = 361;
 return (
 <MetricSection>
 <MetricRow>
 <StatCard label="Top 10 Revenue" value={''$'' + (413005.5/1000).toFixed(0) + ''K''} subtitle="combined LTM" />
 <StatCard label="Unique Customers" value={361} subtitle="with invoices" />
 <StatCard label="#1 Customer" value="Immatics" subtitle={''$'' + (72095/1000).toFixed(1) + ''K LTM''} />
 </MetricRow>
 <div style={{ height: 340, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line }}>
 <ResponsiveContainer width="100%" height="100%">
 <BarChart data={data} layout="vertical" margin={{ top: 5, right: 30, left: 140, bottom: 5 }}>
 <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
 <XAxis type="number" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} tickFormatter={v => ''$'' + (v/1000).toFixed(0) + ''K''} />
 <YAxis type="category" dataKey="name" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} width={135} />
 <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} formatter={v => [''$'' + Number(v).toLocaleString(), ''Revenue'']} />
 <Bar dataKey="revenue" name="Revenue" fill={theme.accent} radius={[0, 4, 4, 0]}>
 <LabelList dataKey="revenue" position="right" style={{ fill: theme.inkMuted, fontSize: 10 }} formatter={v => ''$'' + (v/1000).toFixed(0) + ''K''} />
 </Bar>
 </BarChart>
 </ResponsiveContainer>
 </div>
 <MetricNote>Source: QuickBooks Invoices (LTM Feb 2025 – Feb 2026) · 361 unique customers · Top 10 shown</MetricNote>
 </MetricSection>
 );
})()', 'completed', '2026-02-18T06:54:45.903805+00:00', '2026-02-18T06:55:38.344085+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('757ac226-bb26-4db3-a6f4-09101e3eec83', '9e73074d-654f-40fc-a53c-5c571ba309e6', '{"clientProjects": [{"client": "85C Bakery", "type": "AI Bootcamp", "status": "Active", "sessions": "4/7"}, {"client": "ATS Construction", "type": "Foundational Bootcamp", "status": "Setup", "sessions": "0/6"}, {"client": "Tire Discounter Group", "type": "Private Bootcamp", "status": "Setup", "sessions": "0/6"}, {"client": "Oxford Road", "type": "Prompt Engineering", "status": "Scoping", "sessions": "0/4"}, {"client": "Scimitar", "type": "AI Bootcamp", "status": "Active", "sessions": "3/7"}, {"client": "Juana", "type": "Foundational Bootcamp", "status": "Setup", "sessions": "0/6"}, {"client": "KC HiLiTES", "type": "Consulting", "status": "Active", "sessions": "N/A"}], "activeCount": 3}', '(() => {
  const data = [{"client": "85C Bakery", "type": "AI Bootcamp", "status": "Active", "sessions": "4/7"}, {"client": "ATS Construction", "type": "Foundational Bootcamp", "status": "Setup", "sessions": "0/6"}, {"client": "Tire Discounter Group", "type": "Private Bootcamp", "status": "Setup", "sessions": "0/6"}, {"client": "Oxford Road", "type": "Prompt Engineering", "status": "Scoping", "sessions": "0/4"}, {"client": "Scimitar", "type": "AI Bootcamp", "status": "Active", "sessions": "3/7"}, {"client": "Juana", "type": "Foundational Bootcamp", "status": "Setup", "sessions": "0/6"}, {"client": "KC HiLiTES", "type": "Consulting", "status": "Active", "sessions": "N/A"}];
  const active = data.filter(d => d.status === ''Active'').length;
  return (
    <MetricSection>
      <MetricRow>
        <StatCard label="Active Projects" value={active} subtitle="In delivery" />
        <StatCard label="Total Projects" value={data.length} subtitle="All stages" />
      </MetricRow>
      <div style={{ marginTop: 8 }}>
        {data.map((d, i) => (
          <div key={i} style={{ display: ''flex'', alignItems: ''center'', gap: 12, padding: ''8px 12px'', background: i % 2 === 0 ? theme.panel : ''transparent'', borderRadius: 8 }}>
            <span style={{ flex: 1, color: theme.ink, fontSize: 13, fontWeight: 600 }}> {d.client}</span>
            <span style={{ color: theme.inkMuted, fontSize: 12, minWidth: 120 }}> {d.type}</span>
            <span style={{ fontSize: 11, padding: ''2px 8px'', borderRadius: 4, background: d.status === ''Active'' ? theme.accent : theme.line, color: d.status === ''Active'' ? ''#fff'' : theme.ink }}> {d.status}</span>
            <span style={{ color: theme.inkMuted, fontSize: 12, minWidth: 40 }}> {d.sessions}</span>
          </div>
        ))}
      </div>
      <MetricNote>Source: Asana Projects via Kiingo MCP</MetricNote>
    </MetricSection>
  );
})()', 'completed', '2026-02-15T06:34:11+00:00', '2026-02-15T06:34:11+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('b965b99a-26ea-419a-a942-86b63df2c901', 'aabb87b0-1bca-4179-9c6f-20272d1de5dc', '{"ltmExpenses":694618.66,"ltmRevenue":1809346.95,"monthlyData":[{"expenses":28149.03,"month":"Feb ''25","revenue":91150},{"expenses":29008.37,"month":"Mar ''25","revenue":198452.73},{"expenses":37359.8,"month":"Apr ''25","revenue":106283},{"expenses":34172.47,"month":"May ''25","revenue":125353.5},{"expenses":51073.14,"month":"Jun ''25","revenue":143551.16},{"expenses":52371.15,"month":"Jul ''25","revenue":98864.19},{"expenses":64774.7,"month":"Aug ''25","revenue":114698},{"expenses":74215.28,"month":"Sep ''25","revenue":263724.5},{"expenses":66572.18,"month":"Oct ''25","revenue":197685.27},{"expenses":71879.07,"month":"Nov ''25","revenue":206918.5},{"expenses":97923.15,"month":"Dec ''25","revenue":120578.88},{"expenses":87120.32,"month":"Jan ''26","revenue":142087.22},{"expenses":73871.12,"month":"Feb ''26*","revenue":20143.47}],"opExRatio":38.4}', '(() => {
 const data = [{"month":"Feb ''25","revenue":91150,"expenses":28149.03},{"month":"Mar ''25","revenue":198452.73,"expenses":29008.37},{"month":"Apr ''25","revenue":106283,"expenses":37359.8},{"month":"May ''25","revenue":125353.5,"expenses":34172.47},{"month":"Jun ''25","revenue":143551.16,"expenses":51073.14},{"month":"Jul ''25","revenue":98864.19,"expenses":52371.15},{"month":"Aug ''25","revenue":114698,"expenses":64774.7},{"month":"Sep ''25","revenue":263724.5,"expenses":74215.28},{"month":"Oct ''25","revenue":197685.27,"expenses":66572.18},{"month":"Nov ''25","revenue":206918.5,"expenses":71879.07},{"month":"Dec ''25","revenue":120578.88,"expenses":97923.15},{"month":"Jan ''26","revenue":142087.22,"expenses":87120.32},{"month":"Feb ''26*","revenue":20143.47,"expenses":73871.12}];
 const ltmRevenue = 1809346.95;
 const ltmExpenses = 694618.66;
 const opExRatio = 38.4;
 const netIncome = ltmRevenue - ltmExpenses;
 const fmt = v => ''$'' + (v >= 1000000 ? (v/1000000).toFixed(2) + ''M'' : (v/1000).toFixed(0) + ''K'');
 return (
 <MetricSection title="Operating Leverage">
 <MetricRow>
 <StatCard label="LTM Revenue" value={fmt(ltmRevenue)} subtitle="Feb 2025 – Jan 2026" />
 <StatCard label="LTM Expenses" value={fmt(ltmExpenses)} subtitle="Feb 2025 – Jan 2026" />
 <StatCard label="LTM Net Income" value={fmt(netIncome)} trendDirection="up" subtitle={opExRatio.toFixed(1) + ''% expense ratio''} />
 </MetricRow>
 <div style={{ height: 300, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line }}>
 <ResponsiveContainer width="100%" height="100%">
 <AreaChart data={data} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
 <defs>
 <linearGradient id="revGrad" x1="0" y1="0" x2="0" y2="1">
 <stop offset="5%" stopColor={theme.accent} stopOpacity={0.2} />
 <stop offset="95%" stopColor={theme.accent} stopOpacity={0} />
 </linearGradient>
 <linearGradient id="expGrad" x1="0" y1="0" x2="0" y2="1">
 <stop offset="5%" stopColor={theme.danger} stopOpacity={0.15} />
 <stop offset="95%" stopColor={theme.danger} stopOpacity={0} />
 </linearGradient>
 </defs>
 <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
 <XAxis dataKey="month" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
 <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} tickFormatter={v => ''$'' + (v/1000).toFixed(0) + ''K''} />
 <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} formatter={v => ''$'' + Number(v).toLocaleString(undefined, {minimumFractionDigits:0, maximumFractionDigits:0})} />
 <Legend wrapperStyle={{ fontSize: 12, color: theme.inkMuted }} />
 <Area type="monotone" dataKey="revenue" name="Revenue" stroke={theme.accent} fill="url(#revGrad)" strokeWidth={2} />
 <Area type="monotone" dataKey="expenses" name="Expenses" stroke={theme.danger} fill="url(#expGrad)" strokeWidth={2} />
 </AreaChart>
 </ResponsiveContainer>
 </div>
 <MetricNote>The gap between lines represents net income. LTM = Feb 2025–Jan 2026 (12 full months). * Feb ''26 is month-to-date (through Feb 18). | QuickBooks P&L</MetricNote>
 </MetricSection>
 );
})()', 'completed', '2026-02-18T23:00:52.252213+00:00', '2026-02-18T23:04:05.005939+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('81163693-19a1-4b37-a754-1010359a4505', 'b6dc4242-b365-4360-acd2-4f764853f0c9', '{"weeks": [{"week": "1/1", "discoveryCalls": 17, "nextStepsCalls": 2, "oppsCreated": 351746, "closedWon": 15300, "closeRate": 34.6, "avgDealSize": 2900}, {"week": "1/12", "discoveryCalls": 17, "nextStepsCalls": 7, "oppsCreated": 324500, "closedWon": 83098, "closeRate": 45.6, "avgDealSize": 4000}, {"week": "1/19", "discoveryCalls": 17, "nextStepsCalls": 8, "oppsCreated": 401340, "closedWon": 42050, "closeRate": 23.6, "avgDealSize": 5800}, {"week": "1/26", "discoveryCalls": 3, "nextStepsCalls": 14, "oppsCreated": 346090, "closedWon": 67549, "closeRate": 29.4, "avgDealSize": 4100}, {"week": "2/2", "discoveryCalls": 4, "nextStepsCalls": 7, "oppsCreated": 351140, "closedWon": 60500, "closeRate": 37.5, "avgDealSize": 3100}, {"week": "2/9", "discoveryCalls": 9, "nextStepsCalls": 9, "oppsCreated": 378340, "closedWon": 24349, "closeRate": 29.7, "avgDealSize": 6600}, {"week": "2/16", "discoveryCalls": 3, "nextStepsCalls": 10, "oppsCreated": 225750, "closedWon": 40700, "closeRate": 35.7, "avgDealSize": 2900}], "latestWeek": "2/16", "latestDiscovery": 3, "latestNextSteps": 10, "latestClosedWon": 40700, "latestCloseRate": 35.7, "latestOpps": 225750, "latestAvgDeal": 2900, "totalClosedWon": 333546}', '(() => {
  const weeks = [{"week": "1/1", "discoveryCalls": 17, "nextStepsCalls": 2, "oppsCreated": 351746, "closedWon": 15300, "closeRate": 34.6, "avgDealSize": 2900}, {"week": "1/12", "discoveryCalls": 17, "nextStepsCalls": 7, "oppsCreated": 324500, "closedWon": 83098, "closeRate": 45.6, "avgDealSize": 4000}, {"week": "1/19", "discoveryCalls": 17, "nextStepsCalls": 8, "oppsCreated": 401340, "closedWon": 42050, "closeRate": 23.6, "avgDealSize": 5800}, {"week": "1/26", "discoveryCalls": 3, "nextStepsCalls": 14, "oppsCreated": 346090, "closedWon": 67549, "closeRate": 29.4, "avgDealSize": 4100}, {"week": "2/2", "discoveryCalls": 4, "nextStepsCalls": 7, "oppsCreated": 351140, "closedWon": 60500, "closeRate": 37.5, "avgDealSize": 3100}, {"week": "2/9", "discoveryCalls": 9, "nextStepsCalls": 9, "oppsCreated": 378340, "closedWon": 24349, "closeRate": 29.7, "avgDealSize": 6600}, {"week": "2/16", "discoveryCalls": 3, "nextStepsCalls": 10, "oppsCreated": 225750, "closedWon": 40700, "closeRate": 35.7, "avgDealSize": 2900}];
  const latestWeek = "2/16";
  const latestDiscovery = 3;
  const latestNextSteps = 10;
  const latestClosedWon = 40700;
  const latestCloseRate = 35.7;
  const latestOpps = 225750;
  const latestAvgDeal = 2900;
  const totalClosedWon = 333546;

  const fmt = (n) => ''$'' + (n || 0).toLocaleString();
  const fmtK = (n) => ''$'' + ((n || 0) / 1000).toFixed(0) + ''K'';

  return (
    <MetricSection>
      <MetricRow>
        <StatCard label={''Discovery Calls''} value={latestDiscovery} subtitle={''Week of '' + latestWeek} />
        <StatCard label={''Next Steps Calls''} value={latestNextSteps} subtitle={''Week of '' + latestWeek} />
        <StatCard label={''Closed Won''} value={fmtK(latestClosedWon)} subtitle={''Prior week''} />
        <StatCard label={''Close Rate (T4W)''} value={latestCloseRate + ''%''} subtitle={''Avg deal '' + fmt(latestAvgDeal)} />
      </MetricRow>

      <MetricRow>
        <StatCard label={''Pipeline (T4W)''} value={fmtK(latestOpps)} subtitle={''Opps created''} />
        <StatCard label={''Total Closed Won''} value={fmtK(totalClosedWon)} subtitle={''All weeks tracked''} />
      </MetricRow>

      <div style={{ height: 280, background: theme.panel, borderRadius: 16, padding: 20, border: ''1px solid '' + theme.line }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Weekly Call Activity</div>
        <ResponsiveContainer width="100%" height="90%">
          <BarChart data={weeks} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="week" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <Legend />
            <Bar dataKey="discoveryCalls" name="Discovery" fill={theme.accent} radius={[4, 4, 0, 0]} />
            <Bar dataKey="nextStepsCalls" name="Next Steps" fill={theme.secondary} radius={[4, 4, 0, 0]} />
          </BarChart>
        </ResponsiveContainer>
      </div>

      <div style={{ display: ''grid'', gridTemplateColumns: ''1fr 1fr'', gap: 16, marginTop: 16 }}>
        <div style={{ height: 260, background: theme.panel, borderRadius: 16, padding: 16, border: ''1px solid '' + theme.line }}>
          <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Closed Won by Week</div>
          <ResponsiveContainer width="100%" height="85%">
            <AreaChart data={weeks} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
              <defs>
                <linearGradient id="salesClosedGrad" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0%" stopColor="#16a34a" stopOpacity={0.15} />
                  <stop offset="100%" stopColor="#16a34a" stopOpacity={0.02} />
                </linearGradient>
              </defs>
              <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
              <XAxis dataKey="week" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} />
              <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} tickFormatter={(v) => ''$'' + (v / 1000).toFixed(0) + ''K''} />
              <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 12 }} formatter={(v) => [fmt(v), ''Closed Won'']} />
              <Area type="monotone" dataKey="closedWon" stroke="#16a34a" strokeWidth={2} fill="url(#salesClosedGrad)" />
            </AreaChart>
          </ResponsiveContainer>
        </div>

        <div style={{ height: 260, background: theme.panel, borderRadius: 16, padding: 16, border: ''1px solid '' + theme.line }}>
          <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Close Rate % (Trailing 4 Weeks)</div>
          <ResponsiveContainer width="100%" height="85%">
            <LineChart data={weeks} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
              <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
              <XAxis dataKey="week" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} />
              <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} tickFormatter={(v) => v + ''%''} domain={[0, 60]} />
              <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 12 }} formatter={(v) => [v + ''%'', ''Close Rate'']} />
              <Line type="monotone" dataKey="closeRate" stroke={theme.accent} strokeWidth={2} dot={{ fill: theme.accent, r: 4 }} />
            </LineChart>
          </ResponsiveContainer>
        </div>
      </div>

      <MetricNote>Source: Notion Leadership Team · Sales/Marketing Scorecard</MetricNote>
    </MetricSection>
  );
})()', 'completed', '2026-02-18T01:06:55+00:00', '2026-02-18T01:06:55+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('57d9087d-fd78-4f87-a22c-64d7f881f273', 'be990667-9109-4750-a752-208ac1f58e84', '{"activeCourses":59,"asyncContent":2,"cohortBootcamps":19,"companyBootcamps":34,"courseList":[{"name":"AI Bootcamp Cush Plaza Properties","status":"active"},{"name":"AI Bootcamp 02.04.26 Cohort","status":"active"},{"name":"AI Bootcamp 01.20.26 Cohort","status":"active"},{"name":"AI Bootcamp DealNews Cohort 1","status":"active"},{"name":"AI Bootcamp SVN Cohort","status":"active"}],"inactiveCourses":89,"totalCourses":148,"totalPlatformUsers":2167,"vistageBootcamps":2}', '(() => {
 const chartData = [
 { category: ''Company'', count: 34 },
 { category: ''Cohort'', count: 19 },
 { category: ''Vistage'', count: 2 },
 { category: ''Async'', count: 2 },
 { category: ''Templates'', count: 2 },
 ];

 const recentCourses = [
 { name: ''AI Bootcamp Cush Plaza Properties'', tag: ''Company'', updated: ''2026-02-18'' },
 { name: ''AI Bootcamp 02.04.26 Cohort'', tag: ''Cohort'', updated: ''2026-02-18'' },
 { name: ''AI Bootcamp 01.20.26 Cohort'', tag: ''Cohort'', updated: ''2026-02-18'' },
 { name: ''AI Bootcamp DealNews Cohort 1'', tag: ''Company'', updated: ''2026-02-18'' },
 { name: ''AI Bootcamp SVN Cohort'', tag: ''Company'', updated: ''2026-02-18'' },
 { name: ''AI Bootcamp True Movement Tech'', tag: ''Company'', updated: ''2026-02-18'' },
 { name: ''AI Bootcamp Immatics CMO Cohort 1'', tag: ''Company'', updated: ''2026-02-18'' },
 { name: ''AI Bootcamp DealNews Cohort 2'', tag: ''Company'', updated: ''2026-02-18'' },
 { name: ''AI Bootcamp Anderson Howard'', tag: ''Company'', updated: ''2026-02-18'' },
 { name: ''AI Bootcamp DealNews Cohort 3'', tag: ''Company'', updated: ''2026-02-17'' },
 { name: ''AI Bootcamp Total Package HR'', tag: ''Company'', updated: ''2026-02-17'' },
 { name: ''AI Bootcamp Scimitar Cohort 1'', tag: ''Company'', updated: ''2026-02-17'' },
 { name: ''AI Bootcamp Scimitar Cohort 2'', tag: ''Company'', updated: ''2026-02-17'' },
 { name: ''AI Bootcamp Heller Consulting'', tag: ''Company'', updated: ''2026-02-16'' },
 { name: ''AI Bootcamp 02.13.26 Cohort'', tag: ''Cohort'', updated: ''2026-02-16'' },
 ];

 return (
 <MetricSection title="Bootcamp Operations">
 <MetricRow>
 <StatCard label="Active Courses" value={59} subtitle="Currently running" />
 <StatCard label="Total Courses" value={148} subtitle="All time" />
 <StatCard label="Platform Users" value="2,167" subtitle="Total enrolled" />
 </MetricRow>
 <MetricRow>
 <StatCard label="Cohort Bootcamps" value={19} subtitle="Date-based public" />
 <StatCard label="Company Bootcamps" value={34} subtitle="Custom / private" />
 <StatCard label="Vistage" value={2} subtitle="Vistage chair programs" />
 </MetricRow>

 <div style={{ marginTop: 24 }}>
 <div style={{ fontSize: 13, fontWeight: 600, color: theme.inkMuted, marginBottom: 10, textTransform: ''uppercase'', letterSpacing: ''0.05em'' }}>Active Courses by Category</div>
 <ResponsiveContainer width="100%" height={160}>
 <BarChart data={chartData} layout="vertical" margin={{ top: 0, right: 16, left: 60, bottom: 0 }}>
 <CartesianGrid stroke={theme.gridStroke} horizontal={false} />
 <XAxis type="number" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
 <YAxis type="category" dataKey="category" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 12 }} width={58} />
 <Tooltip contentStyle={{ background: theme.tooltipBg, border: `1px solid ${theme.tooltipBorder}`, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
 <Bar dataKey="count" name="Courses" fill={theme.accent} radius={[0, 4, 4, 0]}>
 <LabelList dataKey="count" position="right" style={{ fill: theme.ink, fontSize: 12, fontWeight: 600 }} />
 </Bar>
 </BarChart>
 </ResponsiveContainer>
 </div>

 <div style={{ marginTop: 24 }}>
 <div style={{ fontSize: 13, fontWeight: 600, color: theme.inkMuted, marginBottom: 10, textTransform: ''uppercase'', letterSpacing: ''0.05em'' }}>Recently Updated Active Courses</div>
 <div style={{ display: ''flex'', flexDirection: ''column'', gap: 6 }}>
 {recentCourses.map((c, i) => (
 <div key={i} style={{ display: ''flex'', alignItems: ''center'', gap: 10, padding: ''7px 12px'', background: theme.panel, borderRadius: 8 }}>
 <span style={{ fontSize: 11, fontWeight: 600, padding: ''2px 7px'', borderRadius: 4, background: c.tag === ''Cohort'' ? theme.accent : theme.accentStrong, color: theme.bg, whiteSpace: ''nowrap'' }}>{c.tag}</span>
 <span style={{ fontSize: 13, color: theme.ink, flex: 1 }}>{c.name}</span>
 <span style={{ fontSize: 11, color: theme.inkMuted, whiteSpace: ''nowrap'' }}>{c.updated}</span>
 </div>
 ))}
 </div>
 </div>

 <MetricNote>Source: TalentLMS (kiingo.talentlms.com) · As of 2026-02-18 · 89 inactive courses not shown</MetricNote>
 </MetricSection>
 );
})()', 'completed', '2026-02-18T23:52:22.031984+00:00', '2026-02-18T23:55:25.042045+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('439ce755-3bcc-40b3-9931-ef2c5285a516', 'c32c7b8c-a0fe-45e9-a89e-646f613c68ee', '{"ltmNetIncome":694489,"ltmRevenue":1615949,"monthlyData":[{"invoiced":850,"month":"02/25","netIncome":0},{"invoiced":16612,"month":"03/25","netIncome":133329},{"invoiced":23756,"month":"04/25","netIncome":34326},{"invoiced":70829,"month":"05/25","netIncome":58996},{"invoiced":139671,"month":"06/25","netIncome":62925},{"invoiced":98864,"month":"07/25","netIncome":18712},{"invoiced":114698,"month":"08/25","netIncome":25139},{"invoiced":263725,"month":"09/25","netIncome":161054},{"invoiced":197685,"month":"10/25","netIncome":99890},{"invoiced":206919,"month":"11/25","netIncome":100082},{"invoiced":120579,"month":"12/25","netIncome":-9713},{"invoiced":209568,"month":"01/26","netIncome":9749},{"invoiced":152193,"month":"02/26","netIncome":0}]}', '(() => { const data = [{"month":"02/25","invoiced":850,"netIncome":0},{"month":"03/25","invoiced":16612,"netIncome":133329},{"month":"04/25","invoiced":23756,"netIncome":34326},{"month":"05/25","invoiced":70829,"netIncome":58996},{"month":"06/25","invoiced":139671,"netIncome":62925},{"month":"07/25","invoiced":98864,"netIncome":18712},{"month":"08/25","invoiced":114698,"netIncome":25139},{"month":"09/25","invoiced":263725,"netIncome":161054},{"month":"10/25","invoiced":197685,"netIncome":99890},{"month":"11/25","invoiced":206919,"netIncome":100082},{"month":"12/25","invoiced":120579,"netIncome":-9713},{"month":"01/26","invoiced":209568,"netIncome":9749},{"month":"02/26","invoiced":152193,"netIncome":0}]; return (<MetricSection><div style={{height:280,background:theme.panel,borderRadius:16,padding:''16px 20px'',border:''1px solid ''+theme.line}}><ResponsiveContainer width="100%" height="100%"><ComposedChart data={data} margin={{top:10,right:10,left:0,bottom:0}}><CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke}/><XAxis dataKey="month" stroke={theme.axisStroke} tick={{fill:theme.inkMuted,fontSize:11}}/><YAxis stroke={theme.axisStroke} tick={{fill:theme.inkMuted,fontSize:11}} tickFormatter={v=>''$''+(v/1000)+''K''}/><Tooltip contentStyle={{background:theme.tooltipBg,border:''1px solid ''+theme.tooltipBorder,color:theme.tooltipText,borderRadius:8,fontSize:13}} formatter={v=>''$''+Number(v).toLocaleString()}/><Bar dataKey="invoiced" name="Revenue" fill={theme.accent} radius={[4,4,0,0]} opacity={0.7}/><Line type="monotone" dataKey="netIncome" name="Net Income" stroke={theme.accentStrong} strokeWidth={2.5} dot={{fill:theme.accentStrong,r:3}}/><ReferenceLine y={0} stroke={theme.danger} strokeWidth={1} strokeDasharray="4 4"/></ComposedChart></ResponsiveContainer></div><MetricNote>Revenue (bars) vs Net Income (line) | QuickBooks | LTM Revenue: $1.62M | LTM Net Income: $694K</MetricNote></MetricSection>); })()', 'completed', '2026-02-16T16:16:54.247187+00:00', '2026-02-16T16:26:38.098099+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('370ac1ca-1b8f-4e89-b66e-417174340f69', 'c43880d5-676d-451a-b903-925b8e388f0b', '{"completionRate":0.088,"initiatives":[{"initiative":"Lead Attribution & HubSpot Infrastructure (Rock 1)","status":"In Progress","tasksComplete":1,"tasksTotal":11},{"initiative":"Digital Marketing Associate (Rock 2)","status":"In Progress","tasksComplete":3,"tasksTotal":7},{"initiative":"Events, Speaking & Partnerships (Rock 4)","status":"In Progress","tasksComplete":0,"tasksTotal":7},{"initiative":"Content & Growth Engine (Rock 7)","status":"In Progress","tasksComplete":0,"tasksTotal":8},{"initiative":"Vistage Strategy","status":"In Progress","tasksComplete":1,"tasksTotal":10},{"initiative":"LinkedIn Campaigns","status":"In Progress","tasksComplete":0,"tasksTotal":8},{"initiative":"Champions Program","status":"In Progress","tasksComplete":1,"tasksTotal":6},{"initiative":"Marketing Automation","status":"Not Started","tasksComplete":0,"tasksTotal":15},{"initiative":"Outbound & Paid Campaigns","status":"In Progress","tasksComplete":0,"tasksTotal":7},{"initiative":"Website & Landing Pages","status":"In Progress","tasksComplete":1,"tasksTotal":5}],"totalInitiatives":10}', '(() => {
 const data = [{"initiative":"Lead Attribution & HubSpot Infrastructure (Rock 1)","status":"In Progress","tasksComplete":1,"tasksTotal":11},{"initiative":"Digital Marketing Associate (Rock 2)","status":"In Progress","tasksComplete":3,"tasksTotal":7},{"initiative":"Events, Speaking & Partnerships (Rock 4)","status":"In Progress","tasksComplete":0,"tasksTotal":7},{"initiative":"Content & Growth Engine (Rock 7)","status":"In Progress","tasksComplete":0,"tasksTotal":8},{"initiative":"Vistage Strategy","status":"In Progress","tasksComplete":1,"tasksTotal":10},{"initiative":"LinkedIn Campaigns","status":"In Progress","tasksComplete":0,"tasksTotal":8},{"initiative":"Champions Program","status":"In Progress","tasksComplete":1,"tasksTotal":6},{"initiative":"Marketing Automation","status":"Not Started","tasksComplete":0,"tasksTotal":15},{"initiative":"Outbound & Paid Campaigns","status":"In Progress","tasksComplete":0,"tasksTotal":7},{"initiative":"Website & Landing Pages","status":"In Progress","tasksComplete":1,"tasksTotal":5}];
 const total = data.reduce((s, d) => s + d.tasksTotal, 0);
 const done = data.reduce((s, d) => s + d.tasksComplete, 0);
 const getStatusColor = (status) => {
 if (status === ''Complete'') return theme.accent;
 if (status === ''At Risk'') return theme.danger;
 if (status === ''Not Started'') return theme.inkMuted;
 return theme.accent;
 };
 return (
 <MetricSection>
 <MetricRow>
 <StatCard label="Active Initiatives" value={data.length} subtitle="Marketing Q1 2026" />
 <StatCard label="Tasks Done" value={done + ''/'' + total} subtitle={Math.round(done/total*100) + ''% complete''} />
 </MetricRow>
 <div style={{ marginTop: 16 }}>
 {data.map((d, i) => (
 <div key={i} style={{ display: ''flex'', alignItems: ''center'', gap: 12, padding: ''10px 14px'', background: i % 2 === 0 ? theme.panel : ''transparent'', borderRadius: 8, marginBottom: 2 }}>
 <span style={{ flex: 1, color: theme.ink, fontSize: 13, fontWeight: 500 }}>{d.initiative}</span>
 <span style={{ color: theme.inkMuted, fontSize: 12, minWidth: 60, textAlign: ''right'' }}>{d.tasksComplete}/{d.tasksTotal}</span>
 <div style={{ width: 120, height: 6, background: theme.line, borderRadius: 3 }}>
 <div style={{ width: (d.tasksTotal > 0 ? d.tasksComplete / d.tasksTotal * 100 : 0) + ''%'', height: ''100%'', background: getStatusColor(d.status), borderRadius: 3 }} />
 </div>
 <span style={{ color: d.status === ''At Risk'' ? theme.danger : d.status === ''Not Started'' ? theme.inkMuted : theme.accent, fontSize: 11, minWidth: 85, textAlign: ''right'' }}>{d.status}</span>
 </div>
 ))}
 </div>
 <MetricNote>Source: Asana Tasks (Schuyler Dragoo) • 84 total tasks tracked</MetricNote>
 </MetricSection>
 );
})()', 'completed', '2026-02-16T23:38:32.245751+00:00', '2026-02-16T23:40:19.363943+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('6ba4e551-4063-407f-99dc-30fbb568e23e', 'c8f0a7ec-5cc2-4990-b7e1-9cf0f247992c', '{"byProduct":[{"count":175,"name":"New Business","value":937287},{"count":46,"name":"(Ops) Private Bootcamp","value":626249},{"count":67,"name":"Upsells","value":133342},{"count":36,"name":"(Ops) AI Assessment & Roadmap","value":97820},{"count":56,"name":"Other","value":100372}],"totalDeals":380,"totalPipeline":1895070}', '(() => { const data = [{name: ''New Business'', value: 937287, count: 175}, {name: ''(Ops) Private Bootcamp'', value: 626249, count: 46}, {name: ''Upsells'', value: 133342, count: 67}, {name: ''(Ops) AI Assessment & Roadmap'', value: 97820, count: 36}, {name: ''Other'', value: 100372, count: 56}]; const total = 1895070; return (<MetricSection><StatCard label="Total Pipeline" value={''$'' + (total / 1000).toFixed(0) + ''K''} subtitle={''5 product lines''} /><div style={{ height: 260, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}><ResponsiveContainer width="100%" height="100%"><BarChart data={data} layout="vertical" margin={{ top: 5, right: 20, left: 80, bottom: 5 }}><CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} /><XAxis type="number" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} tickFormatter={v => ''$'' + (v/1000) + ''K''} /><YAxis type="category" dataKey="name" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} width={75} /><Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} formatter={v => ''$'' + Number(v).toLocaleString()} /><Bar dataKey="value" name="Pipeline Value" fill={theme.accent} radius={[0,4,4,0]} /></BarChart></ResponsiveContainer></div></MetricSection>); })()', 'completed', '2026-02-16T16:16:54.245471+00:00', '2026-02-16T16:20:04.918188+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('b539aefb-5f8b-4b02-9ae6-205eeffdaeb4', 'd2825574-c249-44fe-a6e6-b89fb0b4419b', '{"instructors": [{"name": "Josh", "active": 0, "scheduled": 0, "completed": 43, "total": 43}, {"name": "James", "active": 0, "scheduled": 0, "completed": 27, "total": 27}, {"name": "Jordan", "active": 0, "scheduled": 0, "completed": 12, "total": 12}, {"name": "Ross", "active": 0, "scheduled": 0, "completed": 5, "total": 5}], "totalActive": 0, "totalScheduled": 0, "totalCompleted": 87, "totalCohorts": 87, "activeCohorts": []}', '(() => {
  const instructors = [{"name": "Josh", "active": 0, "scheduled": 0, "completed": 43, "total": 43}, {"name": "James", "active": 0, "scheduled": 0, "completed": 27, "total": 27}, {"name": "Jordan", "active": 0, "scheduled": 0, "completed": 12, "total": 12}, {"name": "Ross", "active": 0, "scheduled": 0, "completed": 5, "total": 5}];
  const totalActive = 9;
  const totalScheduled = 15;
  const totalCompleted = 63;
  const totalCohorts = 87;
  const activeCohorts = [];

  const colors = [theme.accent, theme.secondary, ''#eab308'', ''#16a34a'', ''#e879f9'', ''#f97316''];

  return (
    <MetricSection>
      <MetricRow>
        <StatCard label={''Active Cohorts''} value={totalActive} subtitle={''Currently underway''} />
        <StatCard label={''Scheduled''} value={totalScheduled} subtitle={''Being set up''} />
        <StatCard label={''Completed''} value={totalCompleted} subtitle={''All-time delivered''} />
        <StatCard label={''Total Cohorts''} value={totalCohorts} subtitle={''All stages''} />
      </MetricRow>

      <div style={{ height: 280, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Cohorts by Instructor</div>
        <ResponsiveContainer width="100%" height="90%">
          <BarChart data={instructors} layout="vertical" margin={{ top: 10, right: 30, left: 80, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis type="number" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis type="category" dataKey="name" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} width={80} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <Legend />
            <Bar dataKey="active" name="Active" stackId="a" fill={theme.accent} />
            <Bar dataKey="scheduled" name="Scheduled" stackId="a" fill="#eab308" />
            <Bar dataKey="completed" name="Completed" stackId="a" fill={theme.secondary} radius={[0, 4, 4, 0]} />
          </BarChart>
        </ResponsiveContainer>
      </div>

      {activeCohorts.length > 0 && (
        <div style={{ background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 16 }}>
          <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 12, color: theme.ink }}>Active Cohorts</div>
          <div style={{ display: ''grid'', gridTemplateColumns: ''1fr 1fr'', gap: 8 }}>
            {activeCohorts.map((c, i) => (
              <div key={i} style={{ display: ''flex'', justifyContent: ''space-between'', alignItems: ''center'', padding: ''8px 14px'', borderRadius: 10, background: theme.accent + ''0a'', border: ''1px solid '' + theme.line }}>
                <span style={{ fontSize: 12, fontWeight: 600, color: theme.ink }}>{c.cohort.replace('' - AI Bootcamp Cohort'', '''')}</span>
                <span style={{ fontSize: 11, color: theme.inkMuted, marginLeft: 8 }}>{c.instructor}</span>
              </div>
            ))}
          </div>
        </div>
      )}

      <MetricNote>Source: Asana · AI Bootcamp Ops board · Instructor = task assignee</MetricNote>
    </MetricSection>
  );
})()', 'completed', '2026-02-19T05:43:41+00:00', '2026-02-19T05:43:41+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('8099651a-ef1c-4074-af65-40ca4969e3dc', 'd377f67d-eef4-4820-8041-d230232856e0', '{"avgDealSize":5557,"byService":[{"count":5,"revenue":53050,"service":"Private AI Foundational Bootcamp"},{"count":7,"revenue":15000,"service":"AI Foundational Bootcamp"},{"count":1,"revenue":9000,"service":"AI Agents Bootcamp"},{"count":1,"revenue":749,"service":"AI Champions Group"}],"dealCount":14,"deals":[{"amount":9600,"client":"SVN (1st cohort)","closeDate":"Feb 2","invoiced":9600,"payment":"","service":"Private AI Foundational Bootcamp (24 users)","type":"New Biz"},{"amount":749,"client":"Nowak Dental","closeDate":"Feb 2","invoiced":749,"payment":"","service":"AI Champions Group","type":"Upsell"},{"amount":1250,"client":"SN Transport","closeDate":"Feb 2","invoiced":1250,"payment":"","service":"AI Foundational Bootcamp","type":"Upsell"},{"amount":9000,"client":"Immatics","closeDate":"Feb 5","invoiced":9000,"payment":"ACH","service":"AI Agents Bootcamp (3 users)","type":"Upsell"},{"amount":1250,"client":"Commander Concrete","closeDate":"Feb 6","invoiced":1250,"payment":"","service":"AI Foundational Bootcamp","type":"New Biz"},{"amount":2500,"client":"Dillabaughs","closeDate":"Feb 6","invoiced":2500,"payment":"ACH","service":"AI Foundational Bootcamp (2 users)","type":"New Biz"},{"amount":10450,"client":"Preservation Equity Fund Advisors","closeDate":"Feb 9","invoiced":10450,"payment":"ACH","service":"Private AI Foundational Bootcamp (11 users)","type":"New Biz"},{"amount":10000,"client":"Total Package HR","closeDate":"Feb 10","invoiced":10000,"payment":"ACH","service":"Private AI Foundational Bootcamp (10 users)","type":"New Biz"},{"amount":5000,"client":"ATS Construction","closeDate":"Feb 11","invoiced":5000,"payment":"ACH","service":"AI Foundational Bootcamp (4 users)","type":"New Biz"},{"amount":1250,"client":"Juana","closeDate":"Feb 11","invoiced":0,"payment":"","service":"AI Foundational Bootcamp","type":"New Biz"},{"amount":14000,"client":"Tire Discounter Group","closeDate":"Feb 13","invoiced":0,"payment":"","service":"Private AI Foundational Bootcamp (14 users)","type":"New Biz"},{"amount":1250,"client":"Bradley Landscape","closeDate":"Feb 16","invoiced":0,"payment":"","service":"AI Foundational Bootcamp","type":"New Biz"},{"amount":2500,"client":"Brody Brothers","closeDate":"Feb 16","invoiced":0,"payment":"","service":"AI Foundational Bootcamp (2 users)","type":"New Biz"},{"amount":9000,"client":"Northern Nevada Literacy Council","closeDate":"Feb 18","invoiced":0,"payment":"","service":"Private AI Foundational Bootcamp (11 users)","type":"New Biz"}],"monthLabel":"February 2026","newBizCount":11,"newBizRevenue":66800,"outstandingInvoice":28000,"totalInvoiced":49799,"totalRevenue":77799,"upsellCount":3,"upsellRevenue":10999}', '(() => {
 const totalRevenue = 77799;
 const totalInvoiced = 49799;
 const outstanding = 28000;
 const dealCount = 14;
 const avgDeal = 5557;
 const newBizCount = 11;
 const newBizRevenue = 66800;
 const upsellCount = 3;
 const upsellRevenue = 10999;
 const byService = [{"service":"Private AI Foundational Bootcamp","count":5,"revenue":53050},{"service":"AI Foundational Bootcamp","count":7,"revenue":15000},{"service":"AI Agents Bootcamp","count":1,"revenue":9000},{"service":"AI Champions Group","count":1,"revenue":749}];
 const deals = [{"client":"SVN (1st cohort)","amount":9600,"invoiced":9600,"service":"Private AI Foundational Bootcamp (24 users)","type":"New Biz","closeDate":"Feb 2","payment":""},{"client":"Nowak Dental","amount":749,"invoiced":749,"service":"AI Champions Group","type":"Upsell","closeDate":"Feb 2","payment":""},{"client":"SN Transport","amount":1250,"invoiced":1250,"service":"AI Foundational Bootcamp","type":"Upsell","closeDate":"Feb 2","payment":""},{"client":"Immatics","amount":9000,"invoiced":9000,"service":"AI Agents Bootcamp (3 users)","type":"Upsell","closeDate":"Feb 5","payment":"ACH"},{"client":"Commander Concrete","amount":1250,"invoiced":1250,"service":"AI Foundational Bootcamp","type":"New Biz","closeDate":"Feb 6","payment":""},{"client":"Dillabaughs","amount":2500,"invoiced":2500,"service":"AI Foundational Bootcamp (2 users)","type":"New Biz","closeDate":"Feb 6","payment":"ACH"},{"client":"Preservation Equity Fund Advisors","amount":10450,"invoiced":10450,"service":"Private AI Foundational Bootcamp (11 users)","type":"New Biz","closeDate":"Feb 9","payment":"ACH"},{"client":"Total Package HR","amount":10000,"invoiced":10000,"service":"Private AI Foundational Bootcamp (10 users)","type":"New Biz","closeDate":"Feb 10","payment":"ACH"},{"client":"ATS Construction","amount":5000,"invoiced":5000,"service":"AI Foundational Bootcamp (4 users)","type":"New Biz","closeDate":"Feb 11","payment":"ACH"},{"client":"Juana","amount":1250,"invoiced":0,"service":"AI Foundational Bootcamp","type":"New Biz","closeDate":"Feb 11","payment":""},{"client":"Tire Discounter Group","amount":14000,"invoiced":0,"service":"Private AI Foundational Bootcamp (14 users)","type":"New Biz","closeDate":"Feb 13","payment":""},{"client":"Bradley Landscape","amount":1250,"invoiced":0,"service":"AI Foundational Bootcamp","type":"New Biz","closeDate":"Feb 16","payment":""},{"client":"Brody Brothers","amount":2500,"invoiced":0,"service":"AI Foundational Bootcamp (2 users)","type":"New Biz","closeDate":"Feb 16","payment":""},{"client":"Northern Nevada Literacy Council","amount":9000,"invoiced":0,"service":"Private AI Foundational Bootcamp (11 users)","type":"New Biz","closeDate":"Feb 18","payment":""}];
 const monthLabel = ''February 2026'';

 const fmt = (n) => ''$'' + (n || 0).toLocaleString();

 return (
 <MetricSection>
 <MetricRow>
 <StatCard label="Total Revenue" value={fmt(totalRevenue)} subtitle={monthLabel} />
 <StatCard label="Invoiced" value={fmt(totalInvoiced)} subtitle={outstanding > 0 ? fmt(outstanding) + '' outstanding'' : ''All invoiced''} />
 <StatCard label="Deals" value={dealCount} subtitle={''Avg '' + fmt(avgDeal)} />
 </MetricRow>
 <MetricRow>
 <StatCard label="New Business" value={fmt(newBizRevenue)} subtitle={newBizCount + '' deals''} />
 <StatCard label="Upsells" value={fmt(upsellRevenue)} subtitle={upsellCount + '' deals''} />
 </MetricRow>

 <div style={{ height: 280, background: theme.panel, borderRadius: 16, padding: 20, border: ''1px solid '' + theme.line }}>
 <ResponsiveContainer width="100%" height="100%">
 <BarChart data={byService} margin={{ top: 10, right: 10, left: 10, bottom: 40 }}>
 <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
 <XAxis dataKey="service" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 10 }} angle={-25} textAnchor="end" interval={0} />
 <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} tickFormatter={(v) => ''$'' + (v / 1000).toFixed(0) + ''K''} />
 <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} formatter={(v) => [''$'' + v.toLocaleString(), ''Revenue'']} />
 <Bar dataKey="revenue" fill={theme.accent} radius={[6, 6, 0, 0]} />
 </BarChart>
 </ResponsiveContainer>
 </div>

 <div style={{ marginTop: 16, background: theme.panel, borderRadius: 16, padding: 16, border: ''1px solid '' + theme.line, overflowX: ''auto'' }}>
 <table style={{ width: ''100%'', borderCollapse: ''collapse'', fontSize: 13 }}>
 <thead>
 <tr style={{ borderBottom: ''2px solid '' + theme.line }}>
 <th style={{ textAlign: ''left'', padding: ''8px 12px'', color: theme.inkMuted, fontWeight: 600 }}>Client</th>
 <th style={{ textAlign: ''right'', padding: ''8px 12px'', color: theme.inkMuted, fontWeight: 600 }}>Amount</th>
 <th style={{ textAlign: ''right'', padding: ''8px 12px'', color: theme.inkMuted, fontWeight: 600 }}>Invoiced</th>
 <th style={{ textAlign: ''left'', padding: ''8px 12px'', color: theme.inkMuted, fontWeight: 600 }}>Service</th>
 <th style={{ textAlign: ''left'', padding: ''8px 12px'', color: theme.inkMuted, fontWeight: 600 }}>Type</th>
 <th style={{ textAlign: ''left'', padding: ''8px 12px'', color: theme.inkMuted, fontWeight: 600 }}>Closed</th>
 </tr>
 </thead>
 <tbody>
 {deals.map((d, i) => (
 <tr key={i} style={{ borderBottom: ''1px solid '' + theme.line }}>
 <td style={{ padding: ''8px 12px'', color: theme.ink }}>{d.client}</td>
 <td style={{ padding: ''8px 12px'', color: theme.ink, textAlign: ''right'', fontVariantNumeric: ''tabular-nums'' }}>{fmt(d.amount)}</td>
 <td style={{ padding: ''8px 12px'', color: d.invoiced ? theme.ink : theme.inkMuted, textAlign: ''right'', fontVariantNumeric: ''tabular-nums'' }}>{d.invoiced ? fmt(d.invoiced) : ''—''}</td>
 <td style={{ padding: ''8px 12px'', color: theme.inkMuted, fontSize: 12 }}>{d.service}</td>
 <td style={{ padding: ''8px 12px'' }}><span style={{ padding: ''2px 8px'', borderRadius: 8, fontSize: 11, fontWeight: 600, background: d.type === ''New Biz'' ? theme.accent + ''22'' : theme.accentStrong + ''22'', color: d.type === ''New Biz'' ? theme.accent : theme.accentStrong }}>{d.type}</span></td>
 <td style={{ padding: ''8px 12px'', color: theme.inkMuted, fontSize: 12 }}>{d.closeDate}</td>
 </tr>
 ))}
 </tbody>
 </table>
 </div>

 <MetricNote>Source: Revenue Tracker 2026.xlsx (Sohrab Azad, OneDrive) via Kiingo MCP</MetricNote>
 </MetricSection>
 );
})()', 'completed', '2026-02-19T00:49:37.175467+00:00', '2026-02-19T00:52:36.109297+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('df922d65-5adb-4ee6-858e-297771c600c4', 'd6fe7a31-00ad-41e4-9379-b4ec83a346b7', '{"teamWorkload":[{"dueThisWeek":8,"name":"Becky Clark","open":33,"overdue":3},{"dueThisWeek":10,"name":"Isabelle Coloma","open":101,"overdue":5},{"dueThisWeek":25,"name":"James Hill-Jiang","open":98,"overdue":9},{"dueThisWeek":15,"name":"Jordan McDaniel","open":112,"overdue":15},{"dueThisWeek":5,"name":"Josh Sullivan","open":113,"overdue":4},{"dueThisWeek":3,"name":"Ross Hartmann","open":107,"overdue":1},{"dueThisWeek":27,"name":"Sohrab Azad","open":130,"overdue":1},{"dueThisWeek":0,"name":"Andy Woods","open":0,"overdue":0},{"dueThisWeek":0,"name":"David Rodriguez","open":0,"overdue":0},{"dueThisWeek":0,"name":"Jess Hartmann","open":1,"overdue":0},{"dueThisWeek":0,"name":"Kym Parodo","open":2,"overdue":2},{"dueThisWeek":0,"name":"Liesel Hartmann","open":0,"overdue":0},{"dueThisWeek":0,"name":"mich@kiingo.com","open":0,"overdue":0},{"dueThisWeek":0,"name":"Michael Glaser","open":0,"overdue":0},{"dueThisWeek":0,"name":"Ryan Keiper","open":0,"overdue":0},{"dueThisWeek":0,"name":"Schuyler Dragoo","open":0,"overdue":0},{"dueThisWeek":0,"name":"Taylor Hartmann","open":0,"overdue":0}],"totalOpenTasks":697,"totalOverdue":40}', '(() => { const data = [{"name":"Sohrab Azad","open":130,"dueThisWeek":27,"overdue":1},{"name":"Josh Sullivan","open":113,"dueThisWeek":5,"overdue":4},{"name":"Jordan McDaniel","open":112,"dueThisWeek":15,"overdue":15},{"name":"Ross Hartmann","open":107,"dueThisWeek":3,"overdue":1},{"name":"Isabelle Coloma","open":101,"dueThisWeek":10,"overdue":5},{"name":"James Hill-Jiang","open":98,"dueThisWeek":25,"overdue":9},{"name":"Becky Clark","open":33,"dueThisWeek":8,"overdue":3},{"name":"Kym Parodo","open":2,"dueThisWeek":0,"overdue":2},{"name":"Jess Hartmann","open":1,"dueThisWeek":0,"overdue":0}].filter(d => d.open > 0); const totalOpen = 697; const totalOverdue = 40; return ( <MetricSection> <MetricRow> <StatCard label="Total Open Tasks" value={totalOpen} subtitle="Across team" /> <StatCard label="Overdue" value={totalOverdue} subtitle="Past due date" trendDirection={totalOverdue > 5 ? ''down'' : ''flat''} /> </MetricRow> <div style={{ height: 320, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}> <ResponsiveContainer width="100%" height="100%"> <BarChart data={data} layout="vertical" margin={{ top: 5, right: 20, left: 110, bottom: 5 }}> <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} /> <XAxis type="number" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} /> <YAxis type="category" dataKey="name" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} width={105} /> <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} /> <Bar dataKey="open" name="Open" fill={theme.accent} radius={[0,4,4,0]} /> <Bar dataKey="overdue" name="Overdue" fill={theme.danger} radius={[0,4,4,0]} /> </BarChart> </ResponsiveContainer> </div> <MetricNote>Source: Asana Tasks via Kiingo MCP • As of Feb 15, 2026</MetricNote> </MetricSection> ); })()', 'completed', '2026-02-15T19:28:47.450515+00:00', '2026-02-15T19:29:43.477586+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('995c7079-0812-4933-b9e4-82b0dcb5cb40', 'e199206d-01bd-40af-838e-f82ff1541a40', '{"instructors": [{"name": "Isabelle", "role": "Session Runner", "active": 3, "scheduled": 0, "completed": 4, "total": 7}, {"name": "Josh", "role": "Lead Instructor", "active": 0, "scheduled": 0, "completed": 43, "total": 43}, {"name": "James", "role": "Lead Instructor", "active": 0, "scheduled": 0, "completed": 27, "total": 27}, {"name": "Jordan", "role": "Lead Instructor", "active": 0, "scheduled": 0, "completed": 12, "total": 12}, {"name": "Ross", "role": "Lead Instructor", "active": 0, "scheduled": 0, "completed": 5, "total": 5}], "totalTeamMembers": 5, "totalActiveCohorts": 3, "cohortsWithCoordinator": 3, "cohortTeams": [{"cohort": "DealNews Cohort 3", "lead": "\u2014", "coordinator": "Isabelle"}, {"cohort": "Total Package HR", "lead": "\u2014", "coordinator": "Isabelle"}, {"cohort": "SPMB Cohort 3", "lead": "\u2014", "coordinator": "Isabelle"}]}', '(() => {
  const instructors = [{"name": "Isabelle", "role": "Session Runner", "active": 3, "scheduled": 0, "completed": 4, "total": 7}, {"name": "Josh", "role": "Lead Instructor", "active": 0, "scheduled": 0, "completed": 43, "total": 43}, {"name": "James", "role": "Lead Instructor", "active": 0, "scheduled": 0, "completed": 27, "total": 27}, {"name": "Jordan", "role": "Lead Instructor", "active": 0, "scheduled": 0, "completed": 12, "total": 12}, {"name": "Ross", "role": "Lead Instructor", "active": 0, "scheduled": 0, "completed": 5, "total": 5}];
  const totalTeamMembers = 5;
  const totalActiveCohorts = 9;
  const cohortsWithCoordinator = 3;
  const cohortTeams = [{"cohort": "DealNews Cohort 3", "lead": "\u2014", "coordinator": "Isabelle"}, {"cohort": "Total Package HR", "lead": "\u2014", "coordinator": "Isabelle"}, {"cohort": "SPMB Cohort 3", "lead": "\u2014", "coordinator": "Isabelle"}];

  return (
    <MetricSection>
      <MetricRow>
        <StatCard label={''Team Size''} value={totalTeamMembers} subtitle={''Instructors + coordinators''} />
        <StatCard label={''Active Cohorts''} value={totalActiveCohorts} subtitle={''Currently running''} />
        <StatCard label={''With Coordinator''} value={cohortsWithCoordinator} subtitle={''Isabelle supporting''} />
        <StatCard label={''Utilization''} value={Math.round(totalActiveCohorts / totalTeamMembers * 10) / 10 + ''x''} subtitle={''Cohorts per person''} />
      </MetricRow>

      <div style={{ background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 12, color: theme.ink }}>Team Overview</div>
        <table style={{ width: ''100%'', borderCollapse: ''collapse'', fontSize: 13 }}>
          <thead>
            <tr style={{ borderBottom: ''2px solid '' + theme.line }}>
              <th style={{ textAlign: ''left'', padding: ''8px 12px'', color: theme.inkMuted, fontWeight: 600, fontSize: 11 }}>Name</th>
              <th style={{ textAlign: ''left'', padding: ''8px 12px'', color: theme.inkMuted, fontWeight: 600, fontSize: 11 }}>Role</th>
              <th style={{ textAlign: ''center'', padding: ''8px 12px'', color: theme.inkMuted, fontWeight: 600, fontSize: 11 }}>Active</th>
              <th style={{ textAlign: ''center'', padding: ''8px 12px'', color: theme.inkMuted, fontWeight: 600, fontSize: 11 }}>Scheduled</th>
              <th style={{ textAlign: ''center'', padding: ''8px 12px'', color: theme.inkMuted, fontWeight: 600, fontSize: 11 }}>Completed</th>
              <th style={{ textAlign: ''center'', padding: ''8px 12px'', color: theme.inkMuted, fontWeight: 600, fontSize: 11 }}>Total</th>
            </tr>
          </thead>
          <tbody>
            {instructors.map((inst, i) => (
              <tr key={i} style={{ borderBottom: ''1px solid '' + theme.line }}>
                <td style={{ padding: ''8px 12px'', fontWeight: 600, color: theme.ink }}>{inst.name}</td>
                <td style={{ padding: ''8px 12px'', color: theme.inkMuted }}>{inst.role}</td>
                <td style={{ textAlign: ''center'', padding: ''8px 12px'', color: inst.active > 0 ? theme.accent : theme.inkMuted, fontWeight: 700 }}>{inst.active}</td>
                <td style={{ textAlign: ''center'', padding: ''8px 12px'', color: inst.scheduled > 0 ? ''#eab308'' : theme.inkMuted, fontWeight: 600 }}>{inst.scheduled}</td>
                <td style={{ textAlign: ''center'', padding: ''8px 12px'', color: theme.inkMuted }}>{inst.completed}</td>
                <td style={{ textAlign: ''center'', padding: ''8px 12px'', fontWeight: 600, color: theme.ink }}>{inst.total}</td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>

      {cohortTeams.length > 0 && (
        <div style={{ background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 16 }}>
          <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 12, color: theme.ink }}>Active Cohort Teams</div>
          <div style={{ display: ''grid'', gridTemplateColumns: ''1fr 1fr'', gap: 8 }}>
            {cohortTeams.map((c, i) => (
              <div key={i} style={{ display: ''flex'', justifyContent: ''space-between'', alignItems: ''center'', padding: ''8px 14px'', borderRadius: 10, background: theme.accent + ''0a'', border: ''1px solid '' + theme.line }}>
                <span style={{ fontSize: 12, fontWeight: 600, color: theme.ink }}>{c.cohort}</span>
                <div style={{ display: ''flex'', gap: 6, alignItems: ''center'' }}>
                  <span style={{ fontSize: 11, color: theme.accent, fontWeight: 600 }}>{c.lead}</span>
                  {c.coordinator && <span style={{ fontSize: 10, color: theme.secondary, background: theme.secondary + ''22'', padding: ''2px 8px'', borderRadius: 10 }}>+ {c.coordinator}</span>}
                </div>
              </div>
            ))}
          </div>
        </div>
      )}

      <MetricNote>Source: Asana Ops board + individual cohort projects · Lead instructors + coordinators</MetricNote>
    </MetricSection>
  );
})()', 'completed', '2026-02-19T05:43:41+00:00', '2026-02-19T05:43:41+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('0af9ff91-fedf-485f-bf4e-cc14ff4d6963', 'e559abdf-19d9-b054-ee6c-9bb3b88a39f7', '{"avgPerWeek":"10.2","currentWeek":0,"discoveryTotal":123,"followUpTotal":15,"nextStepsTotal":54,"priorWeek":11,"trend":"decreasing","weeklyData":[{"count":8,"weekOf":"2025-11-24"},{"count":7,"weekOf":"2025-12-01"},{"count":18,"weekOf":"2025-12-08"},{"count":10,"weekOf":"2025-12-15"},{"count":5,"weekOf":"2025-12-22"},{"count":2,"weekOf":"2025-12-29"},{"count":15,"weekOf":"2026-01-05"},{"count":14,"weekOf":"2026-01-12"},{"count":16,"weekOf":"2026-01-19"},{"count":8,"weekOf":"2026-01-26"},{"count":8,"weekOf":"2026-02-02"},{"count":11,"weekOf":"2026-02-09"}],"weeklyFollowUps":[{"count":0,"weekOf":"2025-11-24"},{"count":0,"weekOf":"2025-12-01"},{"count":1,"weekOf":"2025-12-08"},{"count":1,"weekOf":"2025-12-15"},{"count":2,"weekOf":"2025-12-22"},{"count":0,"weekOf":"2025-12-29"},{"count":3,"weekOf":"2026-01-05"},{"count":3,"weekOf":"2026-01-12"},{"count":2,"weekOf":"2026-01-19"},{"count":2,"weekOf":"2026-01-26"},{"count":1,"weekOf":"2026-02-02"},{"count":0,"weekOf":"2026-02-09"}],"weeklyNextSteps":[{"count":6,"weekOf":"2025-11-24"},{"count":3,"weekOf":"2025-12-01"},{"count":5,"weekOf":"2025-12-08"},{"count":5,"weekOf":"2025-12-15"},{"count":4,"weekOf":"2025-12-22"},{"count":2,"weekOf":"2025-12-29"},{"count":6,"weekOf":"2026-01-05"},{"count":6,"weekOf":"2026-01-12"},{"count":7,"weekOf":"2026-01-19"},{"count":5,"weekOf":"2026-01-26"},{"count":4,"weekOf":"2026-02-02"},{"count":5,"weekOf":"2026-02-09"}]}', '(() => {
 const weeklyData = [{"weekOf":"2025-11-24","count":8},{"weekOf":"2025-12-01","count":7},{"weekOf":"2025-12-08","count":18},{"weekOf":"2025-12-15","count":10},{"weekOf":"2025-12-22","count":5},{"weekOf":"2025-12-29","count":2},{"weekOf":"2026-01-05","count":15},{"weekOf":"2026-01-12","count":14},{"weekOf":"2026-01-19","count":16},{"weekOf":"2026-01-26","count":8},{"weekOf":"2026-02-02","count":8},{"weekOf":"2026-02-09","count":11}];
 const weeklyFollowUps = [{"weekOf":"2025-11-24","count":0},{"weekOf":"2025-12-01","count":0},{"weekOf":"2025-12-08","count":1},{"weekOf":"2025-12-15","count":1},{"weekOf":"2025-12-22","count":2},{"weekOf":"2025-12-29","count":0},{"weekOf":"2026-01-05","count":3},{"weekOf":"2026-01-12","count":3},{"weekOf":"2026-01-19","count":2},{"weekOf":"2026-01-26","count":2},{"weekOf":"2026-02-02","count":1},{"weekOf":"2026-02-09","count":0}];
 const weeklyNextSteps = [{"weekOf":"2025-11-24","count":6},{"weekOf":"2025-12-01","count":3},{"weekOf":"2025-12-08","count":5},{"weekOf":"2025-12-15","count":5},{"weekOf":"2025-12-22","count":4},{"weekOf":"2025-12-29","count":2},{"weekOf":"2026-01-05","count":6},{"weekOf":"2026-01-12","count":6},{"weekOf":"2026-01-19","count":7},{"weekOf":"2026-01-26","count":5},{"weekOf":"2026-02-02","count":4},{"weekOf":"2026-02-09","count":5}];
 const currentWeek = 0;
 const priorWeek = 11;
 const discoveryTotal = 123;
 const followUpTotal = 15;
 const nextStepsTotal = 54;
 const avgPerWeek = ''10.2'';
 const trend = ''decreasing'';

 const trendColor = trend === ''increasing'' ? theme.accent : trend === ''decreasing'' ? theme.danger : theme.inkMuted;
 const trendLabel = trend === ''increasing'' ? ''\u25B2 Increasing'' : trend === ''decreasing'' ? ''\u25BC Decreasing'' : ''\u25C6 Flat'';

 const combined = weeklyData.map((d, i) => ({
 week: d.weekOf.substring(5),
 discovery: d.count,
 followUps: weeklyFollowUps[i] ? weeklyFollowUps[i].count : 0,
 nextSteps: weeklyNextSteps[i] ? weeklyNextSteps[i].count : 0,
 }));

 return (
 <MetricSection>
 <MetricRow>
 <StatCard label="This Week" value={currentWeek} subtitle="First-time discovery" trendDirection="flat" />
 <StatCard label="Prior Week" value={priorWeek} subtitle="First-time discovery" />
 <StatCard label="12-Week Total" value={discoveryTotal} subtitle={''Avg '' + avgPerWeek + ''/week''} />
 <StatCard label="Trend" value={trendLabel} subtitle={followUpTotal + '' follow-ups · '' + nextStepsTotal + '' next steps''} />
 </MetricRow>

 <div style={{ height: 300, background: theme.panel, borderRadius: 16, padding: 20, border: ''1px solid '' + theme.line }}>
 <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Weekly Discovery Calls (First-Time Only)</div>
 <ResponsiveContainer width="100%" height="90%">
 <BarChart data={combined} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
 <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
 <XAxis dataKey="week" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
 <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
 <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
 <Legend />
 <ReferenceLine y={10} stroke={theme.accent} strokeDasharray="4 2" label={{ value: ''Target (10)'', fill: theme.inkMuted, fontSize: 10, position: ''insideTopRight'' }} />
 <Bar dataKey="discovery" name="Discovery (1st time)" fill={theme.accent} radius={[4, 4, 0, 0]} />
 <Bar dataKey="followUps" name="Follow-ups" fill={theme.line} opacity={0.7} radius={[4, 4, 0, 0]} />
 <Bar dataKey="nextSteps" name="Next Steps" fill={theme.inkMuted} opacity={0.5} radius={[4, 4, 0, 0]} />
 </BarChart>
 </ResponsiveContainer>
 </div>

 <MetricNote>Source: David&apos;s calendar (david@kiingo.com) · Trailing 12 weeks · Interviews, workshops, follow-ups, and repeat-company calls excluded · Week of Feb 17 just started (0 so far)</MetricNote>
 </MetricSection>
 );
})()', 'completed', '2026-02-18T06:55:04.086079+00:00', '2026-02-18T06:58:21.683321+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('ff442421-0d31-4a93-8e93-18e7d331b546', 'e6bfcbb4-ac2e-480d-8b3d-431f6312551e', '{"activeCount": 42, "scheduledCount": 0, "officeHourCohorts": 42, "totalSessions": 315, "activeCohorts": [{"name": "DealNews Cohort 1", "instructor": "Isabelle"}, {"name": "DealNews Cohort 2", "instructor": "Isabelle"}, {"name": "DealNews Cohort 3", "instructor": "Isabelle"}, {"name": "Total Package HR", "instructor": "Isabelle"}, {"name": "SPMB Cohort 3", "instructor": "Isabelle"}, {"name": "02.04 Cohort", "instructor": "\u2014"}, {"name": "02.13.26 Cohort", "instructor": "\u2014"}, {"name": "02.25.26 Cohort", "instructor": "\u2014"}, {"name": "01.20.26 Cohort", "instructor": "\u2014"}, {"name": "01.05.26 Cohort", "instructor": "\u2014"}, {"name": "85C Bakery", "instructor": "\u2014"}, {"name": "Anderson Howard", "instructor": "\u2014"}, {"name": "Preservation Equity", "instructor": "James"}, {"name": "Heller Consulting", "instructor": "\u2014"}, {"name": "DMT Law Firm", "instructor": "\u2014"}, {"name": "Cush Plaza Properties", "instructor": "\u2014"}, {"name": "Gibbs Construction", "instructor": "\u2014"}, {"name": "SVN", "instructor": "\u2014"}, {"name": "Phoenix Manufacturing", "instructor": "\u2014"}, {"name": "Immatics 1", "instructor": "\u2014"}, {"name": "Immatics 2", "instructor": "\u2014"}, {"name": "InOvate", "instructor": "\u2014"}, {"name": "Netgain", "instructor": "\u2014"}, {"name": "Parron Hall", "instructor": "\u2014"}, {"name": "Partner4Work", "instructor": "\u2014"}, {"name": "Sadoff", "instructor": "\u2014"}, {"name": "Scimitar", "instructor": "\u2014"}, {"name": "10 Fitness", "instructor": "\u2014"}, {"name": "Total Environmental Mgmt", "instructor": "\u2014"}, {"name": "True Movement Tech", "instructor": "\u2014"}, {"name": "Tarlton", "instructor": "\u2014"}, {"name": "Statewide PA", "instructor": "\u2014"}, {"name": "Anglepoint", "instructor": "\u2014"}, {"name": "Citadel CPM", "instructor": "\u2014"}, {"name": "Nolan Consulting", "instructor": "\u2014"}, {"name": "12.02 Marketing", "instructor": "\u2014"}, {"name": "12.05 Cohort", "instructor": "\u2014"}, {"name": "12.12 Cohort", "instructor": "\u2014"}, {"name": "12.18 Cohort", "instructor": "\u2014"}, {"name": "11.19 Cohort", "instructor": "\u2014"}, {"name": "01.14.26 Cohort", "instructor": "\u2014"}, {"name": "01.26.26 Agents", "instructor": "\u2014"}], "scheduledCohorts": [], "weeklyDensity": [{"week": "2/17", "sessions": 52}, {"week": "2/24", "sessions": 48}, {"week": "3/2", "sessions": 45}, {"week": "3/9", "sessions": 42}, {"week": "3/16", "sessions": 38}, {"week": "3/23", "sessions": 35}, {"week": "3/30", "sessions": 30}, {"week": "4/6", "sessions": 25}]}', '(() => {
  const activeCount = 42;
  const scheduledCount = 0;
  const officeHourCohorts = 42;
  const totalSessions = 315;
  const activeCohorts = [{"name": "DealNews Cohort 1", "instructor": "Isabelle"}, {"name": "DealNews Cohort 2", "instructor": "Isabelle"}, {"name": "DealNews Cohort 3", "instructor": "Isabelle"}, {"name": "Total Package HR", "instructor": "Isabelle"}, {"name": "SPMB Cohort 3", "instructor": "Isabelle"}, {"name": "02.04 Cohort", "instructor": "\u2014"}, {"name": "02.13.26 Cohort", "instructor": "\u2014"}, {"name": "02.25.26 Cohort", "instructor": "\u2014"}, {"name": "01.20.26 Cohort", "instructor": "\u2014"}, {"name": "01.05.26 Cohort", "instructor": "\u2014"}, {"name": "85C Bakery", "instructor": "\u2014"}, {"name": "Anderson Howard", "instructor": "\u2014"}, {"name": "Preservation Equity", "instructor": "James"}, {"name": "Heller Consulting", "instructor": "\u2014"}, {"name": "DMT Law Firm", "instructor": "\u2014"}, {"name": "Cush Plaza Properties", "instructor": "\u2014"}, {"name": "Gibbs Construction", "instructor": "\u2014"}, {"name": "SVN", "instructor": "\u2014"}, {"name": "Phoenix Manufacturing", "instructor": "\u2014"}, {"name": "Immatics 1", "instructor": "\u2014"}, {"name": "Immatics 2", "instructor": "\u2014"}, {"name": "InOvate", "instructor": "\u2014"}, {"name": "Netgain", "instructor": "\u2014"}, {"name": "Parron Hall", "instructor": "\u2014"}, {"name": "Partner4Work", "instructor": "\u2014"}, {"name": "Sadoff", "instructor": "\u2014"}, {"name": "Scimitar", "instructor": "\u2014"}, {"name": "10 Fitness", "instructor": "\u2014"}, {"name": "Total Environmental Mgmt", "instructor": "\u2014"}, {"name": "True Movement Tech", "instructor": "\u2014"}, {"name": "Tarlton", "instructor": "\u2014"}, {"name": "Statewide PA", "instructor": "\u2014"}, {"name": "Anglepoint", "instructor": "\u2014"}, {"name": "Citadel CPM", "instructor": "\u2014"}, {"name": "Nolan Consulting", "instructor": "\u2014"}, {"name": "12.02 Marketing", "instructor": "\u2014"}, {"name": "12.05 Cohort", "instructor": "\u2014"}, {"name": "12.12 Cohort", "instructor": "\u2014"}, {"name": "12.18 Cohort", "instructor": "\u2014"}, {"name": "11.19 Cohort", "instructor": "\u2014"}, {"name": "01.14.26 Cohort", "instructor": "\u2014"}, {"name": "01.26.26 Agents", "instructor": "\u2014"}];
  const scheduledCohorts = [];
  const weeklyDensity = [{"week": "2/17", "sessions": 52}, {"week": "2/24", "sessions": 48}, {"week": "3/2", "sessions": 45}, {"week": "3/9", "sessions": 42}, {"week": "3/16", "sessions": 38}, {"week": "3/23", "sessions": 35}, {"week": "3/30", "sessions": 30}, {"week": "4/6", "sessions": 25}];

  return (
    <MetricSection>
      <MetricRow>
        <StatCard label={''Active''} value={activeCount} subtitle={''Underway now''} />
        <StatCard label={''Scheduling''} value={scheduledCount} subtitle={''Being set up''} />
        <StatCard label={''OH Cohorts''} value={officeHourCohorts} subtitle={''With office hours''} />
        <StatCard label={''OH Sessions''} value={totalSessions} subtitle={''Next 60 days''} />
      </MetricRow>

      <div style={{ height: 220, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
        <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, color: theme.ink }}>Weekly Office Hours Density</div>
        <ResponsiveContainer width="100%" height="85%">
          <BarChart data={weeklyDensity} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
            <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
            <XAxis dataKey="week" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <YAxis stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
            <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} />
            <Bar dataKey="sessions" name="OH Sessions" fill={theme.accent} radius={[4, 4, 0, 0]} />
          </BarChart>
        </ResponsiveContainer>
      </div>

      <div style={{ display: ''grid'', gridTemplateColumns: ''1fr 1fr'', gap: 16, marginTop: 16 }}>
        <div style={{ background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line }}>
          <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 12, color: theme.ink }}>Active Cohorts</div>
          <div style={{ display: ''flex'', flexDirection: ''column'', gap: 6 }}>
            {activeCohorts.map((c, i) => (
              <div key={i} style={{ display: ''flex'', justifyContent: ''space-between'', alignItems: ''center'', padding: ''6px 12px'', borderRadius: 8, background: theme.accent + ''0a'', border: ''1px solid '' + theme.line }}>
                <span style={{ fontSize: 12, fontWeight: 600, color: theme.ink }}>{c.name}</span>
                <span style={{ fontSize: 11, color: theme.inkMuted }}>{c.instructor}</span>
              </div>
            ))}
          </div>
        </div>
        <div style={{ background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line }}>
          <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 12, color: theme.ink }}>Scheduling Pipeline</div>
          <div style={{ display: ''flex'', flexDirection: ''column'', gap: 6 }}>
            {scheduledCohorts.map((c, i) => (
              <div key={i} style={{ display: ''flex'', justifyContent: ''space-between'', alignItems: ''center'', padding: ''6px 12px'', borderRadius: 8, background: ''#eab308'' + ''0a'', border: ''1px solid '' + theme.line }}>
                <span style={{ fontSize: 12, fontWeight: 600, color: theme.ink }}>{c.name}</span>
                <span style={{ fontSize: 11, color: theme.inkMuted }}>{c.instructor}</span>
              </div>
            ))}
          </div>
        </div>
      </div>

      <MetricNote>Source: Asana Ops board + Microsoft Calendar office hours</MetricNote>
    </MetricSection>
  );
})()', 'completed', '2026-02-19T05:43:41+00:00', '2026-02-19T05:43:41+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('8a64b74d-c0fb-42e1-adbc-094ef1f6a0f7', 'eac7d43a-5003-48aa-9165-fc869d8597f2', '{"ltmRevenue":1949261.97,"momGrowth":-27.38,"netMargin":34.47,"openPipeline":1895070,"trailing3Avg":160779.95,"winRate":37.76}', '(() => { const ltmRevenue = 1949261.97; const openPipeline = 1895070; const winRate = 37.76; const netMargin = 34.47; const momGrowth = -27.38; return ( <MetricSection> <MetricRow> <StatCard label="LTM Revenue" value={''$'' + (ltmRevenue / 1000).toFixed(0) + ''K''} subtitle="Invoiced (12 mo)" trend={momGrowth.toFixed(1) + ''% MoM''} trendDirection="down" /> <StatCard label="Open Pipeline" value={''$'' + (openPipeline / 1000).toFixed(0) + ''K''} subtitle="Active deals" /> <StatCard label="Win Rate" value={winRate.toFixed(1) + ''%''} subtitle="Closed won / total" /> <StatCard label="Net Margin" value={netMargin.toFixed(1) + ''%''} subtitle="LTM accrual" /> </MetricRow> </MetricSection> ); })()', 'completed', '2026-02-16T16:16:54.131503+00:00', '2026-02-16T16:22:03.839053+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('8cde9fee-a00c-42d3-aecc-30d0f52cb031', 'ebc99ea9-2609-4b9c-bcf0-71d191cae36a', '{"avgDealSize": 3783, "avgDaysToClose": 12, "pipelineCoverage": 3.9, "dealsClosedLTM": 415}', '(() => {
  const avgSize = 3783;
  const avgDays = 12;
  const coverage = 3.9;
  const closedLTM = 415;
  return (
    <MetricSection>
      <MetricRow>
        <StatCard label="Avg Deal Size" value={''$'' + (avgSize / 1000).toFixed(1) + ''K''} subtitle="Closed won" />
        <StatCard label="Days to Close" value={avgDays} subtitle="Average" />
      </MetricRow>
      <MetricRow>
        <StatCard label="Pipeline Coverage" value={coverage.toFixed(1) + ''x''} subtitle="vs quarterly run rate" />
        <StatCard label="Deals Won (LTM)" value={closedLTM} subtitle="Last 12 months" />
      </MetricRow>
    </MetricSection>
  );
})()', 'completed', '2026-02-15T06:29:29+00:00', '2026-02-15T06:29:29+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('6e507000-9a2a-4a08-8a93-05054d8dbeb2', 'f90cc540-c123-44eb-a2e3-20df6049db9b', '{"arBalance":151268,"ltmCollectionRate":92.9,"monthlyData":[{"collected":84150,"invoiced":87650,"month":"Feb ''25","rate":96},{"collected":151123,"invoiced":190174,"month":"Mar ''25","rate":79.5},{"collected":117289,"invoiced":106283,"month":"Apr ''25","rate":100},{"collected":107693,"invoiced":125354,"month":"May ''25","rate":85.9},{"collected":126010,"invoiced":139671,"month":"Jun ''25","rate":90.2},{"collected":159150,"invoiced":98864,"month":"Jul ''25","rate":100},{"collected":89494,"invoiced":114698,"month":"Aug ''25","rate":78},{"collected":146281,"invoiced":263725,"month":"Sep ''25","rate":55.5},{"collected":191140,"invoiced":197685,"month":"Oct ''25","rate":96.7},{"collected":204403,"invoiced":206919,"month":"Nov ''25","rate":98.8},{"collected":207654,"invoiced":120579,"month":"Dec ''25","rate":100},{"collected":135066,"invoiced":199568,"month":"Jan ''26","rate":67.7}]}', '(() => {
 const data = [
 {month:"Feb ''25",invoiced:87650,collected:84150,rate:96},
 {month:"Mar ''25",invoiced:190174,collected:151123,rate:79.5},
 {month:"Apr ''25",invoiced:106283,collected:117289,rate:100},
 {month:"May ''25",invoiced:125354,collected:107693,rate:85.9},
 {month:"Jun ''25",invoiced:139671,collected:126010,rate:90.2},
 {month:"Jul ''25",invoiced:98864,collected:159150,rate:100},
 {month:"Aug ''25",invoiced:114698,collected:89494,rate:78},
 {month:"Sep ''25",invoiced:263725,collected:146281,rate:55.5},
 {month:"Oct ''25",invoiced:197685,collected:191140,rate:96.7},
 {month:"Nov ''25",invoiced:206919,collected:204403,rate:98.8},
 {month:"Dec ''25",invoiced:120579,collected:207654,rate:100},
 {month:"Jan ''26",invoiced:199568,collected:135066,rate:67.7}
 ];
 const ltmRate = 92.9;
 const ar = 151268;
 return (
 <MetricSection>
 <MetricRow>
 <StatCard label="LTM Collection Rate" value={ltmRate.toFixed(1) + ''%''} subtitle="Last 12 months" trendDirection="up" />
 <StatCard label="Outstanding AR" value={''$'' + (ar / 1000).toFixed(0) + ''K''} subtitle="Uncollected balance" />
 <StatCard label="Months Below 80%" value="3" subtitle="Mar, Aug, Sep ''25" trendDirection="down" />
 </MetricRow>
 <div style={{ height: 280, background: theme.panel, borderRadius: 16, padding: ''16px 20px'', border: ''1px solid '' + theme.line, marginTop: 8 }}>
 <ResponsiveContainer width="100%" height="100%">
 <ComposedChart data={data} margin={{ top: 10, right: 36, left: 0, bottom: 0 }}>
 <CartesianGrid strokeDasharray="3 3" stroke={theme.gridStroke} />
 <XAxis dataKey="month" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} />
 <YAxis yAxisId="left" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} tickFormatter={v => ''$'' + (v/1000).toFixed(0) + ''K''} />
 <YAxis yAxisId="right" orientation="right" stroke={theme.axisStroke} tick={{ fill: theme.inkMuted, fontSize: 11 }} tickFormatter={v => v + ''%''} domain={[0, 100]} />
 <Tooltip contentStyle={{ background: theme.tooltipBg, border: ''1px solid '' + theme.tooltipBorder, color: theme.tooltipText, borderRadius: 8, fontSize: 13 }} formatter={(value, name) => name === ''Collection %'' ? [value.toFixed(1) + ''%'', name] : [''$'' + value.toLocaleString(), name]} />
 <Legend wrapperStyle={{ fontSize: 12, color: theme.inkMuted }} />
 <ReferenceLine yAxisId="right" y={80} stroke={theme.danger} strokeDasharray="4 4" label={{ value: ''80% floor'', fill: theme.danger, fontSize: 10, position: ''insideTopRight'' }} />
 <Bar yAxisId="left" dataKey="invoiced" name="Invoiced" fill={theme.accent} radius={[4,4,0,0]} opacity={0.5} />
 <Bar yAxisId="left" dataKey="collected" name="Collected" fill={theme.accentStrong} radius={[4,4,0,0]} />
 <Line yAxisId="right" type="monotone" dataKey="rate" name="Collection %" stroke={theme.danger} strokeWidth={2} dot={{ r: 3 }} />
 </ComposedChart>
 </ResponsiveContainer>
 </div>
 <MetricNote>⚠️ Flagged below 80%: Mar ''25 (79.5%), Aug ''25 (78.0%), Sep ''25 (55.5%). Jan ''26 excluded as prior month still collecting. LTM totals: $1.85M invoiced · $1.72M collected.</MetricNote>
 </MetricSection>
 );
})()', 'completed', '2026-02-18T23:10:49.492171+00:00', '2026-02-18T23:13:41.973436+00:00');
INSERT OR REPLACE INTO metric_snapshots (id, metric_id, values_json, rendered_html, status, created_at, completed_at) VALUES ('6f58ac65-9d71-45d1-bfed-3890d3181e9d', 'fca4c412-05b2-44e4-b523-cc3947b52328', '{"activeBootcamps":2,"upcomingBootcamps":3,"completedBootcamps":26,"totalParticipants":2157,"bootcampRevenue":680000,"companyBootcamps":21}', '(() => {
  const active = 2;
  const upcoming = 3;
  const completed = 26;
  const participants = 2157;
  const revenue = 680000;
  const companyBc = 21;
  return (
    <MetricSection>
      <MetricRow>
        <StatCard label="Active" value={active} subtitle="Running now" />
        <StatCard label="Upcoming" value={upcoming} subtitle="In setup" />
        <StatCard label="Completed" value={completed} subtitle="Cohorts finished" />
      </MetricRow>
      <MetricRow>
        <StatCard label="Total Trained" value={participants.toLocaleString()} subtitle="All participants" />
        <StatCard label="Company Bootcamps" value={companyBc} subtitle="Private clients" />
        <StatCard label="Bootcamp Revenue" value={String.fromCharCode(36) + (revenue / 1000).toFixed(0) + String.fromCharCode(75)} subtitle="LTM estimate" />
      </MetricRow>
    </MetricSection>
  );
})()', 'completed', '2026-02-15T06:34:11+00:00', '2026-02-15T06:30:00+00:00');

-- ============================================
-- Settings (app config, nav order, migrations)
-- ============================================

INSERT OR REPLACE INTO settings (key, value_json, updated_at) VALUES ('app', '{"codexPath":"codex","claudePath":"claude","conversationThreadsV1":true,"retentionDays":90,"maxStorageMb":1024,"allowAdvancedPolicy":false,"remoteTelemetryOptIn":false,"redactAggressive":true,"storeEncryptedRawArtifacts":false,"navOrder":{"groupOrder":["overview","ceo-training","workspace","business","departments","team","clients","path1","path2","ai-agent","system"],"itemOrder":{"ai-agent":["chat","composer","live","history","queue"],"business":["growth","revenue","efficiency","pipeline","leads-gtm"],"ceo-training":["ceo-training","ceo-principles"],"clients":["client-roi","client-journey","client-health"],"departments":["dept-marketing","dept-engineering","dept-operations","sub:sales"],"overview":["dashboard"],"path1":["path1-bootcamps","path1-champions","path1-accelerator"],"path2":["path2-pipeline","path2-deployed","path2-fde"],"sub:principles":["coo-principles","cmo-principles","cro-principles","cto-principles","cfo-principles","cpo-principles","cco-principles","chro-principles"],"sub:sales":["dept-sales","discovery-calls","follow-up-calls"],"system":["settings","profiles","compatibility","metric-admin"],"team":["team-scorecard","team-rocks","sub:principles"],"workspace":["notepad","tasks"]}}}', '2026-02-17T18:49:15.879218+00:00');
INSERT OR REPLACE INTO settings (key, value_json, updated_at) VALUES ('migration:conversation_threads_v1', '{"completedAt":"2026-02-13T21:05:56.690346+00:00","strategy":"one-run-per-conversation"}', '2026-02-13T21:05:56.690395+00:00');
INSERT OR REPLACE INTO settings (key, value_json, updated_at) VALUES ('migration:grid_rowheight_v2', '"done"', '2026-02-14T23:49:07.612729+00:00');
INSERT OR REPLACE INTO settings (key, value_json, updated_at) VALUES ('migration:screen_metrics_multi_widget', '"done"', '2026-02-15T01:57:43.452153+00:00');

-- ============================================
-- Workspace Grants
-- ============================================

INSERT OR REPLACE INTO workspace_grants (id, path, granted_by, granted_at, revoked_at) VALUES ('320f986c-cdfb-45b9-901c-4611d48d96eb', '/Users/rosshartmann/Projects/kiingo-command-center', 'bootstrap', '2026-02-13T01:02:10.679422+00:00', NULL);
